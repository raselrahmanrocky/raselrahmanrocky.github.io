<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bangla Toolbox</title>
	<link rel="icon" type="image/png" href="https://mdsifatgitid.github.io/converticon.png">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/easyqrcodejs@4.4.13/dist/easy.qrcode.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>

    <style>
        /* Custom font and basic styles */
        /* SUTONNYMJ ফন্টটি লোড করার জন্য @font-face ব্যবহার করা হয়েছে। */
        /* মোবাইল ডিভাইসে দ্রুত এবং নির্ভরযোগ্য লোডিং নিশ্চিত করতে jsDelivr CDN ব্যবহার করা হয়েছে। */
        @font-face {
            font-family: 'SUTONNYMJ';
            src: url('https://cdn.jsdelivr.net/gh/mdsifatgitid/mdsifatgitid.github.io/SUTONNYMJ.TTF') format('truetype');
            font-weight: normal;
            font-style: normal;
        }
/* নতুন ফন্ট সেকশন শুরু */
/* 'Bornomala' ফন্টটি লোড করার জন্য @font-face যুক্ত করা হয়েছে। */
/* পরিবর্তন: GitHub-এর সরাসরি লিংকের পরিবর্তে jsDelivr CDN ব্যবহার করা হয়েছে। */
/* এটি সব ডিভাইসে, বিশেষ করে মোবাইলে, ফন্টটি সঠিকভাবে লোড হতে সাহায্য করবে। */
@font-face {
    font-family: 'Bornomala';
    src: url('https://cdn.jsdelivr.net/gh/mdsifatgitid/mdsifatgitid.github.io/Bornomala-Regular.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
}
/* নতুন ফন্ট সেকশন শেষ */
/* Preloader Styles (পরিবর্তিত) */
#preloader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #000000;
    z-index: 9999;
    display: flex;
    flex-direction: column; /* ছবি এবং লেখাকে উল্লম্বভাবে সাজানোর জন্য এই লাইনটি যোগ করা হয়েছে */
    justify-content: center;
    align-items: center;
    transition: opacity 1.5s ease, visibility 1.5s ease;
}

/* নতুন: প্রি-লোডার ছবির জন্য স্টাইল */
#preloader-image {
    width: 120px;
    height: 120px;
    border-radius: 50%; /* গোলাকার ছবির জন্য */
    object-fit: cover;
    margin-bottom: 20px; /* লেখা থেকে ছবির দূরত্ব */
    border: 3px solid #fff; /* একটি সাদা বর্ডার দেওয়া হয়েছে */
    opacity: 0;
    /* লেখার মতো ছবির জন্যও একই অ্যানিমেশন যোগ করা হয়েছে */
    animation: animate-name 3.5s ease-out forwards;
}

#preloader.preloader-hidden {
    opacity: 0;
    visibility: hidden;
}

#preloader-name {
    color: white;
    font-size: 2.5rem;
    font-weight: bold;
    opacity: 0;
    animation: animate-name 3.5s ease-out forwards;
    text-align: center;
}

@keyframes animate-name {
    0% {
        opacity: 0;
        transform: scale(0.8);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}
        
        @keyframes fadeInContent {
            from { opacity: 0; }
            to { opacity: 1; }
        }


        /* Animated Background Styles */
        .area {
            background: #e0f2f7;
            background: -webkit-linear-gradient(to left, #e0f2f7, #d2eaf1);
            width: 100%;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            z-index: -1;
        }
        /* ডার্ক মোডে অ্যানিমেটেড ব্যাকগ্রাউন্ড পরিবর্তন */
        .dark .area {
             background: #1a202c; /* গাঢ় নীল-ধূসর */
             background: -webkit-linear-gradient(to left, #2d3748, #1a202c);
        }


        .circles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .circles li {
            position: absolute;
            display: block;
            list-style: none;
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.4);
            animation: animate-bg 25s linear infinite;
            bottom: -150px;
        }
        /* ডার্ক মোডে বৃত্তের রঙ পরিবর্তন */
        .dark .circles li {
            background: rgba(255, 255, 255, 0.1);
        }


        .circles li:nth-child(1) { left: 25%; width: 80px; height: 80px; animation-delay: 0s; }
        .circles li:nth-child(2) { left: 10%; width: 20px; height: 20px; animation-delay: 2s; animation-duration: 12s; }
        .circles li:nth-child(3) { left: 70%; width: 20px; height: 20px; animation-delay: 4s; }
        .circles li:nth-child(4) { left: 40%; width: 60px; height: 60px; animation-delay: 0s; animation-duration: 18s; }
        .circles li:nth-child(5) { left: 65%; width: 20px; height: 20px; animation-delay: 0s; }
        .circles li:nth-child(6) { left: 75%; width: 110px; height: 110px; animation-delay: 3s; }
        .circles li:nth-child(7) { left: 35%; width: 150px; height: 150px; animation-delay: 7s; }
        .circles li:nth-child(8) { left: 50%; width: 25px; height: 25px; animation-delay: 15s; animation-duration: 45s; }
        .circles li:nth-child(9) { left: 20%; width: 15px; height: 15px; animation-delay: 2s; animation-duration: 35s; }
        .circles li:nth-child(10) { left: 85%; width: 150px; height: 150px; animation-delay: 0s; animation-duration: 11s; }

        @keyframes animate-bg {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
                border-radius: 0;
            }
            100% {
                transform: translateY(-1000px) rotate(720deg);
                opacity: 0;
                border-radius: 50%;
            }
        }

		/* body ট্যাগের font-family পরিবর্তন করে Bornomala ফন্টটিকে প্রধান ফন্ট হিসেবে সেট করা হয়েছে। */
			body {
			font-family: 'Bornomala', 'Inter', 'Hind Siliguri', sans-serif;
			display: flex;
			justify-content: center; /* অনুভূমিকভাবে মাঝখানে রাখার জন্য */
			align-items: flex-start;     /* উল্লম্বভাবে ওপরে অ্যালাইন করার জন্য (স্ক্রোলের জন্য গুরুত্বপূর্ণ) */
			min-height: 100vh;
			background-color: transparent; /* অ্যানিমেটেড ব্যাকগ্রাউন্ডের জন্য স্বচ্ছ করা হয়েছে */
			padding: 5px 5px; /* ওপরে এবং নিচে প্যাডিং বাড়ানো হয়েছে */
			}

        .main-container {
            background-color: rgba(255, 255, 255, 0.85); /* Slightly transparent white */
            backdrop-filter: blur(10px); /* Frosted glass effect */
            -webkit-backdrop-filter: blur(10px);
            padding: 10px; /* বর্ধিত প্যাডিং */
            border-radius: 20px; /* গোলাকার কোণ */
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15); /* গভীর ছায়া */
            max-width: 1000px; /* সমস্ত কন্টেন্টের জন্য বর্ধিত সর্বোচ্চ প্রস্থ */
            width: 100%; /* প্রতিক্রিয়াশীল প্রস্থ */
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            visibility: hidden; /* Initially hidden */
        }
        .dark .main-container {
            background-color: rgba(26, 32, 44, 0.85); /* গাঢ় ব্যাকগ্রাউন্ড */
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        /* নতুন: থিম টগল বাটন */
        .theme-toggle-container {
            display: flex;
            align-items: center;
        }
        .theme-toggle-button {
            background-color: #e0e7ff;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            padding: 8px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .dark .theme-toggle-button {
            background-color: #4a5568;
        }
        .theme-toggle-button:hover {
            transform: scale(1.1);
        }
        .theme-toggle-button svg {
            width: 24px;
            height: 24px;
            color: #3f51b5;
        }
        .dark .theme-toggle-button svg {
            color: #f7fafc;
        }
        #moon-icon { display: none; }
        .dark #sun-icon { display: none; }
        .dark #moon-icon { display: block; }


        .tab-buttons {
            display: flex;
            justify-content: center;
            align-items: center; /* উল্লম্বভাবে কেন্দ্র করার জন্য যোগ করা হয়েছে */
            margin-bottom: 5px; /* বর্ধিত মার্জিন */
            gap: 8px; /* বর্ধিত ফাঁক */
            flex-wrap: wrap; /* ছোট স্ক্রিনে ট্যাবগুলি মোড়ানো */
        }

        .tab-button {
            padding: 10px 16px; /* বর্ধিত প্যাডিং */
            background-color: #e0e7ff; /* হালকা নীল */
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem; /* সামঞ্জস্যপূর্ণ ফন্ট সাইজ */
            font-weight: 600;
            color: #3f51b5; /* গাঢ় নীল টেক্সট */
            transition: background-color 0.3s ease, transform 0.2s ease;
        }
        .dark .tab-button {
            background-color: #2d3748;
            color: #cbd5e0;
        }

        .tab-button.active {
            background-color: #3f51b5; /* সক্রিয় ট্যাবের রঙ (গভীর নীল) */
            color: white;
            box-shadow: 0 4px 8px rgba(63, 81, 181, 0.3);
            transform: translateY(-2px);
        }
        .dark .tab-button.active {
            background-color: #4c51bf;
            color: #f7fafc;
        }

        .tab-button:hover:not(.active) {
            background-color: #c5cae9; /* হোভারে হালকা নীল */
            transform: translateY(-1px);
        }
        .dark .tab-button:hover:not(.active) {
            background-color: #4a5568;
        }

        /* মৌলিক ক্যালকুলেটর স্টাইল */
        .basic-calculator-wrapper {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: stretcht; 
            gap: 20px;
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr); /* 4 কলাম, সমান প্রস্থ */
            grid-template-rows: minmax(100px, auto) repeat(5, 1fr); /* ডিসপ্লে এবং 5 সারি বোতাম */
            gap: 10px; /* বোতামগুলির মধ্যে ফাঁক */
            padding: 20px; /* বর্ধিত প্যাডিং */
            border-radius: 20px; /* গোলাকার কোণ */
            background-color: #263238; /* গাঢ় ধূসর/নীল ক্যালকুলেটর ব্যাকগ্রাউন্ড */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3); /* ছায়া */
            /* margin: 0 auto; Removed as parent flex handles centering */
            max-width: 380px; /* মৌলিক ক্যালকুলেটরের জন্য বর্ধিত প্রস্থ */
        }
        .output {
            grid-column: 1 / -1; /* ডিসপ্লে পূর্ণ প্রস্থ জুড়ে বিস্তৃত */
            background-color: #1c262b; /* ডিসপ্লে ব্যাকগ্রাউন্ড */
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            justify-content: space-around;
            padding: 12px; /* বর্ধিত প্যাডিং */
            border-radius: 12px; /* ডিসপ্লের জন্য গোলাকার কোণ */
            margin-bottom: 8px; /* বর্ধিত মার্জিন */
            height: 100px; /* বর্ধিত নির্দিষ্ট উচ্চতা */
            word-wrap: break-word; /* দীর্ঘ সংখ্যা ভাঙুন */
            word-break: break-all; /* দীর্ঘ সংখ্যা ভাঙুন */
            box-sizing: border-box; /* উচ্চতায় প্যাডিং এবং বর্ডার অন্তর্ভুক্ত করুন */
        }
        .output .previous-operand {
            color: rgba(255, 255, 255, 0.6); /* পূর্ববর্তী অপারেশনের রঙ */
            font-size: 1.5rem; /* বর্ধিত ফন্ট সাইজ */
            word-wrap: break-word; /* দীর্ঘ সংখ্যা ভাঙুন */
            word-break: break-all; /* দীর্ঘ সংখ্যা ভাঙুন */
            align-self: flex-end; /* ডানদিকে সারিবদ্ধ করুন */
            max-width: 100%; /* নিশ্চিত করুন যে এটি তার কন্টেইনারের বাইরে না যায় */
        }
        .output .current-operand {
            color: white; /* বর্তমান অপারেশনের রঙ */
            font-size: 2.8rem; /* ফন্ট সাইজ কমানো হয়েছে */
            word-wrap: break-word; /* দীর্ঘ সংখ্যা ভাঙুন */
            word-break: break-all; /* দীর্ঘ সংখ্যা ভাঙুন */
            align-self: flex-end; /* ডানদিকে সারিবদ্ধ করুন */
            max-width: 100%; /* নিশ্চিত করুন যে এটি তার কন্টেইনারের বাইরে না যায় */
        }
        .calculator-button {
            cursor: pointer;
            font-size: 1.6rem; /* বর্ধিত ফন্ট সাইজ */
            border: none;
            outline: none;
            background-color: #455a64; /* বোতামের ব্যাকগ্রাউন্ড (নীল-ধূসর) */
            color: white; /* বোতামের টেক্সট রঙ */
            border-radius: 10px; /* বোতামগুলির জন্য গোলাকার কোণ */
            transition: background-color 0.2s ease-in-out, transform 0.1s ease; /* হোভার প্রভাব */
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .calculator-button:hover {
            background-color: #546e7a; /* হোভারে ব্যাকগ্রাউন্ড */
            transform: translateY(-1px);
        }
        .operator {
            background-color: #007bff; /* নীল অপারেটর বোতামের রঙ */
        }
        .operator:hover {
            background-color: #0056b3; /* নীল অপারেটর হোভার রঙ */
        }
        .equals {
            background-color: #007bff; /* ইকুয়ালস বোতামের রঙ (নীল) */
        }
        .equals:hover {
            background-color: #0056b3; /* ইকুয়ালস বোতাম হোভার রঙ (গাঢ় নীল) */
        }
        .clear {
            grid-column: span 2; /* ক্লিয়ার বোতাম দুটি কলাম জুড়ে বিস্তৃত */
            background-color: #ef5350; /* লাল ক্লিয়ার বোতামের রঙ */
            color: white; /* ক্লিয়ার বোতামের টেক্সট রঙ */
        }
        .clear:hover {
            background-color: #d32f2f; /* লাল ক্লিয়ার বোতাম হোভার রঙ */
        }
        .zero {
            grid-column: span 2; /* জিরো বোতাম দুটি কলাম জুড়ে বিস্তৃত */
        }
        
        /* নতুন: হিস্টোরি প্যানেল স্টাইল */
        .history-panel {
            background-color: #263238;
            color: white;
            padding: 20px;
            border-radius: 20px;
            width: 100%;
            max-width: 300px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }
        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #455a64;
            padding-bottom: 10px;
        }
        .history-header h3 {
            font-size: 1.2rem;
            font-weight: 600;
        }
        #clearHistoryBtn {
            background-color: #ef5350;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background-color 0.2s ease;
        }
        #clearHistoryBtn:hover {
            background-color: #d32f2f;
        }
        #history-list {
            height: 350px;
            overflow-y: auto;
            list-style: none;
            padding: 0;
            margin: 0;
            text-align: right;
        }
        #history-list li {
            padding: 8px 5px;
            border-bottom: 1px solid #37474f;
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.8);
        }
        #history-list li:last-child {
            border-bottom: none;
        }

        /* ব্যাখ্যা বোতামের জন্য নতুন স্টাইল */
        .explain-button {
            background-color: #28a745; /* সবুজ */
            color: white;
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: 10px;
            margin-top: 15px;
            margin-bottom: 5px;
            display: block; /* ব্লক লেভেল উপাদান হিসাবে সেট করুন */
            margin-left: auto; /* কেন্দ্র করার জন্য */
            margin-right: auto; /* কেন্দ্র করার জন্য */
            width: fit-content; /* কন্টেন্টের আকারের সাথে প্রস্থ সামঞ্জস্য করুন */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .explain-button:hover {
            background-color: #218838;
        }

        /* বয়স ক্যালকুলেটর স্টাইল */
        .age-calculator-content {
            padding: 20px; /* বর্ধিত প্যাডিং */
            border-radius: 16px;
            margin: 0 auto;
            max-width: 400px; /* বয়স ক্যালকুলেটরের জন্য বর্ধিত প্রস্থ */
            background-color: #f8f9fa; /* হালকা ধূসর ব্যাকগ্রাউন্ড */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .age-calculator-content {
            background-color: #2d3748;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
        }
        .age-calculator-content .input-group {
            margin-bottom: 20px; /* বর্ধিত মার্জিন */
            text-align: left;
        }
        .age-calculator-content .input-group label {
            display: block;
            margin-bottom: 8px; /* বর্ধিত মার্জিন */
            font-size: 1.05rem; /* বর্ধিত ফন্ট সাইজ */
            color: #333;
            font-weight: 600;
        }
        .dark .age-calculator-content .input-group label {
            color: #e2e8f0;
        }

        .age-calculator-content .input-group input[type="date"],
        .age-calculator-content .input-group input[type="number"] {
            width: 100%;
            padding: 12px; /* বর্ধিত প্যাডিং */
            border: 1px solid #cce7ff; /* হালকা নীল বর্ডার */
            border-radius: 10px;
            font-size: 1rem; /* বর্ধিত ফন্ট সাইজ */
            box-sizing: border-box; /* প্রস্থে প্যাডিং এবং বর্ডার অন্তর্ভুক্ত করুন */
            cursor: pointer;
            background-color: #eaf6ff; /* হালকা নীল ইনপুট ব্যাকগ্রাউন্ড */
            color: #333;
        }
        .dark .age-calculator-content .input-group input[type="date"],
        .dark .age-calculator-content .input-group input[type="number"] {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .age-calculator-content .input-group input[type="date"] {
             appearance: none; /* ডিফল্ট তারিখ ইনপুট স্টাইলিং সরান */
            -webkit-appearance: none;
        }
        .age-calculator-content .calculate-button {
            background-color: #007bff; /* নীল বোতাম */
            color: white;
            padding: 14px 25px; /* বর্ধিত প্যাডিং */
            border: none;
            border-radius: 10px;
            font-size: 1.15rem; /* বর্ধিত ফন্ট সাইজ */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            width: 100%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .age-calculator-content .calculate-button:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
        }
        .age-calculator-content .result-area {
            margin-top: 25px; /* বর্ধিত মার্জিন */
            padding: 20px; /* বর্ধিত প্যাডিং */
            background-color: #e6f7ff; /* ফলাফলের জন্য হালকা নীল ব্যাকগ্রাউন্ড */
            border-radius: 16px;
            border: 1px solid #b3e0ff;
            min-height: 80px; /* বর্ধিত উচ্চতা */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .dark .age-calculator-content .result-area {
            background-color: #1a202c;
            border-color: #4a5568;
        }

        .age-calculator-content .result-area p {
            font-size: 1.3rem; /* বর্ধিত ফন্ট সাইজ */
            color: #0056b3;
            font-weight: 700;
            margin: 5px 0; /* সামঞ্জস্যপূর্ণ মার্জিন */
        }
        .dark .age-calculator-content .result-area p {
            color: #90cdf4;
        }

        .age-calculator-content .result-area .error-message {
            color: #d9534f; /* ত্রুটি বার্তার জন্য লাল */
            font-size: 1rem; /* বর্ধিত ফন্ট সাইজ */
            font-weight: 500;
        }
        
        /* বছর ক্যালকুলেটরের ফলাফলের জন্য স্টাইল */
        #yearCalcResult {
            align-items: stretch;
            text-align: center;
            padding: 10px;
        }
        #yearCalcResult .result-item {
            padding: 15px;
            background-color: #ffffff;
            border-radius: 12px;
            border: 1px solid #cce7ff;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        .dark #yearCalcResult .result-item {
            background-color: #4a5568;
            border-color: #718096;
        }
        #yearCalcResult h3 {
            font-size: 1.1rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 8px;
        }
        .dark #yearCalcResult h3 {
            color: #e2e8f0;
        }
        #yearCalcResult p {
            font-size: 1.2rem;
            font-weight: 600;
        }
        #yearCalcResult .past-date {
            color: #c62828; /* লাল */
        }
        .dark #yearCalcResult .past-date {
            color: #feb2b2;
        }
        #yearCalcResult .future-date {
            color: #28a745; /* সবুজ */
        }
        .dark #yearCalcResult .future-date {
            color: #9ae6b4;
        }

        /* তারিখ ও সময় ক্যালকুলেটর স্টাইল */
        .date-time-content {
            padding: 20px; /* বর্ধিত প্যাডিং */
            border-radius: 16px;
            margin: 0 auto;
            max-width: 450px; /* বর্ধিত প্রস্থ */
            background-color: #f8f9fa; /* হালকা ধূসর ব্যাকগ্রাউন্ড */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .date-time-content {
            background-color: #2d3748;
        }
        .date-time-content .button-group {
            display: flex;
            justify-content: space-around;
            gap: 10px; /* বর্ধিত ফাঁক */
            margin-bottom: 20px; /* বর্ধিত মার্জিন */
            flex-wrap: wrap;
        }
        .date-time-content .show-date-button {
            background-color: #007bff; /* নীল বোতাম */
            color: white;
            padding: 14px 25px; /* বর্ধিত প্যাডিং */
            border: none;
            border-radius: 10px;
            font-size: 1.15rem; /* বর্ধিত ফন্ট সাইজ */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            flex: 1; /* বোতামগুলি সমান প্রস্থ নেবে */
            min-width: 160px; /* ছোট স্ক্রিনে মোড়ানোর জন্য */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .date-time-content .show-date-button:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
        }
        .date-time-content .result-area {
            margin-top: 25px; /* বর্ধিত মার্জিন */
            padding: 20px; /* বর্ধিত প্যাডিং */
            background-color: #e6f7ff; /* ফলাফলের জন্য হালকা নীল ব্যাকগ্রাউন্ড */
            border-radius: 16px;
            border: 1px solid #b3e0ff;
            min-height: 80px; /* বর্ধিত উচ্চতা */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start; /* টেক্সট বামদিকে সারিবদ্ধ করুন */
            text-align: left; /* টেক্সট বামদিকে সারিবদ্ধ করুন */
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .dark .date-time-content .result-area {
            background-color: #1a202c;
            border-color: #4a5568;
        }

        .date-time-content .result-area p {
            font-size: 1.05rem; /* বর্ধিত ফন্ট সাইজ */
            color: #333;
            font-weight: 500;
            margin: 5px 0; /* সামঞ্জস্যপূর্ণ মার্জিন */
        }
        .dark .date-time-content .result-area p {
            color: #e2e8f0;
        }
        .date-time-content .result-area strong {
            font-weight: 700;
            color: #0056b3;
        }
        .dark .date-time-content .result-area strong {
            color: #90cdf4;
        }
        .date-time-content .result-section-title {
            font-size: 1.3rem; /* বর্ধিত ফন্ট সাইজ */
            font-weight: 700;
            color: #0056b3;
            margin-top: 15px; /* বর্ধিত মার্জিন */
            margin-bottom: 10px; /* বর্ধিত মার্জিন */
            width: 100%;
            text-align: center;
        }
        .dark .date-time-content .result-section-title {
            color: #90cdf4;
        }
        .date-time-content .result-section-title:first-child {
            margin-top: 0;
        }
        .date-time-content .input-group input[type="date"] {
            padding: 12px; /* বর্ধিত প্যাডিং */
            border: 1px solid #cce7ff; /* হালকা নীল বর্ডার */
            border-radius: 10px;
            font-size: 1rem; /* বর্ধিত ফন্ট সাইজ */
            background-color: #eaf6ff; /* হালকা নীল ইনপুট ব্যাকগ্রাউন্ড */
            color: #333;
        }
        .dark .date-time-content .input-group input[type="date"] {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .dark .text-gray-700 {
            color: #cbd5e0;
        }

        /* বৈজ্ঞানিক ক্যালকুলেটর স্টাইল */
        .scientific-calculator-content {
            padding: 20px; /* বর্ধিত প্যাডিং */
            border-radius: 20px; /* গোলাকার কোণ */
            background-color: #263238; /* গাঢ় ধূসর/নীল ক্যালকুলেটর ব্যাকগ্রাউন্ড */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3); /* ছায়া */
            margin: 0 auto;
            max-width: 500px; /* বর্ধিত প্রস্থ */
        }
        .scientific-calculator-content .input-area {
            margin-bottom: 15px; /* বর্ধিত মার্জিন */
        }
        .scientific-calculator-content .expression-input {
            width: 100%;
            padding: 12px; /* প্যাডিং কমানো হয়েছে */
            font-size: 1.2rem; /* ফন্ট সাইজ কমানো হয়েছে */
            border: 1px solid #ccc;
            border-radius: 12px;
            box-sizing: border-box;
            margin-bottom: 10px; /* বর্ধিত মার্জিন */
            text-align: right;
            background-color: #1c262b;
            color: white;
            height: 55px; /* উচ্চতা কমানো হয়েছে */
            word-wrap: break-word; /* দীর্ঘ সংখ্যা ভাঙুন */
            word-break: break-all; /* দীর্ঘ সংখ্যা ভাঙুন */
        }
        .scientific-calculator-content .scientific-buttons-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr); /* 5 কলামে পরিবর্তিত */
            gap: 10px; /* বর্ধিত ফাঁক */
            margin-bottom: 15px; /* বর্ধিত মার্জিন */
        }
        .scientific-calculator-content .scientific-button {
            padding: 14px; /* বর্ধিত প্যাডিং */
            font-size: 1.1rem; /* বর্ধিত ফন্ট সাইজ */
            border: none;
            outline: none;
            background-color: #455a64; /* বোতামের ব্যাকগ্রাউন্ড (নীল-ধূসর) */
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        .scientific-calculator-content .scientific-button:hover {
            background-color: #546e7a;
            transform: translateY(-1px);
        }
        .scientific-calculator-content .scientific-button.operator-btn {
            background-color: #007bff; /* নীল অপারেটর */
        }
        .scientific-calculator-content .scientific-button.operator-btn:hover {
            background-color: #0056b3;
        }
        .scientific-calculator-content .scientific-button.clear-btn {
            background-color: #ef5350; /* লাল ক্লিয়ার */
            color: white;
        }
        .scientific-calculator-content .scientific-button.clear-btn:hover {
            background-color: #d32f2f;
        }
        .scientific-calculator-content .scientific-button.equals-btn {
            background-color: #007bff; /* ইকুয়ালস বোতামের রঙ (নীল) */
        }
        .scientific-calculator-content .scientific-button.equals-btn:hover {
            background-color: #0056b3;
        }
        .scientific-result { /* স্টাইলিংয়ের জন্য scientific-calculator-content এর বাইরে সরানো হয়েছে */
            margin-top: 20px; /* বর্ধিত মার্জিন */
            padding: 20px; /* বর্ধিত প্যাডিং */
            background-color: #e6f7ff;
            border-radius: 16px;
            border: 1px solid #b3e0ff;
            font-size: 1.6rem; /* বর্ধিত ফন্ট সাইজ */
            font-weight: 600;
            color: #0056b3;
            min-height: 65px; /* বর্ধিত উচ্চতা */
            display: flex;
            align-items: center;
            justify-content: flex-end;
            word-wrap: break-word;
            word-break: break-all;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
            margin-left: auto;
            margin-right: auto;
            max-width: 500px; /* scientific-calculator-content এর সর্বোচ্চ প্রস্থের সাথে সারিবদ্ধ করুন */
        }
        .dark .scientific-result {
            background-color: #1a202c;
            border-color: #4a5568;
            color: #90cdf4;
        }
        .error-message { /* স্টাইলিংয়ের জন্য scientific-calculator-content এর বাইরে সরানো হয়েছে */
            color: #d9534f;
            font-size: 1rem;
            font-weight: 500;
            margin-top: 10px;
            margin-left: auto;
            margin-right: auto;
            max-width: 500px; /* scientific-calculator-content এর সর্বোচ্চ প্রস্থের সাথে সারিবদ্ধ করুন */
        }
        .dark .error-message {
            color: #fc8181;
        }
        .dark .text-gray-800 {
            color: #f7fafc;
        }


        /* সংবাদ বিভাগের স্টাইল */
        .news-content {
            padding: 20px; /* বর্ধিত প্যাডিং */
            border-radius: 16px;
            margin: 0 auto;
            max-width: 480px; /* বর্ধিত প্রস্থ */
            background-color: #f8f9fa; /* হালকা ধূসর ব্যাকগ্রাউন্ড */
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .news-content {
            background-color: #2d3748;
        }
        .news-content .news-display-area {
            margin-top: 20px; /* বর্ধিত মার্জিন */
            padding: 20px; /* বর্ধিত প্যাডিং */
            background-color: #e6f7ff; /* হালকা নীল ব্যাকগ্রাউন্ড */
            border-radius: 16px;
            border: 1px solid #b3e0ff;
            min-height: 100px; /* বর্ধিত উচ্চতা */
            text-align: left;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        .dark .news-content .news-display-area {
            background-color: #1a202c;
            border-color: #4a5568;
        }
        .news-content .news-display-area h3 {
            font-size: 1.4rem; /* বর্ধিত ফন্ট সাইজ */
            font-weight: 700;
            color: #0056b3;
            margin-bottom: 12px; /* বর্ধিত মার্জিন */
        }
        .dark .news-content .news-display-area h3 {
            color: #90cdf4;
        }
        .news-content .news-display-area ul {
            list-style: none;
            padding: 0;
        }
        .news-content .news-display-area li {
            margin-bottom: 10px; /* বর্ধিত মার্জিন */
        }
        .news-content .news-display-area a {
            color: #007bff;
            text-decoration: none;
            font-size: 1.05rem; /* বর্ধিত ফন্ট সাইজ */
            transition: color 0.2s ease;
        }
        .dark .news-content .news-display-area a {
            color: #63b3ed;
        }
        .news-content .news-display-area a:hover {
            color: #0056b3;
            text-decoration: underline;
        }
        .dark .news-content .news-display-area a:hover {
            color: #90cdf4;
        }
        .news-content .news-display-area .error-message {
            color: #d9534f;
            font-size: 1rem;
            font-weight: 500;
        }

        .bio-link-section {
            margin-top: 20px; /* বর্ধিত মার্জিন */
            text-align: center;
            padding-top: 15px; /* বর্ধিত প্যাডিং */
            border-top: 1px solid #e0e0e0;
        }
        .dark .bio-link-section {
            border-top-color: #4a5568;
        }

        .bio-link-section p {
            font-size: 1.05rem; /* বর্ধিত ফন্ট সাইজ */
            font-weight: 600;
            color: #333;
            margin-bottom: 10px; /* বর্ধিত মার্জিন */
        }
        .dark .bio-link-section p {
            color: #e2e8f0;
        }


        /* ফন্ট কনভার্টার বিভাগের স্টাইল */
        .font-converter-content {
            padding: 15px; /* বডির সাথে মিলিয়ে প্যাডিং বাড়ানো হয়েছে */
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15); /* গভীর ছায়া */
            width: 100%;
            max-width: 1000px; /* দুটি কলামের জন্য সর্বোচ্চ প্রস্থ সামঞ্জস্য করা হয়েছে */
            display: flex;
            flex-direction: column;
            gap: 12px;				/* গ্যাপ কমানো হয়েছে */
            background-color: #ffffff; /* কনভার্টার বিভাগের জন্য সাদা ব্যাকগ্রাউন্ড */
        }
        .dark .font-converter-content {
            background-color: #2d3748;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.3);
        }
        .font-converter-sections-wrapper {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        @media (min-width: 768px) {
            .font-converter-sections-wrapper {
                flex-direction: row;
            }
        }
        .font-converter-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .font-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }
        .font-section-header h2 {
            font-size: 1.5rem;
            font-weight: bold;
            color: #333;
            margin: 0;
        }
        .dark .font-section-header h2 {
            color: #e2e8f0;
        }
        .font-converter-content textarea {
            width: 100%;
            min-height: 200px;
            padding: 12px;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            font-size: 1rem;
            resize: vertical;
            box-sizing: border-box;
            transition: all 1.0s ease-in-out;
            color: #333; /* টেক্সটএরিয়া টেক্সট পঠনযোগ্য নিশ্চিত করুন */
        }
        .dark .font-converter-content textarea {
            background-color: #1a202c;
            border-color: #4a5568;
            color: #f7fafc;
        }
        /* ডানদিকের টেক্সটএরিয়ার জন্য লোড করা SutonnyMJ ফন্ট ব্যবহার করার স্টাইল */
        #textAreaRight {
            font-family: 'SUTONNYMJ', sans-serif;
            font-size: 1.3rem;
        }
        .font-converter-content textarea:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }
        .font-button-group {
            display: flex;
            justify-content: center;
            gap: 4px; /* গ্যাপ কমানো হয়েছে */
            flex-wrap: wrap;
        }
        .font-converter-content button {
            color: white;
            border: none;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            z-index: 1;
        }
        .font-converter-content button:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            z-index: -1;
            transform: skewX(-20deg);
        }
        .font-converter-content button:hover:before {
            left: 100%;
        }
        .font-converter-content button:hover {
            transform: translateY(-3px);
        }
        .font-converter-content button:active {
            transform: translateY(0);
        }

        .font-conversion-button {
            background-image: linear-gradient(to right, #34d399 0%, #10b981 100%); /* সবুজ গ্রেডিয়েন্ট */
            padding: 10px 15px; /* প্যাডিং কমানো হয়েছে */
            font-size: 1.05rem; /* সামান্য বড় ফন্ট */
            border-radius: 8px; /* আরও গোলাকার */
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); /* উন্নত ছায়া */
        }
        .font-conversion-button:hover {
            background-image: linear-gradient(to right, #10b981 0%, #059669 100%); /* হোভারে গাঢ় সবুজ গ্রেডিয়েন্ট */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        .font-conversion-button:active {
            background-image: linear-gradient(to right, #059669 0%, #047857 100%); /* সক্রিয় অবস্থায় আরও গাঢ় সবুজ */
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        }

        .font-copy-button {
            background-image: linear-gradient(to right, #34d399 0%, #10b981 100%); /* সবুজ গ্রেডিয়েন্ট */
            padding: 8px 15px; /* কপি বোতামের জন্য ছোট */
            font-size: 0.9rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .font-copy-button:hover {
            background-image: linear-gradient(to right, #10b981 0%, #059669 100%); /* হোভারে গাঢ় সবুজ গ্রেডিয়েন্ট */
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        .font-copy-button:active {
            background-image: linear-gradient(to right, #059669 0%, #047857 100%); /* সক্রিয় অবস্থায় আরও গাঢ় সবুজ */
            transform: translateY(0);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        }

        .font-undo-redo-button {
            background-image: linear-gradient(to right, #60a5fa 0%, #3b82f6 100%); /* নীল গ্রেডিয়েন্ট */
            padding: 10px 15px; /* প্যাডিং কমানো হয়েছে */
            font-size: 0.95rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .font-undo-redo-button:hover {
            background-image: linear-gradient(to right, #3b82f6 0%, #2563eb 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        .font-undo-redo-button:active {
            background-image: linear-gradient(to right, #2563eb 0%, #1d4ed8 100%);
            transform: translateY(0);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        }
        .font-undo-redo-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: translateY(0);
            box-shadow: none;
        }

        .font-clear-button {
            background-image: linear-gradient(to right, #ef5350 0%, #d32f2f 100%); /* লাল গ্রেডিয়েন্ট */
            padding: 10px 15px; /* প্যাডিং কমানো হয়েছে */
            font-size: 0.95rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .font-clear-button:hover {
            background-image: linear-gradient(to right, #d32f2f 0%, #c62828 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        .font-clear-button:active {
            background-image: linear-gradient(to right, #c62828 0%, #b71c1c 100%);
            transform: translateY(0);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        }

        .font-clear-all-button {
            background-image: linear-gradient(to right, #ef5350 0%, #d32f2f 100%); /* লাল গ্রেডিয়েন্ট */
            padding: 15px 30px;
            font-size: 1.05rem;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            width: 100%; /* পূর্ণ প্রস্থ জুড়ে বিস্তৃত করুন */
            margin-top: 00px; /* কিছু টপ মার্জিন যোগ করুন */
        }
        .font-clear-all-button:hover {
            background-image: linear-gradient(to right, #d32f2f 0%, #c62828 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        .font-clear-all-button:active {
            background-image: linear-gradient(to right, #c62828 0%, #b71c1c 100%);
            transform: translateY(0);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        }


        .external-converter-link {
            display: block;
            margin-top: 100px; /* বর্ধিত মার্জিন */
            padding: 12px 18px; /* বর্ধিত প্যাডিং */
            background-color: #007bff;
            color: white;
            border-radius: 10px;
            text-decoration: none;
            font-size: 1.05rem; /* বর্ধিত ফন্ট সাইজ */
            font-weight: 600;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center; /* লিঙ্কের মধ্যে টেক্সট কেন্দ্র করুন */
        }
        .external-converter-link:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
        }
        .dark .text-green-700 {
            color: #68d391;
        }
        .dark .text-purple-700 {
            color: #b794f4;
        }
        .dark .text-blue-700 {
            color: #63b3ed;
        }
        .dark .list-disc, .dark .list-circle {
            color: #a0aec0;
        }

        /* নতুন: পরিমাপ (ইউনিট কনভার্টার) স্টাইল */
        .measurement-content {
            padding: 20px;
            border-radius: 16px;
            margin: 0 auto;
            max-width: 800px; /* প্রস্থ বাড়ানো হয়েছে */
            background-color: #f8f9fa;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .measurement-content {
            background-color: #2d3748;
        }
        .converter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }
        .converter-section {
            background-color: #ffffff;
            padding: 20px;
            border-radius: 12px;
            border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        .dark .converter-section {
            background-color: #1a202c;
            border-color: #4a5568;
        }
        .converter-section h3 {
            font-size: 1.3rem;
            font-weight: 700;
            color: #3f51b5;
            margin-bottom: 15px;
            text-align: center;
        }
        .dark .converter-section h3 {
            color: #90cdf4;
        }
        .converter-section .input-row {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .converter-section .input-wrapper {
            flex: 1;
            display: flex;
            flex-direction: column;
            text-align: left;
        }
        .converter-section label {
            font-size: 0.9rem;
            font-weight: 500;
            color: #4a5568;
            margin-bottom: 5px;
        }
        .dark .converter-section label {
            color: #a0aec0;
        }
        .converter-section input[type="number"],
        .converter-section select {
            width: 100%;
            padding: 10px;
            border: 1px solid #cbd5e0;
            border-radius: 8px;
            font-size: 1rem;
            background-color: #f7fafc;
        }
        .dark .converter-section input[type="number"],
        .dark .converter-section select {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .swap-icon {
            font-size: 1.5rem;
            color: #3f51b5;
            cursor: pointer;
            transition: transform 0.3s ease;
            margin-top: 20px; /* ইনপুটের সাথে সারিবদ্ধ করতে */
        }
        .dark .swap-icon {
            color: #90cdf4;
        }
        .swap-icon:hover {
            transform: rotate(180deg);
        }

/* BMI Calculator Styles - শুরু */
.bmi-calculator {
    max-width: 450px;
    margin: 2rem auto;
    padding: 2rem;
    background-color: #f9fafb;
    border-radius: 12px;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
    border: 1px solid #e5e7eb;
}

.bmi-title {
    text-align: center;
    color: #111827;
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.bmi-subtitle {
    text-align: center;
    color: #6b7280;
    margin-bottom: 2rem;
}

.bmi-input-group {
    margin-bottom: 1.25rem;
}

.bmi-input-group label {
    display: block;
    margin-bottom: 0.5rem;
    color: #374151;
    font-weight: 500;
}

.bmi-input-group input {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    box-sizing: border-box;
    font-size: 1rem;
    transition: border-color 0.2s, box-shadow 0.2s;
}

.bmi-input-group input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
}

.bmi-height-inputs {
    display: flex;
    gap: 1rem;
}

#bmi-calculate-btn {
    width: 100%;
    padding: 0.8rem 1rem;
    background-color: #2563eb;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
}

#bmi-calculate-btn:hover {
    background-color: #1d4ed8;
}

.bmi-result-section {
    margin-top: 1.5rem;
    padding: 1.25rem;
    border-radius: 8px;
    text-align: center;
    font-size: 1.1rem;
    line-height: 1.6;
    display: none; /* Initially hidden */
}

/* Result category styles */
.bmi-underweight { background-color: #e0f2fe; color: #0c4a6e; border: 1px solid #bae6fd; }
.bmi-normal { background-color: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
.bmi-overweight { background-color: #fef3c7; color: #92400e; border: 1px solid #fde68a; }
.bmi-obese { background-color: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
/* BMI Calculator Styles - শেষ */

/* BMI ক্যালকুলেটরের জন্য ডার্ক মোড স্টাইল - শুরু */
.dark .bmi-calculator {
    background-color: #2d3748; /* bg-gray-800 */
    border-color: #4a5568; /* border-gray-600 */
}

.dark .bmi-title {
    color: #e2e8f0; /* text-gray-200 */
}

.dark .bmi-subtitle {
    color: #a0aec0; /* text-gray-400 */
}

.dark .bmi-input-group label {
    color: #cbd5e0; /* text-gray-300 */
}

.dark .bmi-input-group input {
    background-color: #4a5568; /* bg-gray-600 */
    border-color: #718096; /* border-gray-500 */
    color: #f7fafc; /* text-gray-100 */
}

.dark .bmi-input-group input:focus {
    border-color: #63b3ed; /* border-blue-400 */
    box-shadow: 0 0 0 3px rgba(99, 179, 237, 0.3);
}

/* ডার্ক মোডে ফলাফলের জন্য স্টাইল */
.dark .bmi-underweight { background-color: #1e3a8a; color: #bfdbfe; border: 1px solid #3b82f6; } /* bg-blue-900, text-blue-200, border-blue-500 */
.dark .bmi-normal { background-color: #064e3b; color: #a7f3d0; border: 1px solid #34d399; } /* bg-green-900, text-green-300, border-green-500 */
.dark .bmi-overweight { background-color: #78350f; color: #fde68a; border: 1px solid #f59e0b; } /* bg-amber-900, text-amber-300, border-amber-500 */
.dark .bmi-obese { background-color: #7f1d1d; color: #fecaca; border: 1px solid #ef4444; } /* bg-red-900, text-red-300, border-red-500 */
/* BMI ক্যালকুলেটরের জন্য ডার্ক মোড স্টাইল - শেষ */

        /* টেক্সট অ্যাসিস্ট্যান্ট (চ্যাট) বিভাগের নতুন স্টাইল */
        .text-assistant-content {
            padding: 20px;
            border-radius: 16px;
            margin: 0 auto;
            max-width: 600px; /* চ্যাটের জন্য প্রস্থ বাড়ানো হয়েছে */
            background-color: #f8f9fa;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .text-assistant-content {
            background-color: #2d3748;
        }
        .chat-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .chat-header h3 {
            font-size: 1.4rem;
            font-weight: 700;
            color: #333;
        }
        .dark .chat-header h3 {
            color: #e2e8f0;
        }
        .clear-chat-button {
            background-color: #ef5350;
            color: white;
            padding: 6px 12px;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .clear-chat-button:hover {
            background-color: #d32f2f;
        }
        .chat-window {
            height: 400px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 15px;
            background-color: #e6f7ff;
            border-radius: 16px;
            border: 1px solid #b3e0ff;
            margin-bottom: 15px;
        }
        .dark .chat-window {
            background-color: #1a202c;
            border-color: #4a5568;
        }
        .message {
            padding: 10px 15px;
            border-radius: 12px;
            max-width: 85%;
            word-wrap: break-word;
            white-space: pre-wrap;
            line-height: 1.6;
        }
        .user-message {
            background-color: #3f51b5;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }
        .gemini-message {
            background-color: #ffffff;
            color: #333;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        .dark .gemini-message {
            background-color: #4a5568;
            color: #f7fafc;
        }
        .gemini-error-message {
            background-color: #ffebee;
            color: #c62828;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
        }
        .input-container {
            display: flex;
            gap: 10px;
            align-items: stretch; /* বোতাম এবং টেক্সটএরিয়া একই উচ্চতায় রাখুন */
        }
        .text-assistant-content textarea {
            flex-grow: 1;
            height: auto;
            min-height: 50px;
            padding: 12px;
            margin-bottom: 0;
            border: 1px solid #cce7ff;
            border-radius: 10px;
            font-size: 1rem;
            resize: vertical;
        }
        .dark .text-assistant-content textarea {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .text-assistant-content .ask-button {
            width: auto;
            margin-bottom: 0;
            flex-shrink: 0;
            background-color: #8A2BE2;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            cursor: pointer;
        }
        .text-assistant-content .loading-indicator {
            display: none;
            text-align: center;
            padding: 10px;
            font-size: 1rem;
            color: #555;
        }
        .dark .text-assistant-content .loading-indicator {
            color: #a0aec0;
        }

        /* নতুন: ফাইল আপলোড প্রিভিউ স্টাইল */
        #filePreviewContainer {
            background-color: #e6f7ff;
            border-color: #b3e0ff;
        }
        .dark #filePreviewContainer {
            background-color: #1a202c;
            border-color: #4a5568;
        }
        #filePreviewContainer img, #filePreviewContainer video {
            max-width: 100px;
            max-height: 100px;
            border-radius: 8px;
            object-fit: cover;
        }
        #removeFileBtn {
            position: absolute;
            top: -10px;
            right: -10px;
            background-color: #ef5350;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
            z-index: 10;
        }
        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
            color: #333;
        }
        .dark .file-info {
            color: #e2e8f0;
        }
        .user-message img {
            max-width: 150px;
            border-radius: 8px;
            margin-top: 8px;
        }
        
        /* নতুন: বাংলা বানান সংশোধন স্টাইল */
        .spell-checker-content {
            padding: 20px;
            border-radius: 16px;
            margin: 0 auto;
            max-width: 600px;
            background-color: #f8f9fa;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .spell-checker-content {
            background-color: #2d3748;
        }
        .spell-checker-content textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #cce7ff;
            border-radius: 10px;
            font-size: 1.1rem;
            resize: vertical;
            box-sizing: border-box;
            background-color: #eaf6ff;
            color: #333;
        }
        .dark .spell-checker-content textarea {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .spell-checker-content .result-area #spellCheckResult {
            min-height: 150px;
            background-color: #ffffff;
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 12px;
            white-space: pre-wrap; /* ফরম্যাটিং বজায় রাখতে */
        }
        .dark .spell-checker-content .result-area #spellCheckResult {
            background-color: #1a202c;
            border-color: #4a5568;
            color: #e2e8f0;
        }

        /* বানান পরীক্ষা করুন বোতামের জন্য নতুন সুন্দর স্টাইল */
        .spell-check-button {
            background-image: linear-gradient(to right, #8A2BE2 0%, #4A00E0 100%); /* বেগুনি গ্রেডিয়েন্ট */
            color: white;
            padding: 14px 25px;
            border: none;
            border-radius: 12px; /* আরও গোলাকার */
            font-size: 1.15rem;
            font-weight: 700; /* বোল্ড */
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            width: 100%;
            box-shadow: 0 5px 15px rgba(74, 0, 224, 0.3); /* রঙের সাথে মানানসই ছায়া */
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px; /* আইকন এবং টেক্সটের মধ্যে ফাঁক */
        }

        .spell-check-button:hover {
            background-image: linear-gradient(to right, #9932CC 0%, #5D00EE 100%); /* হোভারে ভিন্ন গ্রেডিয়েন্ট */
            transform: translateY(-2px); /* উপরে ওঠার প্রভাব */
            box-shadow: 0 8px 20px rgba(74, 0, 224, 0.4); /* গভীর ছায়া */
        }

        .spell-check-button:active {
            transform: translateY(0);
            box-shadow: 0 5px 15px rgba(74, 0, 224, 0.3);
        }

        /* নতুন: লেখা সাজানো স্টাইল */
        .text-beautifier-content {
            padding: 20px;
            border-radius: 16px;
            margin: 0 auto;
            max-width: 600px;
            background-color: #f8f9fa;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .text-beautifier-content {
            background-color: #2d3748;
        }
        .text-beautifier-content textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #cce7ff;
            border-radius: 10px;
            font-size: 1.1rem;
            resize: vertical;
            box-sizing: border-box;
            background-color: #eaf6ff;
            color: #333;
        }
        .dark .text-beautifier-content textarea {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .text-beautifier-content .result-area #beautifyResult {
            min-height: 150px;
            background-color: #ffffff;
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 12px;
            white-space: pre-wrap; /* ফরম্যাটিং বজায় রাখতে */
        }
        .dark .text-beautifier-content .result-area #beautifyResult {
            background-color: #1a202c;
            border-color: #4a5568;
            color: #e2e8f0;
        }

        /* লেখা সাজানো বোতামের জন্য নতুন সুন্দর স্টাইল */
        .beautify-button {
            background-image: linear-gradient(to right, #20c997 0%, #087f5b 100%); /* টিল/সায়ান গ্রেডিয়েন্ট */
            color: white;
            padding: 14px 25px;
            border: none;
            border-radius: 12px;
            font-size: 1.15rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            width: 100%;
            box-shadow: 0 5px 15px rgba(32, 201, 151, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .beautify-button:hover {
            background-image: linear-gradient(to right, #12b886 0%, #099268 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(32, 201, 151, 0.4);
        }

        .beautify-button:active {
            transform: translateY(0);
            box-shadow: 0 5px 15px rgba(32, 201, 151, 0.3);
        }

        /* নতুন: শব্দের অর্থ বিভাগের স্টাইল */
        .word-meaning-content {
            padding: 20px;
            border-radius: 16px;
            margin: 0 auto;
            max-width: 600px;
            background-color: #f8f9fa;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .word-meaning-content {
            background-color: #2d3748;
        }
        .word-meaning-content input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #cce7ff;
            border-radius: 10px;
            font-size: 1.1rem;
            box-sizing: border-box;
            background-color: #eaf6ff;
            color: #333;
        }
        .dark .word-meaning-content input[type="text"] {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .word-meaning-content .result-area #wordMeaningResult {
            min-height: 150px;
            background-color: #ffffff;
            border-radius: 8px;
            border: 1px solid #ddd;
            padding: 12px;
            white-space: pre-wrap; /* ফরম্যাটিং বজায় রাখতে */
            text-align: left;
        }
        .dark .word-meaning-content .result-area #wordMeaningResult {
            background-color: #1a202c;
            border-color: #4a5568;
            color: #e2e8f0;
        }

        .find-meaning-button {
            background-image: linear-gradient(to right, #fd7e14 0%, #f76707 100%); /* কমলা গ্রেডিয়েন্ট */
            color: white;
            padding: 14px 25px;
            border: none;
            border-radius: 12px;
            font-size: 1.15rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            width: 100%;
            box-shadow: 0 5px 15px rgba(253, 126, 20, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .find-meaning-button:hover {
            background-image: linear-gradient(to right, #f76707 0%, #e8590c 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(253, 126, 20, 0.4);
        }

        .find-meaning-button:active {
            transform: translateY(0);
            box-shadow: 0 5px 15px rgba(253, 126, 20, 0.3);
        }
        
        /* নতুন: টেক্সট টু স্পিচ (TTS) স্টাইল */
        .tts-content {
            padding: 20px;
            border-radius: 16px;
            margin: 0 auto;
            max-width: 600px;
            background-color: #f8f9fa;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .tts-content {
            background-color: #2d3748;
        }
        .tts-content textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #cce7ff;
            border-radius: 10px;
            font-size: 1.1rem;
            resize: vertical;
            box-sizing: border-box;
            background-color: #eaf6ff;
            color: #333;
            margin-bottom: 20px;
        }
        .dark .tts-content textarea {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .tts-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
            text-align: left;
        }
        .control-group label {
            font-weight: 600;
            color: #333;
            min-width: 120px;
        }
        .dark .control-group label {
            color: #e2e8f0;
        }
        .control-group select, .control-group input[type="range"] {
            flex-grow: 1;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #cce7ff;
            background-color: #eaf6ff;
        }
        .dark .control-group select, .dark .control-group input[type="range"] {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .control-group input[type="range"] {
            cursor: pointer;
        }
        .control-group span {
            font-weight: 500;
            min-width: 25px;
            text-align: center;
        }
        .dark .control-group span {
            color: #e2e8f0;
        }
        .tts-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .tts-button {
            color: white;
            padding: 12px 22px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .tts-button.speak {
            background-color: #28a745; /* Green */
        }
        .tts-button.speak:hover {
            background-color: #218838;
        }
        .tts-button.pause {
            background-color: #ffc107; /* Yellow */
        }
        .tts-button.pause:hover {
            background-color: #e0a800;
        }
        .tts-button.resume {
            background-color: #17a2b8; /* Cyan */
        }
        .tts-button.resume:hover {
            background-color: #138496;
        }
        .tts-button.stop {
            background-color: #dc3545; /* Red */
        }
        .tts-button.stop:hover {
            background-color: #c82333;
        }
		/* New download button style */
        .tts-button.download {
            background-color: #007bff; /* Blue */
        }
        .tts-button.download:hover:not(:disabled) {
            background-color: #0056b3;
        }
        .tts-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }
        /* New clear button style for TTS/STT */
        .tts-button.clear-input,
        .stt-button.clear-input {
            background-image: linear-gradient(to right, #ef5350 0%, #d32f2f 100%); /* Red gradient */
            color: white;
            padding: 12px 22px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .tts-button.clear-input:hover,
        .stt-button.clear-input:hover {
            background-image: linear-gradient(to right, #d32f2f 0%, #c62828 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        .tts-button.clear-input:active,
        .stt-button.clear-input:active {
            background-image: linear-gradient(to right, #c62828 0%, #b71c1c 100%);
            transform: translateY(0);
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
        }


        /* নতুন: স্পিচ টু টেক্সট (STT) স্টাইল */
        .stt-content {
            padding: 20px;
            border-radius: 16px;
            margin: 0 auto;
            max-width: 600px;
            background-color: #f8f9fa;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .stt-content {
            background-color: #2d3748;
        }
        .stt-content textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #cce7ff;
            border-radius: 10px;
            font-size: 1.1rem;
            resize: vertical;
            box-sizing: border-box;
            background-color: #eaf6ff;
            color: #333;
            margin-bottom: 20px;
        }
        .dark .stt-content textarea {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .stt-status {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
            padding: 10px;
            background-color: #e6f7ff;
            border-radius: 8px;
            border: 1px solid #b3e0ff;
        }
        .dark .stt-status {
            background-color: #1a202c;
            border-color: #4a5568;
            color: #e2e8f0;
        }
        .stt-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }
        .stt-button {
            color: white;
            padding: 12px 22px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .stt-button.start {
            background-color: #28a745; /* Green */
        }
        .stt-button.start:hover {
            background-color: #218838;
        }
        .stt-button.stop {
            background-color: #dc3545; /* Red */
        }
        .stt-button.stop:hover {
            background-color: #c82333;
        }
        .stt-button.copy {
            background-color: #007bff; /* Blue */
        }
        .stt-button.copy:hover {
            background-color: #0056b3;
        }
        .stt-button:disabled {
            background-color: #6c757d;
            cursor: not-allowed;
        }

        /* নতুন: টাইপিং টেস্ট স্টাইল */
        .typing-test-content {
            padding: 20px;
            border-radius: 16px;
            margin: 0 auto;
            max-width: 800px;
            background-color: #f8f9fa;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .typing-test-content {
            background-color: #2d3748;
        }
        .typing-settings {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .typing-settings label {
            font-weight: 600;
            color: #333;
        }
        .dark .typing-settings label {
            color: #e2e8f0;
        }
        .typing-settings select, .typing-settings textarea {
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #cce7ff;
            background-color: #eaf6ff;
            cursor: pointer;
        }
        .dark .typing-settings select, .dark .typing-settings textarea {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        #custom-text-input {
            width: 100%;
            margin-top: 10px;
            resize: vertical;
        }
        .typing-text-display {
            font-size: 1.2rem;
            line-height: 2.5rem;
            letter-spacing: 1px;
            padding: 20px;
            border-radius: 12px;
            background-color: #e6f7ff;
            border: 1px solid #b3e0ff;
            margin-bottom: 20px;
            text-align: justify;
            user-select: none;
            height: 180px;
            overflow-y: auto;
        }
        .dark .typing-text-display {
            background-color: #1a202c;
            border-color: #4a5568;
            color: #e2e8f0;
        }
        .typing-text-display span.correct {
            color: #28a745;
        }
        .typing-text-display span.incorrect {
            color: #dc3545;
            text-decoration: underline;
        }
        .typing-text-display span.current {
            background-color: #b3e0ff;
            border-radius: 4px;
        }
        .dark .typing-text-display span.current {
             background-color: #4a5568;
        }
        .typing-input {
            width: 100%;
            padding: 15px;
            font-size: 1rem;
            border: 2px solid #007bff;
            border-radius: 10px;
            box-sizing: border-box;
        }
        .typing-input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.3);
        }
        .typing-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 20px;
            padding: 15px;
            background-color: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        }
        .dark .typing-stats {
            background-color: #1a202c;
        }
        .stat-item {
            text-align: center;
        }
        .stat-item h4 {
            font-size: 1rem;
            color: #555;
            margin-bottom: 5px;
        }
        .dark .stat-item h4 {
            color: #a0aec0;
        }
        .stat-item p {
            font-size: 1rem;
            font-weight: 700;
            color: #3f51b5;
        }
        .dark .stat-item p {
            color: #90cdf4;
        }
        .typing-controls {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .typing-btn {
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .typing-btn.restart {
             background-image: linear-gradient(to right, #60a5fa 0%, #3b82f6 100%);
        }
        .typing-btn.clear {
            background-image: linear-gradient(to right, #ef5350 0%, #d32f2f 100%);
        }
		/* নতুন: টাইপিং টেস্টের পজ/রিজিউম বাটনের জন্য স্টাইল */
        .typing-btn.pause {
            background-image: linear-gradient(to right, #ffc107 0%, #f7b733 100%); /* হলুদ গ্রেডিয়েন্ট */
        }

        .typing-btn.pause:hover {
            background-image: linear-gradient(to right, #f7b733 0%, #e0a800 100%);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }
        .typing-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
        }

        /* নতুন: ট্রান্সলেটর স্টাইল */
        .translator-content {
            padding: 20px;
            border-radius: 16px;
            margin: 0 auto;
            max-width: 800px; /* সাইড-বাই-সাইড টেক্সটএরিয়ার জন্য প্রস্থ বাড়ানো হয়েছে */
            background-color: #f8f9fa;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }
        .dark .translator-content {
            background-color: #2d3748;
        }
        .translator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .translator-section textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #cce7ff;
            border-radius: 10px;
            font-size: 1.1rem;
            resize: vertical;
            box-sizing: border-box;
            background-color: #eaf6ff;
            color: #333;
            min-height: 200px;
        }
        .dark .translator-section textarea {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }
        .translator-controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        .language-selector-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .dark .language-selector-wrapper label {
            color: #e2e8f0;
        }
        .translator-actions {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .translate-button {
            background-image: linear-gradient(to right, #2980B9 0%, #6DD5FA 100%);
            color: white;
            padding: 14px 25px;
            border: none;
            border-radius: 12px;
            font-size: 1.15rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease-in-out;
            width: auto;
            box-shadow: 0 5px 15px rgba(41, 128, 185, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .translate-button:hover {
            background-image: linear-gradient(to right, #6DD5FA 0%, #2980B9 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(41, 128, 185, 0.4);
        }

        /* কন্টেন্ট প্রাথমিকভাবে লুকানো */
        .calculator-content {
            display: none;
        }
        .calculator-content.active {
            display: block;
        }

/* নতুন: গুগল ম্যাপ স্টাইল */
.map-container {
    padding: 10px;
    border-radius: 16px;
    margin: 0 auto;
    max-width: 98%; /* প্রস্থ প্রায় সম্পূর্ণ স্ক্রিন জুড়ে দেওয়া হলো */
    background-color: #f8f9fa;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}
.dark .map-container {
    background-color: #2d3748;
}
.map-container iframe {
    border-radius: 12px;
    width: 100%;
    height: 65vh; /* উচ্চতা ভিউপোর্টের উচ্চতার ৬৫% করা হলো */
}
@media (max-width: 600px) {
    .map-container iframe {
        height: 55vh; /* মোবাইল ডিভাইসের জন্য উচ্চতা */
    }
}

/* গুগল ম্যাপের নতুন ফিচারগুলোর জন্য স্টাইল */
    .map-features {
        max-width: 98%;
        margin: 1rem auto 0;
        border: 1px solid #e2e8f0;
    }

    .dark .map-features {
        border-color: #4a5568;
    }

    .feature-section:not(:last-child) {
        border-bottom: 1px solid #e2e8f0;
        padding-bottom: 1rem;
    }

    .dark .feature-section:not(:last-child) {
        border-color: #4a5568;
    }

    .feature-section input[type="text"] {
        transition: all 0.3s ease;
    }

    .feature-section button {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    /* নতুন: নামাজের সময়সূচি স্টাইল */
    .prayer-time-content {
        padding: 20px;
        border-radius: 16px;
        margin: 0 auto;
        max-width: 800px;
        background-color: #f8f9fa;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    }
    .dark .prayer-time-content {
        background-color: #2d3748;
    }
    .prayer-times-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
        text-align: center;
    }
    .prayer-time-card {
        background-color: #e6f7ff;
        border: 1px solid #b3e0ff;
        border-radius: 12px;
        padding: 20px 15px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.05);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    .dark .prayer-time-card {
        background-color: #1a202c;
        border-color: #4a5568;
    }
    .prayer-time-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 16px rgba(0,0,0,0.1);
    }
    .prayer-time-card h4 {
        font-size: 1.1rem;
        font-weight: 700;
        color: #0056b3;
        margin-bottom: 10px;
    }
    .dark .prayer-time-card h4 {
        color: #90cdf4;
    }
    .prayer-time-card p {
        font-size: 1.5rem;
        font-weight: 700;
        color: #333;
    }
    .dark .prayer-time-card p {
        color: #e2e8f0;
    }
	
/* টগল সুইচের জন্য CSS (ছোট আকারের জন্য আপডেট করা হয়েছে) */
.switch {
    position: relative;
    display: inline-block;
    width: 40px;  /* কমানো হয়েছে */
    height: 20px; /* কমানো হয়েছে */
}

.switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    -webkit-transition: .4s;
    transition: .4s;
}

.slider:before {
    position: absolute;
    content: "";
    height: 14px; /* কমানো হয়েছে */
    width: 14px;  /* কমানো হয়েছে */
    left: 3px;    /* সামঞ্জস্য করা হয়েছে */
    bottom: 3px;  /* সামঞ্জস্য করা হয়েছে */
    background-color: white;
    -webkit-transition: .4s;
    transition: .4s;
}

input:checked + .slider {
    background-color: #2196F3;
}

input:focus + .slider {
    box-shadow: 0 0 1px #2196F3;
}

input:checked + .slider:before {
    -webkit-transform: translateX(20px); /* সামঞ্জস্য করা হয়েছে */
    -ms-transform: translateX(20px);    /* সামঞ্জস্য করা হয়েছে */
    transform: translateX(20px);       /* সামঞ্জস্য করা হয়েছে */
}

/* Rounded sliders */
.slider.round {
    border-radius: 20px; /* সামঞ্জস্য করা হয়েছে */
}

.slider.round:before {
    border-radius: 50%;
}

        /* API কী মডেল স্টাইল */
        .api-key-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.6); /* গাঢ় ব্যাকগ্রাউন্ড */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            backdrop-filter: blur(8px); /* ব্যাকগ্রাউন্ড ব্লার */
        }

        .api-key-modal-content {
            background-color: #ffffff;
            padding: 30px; /* বর্ধিত প্যাডিং */
            border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3); /* গভীর ছায়া */
            max-width: 450px;
            width: 90%;
            text-align: center;
            transform: translateY(-30px); /* সামান্য উপর থেকে আসবে */
            animation: fadeInScale 0.4s ease-out forwards;
        }
        .dark .api-key-modal-content {
            background-color: #2d3748;
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.9);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .api-key-modal-content h3 {
            font-size: 1.8rem; /* বর্ধিত ফন্ট সাইজ */
            font-weight: 700;
            color: #333;
            margin-bottom: 25px; /* বর্ধিত মার্জিন */
        }
        .dark .api-key-modal-content h3 {
            color: #e2e8f0;
        }

        .api-key-modal-content input[type="text"] {
            width: 100%;
            padding: 15px; /* বর্ধিত প্যাডিং */
            margin-bottom: 20px; /* বর্ধিত মার্জিন */
            border: 1px solid #cce7ff; /* হালকা নীল বর্ডার */
            border-radius: 10px;
            font-size: 1.05rem;
            box-sizing: border-box;
            background-color: #eaf6ff; /* হালকা নীল ইনপুট ব্যাকগ্রাউন্ড */
            color: #333;
        }
        .dark .api-key-modal-content input[type="text"] {
            background-color: #4a5568;
            border-color: #718096;
            color: #f7fafc;
        }

        .api-key-modal-content .modal-buttons {
            display: flex;
            justify-content: space-around;
            gap: 15px; /* বর্ধিত ফাঁক */
        }

        .api-key-modal-content .modal-button {
            padding: 12px 25px; /* বর্ধিত প্যাডিং */
            border: none;
            border-radius: 10px;
            font-size: 1.05rem;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease;
            flex: 1;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .api-key-modal-content .modal-button.save {
            background-color: #28a745; /* সবুজ */
            color: white;
        }
        .api-key-modal-content .modal-button.save:hover {
            background-color: #218838;
            transform: translateY(-1px);
        }

        .api-key-modal-content .modal-button.cancel {
            background-color: #ef5350; /* লাল */
            color: white;
        }
        .api-key-modal-content .modal-button.cancel:hover {
            background-color: #d32f2f;
            transform: translateY(-1px);
        }

        .api-key-modal-content .message-area {
            margin-top: 20px; /* বর্ধিত মার্জিন */
            font-size: 1rem;
            font-weight: 500;
            min-height: 25px; /* বার্তা প্রদর্শনের জন্য ন্যূনতম উচ্চতা */
        }
        .api-key-modal-content .message-area.success {
            color: #28a745; /* সবুজ */
        }
        .dark .api-key-modal-content .message-area.success {
            color: #68d391;
        }
        .api-key-modal-content .message-area.error {
            color: #d9534f; /* লাল */
        }
        .dark .api-key-modal-content .message-area.error {
            color: #fc8181;
        }
        .dark .response-area {
            background-color: #1a202c !important;
            border-color: #4a5568 !important;
            color: #e2e8f0;
        }

        /* নতুন: বর্তমান তারিখ ও সময় ব্যানার */
        #currentDateTimeBanner {
            display: flex; /* Flexbox ব্যবহার করুন */
            justify-content: center; /* অনুভূমিকভাবে মাঝখানে আনুন */
            align-items: center; /* উল্লম্বভাবে মাঝখানে আনুন */
            flex-wrap: wrap; /* ছোট স্ক্রিনে টেক্সট মোড়ানোর জন্য */
            text-align: center;
            font-size: 0.95rem; /* ফন্ট সাইজ সামঞ্জস্য করুন */
            font-weight: 600;
            margin-bottom: 10px; /* এখানে মার্জিন কমানো হয়েছে */
            margin-top: 0px; /* এখানে মার্জিন কমানো হয়েছে */
            padding: 05px 05px; /* প্যাডিং যোগ করুন */
            background-color: #e0e7ff; /* হালকা নীল ব্যাকগ্রাউন্ড */
            border-radius: 15px; /* গোলাকার কোণ */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); /* হালকা শ্যাডো */
            color: #3f51b5; /* টেক্সটের রঙ */
            line-height: 1.5; /* লাইন উচ্চতা */
            transition: opacity 0.5s ease-in-out; /* অ্যানিমেশনের জন্য এই লাইনটি যোগ করা হয়েছে */
        }
        .dark #currentDateTimeBanner {
            background-color: #2d3748; /* ডার্ক মোডে গাঢ় ব্যাকগ্রাউন্ড */
            color: #cbd5e0; /* ডার্ক মোডে হালকা টেক্সট */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
        }
        #currentDateTimeBanner span {
            margin: 0 4px; /* প্রতিটি অংশের মধ্যে সামান্য ফাঁক */
        }

        /* ছোট স্ক্রিনের জন্য প্রতিক্রিয়াশীল সামঞ্জস্য */
        @media (max-width: 768px) {
            .translator-grid {
                grid-template-columns: 1fr;
            }
        }
        @media (max-width: 600px) {
            .main-container {
                padding: 15px;
                border-radius: 15px;
            }
            #preloader-name {
                font-size: 1.8rem;
            }
            #currentDateTimeBanner {
                font-size: 0.8rem; /* ছোট স্ক্রিনে ফন্ট সাইজ আরও কমানো */
                padding: 8px 10px;
                margin-bottom: 0px; /* এখানে মার্জিন কমানো হয়েছে */
                margin-top: 0px; /* এখানে মার্জিন কমানো হয়েছে */
            }
            #currentDateTimeBanner span {
                margin: 0 2px;
            }
            .tab-buttons {
                margin-bottom: 15px;
                gap: 6px;
            }
            .tab-button {
                padding: 8px 10px;
                font-size: 0.8rem;
                border-radius: 8px;
            }
            .calculator-grid {
                grid-template-columns: repeat(4, 1fr);
                grid-template-rows: minmax(80px, auto) repeat(5, 1fr);
                gap: 8px;
                padding: 15px;
                max-width: 320px;
            }
            .calculator-button {
                font-size: 1.4rem;
                border-radius: 8px;
            }
            .output {
                height: 80px;
                padding: 10px;
                border-radius: 10px;
            }
            .output .current-operand {
                font-size: 2.4rem; /* ছোট স্ক্রিনের জন্য ফন্ট সাইজ কমানো হয়েছে */
            }
            .output .previous-operand {
                font-size: 1.3rem;
            }
            .explain-button {
                padding: 8px 15px;
                font-size: 0.9rem;
                border-radius: 8px;
            }
            .age-calculator-content,
            .date-time-content,
            .scientific-calculator-content,
            .news-content,
            .font-converter-content,
            .measurement-content, /* Measurement content responsiveness */
            .text-assistant-content,
            .spell-checker-content,
            .text-beautifier-content,
            .word-meaning-content,
            .tts-content,
            .stt-content,
            .typing-test-content,
            .translator-content { /* Translator content responsiveness */
                padding: 15px;
                border-radius: 12px;
            }
            .age-calculator-content .input-group label,
            .date-time-content .input-group label {
                font-size: 0.95rem;
            }
            .age-calculator-content .input-group input[type="date"],
            .date-time-content .input-group input[type="date"] {
                padding: 10px;
                font-size: 0.9rem;
                border-radius: 8px;
            }
            .age-calculator-content .calculate-button,
            .date-time-content .show-date-button {
                padding: 12px 20px;
                font-size: 1.05rem;
                border-radius: 8px;
            }
            .age-calculator-content .result-area p,
            .date-time-content .result-area p {
                font-size: 1rem;
            }
            .scientific-calculator-content .expression-input {
                font-size: 1.1rem; /* ছোট স্ক্রিনের জন্য ফন্ট সাইজ কমানো হয়েছে */
                padding: 10px; /* ছোট স্ক্রিনের জন্য প্যাডিং কমানো হয়েছে */
                height: 45px; /* ছোট স্ক্রিনের জন্য উচ্চতা কমানো হয়েছে */
                border-radius: 10px;
            }
            .scientific-button { /* বৈজ্ঞানিক বোতামের জন্য সামঞ্জস্যপূর্ণ */
                font-size: 0.9rem;
                padding: 10px;
                border-radius: 8px;
            }
            .scientific-result { /* বৈজ্ঞানিক ফলাফলের জন্য সামঞ্জস্যপূর্ণ */
                font-size: 1.4rem;
                padding: 15px;
                min-height: 55px;
                border-radius: 12px;
            }
            .news-content .news-display-area h3 {
                font-size: 1.3rem;
            }
            .news-content .news-display-area a {
                font-size: 0.95rem;
            }
            .font-converter-content textarea {
                height: 100px;
                font-size: 0.95rem;
                border-radius: 8px;
            }
            .font-converter-content .font-conversion-button { /* কনভার্টার বোতাম থেকে পরিবর্তিত */
                padding: 10px 15px;
                font-size: 0.95rem;
                min-width: 140px;
                border-radius: 8px;
            }
            .font-converter-content .font-copy-button { /* কনভার্টার বোতাম থেকে পরিবর্তিত */
                padding: 8px 12px;
                font-size: 0.85rem;
                border-radius: 8px;
            }
            .font-undo-redo-button {
                padding: 8px 12px;
                font-size: 0.85rem;
                border-radius: 8px;
            }
            .font-clear-button {
                padding: 8px 12px;
                font-size: 0.85rem;
                border-radius: 8px;
            }
            .font-clear-all-button {
                padding: 12px 20px;
                font-size: 0.95rem;
                border-radius: 8px;
            }
            .text-assistant-content textarea {
                height: 120px;
                font-size: 0.95rem;
                border-radius: 8px;
            }
            .text-assistant-content .ask-button {
                padding: 12px 20px;
                font-size: 1.05rem;
                border-radius: 8px;
            }
            .api-key-modal-content {
                padding: 20px;
                border-radius: 15px;
            }
            .api-key-modal-content h3 {
                font-size: 1.5rem;
            }
            .api-key-modal-content input[type="text"] {
                padding: 12px;
                font-size: 0.95rem;
                border-radius: 8px;
            }
            .api-key-modal-content .modal-button {
                padding: 10px 15px;
                font-size: 0.95rem;
                border-radius: 8px;
            }
        }
		/* নতুন: ছবি থেকে লেখা (OCR) স্টাইল */
.image-to-text-content {
    padding: 20px;
    border-radius: 16px;
    margin: 0 auto;
    max-width: 600px;
    background-color: #f8f9fa;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}
.dark .image-to-text-content {
    background-color: #2d3748;
}
.image-upload-area {
    border: 2px dashed #007bff;
    border-radius: 12px;
    padding: 30px;
    text-align: center;
    cursor: pointer;
    background-color: #eaf6ff;
    transition: background-color 0.3s ease;
}
.dark .image-upload-area {
    border-color: #63b3ed;
    background-color: #1a202c;
}
.image-upload-area:hover {
    background-color: #d4eaff;
}
.dark .image-upload-area:hover {
    background-color: #2c3748;
}
.image-upload-label {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 10px;
    color: #007bff;
    font-weight: 600;
    cursor: pointer;
}
.dark .image-upload-label {
    color: #63b3ed;
}
.image-preview {
    margin-top: 20px;
    text-align: center;
    position: relative;
}
.image-preview img {
    max-width: 100%;
    max-height: 300px;
    border-radius: 12px;
    border: 2px solid #b3e0ff;
}
.dark .image-preview img {
    border-color: #4a5568;
}
.image-preview .remove-image-btn {
    position: absolute;
    top: 5px;
    right: 5px;
    background-color: rgba(239, 83, 80, 0.8);
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-size: 1.5rem;
    line-height: 1;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}
.extract-text-button {
    background-image: linear-gradient(to right, #6d28d9 0%, #4c1d95 100%); /* Deep Purple Gradient */
    color: white;
    padding: 14px 25px;
    border: none;
    border-radius: 12px;
    font-size: 1.15rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
    width: 100%;
    box-shadow: 0 5px 15px rgba(109, 40, 217, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}
.extract-text-button:hover {
    background-image: linear-gradient(to right, #5b21b6 0%, #4c1d95 100%);
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(109, 40, 217, 0.4);
}
.image-to-text-content .result-area textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid #cce7ff;
    border-radius: 10px;
    font-size: 1.1rem;
    resize: vertical;
    box-sizing: border-box;
    background-color: #eaf6ff;
    color: #333;
	text-align: justify;
}
.dark .image-to-text-content .result-area textarea {
    background-color: #1a202c;
    border-color: #4a5568;
    color: #f7fafc;
}
/* Drag & Drop এর জন্য নতুন স্টাইল */
.image-upload-area.drag-over {
    background-color: #cce7ff; /* ড্র্যাগ করার সময় ব্যাকগ্রাউন্ড রঙ পরিবর্তন হবে */
    border-style: solid;
    border-color: #0056b3;
}
.dark .image-upload-area.drag-over {
    background-color: #2c3748;
    border-color: #90cdf4;
}
/* নতুন: ওয়ার্ড কাউন্টার স্টাইল */
.word-counter-content {
    padding: 20px;
    border-radius: 16px;
    margin: 0 auto;
    max-width: 800px;
    background-color: #f8f9fa;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}
.dark .word-counter-content {
    background-color: #2d3748;
}

/* নতুন: আবহাওয়া বিভাগের স্টাইল */
.weather-content {
    padding: 20px;
    border-radius: 16px;
    margin: 0 auto;
    max-width: 500px;
    background-color: #f8f9fa;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}
.dark .weather-content {
    background-color: #2d3748;
}
.weather-search-box {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}
.city-input {
    flex-grow: 1;
    padding: 12px;
    border: 1px solid #cce7ff;
    border-radius: 10px;
    font-size: 1rem;
    background-color: #eaf6ff;
    color: #333;
}
.dark .city-input {
    background-color: #4a5568;
    border-color: #718096;
    color: #f7fafc;
}
.search-weather-button {
    background-color: #007bff;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
}
.search-weather-button:hover {
    background-color: #0056b3;
}
.weather-result-area {
    background-color: #e6f7ff;
    border-radius: 16px;
    padding: 20px;
    text-align: center;
    border: 1px solid #b3e0ff;
    min-height: auto; /* উচ্চতা পরিবর্তন করা হয়েছে */
    display: flex;
    flex-direction: column;
    justify-content: flex-start; /* কন্টেন্ট ওপর থেকে শুরু হবে */
}
.dark .weather-result-area {
    background-color: #1a202c;
    border-color: #4a5568;
}
.weather-result-area h4 {
    font-size: 1.5rem;
    font-weight: 700;
    color: #0056b3;
}
.dark .weather-result-area h4 {
    color: #90cdf4;
}
.weather-result-area .weather-icon {
    width: 100px;
    height: 100px;
    margin: 10px auto;
}
.weather-result-area .temp {
    font-size: 2.5rem;
    font-weight: 700;
}
.weather-result-area .description {
    font-size: 1.2rem;
    text-transform: capitalize;
    margin-bottom: 15px;
}

/* নতুন যুক্ত করা এবং আপডেট করা স্টাইল */
.weather-feels-like {
    font-size: 1rem;
    margin-top: -10px;
    margin-bottom: 15px;
    color: #555;
}
.dark .weather-feels-like {
    color: #a0aec0;
}
.weather-extra-details {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 15px;
    width: 100%;
    margin-top: 20px;
    text-align: left;
}
.detail-item {
    background-color: rgba(255, 255, 255, 0.5);
    padding: 10px;
    border-radius: 10px;
}
.dark .detail-item {
    background-color: rgba(0, 0, 0, 0.2);
}
.detail-item strong {
    display: block;
    font-size: 0.9rem;
    color: #3f51b5;
    margin-bottom: 5px;
}
.dark .detail-item strong {
    color: #90cdf4;
}

 /* প্রিসেট ড্রপডাউন বাটনের জন্য নতুন CSS */
    #presetButtonLeft.open svg, #presetButtonRight.open svg {
        transform: rotate(180deg);
    }
/* আরও মেনু এবং সেটিংস মেনুর জন্য CSS*/
        .tab-menu-container {
			display: flex;
            justify-content: center;
            align-items: center; /* উল্লম্বভাবে কেন্দ্র করার জন্য যোগ করা হয়েছে */
            margin: 5px; 5px; 5px; 5px; /* বর্ধিত মার্জিন */
            gap: 5px; /* বর্ধিত ফাঁক */
            flex-wrap: wrap; /* ছোট স্ক্রিনে ট্যাবগুলি মোড়ানো */
        }


/* নতুন: নোটপ্যাড / টু-ডু লিস্ট স্টাইল (আপডেট করা) */
.notepad-container {
    padding: 20px;
    border-radius: 16px;
    margin: 0 auto;
    max-width: 600px;
    background-color: #f8f9fa;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}
.dark .notepad-container {
    background-color: #2d3748;
}
.notepad-input-area {
    display: flex;
    gap: 10px;
    margin-bottom: 20px;
}
.task-input {
    flex-grow: 1;
    padding: 12px;
    border: 1px solid #cce7ff;
    border-radius: 10px;
    font-size: 1rem;
    background-color: #eaf6ff;
    color: #333;
    /* নতুন সংযোজন */
    min-height: 80px; /* ইনপুট বক্স বড় করা হয়েছে */
    resize: vertical; /* ব্যবহারকারীকে রিসাইজ করার সুবিধা দেওয়া হয়েছে */
    line-height: 1.5; /* লাইনগুলোর মধ্যে ফাঁকা বাড়াতে */
}

.dark .task-input {
    background-color: #4a5568;
    border-color: #718096;
    color: #f7fafc;
}
.add-task-btn {
    background-color: #28a745;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 10px;
    font-size: 1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
}
.add-task-btn:hover {
    background-color: #218838;
}
.task-list {
    list-style: none;
    padding: 0;
    /* max-height এবং overflow-y বৈশিষ্ট্যগুলো মুছে ফেলা হয়েছে যাতে লিস্ট বড় হলে পুরো পেজ স্ক্রোল হয়। */
}

/* টাস্ক আইটেম এবং এর বিভিন্ন অবস্থার স্টাইল */
.task-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 12px;
    background-color: #ffffff;
    border-radius: 8px;
    margin-bottom: 10px;
    border: 1px solid #e2e8f0;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    word-break: break-word;
    position: relative;
    overflow: hidden;
}

.dark .task-item {
    background-color: #1a202c;
    border-color: #4a5568;
}
.task-item.pinned {
    background-color: #fef3c7; /* হালকা হলুদ */
    border-left: 4px solid #f59e0b; /* হলুদ বর্ডার */
}
.dark .task-item.pinned {
    background-color: #3f331a;
    border-left-color: #fcd34d;
}
.task-item.completed .task-text {
    text-decoration: line-through;
    color: #6c757d;
}
.dark .task-item.completed .task-text {
    color: #a0aec0;
}
.task-item.dragging {
    opacity: 0.5;
    background-color: #cce7ff;
}
.dark .task-item.dragging {
    background-color: #2c3748;
}

/* টাস্ক টেক্সট এবং নাম্বারিং স্টাইল */
.task-item .task-text {
    flex-grow: 1;
    text-align: justify; /* লেখাটি সব সময় জাস্টিফাই করা হয়েছে */
    cursor: pointer;
    white-space: pre-wrap; /* এন্টার কী/লাইন ব্রেক সমর্থন করার জন্য */
    display: block; /* লেখাটি সব সময় জাস্টিফাই দেখানোর জন্য এটি যোগ করা হয়েছে */
}

.dark .task-item .task-text {
    color: #f4f4f4;
}
.task-item .task-text:focus {
    display: block;
    outline: none;
    border: 2px solid #3b82f6;
    background-color: #ffffff;
    padding: 4px;
    margin: -6px;
    border-radius: 6px;
}
.dark .task-item .task-text:focus {
    background-color: #2c3748;
    border-color: #60a5fa; /* ডার্ক মোডের জন্য উন্নত ভিজিবিলিটি */
}
.task-number {
    font-weight: bold;
    color: #3f51b5;
    background-color: #e0e7ff;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    font-size: 0.85rem;
    display: flex;
    align-items: center;
    justify-content: center;
    user-select: none;
    flex-shrink: 0;
}
.dark .task-number {
    color: #90cdf4;
    background-color: #4a5568;
}

/* টাস্ক আইটেমের অ্যাকশন বাটন স্টাইল */
.task-item .actions {
    display: flex;
    gap: 8px;
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%) translateX(125%);
    transition: transform 0.2s ease-in-out;
    background: rgba(241, 245, 249, 0.9);
    padding: 5px;
    border-radius: 20px;
    z-index: 2;
}
.dark .task-item .actions {
    background: rgba(45, 55, 72, 0.9);
}
.task-item:hover .actions {
    transform: translateY(-50%) translateX(0);
}
.task-item .action-btn {
    border: none;
    background: #e2e8f0;
    color: #475569;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s, color 0.2s, transform 0.2s;
    flex-shrink: 0;
}
.dark .task-item .action-btn {
    background-color: #4a5568;
    color: #e2e8f0;
}
.task-item .action-btn:hover {
    transform: scale(1.1);
}
.task-item .action-btn.copy:hover {
    background-color: #3b82f6;
    color: white;
}
.task-item .action-btn.delete:hover {
    background-color: #ef4444;
    color: white;
}
.task-item .action-btn.pin:hover {
    background-color: #f59e0b;
    color: white;
}
.task-item .action-btn.pin.active {
    background-color: #f59e0b;
    color: white;
}

/* আগের ডিলিট বাটন স্টাইল অপ্রয়োজনীয়, তাই লুকানো হলো */
.delete-task-btn {
    display: none;
}

/* নতুন: নোটপ্যাড টেক্সট ফরম্যাটিং অ্যাকশন বার */
.notepad-action-toolbar {
    position: absolute;
    z-index: 10;
    background-color: #374151; /* bg-gray-700 */
    color: white;
    border-radius: 8px;
    padding: 4px;
    display: none; /* প্রাথমিকভাবে লুকানো থাকবে */
    gap: 4px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    transition: opacity 0.1s ease-in-out, transform 0.1s ease-in-out;
}

.toolbar-btn {
    background: transparent;
    border: none;
    color: white;
    cursor: pointer;
    padding: 6px 8px;
    border-radius: 4px;
    font-size: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 32px;
    height: 32px;
}

.toolbar-btn:hover {
    background-color: #4b5563; /* bg-gray-600 */
}

/* ইনপুট বক্সকে div হিসাবে স্টাইল করা */
.task-input[contenteditable="true"] {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    background-color: #eaf6ff;
    border: 1px solid #cce7ff;
    border-radius: 10px;
    color: #333;
    flex-grow: 1;
    font-size: 1rem;
    line-height: 1.5;
    min-height: 80px;
    padding: 12px;
    resize: vertical;
    overflow-y: auto; /* textarea-এর মতো স্ক্রোল যুক্ত করা */
    text-align: justify;
}
.dark .task-input[contenteditable="true"] {
    background-color: #4a5568;
    border-color: #718096;
    color: #f7fafc;
}

/* প্লেসহোল্ডার সিমুলেশন */
.task-input[contenteditable="true"]:empty::before {
    content: attr(data-placeholder);
    color: #6b7280; /* text-gray-500 */
    pointer-events: none;
}
.dark .task-input[contenteditable="true"]:empty::before {
    color: #9ca3af; /* text-gray-400 */
}

/* task-text এর জন্য overflow-wrap property যোগ করা হয়েছে */
.task-item .task-text {
    flex-grow: 1;
    text-align: justify;
    cursor: pointer;
    white-space: pre-wrap;
    display: block;
    overflow-wrap: break-word; /* লম্বা শব্দ ভাঙার জন্য */
    word-break: break-word;    /* অতিরিক্ত সুরক্ষার জন্য */
}

/* নতুন: ঘড়ি ট্যাবের জন্য স্টাইল */
.clock-container {
    padding: 20px;
    border-radius: 16px;
    margin: 0 auto;
    max-width: 900px;
    background-color: #f8f9fa;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    display: grid;
    grid-template-columns: 1fr;
    gap: 25px;
}
.dark .clock-container {
    background-color: #2d3748;
}

@media (min-width: 768px) {
    .clock-container {
        grid-template-columns: repeat(2, 1fr);
        grid-template-areas:
            "stopwatch alarm"
            "world-clock world-clock";
    }
    .stopwatch { grid-area: stopwatch; }
    .alarm { grid-area: alarm; }
    .world-clock { grid-area: world-clock; }
}

.clock-section {
    background-color: #ffffff;
    padding: 20px;
    border-radius: 12px;
    border: 1px solid #e2e8f0;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
}
.dark .clock-section {
    background-color: #1a202c;
    border-color: #4a5568;
}

.section-title {
    font-size: 1.4rem;
    font-weight: 700;
    color: #3f51b5;
    margin-bottom: 20px;
    text-align: center;
}
.dark .section-title {
    color: #90cdf4;
}

/* স্টপওয়াচ স্টাইল */
.stopwatch-display {
    font-family: 'Courier New', Courier, monospace;
    font-size: 2.5rem;
    font-weight: bold;
    text-align: center;
    color: #111827;
    background-color: #e6f7ff;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 20px;
    letter-spacing: 2px;
}
.dark .stopwatch-display {
    background-color: #1e3a8a;
    color: #e0f2fe;
}
.stopwatch-controls, .alarm-controls {
    display: flex;
    justify-content: center;
    gap: 10px;
    flex-wrap: wrap;
}
.control-btn {
    padding: 10px 20px;
    font-size: 1rem;
    font-weight: 600;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    color: white;
    transition: all 0.2s ease;
}
.control-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}
.control-btn.start-btn { background-color: #28a745; }
.control-btn.stop-btn { background-color: #dc3545; }
.control-btn.reset-btn { background-color: #6c757d; }
.control-btn.lap-btn { background-color: #007bff; }
.laps-container {
    margin-top: 20px;
    max-height: 150px;
    overflow-y: auto;
    background-color: #f1f5f9;
    border-radius: 8px;
    padding: 10px;
}
.dark .laps-container {
    background-color: #4a5568;
}
.laps-container h4 {
    text-align: center;
    font-weight: 600;
    margin-bottom: 5px;
    color: #475569;
}
.dark .laps-container h4 {
    color: #cbd5e0;
}
#lapsList {
    list-style: none;
    padding: 0;
    margin: 0;
}
#lapsList li {
    padding: 8px;
    border-bottom: 1px solid #e2e8f0;
    font-family: 'Courier New', Courier, monospace;
    display: flex;
    justify-content: space-between;
}
.dark #lapsList li {
    border-color: #718096;
    color: #e2e8f0; /* লেখা সাদা করার জন্য যোগ করা হয়েছে */
}

/* অ্যালার্ম স্টাইল */
.alarm-time-input {
    width: 100%;
    padding: 5px;
    font-size: 1.5rem;
    border: 1px solid #cbd5e0;
    border-radius: 8px;
    text-align: center;
    margin-bottom: 10px;
}
.dark .alarm-time-input {
    background-color: #4a5568;
    border-color: #718096;
    color: #f7fafc;
}
.control-btn.set-alarm-btn { background-color: #8A2BE2; }
.control-btn.clear-alarm-btn { background-color: #ffc107; color: #111827; }

.alarm-status {
    text-align: center;
    margin-top: 10px;
    font-weight: 600;
    font-size: 1.1rem;
    padding: 5px;
    border-radius: 8px;
}
/* নতুন: ডার্ক মোডে অ্যালার্ম স্ট্যাটাসের জন্য রঙ যোগ করা হয়েছে */
.dark .alarm-status {
    color: #cbd5e0;
}
.alarm-status.active {
    background-color: #dcfce7;
    color: #166534;
    animation: pulse 2s infinite;
}
.dark .alarm-status.active {
    background-color: #064e3b;
    color: #a7f3d0;
}
@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.03); }
    100% { transform: scale(1); }
}
/* অ্যালার্ম স্ট্যাটাসের জন্য অতিরিক্ত স্টাইল */
.alarm-status .countdown {
    display: block;
    font-size: 1rem;
    font-weight: 500;
    color: #4a5568;
    margin-top: 5px;
}

.dark .alarm-status .countdown {
    color: #a0aec0;
}
/* কাস্টম অডিও সিলেকশন */
.custom-file-upload-small {
    padding: 5px 5px;
    cursor: pointer;
    background-color: #4a5568;
    color: white;
    border-radius: 6px;
    font-size: 0.9rem;
    font-weight: 500;
    transition: background-color 0.3s ease;
}
.dark .custom-file-upload-small {
    background-color: #718096;
}
.custom-file-upload-small:hover {
    background-color: #2d3748;
}
.dark .custom-file-upload-small:hover {
    background-color: #4a5568;
}
#removeCustomAlarmSound {
    background-color: #ef5350;
    color: white;
    border: none;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    line-height: 1;
}

/* বিশ্ব ঘড়ি স্টাইল (এখানে পুরনো কোডটি বদলে দিন) */
        .world-clock-grid {
            display: grid;
            /* ছোট স্ক্রিনের জন্য: স্বয়ংক্রিয় ফিট কলাম */
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        /* বড় স্ক্রিনের জন্য ৩-কলামের লেআউট নিশ্চিত করতে */
        @media (min-width: 900px) {
            .world-clock-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        .world-clock-card {
            background-color: #e0f2f7;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid #b3e0ff;
        }
        .dark .world-clock-card {
            background-color: #1a202c;
            border-color: #4a5568;
        }
        .world-clock-card .city {
            font-size: 1.2rem;
            font-weight: bold;
            color: #0056b3;
        }
        .dark .world-clock-card .city {
            color: #90cdf4;
        }
        /* নতুন: দেশের নামের জন্য স্টাইল */
        .world-clock-card .country {
            font-size: 0.85rem;
            color: #4a5568;
            margin-bottom: 4px;
        }
        .dark .world-clock-card .country {
            color: #a0aec0;
        }
        .world-clock-card .time {
            font-size: 1.8rem;
            font-weight: 500;
            margin: 5px 0;
        }
        .dark .world-clock-card .time {
            color: #e2e8f0;
        }
        .world-clock-card .date {
            font-size: 0.9rem;
            color: #555;
        }
        .dark .world-clock-card .date {
            color: #a0aec0;
        }
        /* নির্বাচিত কার্ডকে আলাদাভাবে স্টাইল করতে */
        #selected-timezone-card {
            background-color: #dbeafe; /* হালকা নীল */
            border-color: #93c5fd;
            border-width: 2px;
        }
        .dark #selected-timezone-card {
            background-color: #1e3a8a; /* গাঢ় নীল */
            border-color: #3b82f6;
        }

/* নতুন: প্লেয়ার ট্যাবের জন্য স্টাইল */
.player-container {
    padding: 20px;
    border-radius: 16px;
    margin: 0 auto;
    max-width: 800px;
    background-color: #f8f9fa;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.dark .player-container {
    background-color: #2d3748;
}

.player-section {
    background-color: #ffffff;
    padding: 20px;
    border-radius: 12px;
    border: 1px solid #e2e8f0;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
}

.dark .player-section {
    background-color: #1a202c;
    border-color: #4a5568;
}

.player-section-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: #3f51b5;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
    padding-bottom: 10px;
    border-bottom: 1px solid #e2e8f0;
}

.dark .player-section-title {
    color: #90cdf4;
    border-bottom-color: #4a5568;
}

.player-content-area {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.image-preview-box {
    width: 100%;
    max-height: 400px;
    display: flex;
    justify-content: center;
    align-items: center;
    background-color: #f1f5f9;
    border-radius: 8px;
    overflow: hidden;
}

.dark .image-preview-box {
    background-color: #2d3748;
}

#imagePreview {
    width: 100%;
    height: 100%;
    max-height: 400px;
    object-fit: contain;
}

.player-input-area {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
}

.player-input-area input[type="file"] {
    display: none;
}

.custom-file-upload {
    display: inline-block;
    padding: 10px 18px;
    cursor: pointer;
    background-color: #3f51b5;
    color: white;
    border-radius: 8px;
    font-weight: 600;
    transition: background-color 0.3s ease;
}

.dark .custom-file-upload {
    background-color: #4c51bf;
}

.custom-file-upload:hover {
    background-color: #303f9f;
}

.dark .custom-file-upload:hover {
    background-color: #434190;
}

.file-name-display {
    font-size: 0.9rem;
    color: #4a5568;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.dark .file-name-display {
    color: #a0aec0;
}

.player-section.drag-over {
  border-color: #3b82f6;
  border-style: dashed;
  background-color: #eff6ff;
 }
 .dark .player-section.drag-over {
   border-color: #60a5fa;
   background-color: #2c3748;
}

/* ==================================================================== */
/* START: QR Code Generator Styles */
/* ==================================================================== */

.qr-code-content {
    padding: 20px;
    border-radius: 16px;
    margin: 0 auto;
    max-width: 800px; /* Increased max-width */
    background-color: #f8f9fa;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
    display: grid;
    grid-template-columns: 1fr;
    gap: 25px;
}
.dark .qr-code-content {
    background-color: #2d3748;
}

@media (min-width: 768px) {
    .qr-code-content {
        grid-template-columns: 1fr 1fr; /* Two columns on larger screens */
    }
}

.qr-input-section, .qr-output-section {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.qr-code-content textarea {
    width: 100%;
    padding: 12px;
    border: 1px solid #cce7ff;
    border-radius: 10px;
    font-size: 1.1rem;
    resize: vertical;
    box-sizing: border-box;
    background-color: #eaf6ff;
    color: #333;
    min-height: 150px;
    transition: all 0.2s ease-in-out;
}
.dark .qr-code-content textarea {
    background-color: #4a5568;
    border-color: #718096;
    color: #f7fafc;
}
.qr-code-content textarea:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
}

#qrcode-container {
    margin: 0 auto; /* Horizontally center the container */
    width: 280px;
    height: 280px;
    display: flex;
    align-items: center;
    justify-content: center;
    background-color: #e6f7ff;
    border: 1px solid #b3e0ff;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.05) inset;
}
.dark #qrcode-container {
    background-color: #1a202c;
    border-color: #4a5568;
}

#qrcode canvas {
    border-radius: 8px;
}

#qrcode-placeholder {
    width: 100%;
    height: 100%;
}

.qr-actions {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 10px;
}

.qr-button {
    color: white;
    padding: 14px 25px;
    border: none;
    border-radius: 12px;
    font-size: 1.1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.3s ease-in-out;
    width: 100%;
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.qr-button:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.15);
}
.qr-button:active:not(:disabled) {
    transform: translateY(0);
    box-shadow: 0 5px 15px rgba(0,0,0,0.1);
}

.qr-button.generate {
    background-image: linear-gradient(to right, #3b82f6 0%, #2563eb 100%);
    box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
}
.qr-button.download {
    background-image: linear-gradient(to right, #10b981 0%, #059669 100%);
    box-shadow: 0 5px 15px rgba(16, 185, 129, 0.3);
}
.qr-button.clear {
    background-image: linear-gradient(to right, #ef4444 0%, #dc2626 100%);
    box-shadow: 0 5px 15px rgba(239, 68, 68, 0.3);
}

.qr-button.upload {
    background-image: linear-gradient(to right, #8b5cf6 0%, #6d28d9 100%);
    box-shadow: 0 5px 15px rgba(139, 92, 246, 0.3);
}

.qr-button:disabled {
    background-image: none;
    background-color: #9ca3af;
    cursor: not-allowed;
    opacity: 0.7;
}

/* ==================================================================== */
/* END: QR Code Generator Styles */
/* ==================================================================== */

/* ==================================================================== */
/* START: Emergency Numbers Styles */
/* ==================================================================== */


.emergency-numbers-content {
    padding: 20px;
    border-radius: 16px;
    margin: 0 auto;
    max-width: 900px;
    background-color: #f8f9fa;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}
.dark .emergency-numbers-content {
    background-color: #2d3748;
}

.emergency-controls {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
    margin-bottom: 25px;
}

@media (min-width: 640px) {
    .emergency-controls {
        flex-direction: row;
        justify-content: center;
    }
}

.emergency-numbers-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 15px;
}

.emergency-card {
    background-color: #ffffff;
    border: 1px solid #e2e8f0;
    border-left: 5px solid #3b82f6; /* Blue accent */
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}
.dark .emergency-card {
    background-color: #1a202c;
    border-color: #4a5568;
    border-left-color: #60a5fa; /* Light blue accent for dark mode */
}

.emergency-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 8px 16px rgba(0,0,0,0.1);
}

.emergency-card .card-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: #1e3a8a;
    margin-bottom: 8px;
}
.dark .emergency-card .card-title {
    color: #93c5fd;
}

.emergency-card .card-number {
    font-size: 1.5rem;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 15px;
    font-family: 'Courier New', Courier, monospace;
}
.dark .emergency-card .card-number {
    color: #e5e7eb;
}

.emergency-card .call-button {
    background-color: #28a745;
    color: white;
    padding: 8px 12px;
    border: none;
    border-radius: 8px;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    align-self: flex-start; /* Button aligns to the start */
}

.emergency-card .call-button:hover {
    background-color: #218838;
}

.emergency-card {
    position: relative; /* Action বাটন পজিশন করার জন্য */
    overflow: hidden; /* বাইরে চলে যাওয়া Action বাটন লুকানোর জন্য */
}

/* নম্বর এডিট করার সময় আউটলাইন এবং ব্যাকগ্রাউন্ড পরিবর্তন হবে */
.emergency-card .card-number[contenteditable="true"] {
    outline: 2px solid #3b82f6; /* নীল আউটলাইন */
    background-color: #ffffff;
    padding: 2px 4px;
    margin: -3px -5px; /* ইনপুটের মতো দেখানোর জন্য */
    border-radius: 4px;
}
.dark .emergency-card .card-number[contenteditable="true"] {
    background-color: #2c3748;
    border-color: #60a5fa;
}

/* Action বাটনের কন্টেইনার */
.emergency-card .actions {
    display: flex;
    gap: 8px;
    position: absolute;
    right: 10px;
    top: 15px; /* ওপর থেকে পজিশন */
    transform: translateX(125%); /* প্রাথমিকভাবে ডানদিকে লুকানো থাকবে */
    transition: transform 0.2s ease-in-out;
    background: rgba(241, 245, 249, 0.9);
    padding: 5px;
    border-radius: 20px;
    z-index: 2;
}
.dark .emergency-card .actions {
    background: rgba(45, 55, 72, 0.9);
}
/* কার্ডের ওপর হোভার করলে Action বাটন দেখা যাবে */
.emergency-card:hover .actions {
    transform: translateX(0);
}

/* প্রতিটি Action বাটনের স্টাইল */
.emergency-card .action-btn {
    border: none;
    background: #e2e8f0;
    color: #475569;
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s, color 0.2s, transform 0.2s;
    flex-shrink: 0;
}
.dark .emergency-card .action-btn {
    background-color: #4a5568;
    color: #e2e8f0;
}
.emergency-card .action-btn:hover {
    transform: scale(1.1);
}
.emergency-card .action-btn.copy:hover {
    background-color: #3b82f6; /* নীল */
    color: white;
}
.emergency-card .action-btn.edit:hover {
    background-color: #f59e0b; /* কমলা */
    color: white;
}

/* ==================================================================== */
/* END: Emergency Numbers Styles */
/* ==================================================================== */

/* শুরু: যাকাত ক্যালকুলেটর স্টাইল */
.zakat-calculator-content {
    padding: 20px;
    border-radius: 16px;
    margin: 0 auto;
    max-width: 900px;
    background-color: #f8f9fa;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
}
.dark .zakat-calculator-content {
    background-color: #2d3748;
}
.zakat-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 25px;
    margin-bottom: 25px;
}
@media (min-width: 768px) {
    .zakat-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    .nisab-section {
        grid-column: 1 / -1; /* Make Nisab section span full width on larger screens */
    }
}
.zakat-section {
    background-color: #ffffff;
    padding: 20px;
    border-radius: 12px;
    border: 1px solid #e2e8f0;
    box-shadow: 0 4px 6px rgba(0,0,0,0.05);
}
.dark .zakat-section {
    background-color: #1a202c;
    border-color: #4a5568;
}
.zakat-section-title {
    font-size: 1.2rem;
    font-weight: 700;
    color: #3f51b5;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 1px solid #e2e8f0;
}
.dark .zakat-section-title {
    color: #90cdf4;
    border-bottom-color: #4a5568;
}
.zakat-input-group {
    margin-bottom: 15px;
    text-align: left;
}
.zakat-input-group label {
    display: block;
    margin-bottom: 8px;
    color: #374151;
    font-weight: 500;
}
.dark .zakat-input-group label {
    color: #cbd5e0;
}
.zakat-input {
    width: 100%;
    padding: 0.75rem;
    border: 1px solid #d1d5db;
    border-radius: 8px;
    box-sizing: border-box;
    font-size: 1rem;
    transition: border-color 0.2s, box-shadow 0.2s;
}
.dark .zakat-input {
    background-color: #4a5568;
    border-color: #718096;
    color: #f7fafc;
}
.zakat-input:focus {
    outline: none;
    border-color: #3b82f6;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
}
.nisab-result {
    margin-top: 15px;
    padding: 10px;
    background-color: #e6f7ff;
    border: 1px solid #b3e0ff;
    border-radius: 8px;
    text-align: center;
    font-size: 1.1rem;
}
.dark .nisab-result {
    background-color: #1a202c;
    border-color: #4a5568;
    color: #e2e8f0;
}
.zakat-calculate-btn {
    width: 100%;
    padding: 0.8rem 1rem;
    background-color: #10b981;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.2s ease;
    margin-top: 10px;
}
.zakat-calculate-btn:hover {
    background-color: #059669;
    transform: translateY(-2px);
}
.zakat-result-area {
    margin-top: 25px;
    padding: 20px;
    border-radius: 12px;
    background-color: #dcfce7;
    border: 1px solid #bbf7d0;
    text-align: left;
    line-height: 1.8;
    display: none; /* Initially hidden */
}
.dark .zakat-result-area {
    background-color: #064e3b;
    border-color: #34d399;
    color: #d1fae5;
}
.zakat-result-area h4 {
    font-size: 1.3rem;
    font-weight: 700;
    margin-bottom: 10px;
}
.zakat-result-area p {
    font-size: 1rem;
    margin-bottom: 5px;
}
.zakat-result-area .final-zakat {
    font-size: 1.5rem;
    font-weight: bold;
    color: #047857;
    margin-top: 10px;
}
.dark .zakat-result-area .final-zakat {
    color: #6ee7b7;
}
.zakat-result-area.not-payable {
    background-color: #fef3c7;
    border-color: #fde68a;
}
.dark .zakat-result-area.not-payable {
    background-color: #78350f;
    border-color: #f59e0b;
    color: #fef3c7;
}

/* শেষ: যাকাত ক্যালকুলেটর স্টাইল */


/* Animated News Ticker Styles (Updated) */
#news-ticker-container {
    position: relative; /* For positioning nav icons */
    display: flex;
    align-items: center;
    justify-content: center;
}

#news-ticker-container:hover #news-ticker-text {
    animation-play-state: paused;
}

#news-ticker-content {
    width: 100%;
    text-align: center;
    overflow: hidden;
}

#news-ticker-text {
    display: inline-block;
    vertical-align: middle;
    overflow: hidden;
    white-space: nowrap; /* অ্যানিমেশনের সময় লেখা এক লাইনে থাকবে */
    /* কার্সরের জন্য border-right এবং blink-caret অ্যানিমেশন সরানো হয়েছে */
    animation: typing 3.5s steps(60, end);
    color: inherit;
    text-decoration: none;
    /* লেখা ভাঙার জন্য এই প্রোপার্টিগুলো যোগ করা হয়েছে */
    word-wrap: break-word;
    overflow-wrap: break-word;
}

#news-ticker-text:hover {
    text-decoration: underline;
}

.news-source {
    font-style: italic;
    color: #4f46e5; /* Indigo color to match */
}
.dark .news-source {
    color: #a5b4fc;
}

.news-nav-icon {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background-color: rgba(0, 0, 0, 0.1);
    color: #312e81;
    border: none;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0; /* Initially hidden */
    transition: opacity 0.3s ease, background-color 0.3s ease;
    z-index: 10;
}
.dark .news-nav-icon {
    background-color: rgba(255, 255, 255, 0.2);
    color: #e0e7ff;
}

#news-ticker-container:hover .news-nav-icon {
    opacity: 1; /* Show on hover */
}

.news-nav-icon:hover {
    background-color: rgba(0, 0, 0, 0.2);
}
.dark .news-nav-icon:hover {
    background-color: rgba(255, 255, 255, 0.4);
}

#prev-news { left: 5px; }
#next-news { right: 5px; }

/* Typing animation */
@keyframes typing {
    from { width: 0 }
    to { width: 100% }
}
/* blink-caret keyframes সরানো হয়েছে */
/* Animated News Ticker Styles End */

<!-- এখান থেকে ওপরে নতুন ট্যাবের সি এস এস কোড লিখতে হবে বা বসাতে হয় বা বসাতে হবে -->
    </style>
</head>
<body>
		<div id="preloader">
<!-- সামনের এই কমেন্ট অংশটুকু এবং পেছনের কমেন্ট এর অংশটুকু মুছে দিলে ইমেজও দেখা যাবে।	<img id="preloader-image" src="https://cdn.jsdelivr.net/gh/mdsifatgitid/mdsifatgitid.github.io/Md%20Shahiduzzaman%20Sifat.png" alt="Profile Picture"> সামনের অংশটুকু এবং এখানের পিছনের অংশটুকু মুছলে ছবিও দেখা যাবে -->
			<h1 id="preloader-name">Md Shahiduzzaman Sifat</h1>
		</div>

    <!-- Animated Background -->
    <div class="area">
        <ul class="circles">
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
            <li></li>
        </ul>
    </div>
	
<!--css style started from here ওপরে অন্যান্য স্টাইলগুলো আছে।-->

    <div class="main-container">
        <!-- বর্তমান তারিখ ও সময় ব্যানার -->
        <!-- মার্জিন কমানো হয়েছে: mb-4 থেকে mb-0 এবং mt-0 যোগ করা হয়েছে -->
        <div id="currentDateTimeBanner" class="text-center text-lg font-semibold mb-0 mt-0 p-2 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded-lg shadow-md">
            <!-- JavaScript দ্বারা তারিখ ও সময় এখানে আপডেট হবে -->
        </div>
	
<!-- Animated News Ticker Start -->

<!-- বর্তমান তারিখ ও সময় ব্যানারের ঠিক নিচে এবং "বাংলা টুলবক্স" শিরোনামের ওপরে এই অংশটি যোগ করা হয়েছে, এটি দিয়ে নিউজ শিরোনামের মতো করে লেখা আসবে। -->

<!--এটি দ্বারা কমেন্ট করা আছে এখন ব্রাউজারে দেখা যাবেনা, এই ট্যাগ এর মাঝে সেকশনটি রাখলে ব্রাউজারে দেখা যাবেনা, সরিয়ে দিলে তখন দেখা যাবে  -->

<!-- Animated News Ticker Start (Updated) -->

<div id="news-ticker-container" class="relative w-full max-w-2xl mx-auto mt-3 mb-1 overflow-hidden bg-indigo-100 dark:bg-gray-700 p-1 rounded-lg shadow-inner">
<div id="news-ticker-content">
<!-- The 'a' tag will be populated by JavaScript -->
<a id="news-ticker-text" href="#" target="_blank" class="text-indigo-800 dark:text-indigo-200 font-semibold"></a>
</div>
<!-- Navigation Icons -->
<button id="prev-news" class="news-nav-icon" title="Previous News">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/></svg>
</button>
<button id="next-news" class="news-nav-icon" title="Next News">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/></svg>
</button>
</div>
<!-- Animated News Ticker End -->
      
<!--এটি দ্বারা কমেন্ট করা আছে এখন ব্রাউজারে দেখা যাবেনা, এই ট্যাগ এর মাঝে সেকশনটি রাখলে ব্রাউজারে দেখা যাবেনা, সরিয়ে দিলে তখন দেখা যাবে  -->

<!--এটি দ্বারা কমেন্ট করা আছে এখন ব্রাউজারে দেখা যাবেনা, এই ট্যাগ এর মাঝে সেকশনটি রাখলে ব্রাউজারে দেখা যাবেনা, সরিয়ে দিলে তখন দেখা যাবে  -->

<!-- Animated News Ticker End -->


        <h2 class="text-2xl font-bold text-gray-800 mb-0">বাংলা টুলবক্স</h2>

        <div class="tab-buttons">
    <!-- থিম টগল বাটন এখানে সরানো হয়েছে -->
    <div class="theme-toggle-container">
        <button id="theme-toggle" type="button" class="theme-toggle-button" title="লাইট/ডার্ক মোডে পরিবর্তন করুন">
            <svg id="sun-icon" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
            <svg id="moon-icon" class="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
        </button>
    </div>
    <button id="basicCalcTab" class="tab-button active rounded-xl">সাধারণ ক্যালকুলেটর</button>
    <button id="scientificCalcTab" class="tab-button rounded-xl">সাইন্টিফিক ক্যালকুলেটর</button>
	<button id="dateCalcTab" class="tab-button rounded-xl">তারিখ ও সময়</button>
    <button id="ageCalcTab" class="tab-button rounded-xl">বয়স ক্যালকুলেটর</button>
	<button id="textAssistantTab" class="tab-button rounded-xl">টেক্সট অ্যাসিস্ট্যান্ট</button>
	<button id="converterTab" class="tab-button rounded-xl">কনভার্টার</button>
	<button id="prayerTimeTab" class="tab-button rounded-xl">নামাজের সময়সূচি</button>
	<button id="newsTab" class="tab-button rounded-xl">সাম্প্রতিক খবর</button>
    <button id="translatorTab" class="tab-button rounded-xl">ট্রান্সলেটর</button>
	<button id="wordCounterTab" class="tab-button rounded-xl">ওয়ার্ড কাউন্টার</button>
	<button id="wordMeaningTab" class="tab-button rounded-xl">শব্দের অর্থ</button>
    <button id="spellCheckTab" class="tab-button rounded-xl">বানান সংশোধন</button>
    <button id="textBeautifierTab" class="tab-button rounded-xl">লেখা সাজানো</button>
	<button id="typingTestTab" class="tab-button rounded-xl">টাইপিং টেস্ট</button>
	<button id="imageToTextTab" class="tab-button rounded-xl">ছবি থেকে লেখা</button>
	<button id="sttTab" class="tab-button rounded-xl">কথা থেকে লেখা</button>
    <button id="ttsTab" class="tab-button rounded-xl">লেখা থেকে কথা</button>
	<button id="mapTab" class="tab-button rounded-xl">গুগল ম্যাপ</button>
    <button id="weatherTab" class="tab-button rounded-xl">আবহাওয়া</button>
	<button id="measurementTab" class="tab-button rounded-xl">পরিমাপ</button>
	<button id="notepadTab" class="tab-button rounded-xl">নোটপ্যাড</button>
    
    <!-- নতুন: আরও মেনু (ড্রপডাউন) -->
    <div class="tab-buttons">
        <button id="moreMenuBtn" class="tab-button rounded-xl flex items-center gap-1">
            আরও
            <svg class="w-4 h-4 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </button>
        <!-- নতুন কোড (উপরের অংশটি সরিয়ে এটি বসান) -->
		<div id="moreMenuDropdown" class="absolute right-0 mt-1 w-auto bg-white dark:bg-gray-800 rounded-lg shadow-xl z-20 hidden ring-1 ring-black ring-opacity-5">
			<div class="tab-menu-container">
				<!-- ভবিষ্যতে নতুন ট্যাব এখানে যোগ করা যাবে -->
				<button id="clockTab" class="tab-button rounded-xl">ঘড়ি</button>
				<button id="playerTab" class="tab-button rounded-xl">প্লেয়ার</button>
				<button id="zakatCalcTab" class="tab-button rounded-xl">যাকাতের হিসাব</button>
				<button id="qrCodeTab" class="tab-button rounded-xl">কিউআর কোড</button>
				<button id="emergencyNumbersTab" class="tab-button rounded-xl">জরুরি নম্বর</button>
				<button id="allFeaturesTab" class="tab-button rounded-xl">সকল ফিচার</button>
			</div>
		</div>
    </div>

    <!-- নতুন: সেটিংস মেনু (ড্রপডাউন) -->
    <div class="tab-buttons">
        <button id="settingsMenuBtn" class="tab-button rounded-xl flex items-center gap-1">
            সেটিংস
            <svg class="w-4 h-4 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </button>
        <div id="settingsMenuDropdown" class="absolute right-0 mt-1 w-auto bg-white dark:bg-gray-800 rounded-lg shadow-xl z-20 hidden ring-1 ring-black ring-opacity-5">
            <div class="tab-menu-container">
                <button id="setApiKeyBtn" class="tab-button rounded-xl">API কী সেট করুন</button>
            </div>
        </div>
    </div>
</div>

        <!-- মৌলিক ক্যালকুলেটর বিভাগ -->
        <div id="basicCalculatorContent" class="calculator-content active">
            <div class="basic-calculator-wrapper">
                <div class="calculator-grid">
                    <div class="output">
                        <div data-previous-operand class="previous-operand"></div>
                        <div data-current-operand class="current-operand"></div>
                    </div>
                    <button data-all-clear class="clear calculator-button rounded-xl" style="grid-column: span 2;">AC</button>
                    <button data-delete class="calculator-button rounded-xl">DEL</button>
                    <button data-operator class="operator calculator-button rounded-xl">÷</button> <!-- ভাগ -->
                    <button data-number class="calculator-button rounded-xl">7</button>
                    <button data-number class="calculator-button rounded-xl">8</button>
                    <button data-number class="calculator-button rounded-xl">9</button>
                    <button data-operator class="operator calculator-button rounded-xl">×</button> <!-- গুণ -->
                    <button data-number class="calculator-button rounded-xl">4</button>
                    <button data-number class="calculator-button rounded-xl">5</button>
                    <button data-number class="calculator-button rounded-xl">6</button>
                    <button data-operator class="operator calculator-button rounded-xl">-</button> <!-- বিয়োগ -->
                    <button data-number class="calculator-button rounded-xl">1</button>
                    <button data-number class="calculator-button rounded-xl">2</button>
                    <button data-number class="calculator-button rounded-xl">3</button>
                    <button data-operator class="operator calculator-button rounded-xl">+</button> <!-- যোগ -->
                    <button data-number class="zero calculator-button rounded-xl" style="grid-column: span 2;">0</button>
                    <button data-number class="calculator-button rounded-xl">.</button>
                    <button data-equals class="equals calculator-button rounded-xl">=</button> <!-- সমান -->
                </div>
                <!-- নতুন: হিস্টোরি প্যানেল -->
                <div class="history-panel">
                    <div class="history-header">
                        <h3>হিস্টোরি</h3>
                        <button id="clearHistoryBtn">মুছুন</button>
                    </div>
                    <ul id="history-list">
                        <!-- হিস্টোরি আইটেম এখানে যুক্ত হবে -->
                    </ul>
                </div>
            </div>
            <!-- LLM-চালিত ব্যাখ্যা বৈশিষ্ট্য -->
            <button id="explainBasicBtn" class="explain-button rounded-xl">ব্যাখ্যা করুন ✨</button>
            <div id="basicExplanationLoading" class="loading-indicator">জেমিনি ব্যাখ্যা করছে</div>
            <div id="basicExplanation" class="response-area rounded-lg mt-4" style="background-color: #e6f7ff; border: 1px solid #b3e0ff;"></div>
        </div>

        <!-- বয়স ক্যালকুলেটর বিভাগ -->
        <div id="ageCalculatorContent" class="calculator-content">
            <div class="age-calculator-content">
                <!-- Existing Age Calculator -->
                <h3 class="text-xl font-bold text-gray-700 mb-4">বয়স গণনা করুন</h3>
                <div class="input-group">
                    <label for="birthDate">জন্ম তারিখ:</label>
                    <input type="date" id="birthDate" class="rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div class="input-group">
                    <label for="currentDate">বর্তমান তারিখ:</label>
                    <input type="date" id="currentDate" class="rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <button id="calculateAgeBtn" class="calculate-button rounded-xl">বয়স গণনা করুন</button>
                <div id="ageResultArea" class="result-area">
                    <p id="ageResult" class="text-xl"></p>
                    <p id="ageErrorMessage" class="error-message"></p>
                </div>
                
                <!-- Divider -->
                <hr class="my-8 border-gray-300">

                <!-- New Year Calculator Feature -->
                <h3 class="text-xl font-bold text-gray-700 mb-4">বছর ক্যালকুলেটর</h3>
                <p class="text-gray-600 mb-4">যেকোনো তারিখ থেকে নির্দিষ্ট বছর আগে ও পরের তারিখ খুঁজুন।</p>
                <div class="input-group">
                    <label for="yearCalcDateInput">একটি তারিখ নির্বাচন করুন (খালি রাখলে আজকের তারিখ ব্যবহৃত হবে)</label>
                    <input type="date" id="yearCalcDateInput" class="rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <div class="input-group">
                    <label for="yearCalcYearsInput">বছরের সংখ্যা লিখুন</label>
                    <input type="number" id="yearCalcYearsInput" value="10" placeholder="যেমন: ১০" class="rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                </div>
                <button id="calculateYearsBtn" class="calculate-button rounded-xl">হিসাব করুন</button>
                <div id="yearCalcResult" class="result-area">
                    <!-- Results will be injected here -->
                </div>
            </div>
        </div>


        <!-- তারিখ ও সময় ক্যালকুলেটর বিভাগ -->
        <div id="dateCalculatorContent" class="calculator-content">
            <div class="date-time-content">
                <div class="button-group">
                    <button id="showTodayDatesBtn" class="show-date-button rounded-xl">আজকের তারিখ ও সময়</button>
                    <button id="showTomorrowDatesBtn" class="show-date-button rounded-xl">আগামীকালের তারিখ ও সময়</button>
                </div>
                <div id="dateDisplayResult" class="result-area">
                    <!-- আজকের তারিখের জন্য -->
                    <div id="todayResultSection">
                        <p class="result-section-title">আজকের তারিখ</p>
                        <p id="todayGregorianDateDisplay"></p>
                        <p id="todayBengaliDateDisplay"></p>
                        <p id="todayHijriDateDisplay"></p>
                        <p id="todayDayDisplay"></p> <!-- আজকের দিনের জন্য নতুন সারি -->
                        <p id="todayTimeDisplay"></p>
                    </div>

                    <!-- আগামীকালের তারিখের জন্য -->
                    <div id="tomorrowResultSection" style="display: none;">
                        <p class="result-section-title">আগামীকালের তারিখ</p>
                        <p id="tomorrowGregorianDateDisplay"></p>
                        <p id="tomorrowBengaliDateDisplay"></p>
                        <p id="tomorrowHijriDateDisplay"></p>
                        <p id="tomorrowDayDisplay"></p> <!-- আগামীকালের দিনের জন্য নতুন সারি -->
                        <p id="tomorrowTimeDisplay"></p>
                    </div>
                </div>

                <!-- ইংরেজি থেকে বাংলা তারিখ রূপান্তর বৈশিষ্ট্য -->
                <div class="input-group mt-6">
                    <label for="englishDateInput" class="text-gray-700 font-semibold text-left block mb-2">ইংরেজি তারিখ লিখুন:</label>
                    <input type="date" id="englishDateInput" class="rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full p-2 border border-gray-300">
                </div>
                <button id="convertEnglishToBengaliBtn" class="show-date-button rounded-xl mt-4">বাংলা তারিখে রূপান্তর করুন</button>
                <div id="bengaliConvertedDateDisplay" class="result-area mt-4">
                    <p class="result-section-title">রূপান্তরিত বাংলা তারিখ</p>
                    <p id="convertedBengaliDate"></p>
                    <p id="convertedDayDisplay"></p> <!-- রূপান্তরিত দিনের জন্য নতুন সারি -->
                </div>
                <!-- নতুন বোতাম এবং লিংক -->
                <a href="https://ajkertarikh.com" target="_blank" class="show-date-button rounded-xl mt-4 block mx-auto text-center">প্রয়োজনে এখানে তারিখ দেখুন</a>
            </div>
        </div>

        <!-- বৈজ্ঞানিক ক্যালকুলেটর বিভাগ -->
        <div id="scientificCalculatorContent" class="calculator-content">
            <div class="scientific-calculator-content">
                <div class="input-area">
                    <input type="text" id="scientificExpressionInput" class="expression-input rounded-lg" placeholder="এক্সপ্রেশন লিখুন (যেমন: sin(90) + 2*3)">
                </div>
                <div class="scientific-buttons-grid">
                    <!-- সারি 1 -->
                    <button class="scientific-button clear-btn rounded-lg" data-sci-input="C" style="grid-column: span 2;">C</button>
                    <button class="scientific-button rounded-lg" data-sci-input="DEL">DEL</button>
                    <button class="scientific-button rounded-lg" data-sci-input="(">(</button>
                    <button class="scientific-button rounded-lg" data-sci-input=")">)</button>

                    <!-- সারি 2 (সংখ্যা 1-2-3) -->
                    <button class="scientific-button rounded-lg" data-sci-input="1">1</button>
                    <button class="scientific-button rounded-lg" data-sci-input="2">2</button>
                    <button class="scientific-button rounded-lg" data-sci-input="3">3</button>
                    <button class="scientific-button rounded-lg" data-sci-input="sin">sin</button>
                    <button class="scientific-button operator-btn rounded-lg" data-sci-input="÷">÷</button> <!-- ভাগ -->

                    <!-- সারি 3 (সংখ্যা 4-5-6) -->
                    <button class="scientific-button rounded-lg" data-sci-input="4">4</button>
                    <button class="scientific-button rounded-lg" data-sci-input="5">5</button>
                    <button class="scientific-button rounded-lg" data-sci-input="6">6</button>
                    <button class="scientific-button rounded-lg" data-sci-input="cos">cos</button>
                    <button class="scientific-button operator-btn rounded-lg" data-sci-input="×">×</button> <!-- গুণ -->

                    <!-- সারি 4 (সংখ্যা 7-8-9, tan, -) - পরিবর্তিত -->
                    <button class="scientific-button rounded-lg" data-sci-input="7">7</button>
                    <button class="scientific-button rounded-lg" data-sci-input="8">8</button>
                    <button class="scientific-button rounded-lg" data-sci-input="9">9</button>
                    <button class="scientific-button rounded-lg" data-sci-input="tan">tan</button> <!-- '7' এর পরিবর্তে 'tan' -->
                    <button class="scientific-button operator-btn rounded-lg" data-sci-input="-">-</button> <!-- '-' এখানে সরানো হয়েছে -->

                    <!-- সারি 5 (সংখ্যা 0 এবং অন্যান্য) -->
                    <button class="scientific-button rounded-lg" data-sci-input="0" style="grid-column: span 2;">0</button>
                    <button class="scientific-button rounded-lg" data-sci-input=".">.</button>
                    <button class="scientific-button rounded-lg" data-sci-input="π">π</button>
                    <button class="scientific-button operator-btn rounded-lg" data-sci-input="+">+</button> <!-- যোগ -->

                    <!-- সারি 6 (log, ln, sqrt, ^, =) -->
                    <button class="scientific-button rounded-lg" data-sci-input="log">log</button>
                    <button class="scientific-button rounded-lg" data-sci-input="ln">ln</button>
                    <button class="scientific-button rounded-lg" data-sci-input="sqrt">√</button>
                    <button class="scientific-button rounded-lg" data-sci-input="^">^</button>
                    <button class="scientific-button equals-btn rounded-lg" data-sci-equals style="grid-column: span 1;">=</button> <!-- সমান -->

                </div>
            </div>
            <!-- scientific-calculator-content এর বাইরে সরানো হয়েছে -->
            <div id="scientificResult" class="scientific-result rounded-lg"></div>
            <div id="scientificErrorMessage" class="error-message"></div>
            <!-- LLM-চালিত ব্যাখ্যা বৈশিষ্ট্য -->
            <button id="explainScientificBtn" class="explain-button rounded-xl">ব্যাখ্যা করুন ✨</button>
            <div id="scientificExplanationLoading" class="loading-indicator">জেমিনি ব্যাখ্যা করছে</div>
            <div id="scientificExplanation" class="response-area rounded-lg mt-4" style="background-color: #e6f7ff; border: 1px solid #b3e0ff;"></div>
        </div>

<!-- পরিমাপ (ইউনিট কনভার্টার) বিভাগ শুরু -->
<div id="measurementContent" class="calculator-content">
    <div class="measurement-content">
        <div class="converter-grid">
            <!-- দৈর্ঘ্য রূপান্তরকারী -->
            <div class="converter-section">
                <h3>দৈর্ঘ্য রূপান্তরকারী</h3>
                <div class="input-row">
                    <div class="input-wrapper">
                        <label for="lengthFromValue">পরিমাণ (থেকে)</label>
                        <input type="number" id="lengthFromValue" class="unit-input" data-converter="length" value="1">
                    </div>
                    <div class="input-wrapper">
                        <label for="lengthFromUnit">একক</label>
                        <select id="lengthFromUnit" class="unit-select" data-converter="length">
                            <option value="meter">মিটার</option>
                            <option value="kilometer">কিলোমিটার</option>
                            <option value="centimeter">সেন্টিমিটার</option>
                            <option value="millimeter">মিলিমিটার</option>
                            <option value="mile">মাইল</option>
                            <option value="yard">গজ</option>
                            <option value="foot" selected>ফুট</option>
                            <option value="inch">ইঞ্চি</option>
                        </select>
                    </div>
                </div>
                <div class="input-row">
                     <div class="input-wrapper">
                        <label for="lengthToValue">ফলাফল (তে)</label>
                        <input type="number" id="lengthToValue" class="unit-input" data-converter="length_rev">
                    </div>
                    <div class="input-wrapper">
                        <label for="lengthToUnit">একক</label>
                        <select id="lengthToUnit" class="unit-select" data-converter="length">
                            <option value="meter">মিটার</option>
                            <option value="kilometer">কিলোমিটার</option>
                            <option value="centimeter">সেন্টিমিটার</option>
                            <option value="millimeter">মিলিমিটার</option>
                            <option value="mile">মাইল</option>
                            <option value="yard">গজ</option>
                            <option value="foot">ফুট</option>
                            <option value="inch" selected>ইঞ্চি</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ওজন রূপান্তরকারী -->
            <div class="converter-section">
                <h3>ওজন রূপান্তরকারী</h3>
                 <div class="input-row">
                    <div class="input-wrapper">
                        <label for="weightFromValue">পরিমাণ (থেকে)</label>
                        <input type="number" id="weightFromValue" class="unit-input" data-converter="weight" value="1">
                    </div>
                    <div class="input-wrapper">
                        <label for="weightFromUnit">একক</label>
                        <select id="weightFromUnit" class="unit-select" data-converter="weight">
                            <option value="gram">গ্রাম</option>
                            <option value="kilogram" selected>কিলোগ্রাম</option>
                            <option value="milligram">মিলিগ্রাম</option>
                            <option value="tonne">টন</option>
                            <option value="pound">পাউন্ড</option>
                            <option value="ounce">আউন্স</option>
                        </select>
                    </div>
                </div>
                <div class="input-row">
                     <div class="input-wrapper">
                        <label for="weightToValue">ফলাফল (তে)</label>
                        <input type="number" id="weightToValue" class="unit-input" data-converter="weight_rev">
                    </div>
                    <div class="input-wrapper">
                        <label for="weightToUnit">একক</label>
                        <select id="weightToUnit" class="unit-select" data-converter="weight">
                            <option value="gram" selected>গ্রাম</option>
                            <option value="kilogram">কিলোগ্রাম</option>
                            <option value="milligram">মিলিগ্রাম</option>
                            <option value="tonne">টন</option>
                            <option value="pound">পাউন্ড</option>
                            <option value="ounce">আউন্স</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- ক্ষেত্রফল রূপান্তরকারী -->
            <div class="converter-section">
                <h3>ক্ষেত্রফল রূপান্তরকারী</h3>
                 <div class="input-row">
                    <div class="input-wrapper">
                        <label for="areaFromValue">পরিমাণ (থেকে)</label>
                        <input type="number" id="areaFromValue" class="unit-input" data-converter="area" value="1">
                    </div>
                    <div class="input-wrapper">
                        <label for="areaFromUnit">একক</label>
                        <select id="areaFromUnit" class="unit-select" data-converter="area">
                            <option value="sq_meter">বর্গ মিটার</option>
                            <option value="sq_kilometer">বর্গ কিলোমিটার</option>
                            <option value="sq_foot" selected>বর্গ ফুট</option>
                            <option value="sq_inch">বর্গ ইঞ্চি</option>
                            <option value="hectare">হেক্টর</option>
                            <option value="acre">একর</option>
                            <option value="bigha">বিঘা</option>
                            <option value="katha">কাঠা</option>
                            <option value="shotok">শতক</option>
                        </select>
                    </div>
                </div>
                <div class="input-row">
                     <div class="input-wrapper">
                        <label for="areaToValue">ফলাফল (তে)</label>
                        <input type="number" id="areaToValue" class="unit-input" data-converter="area_rev">
                    </div>
                    <div class="input-wrapper">
                        <label for="areaToUnit">একক</label>
                        <select id="areaToUnit" class="unit-select" data-converter="area">
                            <option value="sq_meter">বর্গ মিটার</option>
                            <option value="sq_kilometer">বর্গ কিলোমিটার</option>
                            <option value="sq_foot">বর্গ ফুট</option>
                            <option value="sq_inch">বর্গ ইঞ্চি</option>
                            <option value="hectare">হেক্টর</option>
                            <option value="acre">একর</option>
                            <option value="bigha">বিঘা</option>
                            <option value="katha" selected>কাঠা</option>
                            <option value="shotok">শতক</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- তাপমাত্রা রূপান্তরকারী -->
            <div class="converter-section">
                <h3>তাপমাত্রা রূপান্তরকারী</h3>
                 <div class="input-row">
                    <div class="input-wrapper">
                        <label for="temperatureFromValue">পরিমাণ (থেকে)</label>
                        <input type="number" id="temperatureFromValue" class="unit-input" data-converter="temperature" value="1">
                    </div>
                    <div class="input-wrapper">
                        <label for="temperatureFromUnit">একক</label>
                        <select id="temperatureFromUnit" class="unit-select" data-converter="temperature">
                            <option value="celsius" selected>সেলসিয়াস</option>
                            <option value="fahrenheit">ফারেনহাইট</option>
                            <option value="kelvin">কেলভিন</option>
                        </select>
                    </div>
                </div>
                <div class="input-row">
                     <div class="input-wrapper">
                        <label for="temperatureToValue">ফলাফল (তে)</label>
                        <input type="number" id="temperatureToValue" class="unit-input" data-converter="temperature_rev">
                    </div>
                    <div class="input-wrapper">
                        <label for="temperatureToUnit">একক</label>
                        <select id="temperatureToUnit" class="unit-select" data-converter="temperature">
                            <option value="celsius">সেলসিয়াস</option>
                            <option value="fahrenheit" selected>ফারেনহাইট</option>
                            <option value="kelvin">কেলভিন</option>
                        </select>
                    </div>
                </div>
            </div>
			<!-- BMI ক্যালকুলেটরের শুরু -->
<div id="bmi-calculator-container" class="bmi-calculator">
    <h3 class="bmi-title">বিএমআই (BMI) ক্যালকুলেটর</h3>
    <p class="bmi-subtitle">আপনার ওজন ও উচ্চতা নিচের ঘরে লিখুন।</p>
    
    <!-- ওজন ইনপুট -->
    <div class="bmi-input-group">
        <label for="bmi-weight">ওজন (কেজি)</label>
        <input type="number" id="bmi-weight" placeholder="যেমন: 70">
    </div>
    
    <!-- উচ্চতা ইনপুট -->
    <div class="bmi-input-group">
        <label>উচ্চতা (ফিট ও ইঞ্চি)</label>
        <div class="bmi-height-inputs">
            <input type="number" id="bmi-height-feet" placeholder="ফিট">
            <input type="number" id="bmi-height-inches" placeholder="ইঞ্চি">
        </div>
    </div>
    
    <!-- হিসাব করার বাটন -->
    <button id="bmi-calculate-btn">হিসাব করুন</button>
    
    <!-- ফলাফল দেখানোর স্থান -->
    <div id="bmi-result" class="bmi-result-section"></div>
</div>
<!-- BMI ক্যালকুলেটরের শেষ -->
        </div>
    </div>
</div>
<!-- পরিমাপ (ইউনিট কনভার্টার) বিভাগ শেষ -->

        <!-- নতুন: টাইপিং টেস্ট বিভাগ (আপডেট করা হয়েছে) -->
        <div id="typingTestContent" class="calculator-content">
            <div class="typing-test-content">
                <h3 class="text-xl font-bold text-gray-700 mb-4">টাইপিং টেস্ট</h3>
                <div class="typing-settings">
                    <div>
                        <label for="textSelection">অনুচ্ছেদ নির্বাচন:</label>
                        <select id="textSelection">
                            <option value="bn_1">বাংলা অনুচ্ছেদ ১</option>
                            <option value="bn_2">বাংলা অনুচ্ছেদ ২</option>
                            <option value="bn_3">বাংলা অনুচ্ছেদ ৩</option>
                            <option value="en_1">English Paragraph 1</option>
                            <option value="en_2">English Paragraph 2</option>
                            <option value="en_3">English Paragraph 3</option>
                            <option value="custom">কাস্টম টেক্সট</option>
                        </select>
                    </div>
                    <div>
                        <label for="timeSelection">সময় নির্বাচন:</label>
                        <select id="timeSelection">
                            <option value="0">আনলিমিটেড</option>
                            <option value="60">১ মিনিট</option>
                            <option value="120">২ মিনিট</option>
                            <option value="180">৩ মিনিট</option>
                            <option value="300">৫ মিনিট</option>
                        </select>
                    </div>
                </div>
                <textarea id="custom-text-input" class="hidden" placeholder="এখানে আপনার কাস্টম টেক্সট লিখুন..."></textarea>
                <div id="typingTextDisplay" class="typing-text-display">
                    পুনরায় শুরু করুন বাটনে ক্লিক করে নিচের বক্সে টাইপ করুন...
                </div>
                <textarea id="typingInput" class="typing-input" placeholder="এখানে টাইপ করুন..." disabled></textarea>
                <div id="typingStats" class="typing-stats">
                    <div class="stat-item">
                        <h4>অতিবাহিত সময়</h4>
                        <p id="elapsedTimeDisplay">০০:০০</p>
                    </div>
                    <div class="stat-item">
                        <h4>অবশিষ্ট সময়</h4>
                        <p id="remainingTimeDisplay">০০:০০</p>
                    </div>
                    <div class="stat-item">
                        <h4>WPM</h4>
                        <p id="wpmDisplay">0</p>
                    </div>
                    <div class="stat-item">
                        <h4>মোট শব্দ</h4>
                        <p id="totalWordsDisplay">0</p>
                    </div>
                    <div class="stat-item">
                        <h4>সঠিক</h4>
                        <p id="correctWordsDisplay">0</p>
                    </div>
                    <div class="stat-item">
                        <h4>ভুল</h4>
                        <p id="incorrectWordsDisplay">0</p>
                    </div>
                    <div class="stat-item">
                        <h4>নির্ভুলতা</h4>
                        <p id="accuracyDisplay">100%</p>
                    </div>
                </div>
                <div class="typing-controls">
                    <button id="restartTypingBtn" class="typing-btn restart">পুনরায় শুরু করুন</button>
                    <!-- পরিবর্তন: নতুন পজ/রিজিউম বাটন যোগ করা হয়েছে -->
                    <button id="pauseResumeTypingBtn" class="typing-btn pause">থামান</button>
                    <button id="clearTypingBtn" class="typing-btn clear">মুছুন</button>
                </div>
            </div>
        </div>



        <!-- সাম্প্রতিক সংবাদ বিভাগ -->
        <div id="newsContent" class="calculator-content">
            <div class="news-content"> <!-- সাধারণ কন্টেন্ট প্রদর্শনের জন্য news-content স্টাইলিং পুনরায় ব্যবহার করা হচ্ছে -->
                <div id="newsDisplayArea" class="news-display-area rounded-lg">
                    <h3>বাংলাদেশের প্রধান দৈনিক পত্রিকা</h3>
                    <ul id="newsHeadlinesList">
                        <li><a href="https://www.bd-pratidin.com/" target="_blank">বাংলাদেশ প্রতিদিন</a></li>
                        <li><a href="https://www.dhakapost.com/" target="_blank">ঢাকাপোস্ট</a></li>
                        <li><a href="https://www.kalerkantho.com/" target="_blank">কালের কণ্ঠ</a></li>
                        <li><a href="https://www.ittefaq.com.bd/" target="_blank">দৈনিক ইত্তেফাক</a></li>
                        <li><a href="https://www.dailyamardesh.com/" target="_blank">আমার দেশ</a></li>
                    </ul>
                    <div class="bio-link-section">
                        <p>প্রয়োজনে ভিজিট করুন</p>
                        <a href="https://bio.link/mdsifatbiolink" target="_blank" class="text-blue-600 hover:underline font-semibold text-lg">bio.link/mdsifatbiolink</a>
                    </div>
                    <div id="newsErrorMessage" class="error-message"></div>
                </div>
            </div>
        </div>

        <!-- ফন্ট কনভার্টার বিভাগ (আনডু/রিডু সহ আপডেট করা হয়েছে) -->
<!-- ফন্ট কনভার্টার বিভাগ (প্রিসেট বাটনসহ আপডেট করা হয়েছে) -->
<div id="converterContent" class="calculator-content">

<!--
    <h1 style="color:green">যেকোনো ভাঙ্গা বিজয় লেখা বিজয় টেক্সট বক্সে রেখে ফিক্স করুন বাটনে ক্লিক করলে অথবা ইউনিকোড করে আবার বিজয় করলেও ঠিক হবে।</h1>
-->
	
    <div class="font-converter-content">
	<!-- নতুন: লাইভ কনভার্ট টগল সুইচ -->
<div id="converter-options" class="flex justify-center items-center gap-3">
    <span class="font-semibold text-gray-700 dark:text-gray-300">ম্যানুয়াল কনভার্ট</span>
    <label class="switch">
        <input type="checkbox" id="live-convert-toggle">
        <span class="slider round"></span>
    </label>
    <span class="font-semibold text-gray-700 dark:text-gray-300">লাইভ কনভার্ট</span>
</div>
        <div class="font-converter-sections-wrapper">
            <!-- বাম টেক্সটএরিয়া -->
            <div class="font-converter-section">
                <div class="font-section-header">
                    <h2>ইউনিকোড</h2>
                    <div class="flex items-center gap-2">
                        <!-- Preset Dropdown Left -->
                        <div class="relative inline-block text-left">
                            <div>
                                <button type="button" id="presetButtonLeft" class="font-copy-button rounded-lg inline-flex justify-center w-full px-4 py-2 text-sm font-medium" style="background-image: linear-gradient(to right, #fbbf24 0%, #f59e0b 100%);">
                                    প্রিসেট
                                    <svg class="-mr-1 ml-2 h-5 w-5 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                                </button>
                            </div>
                            <div id="dropdownMenuLeft" class="origin-top-left absolute left-0 mt-2 w-56 rounded-md shadow-lg bg-white dark:bg-gray-700 ring-1 ring-black ring-opacity-5 focus:outline-none hidden z-10">
                                <div class="py-1">
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="default">ডিফল্ট</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="single-space">একটি স্পেস</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="double-space">দুটি স্পেস</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="four-space">চারটি স্পেস</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="single-enter">একটি এন্টার</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="double-enter">দুটি এন্টার</a>
									<a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="double-enter-v2">দুটি এন্টার V2</a>
									<a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="double-enter-v3">দুটি এন্টার V3</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="custom">কাস্টম</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="custom-serial">ক্রমিকসহ কাস্টম</a>
                                </div>
                            </div>
                        </div>
                        <button id="pasteButtonLeft" class="font-copy-button rounded-lg" style="background-image: linear-gradient(to right, #60a5fa 0%, #3b82f6 100%);">পেস্ট</button>
                        <button class="font-copy-button rounded-lg" onclick="copyToClipboard('textAreaLeft')">কপি করুন</button>
                    </div>
                </div>
                <textarea id="textAreaLeft" placeholder="এখানে ইউনিকোড টেক্সট লিখুন"></textarea>
                <div class="font-button-group">
                    <button class="font-conversion-button rounded-lg" onclick="convertLeftToRight()">ইউনিকোড থেকে বিজয়</button>
					<button id="undoButtonLeft" class="font-undo-redo-button rounded-lg">আনডু</button>
					<button id="redoButtonLeft" class="font-undo-redo-button rounded-lg">রিডু</button>
                    <button class="font-clear-button rounded-lg" onclick="clearTextarea('textAreaLeft')">মুছুন</button>
                </div>
            </div>
            <!-- ডান টেক্সটএরিয়া -->
            <div class="font-converter-section">
                <div class="font-section-header">
                    <h2>বিজয়</h2>
                    <div class="flex items-center gap-2">
                         <!-- Preset Dropdown Right -->
                        <div class="relative inline-block text-left">
                            <div>
                                <button type="button" id="presetButtonRight" class="font-copy-button rounded-lg inline-flex justify-center w-full px-4 py-2 text-sm font-medium" style="background-image: linear-gradient(to right, #fbbf24 0%, #f59e0b 100%);">
                                    প্রিসেট
                                    <svg class="-mr-1 ml-2 h-5 w-5 transition-transform duration-200" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                                </button>
                            </div>
                            <div id="dropdownMenuRight" class="origin-top-left absolute left-0 mt-2 w-56 rounded-md shadow-lg bg-white dark:bg-gray-700 ring-1 ring-black ring-opacity-5 focus:outline-none hidden z-10">
                                <div class="py-1">
                                     <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="default">ডিফল্ট</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="single-space">একটি স্পেস</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="double-space">দুটি স্পেস</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="four-space">চারটি স্পেস</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="single-enter">একটি এন্টার</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="double-enter">দুটি এন্টার</a>
									<a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="double-enter-v2">দুটি এন্টার V2</a>
									<a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="double-enter-v3">দুটি এন্টার V3</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="custom">কাস্টম</a>
                                    <a href="#" class="text-gray-700 dark:text-gray-200 block px-4 py-2 text-sm hover:bg-gray-100 dark:hover:bg-gray-600" data-preset="custom-serial">ক্রমিকসহ কাস্টম</a>
                                </div>
                            </div>
                        </div>
                        <button id="pasteButtonRight" class="font-copy-button rounded-lg" style="background-image: linear-gradient(to right, #60a5fa 0%, #3b82f6 100%);">পেস্ট</button>
                        <button id="fixAnsiButton" class="font-copy-button rounded-lg" style="background-image: linear-gradient(to right, #60a5fa 0%, #3b82f6 100%);">ফিক্স করুন</button>
                        <button class="font-copy-button rounded-lg" onclick="copyToClipboard('textAreaRight')">কপি করুন</button>
                    </div>
                </div>
                <textarea id="textAreaRight" placeholder="এখানে বিজয় টেক্সট লিখুন"></textarea>
                <div class="font-button-group">
                    <button class="font-conversion-button rounded-lg" onclick="convertRightToLeft()">বিজয় থেকে ইউনিকোড</button>
                    <button id="undoButtonRight" class="font-undo-redo-button rounded-lg">আনডু</button>
					<button id="redoButtonRight" class="font-undo-redo-button rounded-lg">রিডু</button>
                    <button class="font-clear-button rounded-lg" onclick="clearTextarea('textAreaRight')">মুছুন</button>
                </div>
            </div>
        </div>
        <!-- নতুন "সব মুছুন" বোতাম -->
        <button class="font-clear-all-button rounded-lg" onclick="clearAllTextareas()">সব মুছুন</button>
        <a href="https://bio.link/mdsifatbiolink" target="_blank" class="external-converter-link rounded-xl">প্রয়োজনে এখানে যোগাযোগ করুন অথবা মতামত জানান</a>
    </div>
</div>

<!-- কাস্টম প্রিসেট ইনপুটের জন্য মোডাল -->
<div id="customPresetModal" class="api-key-modal-overlay hidden">
    <div class="api-key-modal-content">
        <h3 id="customModalTitle">কাস্টম প্রিসেট</h3>
        <p id="customModalDesc" class="mb-4 text-gray-600 dark:text-gray-300"></p>
        <input type="text" id="customPresetInput" placeholder="এখানে আপনার কাস্টম টেক্সট লিখুন..." class="rounded-lg">
        <div class="modal-buttons mt-4">
            <button id="saveCustomPresetBtn" class="modal-button save rounded-lg">সেভ করুন</button>
            <button id="cancelCustomPresetBtn" class="modal-button cancel rounded-lg">বাতিল করুন</button>
        </div>
    </div>
</div>

        <!-- নতুন: ট্রান্সলেটর বিভাগ -->
        <div id="translatorContent" class="calculator-content">
            <div class="translator-content">
                <h3 class="text-xl font-bold text-gray-700 mb-4">যেকোনো ভাষায় অনুবাদ করুন</h3>
                <div class="translator-grid">
                    <!-- Input Text Area -->
                    <div class="translator-section">
                        <textarea id="translatorInput" rows="8" placeholder="এখানে আপনার লেখাটি পেস্ট করুন..."></textarea>
                    </div>
                    <!-- Output Text Area -->
                    <div class="translator-section">
                        <textarea id="translatorOutput" rows="8" placeholder="অনুবাদিত লেখা এখানে দেখা যাবে..." readonly></textarea>
                    </div>
                </div>
                <div class="translator-controls mt-4">
                     <div class="language-selector-wrapper">
                        <label for="targetLanguage" class="font-semibold text-gray-700 dark:text-gray-200">কোন ভাষায় অনুবাদ করবেন:</label>
                        <select id="targetLanguage" class="rounded-lg p-2 border bg-gray-100 dark:bg-gray-600 dark:text-white">
                            <!-- Languages will be populated by JS -->
                        </select>
                    </div>
                    <button id="translateBtn" class="translate-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z"></path></svg>
                        <span>অনুবাদ করুন</span>
                    </button>
                </div>
                 <div class="translator-actions mt-4">
                     <button id="copyTranslatedTextBtn" class="font-copy-button rounded-lg">ফলাফল কপি করুন</button>
                     <button id="clearTranslatorTextBtn" class="font-clear-button rounded-lg">সব মুছুন</button>
                </div>
                <div id="translatorLoading" class="loading-indicator mt-4" style="display: none;">অনুবাদ করা হচ্ছে...</div>
            </div>
        </div>

        <!-- নতুন: বাংলা বানান সংশোধন বিভাগ -->
        <div id="spellCheckerContent" class="calculator-content">
            <div class="spell-checker-content">
                <h3 class="text-xl font-bold text-gray-700 mb-4">বাংলা বানান সংশোধন করুন</h3>
                <textarea id="spellCheckInput" rows="8" placeholder="এখানে আপনার বাংলা লেখাটি পেস্ট করুন..."></textarea>
                <div class="flex gap-4 mt-4">
                    <button id="checkSpellingBtn" class="spell-check-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z"/></svg>
                        <span>বানান পরীক্ষা করুন</span>
                    </button>
                    <!-- নতুন 'মুছুন' বাটন -->
                    <button id="clearSpellCheckBtn" class="font-clear-button rounded-lg" style="width: auto; padding: 14px 25px;">মুছুন</button>
                </div>
                <div id="spellCheckLoading" class="loading-indicator mt-4" style="display: none;">পরীক্ষা করা হচ্ছে...</div>
                <div class="result-area mt-4">
                    <p class="result-section-title">সংশোধিত লেখা</p>
                    <div id="spellCheckResult" class="text-left p-2"></div>
                </div>
            </div>
        </div>

        <!-- নতুন: লেখা সাজানো বিভাগ -->
        <div id="textBeautifierContent" class="calculator-content">
            <div class="text-beautifier-content">
                <h3 class="text-xl font-bold text-gray-700 mb-4">আপনার লেখাকে সহজ ও সুন্দর করুন</h3>
                <textarea id="beautifyInput" rows="8" placeholder="এখানে আপনার এলোমেলো বা জটিল লেখাটি পেস্ট করুন..."></textarea>
                <button id="beautifyTextBtn" class="beautify-button mt-4">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z"></path></svg>
                    <span>সাজিয়ে লেখো</span>
                </button>
                <div id="beautifyLoading" class="loading-indicator mt-4" style="display: none;">আপনার লেখা গোছানো হচ্ছে...</div>
                <div class="result-area mt-4">
                    <div class="flex justify-between items-center mb-2">
                        <p class="result-section-title" style="text-align: left; margin: 0;">সাজানো লেখা</p>
                        <button id="copyBeautifiedTextBtn" class="font-copy-button rounded-lg">কপি করুন</button>
                    </div>
                    <div id="beautifyResult" class="text-left p-2"></div>
                </div>
                <button id="clearBeautifyTextBtn" class="font-clear-button rounded-lg mt-4 w-full">সব মুছে ফেলুন</button>
            </div>
        </div>

        <!-- নতুন: শব্দের অর্থ বিভাগ -->
        <div id="wordMeaningContent" class="calculator-content">
            <div class="word-meaning-content">
                <h3 class="text-xl font-bold text-gray-700 mb-4">শব্দের অর্থ ও ব্যাখ্যা খুঁজুন</h3>
                <input type="text" id="wordMeaningInput" placeholder="এখানে বাংলা বা ইংরেজি শব্দ লিখুন..." class="mb-4">
                <div class="flex gap-4">
                    <button id="findMeaningBtn" class="find-meaning-button">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
                        <span>অর্থ খুঁজুন</span>
                    </button>
                     <!-- নতুন 'মুছুন' বাটন -->
                    <button id="clearWordMeaningBtn" class="font-clear-button rounded-lg" style="width: auto; padding: 14px 25px;">মুছুন</button>
                </div>
                <div id="wordMeaningLoading" class="loading-indicator mt-4" style="display: none;">অর্থ খোঁজা হচ্ছে...</div>
                <div class="result-area mt-4">
                    <p class="result-section-title">ফলাফল</p>
                    <div id="wordMeaningResult" class="text-left p-2"></div>
                </div>
            </div>
        </div>
        
        <!-- নতুন: টেক্সট টু স্পিচ বিভাগ -->
        <div id="textToSpeechContent" class="calculator-content">
            <div class="tts-content">
                <h3 class="text-xl font-bold text-gray-700 mb-4">বাংলা টেক্সট টু স্পিচ</h3>
                <textarea id="ttsInput" rows="8" placeholder="এখানে আপনার বাংলা লেখাটি পেস্ট করুন..."></textarea>
                <div class="tts-controls">
                    <div class="control-group">
                        <label for="voiceSelect">ভয়েস নির্বাচন করুন:</label>
                        <select id="voiceSelect" class="rounded-lg"></select>
                    </div>
                    <div class="control-group">
                        <label for="rate">গতি:</label>
                        <input type="range" min="0.5" max="2" value="1" step="0.1" id="rate">
                        <span id="rate-value">1</span>
                    </div>
                    <div class="control-group">
                        <label for="pitch">পিচ:</label>
                        <input type="range" min="0" max="2" value="1" step="0.1" id="pitch">
                        <span id="pitch-value">1</span>
                    </div>
                </div>
                <div class="tts-buttons">
                    <button id="speakBtn" class="tts-button speak rounded-lg">লোড করুন</button>
                    <button id="resumeBtn" class="tts-button resume rounded-lg">শুনুন</button>
					<button id="pauseBtn" class="tts-button pause rounded-lg">থামান</button>
                    <button id="stopBtn" class="tts-button stop rounded-lg">শেষ করুন</button>
                    <button id="clearTtsBtn" class="tts-button clear-input rounded-lg">মুছুন</button> <!-- Added Clear button -->
					<button id="downloadTtsBtn" class="tts-button download rounded-lg" disabled>ডাউনলোড করুন</button>
                </div>
            </div>
        </div>

        <!-- নতুন: স্পিচ টু টেক্সট বিভাগ -->
<div id="speechToTextContent" class="calculator-content">
    <div class="stt-content">
        <h3 class="text-xl font-bold text-gray-700 mb-4">বাংলা স্পিচ টু টেক্সট (Gemini API)</h3>
        <div id="sttStatus" class="stt-status mb-4">অবস্থা: নিষ্ক্রিয়</div>
        <textarea id="sttOutput" rows="8" class="rounded-lg" placeholder="রেকর্ড করুন বা অডিও আপলোড করে কথাকে লেখায় রূপান্তর করুন..."></textarea>
        <!-- অডিও আপলোডের জন্য লুকানো ফাইল ইনপুট -->
        <input type="file" id="audioFileInput" class="hidden" accept="audio/*">
        <div class="stt-buttons mt-4">
            <button id="startSttBtn" data-state="record" class="stt-button start rounded-lg">রেকর্ড করুন</button>
            <button id="uploadAudioBtn" class="stt-button copy rounded-lg">আপলোড করুন</button>
            <button id="copySttBtn" class="stt-button copy rounded-lg">কপি করুন</button>
            <button id="clearSttBtn" class="stt-button clear-input rounded-lg">মুছুন</button>
        </div>
        <p class="mt-4 text-sm text-gray-500 dark:text-gray-400">দ্রষ্টব্য: রেকর্ডিং শেষ হলে 'পাঠান' বাটনে ক্লিক করে লেখাটি পেতে কিছুক্ষণ অপেক্ষা করুন।</p>
    </div>
</div>


        <!-- টেক্সট অ্যাসিস্ট্যান্ট (চ্যাট) বিভাগ -->
        <div id="textAssistantContent" class="calculator-content">
            <div class="text-assistant-content">
                <div class="chat-header">
                    <h3>জেমিনির সাথে চ্যাট করুন</h3>
                    <button id="clearChatBtn" class="clear-chat-button">চ্যাট মুছুন</button>
                </div>
                <div id="chatWindow" class="chat-window">
                    <!-- চ্যাট বার্তা এখানে যুক্ত করা হবে -->
                </div>
                <div id="assistantLoading" class="loading-indicator">জেমিনি চিন্তা করছে...</div>
                <!-- ফাইল প্রিভিউ কন্টেইনার -->
                <div id="filePreviewContainer" class="hidden mb-2 p-2 border rounded-lg relative">
                    <!-- প্রিভিউ এখানে JS দ্বারা যুক্ত করা হবে -->
                </div>
                <div class="input-container">
                    <!-- নতুন ফাইল আপলোড বাটন -->
                    <label for="fileUploadInput" class="flex items-center justify-center p-2.5 rounded-lg bg-gray-200 hover:bg-gray-300 cursor-pointer dark:bg-gray-600 dark:hover:bg-gray-500 transition-colors" title="ফাইল আপলোড করুন">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600 dark:text-gray-300"><path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path></svg>
                    </label>
                    <input type="file" id="fileUploadInput" class="hidden" accept="image/png, image/jpeg, image/webp, text/*, audio/*, video/*">
                    <textarea id="assistantInput" placeholder="এখানে আপনার প্রশ্ন লিখুন..."></textarea>
                    <button id="askGeminiBtn" class="ask-button">পাঠান</button>
                </div>
            </div>
        </div>

<!-- সকল ফিচার বিভাগ -->
        <div id="allFeaturesContent" class="calculator-content">
            <div class="news-content"> <!-- সাধারণ কন্টেন্ট প্রদর্শনের জন্য news-content স্টাইলিং পুনরায় ব্যবহার করা হচ্ছে -->
                <div id="featuresDisplayArea" class="news-display-area rounded-lg">
                    <h3>এই অ্যাপের সকল ফিচার</h3>
                    <ul class="list-disc pl-5 text-left">
                        <li class="mb-2">
                            <strong class="text-indigo-700 dark:text-indigo-400">সাধারণ ও সাইন্টিফিক ক্যালকুলেটর:</strong> মৌলিক এবং জটিল গাণিতিক গণনার সুবিধা। প্রতিটি গণনার জন্য জেমিনি দ্বারা সহজ ব্যাখ্যা পাওয়ার সুযোগ রয়েছে।
                        </li>
                        <li class="mb-2">
                            <strong class="text-indigo-700 dark:text-indigo-400">বয়স ও তারিখ ক্যালকুলেটর:</strong> সঠিক বয়স গণনা, নির্দিষ্ট বছর আগে বা পরের তারিখ অনুসন্ধান এবং গ্রেগরিয়ান, বাংলা ও হিজরি তারিখ দেখার সুবিধা।
                        </li>
                        <li class="mb-2">
                            <strong class="text-green-700 dark:text-green-400">পরিমাপ (ইউনিট কনভার্টার):</strong> দৈর্ঘ্য, ওজন, ক্ষেত্রফল, তাপমাত্রা এবং বিএমআই (BMI) সহজেই গণনা ও রূপান্তর করুন।
                        </li>
                        <li class="mb-2">
                            <strong class="text-purple-700 dark:text-purple-400">টাইপিং টেস্ট:</strong> বাংলা ও ইংরেজি অনুচ্ছেদ টাইপ করে আপনার টাইপিং স্পিড (WPM) এবং নির্ভুলতা পরীক্ষা করুন। সময়সীমা নির্ধারণ ও কাস্টম টেক্সট ব্যবহারের সুবিধাও রয়েছে।
                        </li>
                        <li class="mb-2">
                            <strong class="text-sky-700 dark:text-sky-400">ফন্ট কনভার্টার:</strong> ইউনিকোড ও বিজয় ফন্টের মধ্যে লেখা রূপান্তর করুন। এতে ভাঙা বিজয় লেখা ফিক্স করার বিশেষ সুবিধা এবং লাইভ কনভার্সন, আনডু/রিডু অপশন রয়েছে।
                        </li>
                         <li class="mb-2">
                            <strong class="text-lime-700 dark:text-lime-400">ওয়ার্ড কাউন্টার:</strong> আপনার লেখার শব্দ, অক্ষর, বাক্য এবং অনুচ্ছেদ রিয়েল-টাইমে গণনা করুন।
                        </li>
                        <li class="mb-2">
                            <strong class="text-cyan-700 dark:text-cyan-400">ট্রান্সলেটর (জেমিনি):</strong> যেকোনো ভাষাকে সহজেই অন্য ভাষায় অনুবাদ করুন।
                        </li>
                        <li class="mb-2">
                            <strong class="text-pink-700 dark:text-pink-400">লেখা সম্পর্কিত টুলস (জেমিনি):</strong>
                            <ul class="list-circle pl-4 mt-1 text-gray-700 dark:text-gray-400">
                                <li><strong>বানান সংশোধন:</strong> বাংলা লেখার বানান ও ব্যাকরণগত ভুল সংশোধন করুন।</li>
                                <li><strong>লেখা সাজানো:</strong> এলোমেলো বা জটিল লেখাকে সহজ ও সুন্দর ভাষায় গুছিয়ে নিন।</li>
                                <li><strong>শব্দের অর্থ:</strong> যেকোনো বাংলা বা ইংরেজি শব্দের বিস্তারিত অর্থ, প্রতিশব্দ ও ব্যাখ্যা খুঁজুন।</li>
                            </ul>
                        </li>
                        <li class="mb-2">
                            <strong class="text-amber-700 dark:text-amber-400">স্পিচ টুলস:</strong>
                            <ul class="list-circle pl-4 mt-1 text-gray-700 dark:text-gray-400">
                                <li><strong>টেক্সট টু স্পিচ:</strong> আপনার লেখা টেক্সটকে বাংলা কণ্ঠে শুনুন এবং অডিও ফাইল ডাউনলোড করুন।</li>
                                <li><strong>স্পিচ টু টেক্সট (জেমিনি):</strong> আপনার কথাকে রিয়েল-টাইমে বাংলা বা ইংরেজি টেক্সটে রূপান্তর করুন। অডিও ফাইলও আপলোড করা যাবে।</li>
                            </ul>
                        </li>
                        <li class="mb-2">
                            <strong class="text-rose-700 dark:text-rose-400">ছবি থেকে লেখা (OCR - জেমিনি):</strong> যেকোনো ছবি থেকে বাংলা ও ইংরেজি লেখা বের করুন।
                        </li>
                        <li class="mb-2">
                            <strong class="text-violet-700 dark:text-violet-400">টেক্সট অ্যাসিস্ট্যান্ট (জেমিনি):</strong> যেকোনো প্রশ্ন করুন, লেখা সারসংক্ষেপ করুন, এবং ছবিসহ বিভিন্ন ফাইল আপলোড করে চ্যাট করুন।
                        </li>
                         <li class="mb-2">
                            <strong class="text-emerald-700 dark:text-emerald-400">গুগল ম্যাপ:</strong> ম্যাপে যেকোনো স্থান খুঁজুন, নিজের অবস্থান দেখুন এবং এক স্থান থেকে অন্য স্থানে যাওয়ার দিকনির্দেশনা (Directions) পান।
                        </li>
                        <li class="mb-2">
                            <strong class="text-orange-700 dark:text-orange-400">আবহাওয়া:</strong> আপনার শহর বা যেকোনো স্থানের বর্তমান ও আগামী ৭ দিনের আবহাওয়ার পূর্বাভাস দেখুন।
                        </li>
                        <li class="mb-2">
                            <strong class="text-teal-700 dark:text-teal-400">নামাজের সময়সূচি:</strong> আপনার জেলা অনুযায়ী নামাজের স্বয়ংক্রিয় সময়সূচি দেখুন এবং প্রয়োজনে ম্যানুয়ালি সময় সেট করার সুবিধাও রয়েছে।
                        </li>
                         <li class="mb-2">
                            <strong class="text-blue-700 dark:text-blue-400">যাকাত ক্যালকুলেটর:</strong> সোনা, রুপা এবং অন্যান্য সম্পদের উপর ভিত্তি করে আপনার যাকাতের পরিমাণ সহজেই হিসাব করুন।
                        </li>
                        <li class="mb-2">
                            <strong class="text-fuchsia-700 dark:text-fuchsia-400">কিউআর কোড:</strong> যেকোনো টেক্সট বা লিঙ্ক থেকে QR কোড তৈরি করুন, ডাউনলোড করুন এবং ছবি থেকে QR কোড স্ক্যান করুন।
                        </li>
                        <li class="mb-2">
                            <strong class="text-red-700 dark:text-red-400">জরুরি নম্বর:</strong> জাতীয় এবং জেলাভিত্তিক সকল জরুরি সেবার নম্বর খুঁজুন, এডিট করুন এবং আপনার ডিভাইসে সেভ করে রাখুন।
                        </li>
                        <li class="mb-2">
                            <strong class="text-cyan-700 dark:text-cyan-400">ঘড়ি:</strong> স্টপওয়াচ, অ্যালার্ম (কাস্টম সাউন্ডসহ) এবং বিশ্বের বিভিন্ন শহরের সময় দেখার সুবিধা।
                        </li>
                        <li class="mb-2">
                            <strong class="text-yellow-700 dark:text-yellow-400">প্লেয়ার:</strong> আপনার ডিভাইস থেকে সরাসরি অডিও, ভিডিও এবং ছবি প্লে করুন।
                        </li>
                        <li class="mb-2">
                             <strong class="text-gray-700 dark:text-gray-400">নোটপ্যাড / টু-ডু লিস্ট:</strong> আপনার কাজ বা নোট যোগ করুন এবং ব্রাউজারেই সেভ করে রাখুন। এতে টেক্সট ফরম্যাটিং, ছবি যোগ করা, এবং কাজ ড্র্যাগ-ড্রপ করার সুবিধা রয়েছে।
                        </li>
                        <li class="mb-2">
                            <strong class="text-slate-700 dark:text-slate-400">সাম্প্রতিক খবর:</strong> বাংলাদেশের প্রধান দৈনিক পত্রিকাগুলোর সরাসরি লিংক এখানে পাবেন।
                        </li>
						<li class="mb-2"><strong class="text-violet-700 dark:text-violet-400">ডেভেলোপার প্রোফাইল: </strong>প্রয়োজনীয় বিভিন্ন লিংক পেতে এবং ডেভেলোপার এর প্রোফাইল 👉 <a href="https://bio.link/mdsifatbiolink" target="_blank" class="text-blue-600 hover:underline">bio.link/mdsifatbiolink</a></li>
                    </ul>
                </div>
            </div>
        </div>

		
<!-- নতুন: গুগল ম্যাপ বিভাগ -->
<div id="mapContent" class="calculator-content">
    <div class="map-container">
        <h3 class="text-xl font-bold text-gray-700 mb-4 dark:text-gray-200">গুগল ম্যাপ - বাংলাদেশ</h3>
        <iframe
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3746118.913102029!2d88.10075841566833!3d23.49058226042993!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x30adaaed80e18ba7%3A0xf2d28e0c4e1fc6b!2sBangladesh!5e0!3m2!1sen!2sbd!4v1675346780000!5m2!1sen!2sbd"
            width="100%"
            height="450"
            style="border:0;"
            allowfullscreen=""
            loading="lazy"
            referrerpolicy="no-referrer-when-downgrade">
			
        </iframe>
		<!-- এই কোডটি mapContent div-এর ভেতরের iframe ট্যাগের পরে যোগ করুন -->
		<div class="map-features mt-4 p-4 bg-white dark:bg-gray-700 rounded-lg shadow-inner">
    <!-- স্থান খুঁজুন -->
    <div class="feature-section mb-4">
        <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2">স্থান খুঁজুন (Search Location)</h4>
        <div class="flex flex-col sm:flex-row gap-2">
            <input type="text" id="searchInput" placeholder="যেমন: ঢাকা বিশ্ববিদ্যালয়" class="flex-grow p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white focus:ring-2 focus:ring-blue-500">
            <button id="searchBtn" class="px-4 py-2 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors">খুঁজুন</button>
        </div>
    </div>

    <!-- আমার অবস্থান -->
    <div class="feature-section mb-4">
        <h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2">আমার অবস্থান (My Location)</h4>
        <button id="myLocationBtn" class="w-full px-4 py-2 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition-colors">আমার বর্তমান অবস্থান দেখুন</button>
    </div>

					<!-- দিকনির্দেশনা -->
			<div class="feature-section">
				<h4 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2">দিকনির্দেশনা (Directions)</h4>
				<div class="flex flex-col sm:flex-row gap-2">
				<input type="text" id="directionsFrom" placeholder="শুরুর স্থান (From)" class="flex-grow p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white focus:ring-2 focus:ring-purple-500">
				<input type="text" id="directionsTo" placeholder="গন্তব্য স্থান (To)" class="flex-grow p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white focus:ring-2 focus:ring-purple-500">
				</div>
				<button id="directionsBtn" class="w-full mt-2 px-4 py-2 bg-purple-500 text-white font-semibold rounded-lg hover:bg-purple-600 transition-colors">দিকনির্দেশনা দেখুন</button>
			</div>
		</div>
	</div>
</div>
<!-- নতুন: নামাজের সময়সূচি বিভাগ -->
<div id="prayerTimeContent" class="calculator-content">
    <div class="prayer-time-content">
        <h3 class="text-xl font-bold text-gray-700 mb-4 dark:text-gray-200">নামাজের সময়সূচি</h3>
        <p id="prayerTimeDate" class="text-md font-semibold text-gray-600 dark:text-gray-300 mb-4"></p>
        
        <div class="district-selector-wrapper mb-6">
            <label for="district-select" class="block text-left mb-2 font-semibold text-gray-700 dark:text-gray-200">আপনার জেলা নির্বাচন করুন:</label>
            <select id="district-select" class="w-full p-3 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white focus:ring-2 focus:ring-blue-500 transition-all"></select>
        </div>


<!-- prayerTimeContent div এর মধ্যে, district-selector-wrapper এর নিচে যোগ করুন -->
<div class="manual-time-control-wrapper mb-6 p-4 bg-gray-100 dark:bg-gray-700 rounded-lg shadow-inner">
    <div class="flex items-center justify-between mb-4">
        <label for="manualTimeToggle" class="font-semibold text-gray-700 dark:text-gray-200">ম্যানুয়াল সময় সেট করুন:</label>
        <label class="switch">
            <input type="checkbox" id="manualTimeToggle">
            <span class="slider round"></span>
        </label>
    </div>
    <div id="manualTimeInputs" class="hidden grid grid-cols-2 sm:grid-cols-3 gap-4">
        <div>
            <label for="manualSehri" class="block text-sm font-medium text-gray-600 dark:text-gray-300">সাহরি:</label>
            <input type="time" id="manualSehri" value="04:00" class="w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white">
        </div>
        <div>
            <label for="manualFajr" class="block text-sm font-medium text-gray-600 dark:text-gray-300">ফজর:</label>
            <input type="time" id="manualFajr" value="04:10" class="w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white">
        </div>
        <div>
            <label for="manualDhuhr" class="block text-sm font-medium text-gray-600 dark:text-gray-300">যোহর:</label>
            <input type="time" id="manualDhuhr" value="12:00" class="w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white">
        </div>
        <div>
            <label for="manualAsr" class="block text-sm font-medium text-gray-600 dark:text-gray-300">আসর:</label>
            <input type="time" id="manualAsr" value="16:30" class="w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white">
        </div>
        <div>
            <label for="manualIftar" class="block text-sm font-medium text-gray-600 dark:text-gray-300">ইফতার ও মাগরিব:</label>
            <input type="time" id="manualIftar" value="18:45" class="w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white">
        </div>
        <div>
            <label for="manualIsha" class="block text-sm font-medium text-gray-600 dark:text-gray-300">ইশা:</label>
            <input type="time" id="manualIsha" value="20:00" class="w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white">
        </div>
    </div>
</div>


        <div id="prayer-times-display" class="prayer-times-grid">
            <div class="prayer-time-card">
                <h4>সাহরি</h4>
                <p id="sehri-time">--:--</p>
            </div>
            <div class="prayer-time-card">
                <h4>ফজর</h4>
                <p id="fajr-time">--:--</p>
            </div>
            <div class="prayer-time-card">
                <h4>যোহর</h4>
                <p id="dhuhr-time">--:--</p>
            </div>
            <div class="prayer-time-card">
                <h4>আসর</h4>
                <p id="asr-time">--:--</p>
            </div>
            <div class="prayer-time-card">
                <h4>ইফতার ও মাগরিব</h4>
                <p id="iftar-time">--:--</p>
            </div>
            <div class="prayer-time-card">
                <h4>ইশা</h4>
                <p id="isha-time">--:--</p>
            </div>
        </div>
        <!-- আপডেট করা দ্রষ্টব্য -->
        <p class="mt-4 text-sm text-gray-500 dark:text-gray-400">দ্রষ্টব্য: সময়সূচি aladhan.com API থেকে আনা হয়েছে (হিসাব পদ্ধতি: University of Islamic Sciences, Karachi)। এটি ইসলামিক ফাউন্ডেশনের সময়ের সাথে কিছুটা ভিন্ন হতে পারে।</p>
    </div>
</div>

<!-- নতুন: ছবি থেকে লেখা (OCR) বিভাগ -->
<div id="imageToTextContent" class="calculator-content">
    <div class="image-to-text-content">
        <h3 class="text-xl font-bold text-gray-700 mb-4 dark:text-gray-200">ছবি থেকে লেখা বের করুন (OCR)</h3>
        <div class="image-upload-area">
            <label for="ocrImageInput" class="image-upload-label">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-12 h-12 mb-2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                <span>একটি ছবি নির্বাচন করুন</span>
            </label>
            <input type="file" id="ocrImageInput" accept="image/png, image/jpeg, image/webp" class="hidden">
        </div>
        <div id="ocrImagePreview" class="image-preview hidden"></div>
        <div class="flex gap-4 mt-4">
            <button id="extractTextBtn" class="extract-text-button">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2L14.5 9.5L22 12L14.5 14.5L12 22L9.5 14.5L2 12L9.5 9.5L12 2Z"/></svg>
                <span>লেখা বের করুন</span>
            </button>
        </div>
        <div id="ocrLoading" class="loading-indicator mt-4" style="display: none;">ছবি থেকে লেখা বের করা হচ্ছে...</div>
        <div class="result-area mt-4">
            <div class="flex justify-between items-center mb-2">
                <p class="result-section-title" style="text-align: left; margin: 0;">বের করা লেখা</p>
                <button id="copyOcrTextBtn" class="font-copy-button rounded-lg">কপি করুন</button>
            </div>
            <textarea id="ocrResultText" rows="10" placeholder="এখানে লেখা দেখা যাবে..."></textarea>
        </div>
        <button id="clearOcrBtn" class="font-clear-button rounded-lg mt-4 w-full">সব মুছে ফেলুন</button>
    </div>
</div>
<!-- নতুন: ওয়ার্ড কাউন্টার বিভাগ -->
<div id="wordCounterContent" class="calculator-content">
    <div class="word-counter-content">
        <h3 class="text-xl font-bold text-gray-700 mb-4 dark:text-gray-200">ওয়ার্ড ও ক্যারেক্টার কাউন্টার</h3>
        <p class="text-gray-600 dark:text-gray-400 mb-4">নিচের টেক্সটবক্সে আপনার লেখা পেস্ট করুন অথবা টাইপ করুন। ফলাফল রিয়েল-টাইমে আপডেট হবে।</p>
        <textarea id="wordCounterInput" rows="10" class="w-full p-3 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white focus:ring-2 focus:ring-blue-500 transition-all" placeholder="এখানে আপনার লেখা পেস্ট করুন অথবা টাইপ করুন..."></textarea>
        <div id="wordCounterStats" class="mt-4 grid grid-cols-2 sm:grid-cols-4 gap-4 text-center">
            <div class="p-4 bg-blue-100 dark:bg-blue-900 rounded-lg shadow">
                <h4 class="text-lg font-semibold text-blue-800 dark:text-blue-200">শব্দ</h4>
                <p id="wordCount" class="text-2xl font-bold text-blue-600 dark:text-blue-300">0</p>
            </div>
            <div class="p-4 bg-green-100 dark:bg-green-900 rounded-lg shadow">
                <h4 class="text-lg font-semibold text-green-800 dark:text-green-200">অক্ষর</h4>
                <p id="charCount" class="text-2xl font-bold text-green-600 dark:text-green-300">0</p>
            </div>
            <div class="p-4 bg-purple-100 dark:bg-purple-900 rounded-lg shadow">
                <h4 class="text-lg font-semibold text-purple-800 dark:text-purple-200">বাক্য</h4>
                <p id="sentenceCount" class="text-2xl font-bold text-purple-600 dark:text-purple-300">0</p>
            </div>
            <div class="p-4 bg-yellow-100 dark:bg-yellow-900 rounded-lg shadow">
                <h4 class="text-lg font-semibold text-yellow-800 dark:text-yellow-200">অনুচ্ছেদ</h4>
                <p id="paragraphCount" class="text-2xl font-bold text-yellow-600 dark:text-yellow-300">0</p>
            </div>
        </div>
    </div>
</div>

<!-- নতুন: আবহাওয়া বিভাগ -->
<div id="weatherContent" class="calculator-content">
    <div class="weather-content">
        <h3 class="text-xl font-bold text-gray-700 mb-4 dark:text-gray-200">আবহাওয়ার পূর্বাভাস</h3>
        <div class="weather-search-box">
            <input type="text" id="cityInput" placeholder="আপনার শহরের নাম লিখুন..." class="city-input">
            <button id="searchWeatherBtn" class="search-weather-button">খুঁজুন</button>
        </div>
        <div id="weatherResult" class="weather-result-area">
            <!-- আবহাওয়ার তথ্য এখানে দেখানো হবে -->
            <p>একটি শহরের নাম লিখে 'খুঁজুন' বাটনে ক্লিক করুন।</p>
        </div>
        <div id="weatherLoading" class="loading-indicator mt-4" style="display: none;">আবহাওয়ার তথ্য আনা হচ্ছে...</div>
    </div>
<!-- আবহাওয়া সেকশন শুরু -->
<section id="weather-section" class="bg-gray-800 p-8 rounded-xl shadow-lg mt-8 hidden">
    <div class="text-center mb-6">
        <h2 class="text-3xl font-bold text-white mb-2">আবহাওয়ার পূর্বাভাস</h2>
        <div class="flex flex-col sm:flex-row items-center justify-center gap-2 mb-4">
            <input type="text" id="location-search-input" placeholder="শহর বা জেলার নাম লিখুন..." class="p-2 rounded-lg text-gray-800 focus:outline-none focus:ring-2 focus:ring-blue-500 w-full sm:w-80">
            <button id="search-weather-button" class="bg-blue-600 text-white p-2 rounded-lg font-semibold hover:bg-blue-700 transition-colors w-full sm:w-auto">
                অনুসন্ধান করুন
            </button>
        </div>
        <p class="text-gray-400 text-lg" id="location-name"></p>
    </div>
    <div id="forecast-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 2xl:grid-cols-8 gap-4">
        <!-- এখানে প্রতিটি দিনের আবহাওয়ার কার্ডগুলো JavaScript দ্বারা যুক্ত হবে -->
    </div>
</section>
<!-- আবহাওয়া সেকশন শেষ -->
</div>

<!-- নতুন: নোটপ্যাড / টু-ডু লিস্ট বিভাগ (ফরম্যাটিং বার সহ) -->
<div id="notepadContent" class="calculator-content">
    <div class="notepad-container relative"> <!-- Toolbar-এর পজিশনের জন্য relative ক্লাস যুক্ত করা হয়েছে -->
        <h3 class="text-xl font-bold text-gray-700 mb-4 dark:text-gray-200">নোটপ্যাড / টু-ডু লিস্ট</h3>
        <p class="text-gray-600 dark:text-gray-400 mb-4">আপনার কাজ বা নোট যোগ করুন। ব্রাউজার বন্ধ করলেও আপনার ডেটা সেভ থাকবে। ছবিও পেস্ট করে যুক্ত করা যাবে।</p>
        
        <!-- ফরম্যাটিং অ্যাকশন বার -->
        <div id="notepadActionToolbar" class="notepad-action-toolbar flex">
            <button class="toolbar-btn" data-command="bold" title="বোল্ড (Ctrl+B)"><b>B</b></button>
            <button class="toolbar-btn" data-command="italic" title="ইটালিক (Ctrl+I)"><i>I</i></button>
            <button class="toolbar-btn" data-command="underline" title="আন্ডারলাইন (Ctrl+U)"><u>U</u></button>
            <button class="toolbar-btn" data-command="strikeThrough" title="স্ট্রাইকথ্রু"><s>S</s></button>
            <button class="toolbar-btn" data-command="increaseFontSize" title="ফন্ট বড় করুন">A+</button>
            <button class="toolbar-btn" data-command="decreaseFontSize" title="ফন্ট ছোট করুন">A-</button>
            <button class="toolbar-btn" data-command="justifyLeft" title="বামে অ্যালাইন">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M3 4h18v2H3V4zm0 14h12v2H3v-2zm0-7h18v2H3v-2z"></path></svg>
            </button>
            <button class="toolbar-btn" data-command="justifyCenter" title="মাঝে অ্যালাইন">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M3 4h18v2H3V4zm3 14h12v2H6v-2zm-3-7h18v2H3v-2z"></path></svg>
            </button>
            <button class="toolbar-btn" data-command="justifyRight" title="ডানে অ্যালাইন">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M3 4h18v2H3V4zm9 14h9v2h-9v-2zm-9-7h18v2H3v-2z"></path></svg>
            </button>
            <button class="toolbar-btn" data-command="justifyFull" title="জাস্টিফাই">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M3 4h18v2H3V4zm0 14h18v2H3v-2zm0-7h18v2H3v-2z"></path></svg>
            </button>
            <button class="toolbar-btn" data-command="removeFormat" title="ফরম্যাটিং মুছুন">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                    <path d="M9.134 11.634 6.866 4.366l1.23-.41L10.366 11.225zm-4.32-2.52- kullanılan.627-1.88L6.072 6.82l.627 1.884-1.885.63zm5.66-2.532.63-1.882 1.884.627-.629 1.883zM4.746 4.366l-1.23.41L1.28 11.225l1.23.41L4.746 4.366zM13.68 11.225l-2.234-6.699 1.23-.41 2.234 6.7zM2.58 12.04l.34-1.018H6.6l.339 1.018H2.58zM10.02 6.82l.63-1.882L12.532 5.57l-.63 1.883z"/>
                </svg>
            </button>
        </div>

        <div class="notepad-input-area">
            <!-- Textarea-কে contenteditable div দিয়ে প্রতিস্থাপন করা হয়েছে -->
            <div id="taskInput" class="task-input" contenteditable="true" data-placeholder="এখানে নতুন কাজ বা নোট লিখুন..."></div>
            <button id="addTaskBtn" class="add-task-btn">যোগ করুন</button>
        </div>
        <ul id="taskList" class="task-list">
            <!-- কাজগুলো এখানে জাভাস্ক্রিপ্ট দ্বারা যুক্ত হবে -->
        </ul>
    </div>
</div>

<!-- নতুন: ঘড়ি ট্যাব (স্টপওয়াচ, অ্যালার্ম, বিশ্ব ঘড়ি) -->
<div id="clockContent" class="calculator-content">
    <div class="clock-container">
        <!-- স্টপওয়াচ সেকশন -->
        <div class="clock-section stopwatch">
            <h3 class="section-title">স্টপওয়াচ</h3>
            <div class="stopwatch-display">00:00:00.000</div>
            <div class="stopwatch-controls">
                <button id="startStopwatch" class="control-btn start-btn">শুরু</button>
                <button id="stopStopwatch" class="control-btn stop-btn">থামুন</button>
                <button id="resetStopwatch" class="control-btn reset-btn">রিসেট</button>
                <button id="lapStopwatch" class="control-btn lap-btn">ল্যাপ</button>
            </div>
            <div class="laps-container">
                <h4>ল্যাপ টাইম</h4>
                <ul id="lapsList"></ul>
            </div>
        </div>

        <!-- অ্যালার্ম সেকশন -->
<!-- আপনার HTML ফাইলের পুরনো অ্যালার্ম সেকশনটি এই কোড দিয়ে সম্পূর্ণরূপে প্রতিস্থাপন করুন -->
<div class="clock-section alarm">
    <h3 class="section-title">অ্যালার্ম</h3>
    <div class="alarm-input-group">
        <input type="time" id="alarmTimeInput" class="alarm-time-input">
    </div>
    <!-- অ্যালার্ম সাউন্ড সিলেকশন -->
    <div class="alarm-sound-selector mb-4">
        <label for="alarmSoundSelect" class="block text-left mb-2 font-semibold text-gray-700 dark:text-gray-200">ডিফল্ট অ্যালার্ম সাউন্ড:</label>
        <select id="alarmSoundSelect" class="w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white">
            <option value="beep">বিপ</option>
            <option value="chime">চাইম</option>
            <option value="radar">রাডার</option>
        </select>
        
        <!-- নতুন: কাস্টম অডিও আপলোড -->
        <div class="mt-4">
            <label class="block text-left text-sm font-medium text-gray-600 dark:text-gray-300">অথবা নিজের অডিও ফাইল দিন (mp3, wav, ogg):</label>
            <div class="flex items-center gap-2 mt-2">
                <input type="file" id="customAlarmSoundInput" class="hidden" accept="audio/*">
                <label for="customAlarmSoundInput" class="custom-file-upload-small">ফাইল বাছাই করুন</label>
                <span id="customAlarmFileName" class="text-sm text-gray-500 dark:text-gray-400 truncate" style="max-width: 120px;">কোনো ফাইল নেই</span>
                <button id="removeCustomAlarmSound" class="hidden" title="কাস্টম সাউন্ড সরান">&times;</button>
            </div>
        </div>

    </div>
    <div class="alarm-controls">
        <button id="setAlarmBtn" class="control-btn set-alarm-btn">অ্যালার্ম সেট করুন</button>
        <!-- নতুন 'থামান' বাটন যোগ করা হয়েছে -->
        <button id="stopAlarmBtn" class="control-btn stop-btn hidden">অ্যালার্ম থামান</button>
        <button id="clearAlarmBtn" class="control-btn clear-alarm-btn">অ্যালার্ম মুছুন</button>
    </div>
    <div id="alarmStatus" class="alarm-status">কোনো অ্যালার্ম সেট করা নেই।</div>
</div>

        <!-- বিশ্ব ঘড়ি সেকশন -->
        <div class="clock-section world-clock">
            <h3 class="section-title">বিশ্ব ঘড়ি</h3>
            <div class="mb-4">
                <label for="timezone-select" class="block mb-2 font-semibold text-gray-700 dark:text-gray-200">অন্যান্য দেশের সময় দেখুন:</label>
                <select id="timezone-select" class="w-full p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white focus:ring-2 focus:ring-blue-500"></select>
            </div>
            <div class="world-clock-grid">
                <!-- ঘড়িগুলো এবং নির্বাচিত কার্ড জাভাস্ক্রিপ্ট দ্বারা এখানে যুক্ত হবে -->
            </div>
        </div>
    </div>
</div>


<!-- নতুন: প্লেয়ার ট্যাব -->
<div id="playerContent" class="calculator-content">
    <div class="player-container">
        <h3 class="text-xl font-bold text-gray-700 mb-4 dark:text-gray-200">মিডিয়া প্লেয়ার</h3>

        <!-- অডিও সেকশন -->
        <div class="player-section">
            <h4 class="player-section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>
                <span>অডিও প্লেয়ার</span>
            </h4>
            <div class="player-content-area">
                <audio id="audioPlayer" controls class="w-full"></audio>
                <div class="player-input-area">
                    <label for="audioInput" class="custom-file-upload">অডিও ফাইল বাছাই করুন</label>
                    <input type="file" id="audioInput" accept="audio/*">
                    <p id="audioFileName" class="file-name-display"></p>
                    <!-- অডিওর জন্য নতুন লুপ টগল সুইচ -->
                    <div class="flex items-center gap-2 ml-auto">
                        <span class="font-semibold text-gray-700 dark:text-gray-300 text-sm">লুপ</span>
                        <label class="switch">
                            <input type="checkbox" id="audioLoopToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- ছবি সেকশন -->
        <div class="player-section">
            <h4 class="player-section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                <span>ছবি প্রদর্শক</span>
            </h4>
            <div class="player-content-area">
                <div class="image-preview-box">
                    <img id="imagePreview" src="https://placehold.co/600x400/e2e8f0/4a5568?text=ছবি+লোড+করুন" alt="Image Preview">
                </div>
                <div class="player-input-area">
                    <label for="imageInput" class="custom-file-upload">ছবি বাছাই করুন</label>
                    <input type="file" id="imageInput" accept="image/*">
                </div>
            </div>
        </div>

        <!-- ভিডিও সেকশন -->
        <div class="player-section">
            <h4 class="player-section-title">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>
                <span>ভিডিও প্লেয়ার</span>
            </h4>
            <div class="player-content-area">
                <video id="videoPlayer" controls class="w-full rounded-lg bg-black"></video>
                <div class="player-input-area">
                    <label for="videoInput" class="custom-file-upload">ভিডিও ফাইল বাছাই করুন</label>
                    <input type="file" id="videoInput" accept="video/*">
                     <!-- ভিডিওর জন্য নতুন লুপ টগল সুইচ -->
                    <div class="flex items-center gap-2 ml-auto">
                        <span class="font-semibold text-gray-700 dark:text-gray-300 text-sm">লুপ</span>
                        <label class="switch">
                            <input type="checkbox" id="videoLoopToggle">
                            <span class="slider round"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<!-- নতুন: যাকাত ক্যালকুলেটর বিভাগ -->
<div id="zakatCalculatorContent" class="calculator-content">
    <div class="zakat-calculator-content">
        <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-4">যাকাত ক্যালকুলেটর</h3>
        <p class="text-gray-600 dark:text-gray-400 mb-6">আপনার যাকাতযোগ্য সম্পদের হিসাব করতে নিচের ঘরগুলো পূরণ করুন। রুপার হিসাব অনুযায়ী নিসাব গণনা করা নিরাপদ।</p>

        <div class="zakat-grid">
            <!-- নিসাব গণনা অংশ -->
            <div class="zakat-section nisab-section">
                <h4 class="zakat-section-title">নিসাব গণনা</h4>
                <div class="zakat-input-group">
                    <label for="silverPrice">১ ভরি রুপার বর্তমান বাজারমূল্য (টাকা)</label>
                    <input type="number" id="silverPrice" placeholder="যেমন: 2100" class="zakat-input">
                </div>
                 <div class="zakat-input-group">
                    <label for="goldPrice">১ ভরি সোনার বর্তমান বাজারমূল্য (টাকা)</label>
                    <input type="number" id="goldPrice" placeholder="যেমন: 110000" class="zakat-input">
                </div>
                <div class="nisab-result">
                    <p>রুপা অনুযায়ী নিসাব: <span id="nisabAmount" class="font-bold">৳ 0.00</span></p>
                    <small>(সাড়ে ৫২ ভরি রুপার মূল্যের সমপরিমাণ)</small>
                </div>
            </div>

            <!-- সম্পদ অংশ -->
            <div class="zakat-section">
                <h4 class="zakat-section-title">যাকাতযোগ্য সম্পদ</h4>
                <div class="zakat-input-group">
                    <label for="goldAmount">সোনা (ভরি)</label>
                    <input type="number" id="goldAmount" placeholder="0" class="zakat-input">
                </div>
                <div class="zakat-input-group">
                    <label for="silverAmount">রুপা (ভরি)</label>
                    <input type="number" id="silverAmount" placeholder="0" class="zakat-input">
                </div>
                <div class="zakat-input-group">
                    <label for="cashAmount">নগদ অর্থ (ব্যাংক, হাতে থাকা)</label>
                    <input type="number" id="cashAmount" placeholder="0" class="zakat-input">
                </div>
                <div class="zakat-input-group">
                    <label for="businessAssets">ব্যবসায়িক সম্পদ (বর্তমান বাজারমূল্য)</label>
                    <input type="number" id="businessAssets" placeholder="0" class="zakat-input">
                </div>
                <div class="zakat-input-group">
                    <label for="otherAssets">অন্যান্য সম্পদ (শেয়ার, বন্ড, প্রদত্ত ঋণ)</label>
                    <input type="number" id="otherAssets" placeholder="0" class="zakat-input">
                </div>
            </div>

            <!-- দেনা অংশ -->
            <div class="zakat-section">
                <h4 class="zakat-section-title">মোট দেনা / ঋণ</h4>
                <div class="zakat-input-group">
                    <label for="debtAmount">বাদযোগ্য ঋণ (যা এক বছরের মধ্যে পরিশোধযোগ্য)</label>
                    <input type="number" id="debtAmount" placeholder="0" class="zakat-input">
                </div>
            </div>
        </div>

        <button id="calculateZakatBtn" class="zakat-calculate-btn">যাকাতের হিসাব করুন</button>

        <div id="zakatResultArea" class="zakat-result-area">
            <!-- ফলাফল এখানে দেখানো হবে -->
        </div>
    </div>
</div>

<!-- নতুন: কিউআর কোড জেনারেটর বিভাগ (আপলোড ফিচার এবং লাইভ জেনারেশনসহ) -->
<div id="qrCodeContent" class="calculator-content">
    <div class="qr-code-content">
        <!-- ইনপুট এবং অপশন -->
        <div class="qr-input-section">
            <h3 class="text-xl font-bold text-gray-700 mb-2 dark:text-gray-200">কিউআর কোড জেনারেটর ও রিডার</h3>
            <p class="text-gray-600 dark:text-gray-400 mb-2">যেকোনো টেক্সট বা লিঙ্ক থেকে QR কোড তৈরি করুন অথবা ছবি আপলোড করে QR কোড থেকে তথ্য পড়ুন। টেক্সটবক্সে লিখলেই লাইভ QR কোড তৈরি হবে।</p>
            <textarea id="qrInput" rows="6" placeholder="এখানে আপনার টেক্সট বা URL লিখুন..."></textarea>
        </div>

        <!-- ফলাফল এবং বাটন -->
        <div class="qr-output-section">
            <!-- কিউআর কোড এখানে দেখানো হবে -->
            <div id="qrcode-container">
                <div id="qrcode" class="p-2 bg-white rounded-lg shadow-inner"></div>
                <div id="qrcode-placeholder" class="flex items-center justify-center">
                    <svg class="w-16 h-16 text-gray-300 dark:text-gray-500" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M5 5h3v3H5zm0 8h3v3H5zm8-8h3v3h-3zm0 8h3v3h-3zM9 2v2M9 20v2m8-11h2m-2-4h2m-6 0V2m-6 0V2m-2 4h2m-2 2H3m2 6H3m2 2H3m6 0v2m-4 0v2m11-2h2m-2 2h2m-2-6h2m-2-2h2"/></svg>
                </div>
            </div>
            
            <div class="qr-actions">
                <button id="downloadQrBtn" class="qr-button download" disabled>
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/><path d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708l3 3z"/></svg>
                    <span>ডাউনলোড (PNG)</span>
                </button>
                 <label for="qrFileInput" class="qr-button upload" style="cursor: pointer;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16"><path d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z"/><path d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z"/></svg>
                    <span>আপলোড</span>
                </label>
                <input type="file" id="qrFileInput" class="hidden" accept="image/*">
                <button id="clearQrBtn" class="qr-button clear">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 16 16"><path d="M2.5 1a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1H3v9a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V4h.5a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H10a1 1 0 0 0-1-1H7a1 1 0 0 0-1 1zm3 4a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 .5-.5M8 5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0v-7A.5.5 0 0 1 8 5m3 .5v7a.5.5 0 0 1-1 0v-7a.5.5 0 0 1 1 0"/></svg>
                    <span>মুছুন</span>
                </button>
            </div>
        </div>
    </div>
</div>

<!-- নতুন: জরুরি নম্বর বিভাগ -->
<div id="emergencyNumbersContent" class="calculator-content">
    <div class="emergency-numbers-content">
        <h3 class="text-xl font-bold text-gray-700 mb-2 dark:text-gray-200">জরুরি সেবার নম্বর</h3>
        <p class="text-gray-600 dark:text-gray-400 mb-4">জাতীয় জরুরি সেবা অথবা আপনার জেলা নির্বাচন করে প্রয়োজনীয় নম্বরগুলো দেখুন। নাম্বারগুলো যাচাই করা প্রয়োজন অথবা কাঙ্খিত সঠিক নাম্বারটি এডিট করে রাখতে পারবেন। ব্রাউজার বন্ধ করলেও নাম্বারটি সেভ থাকবে।</p>

        <div class="emergency-controls">
            <label for="location-select" class="font-semibold text-gray-700 dark:text-gray-300">অবস্থান নির্বাচন করুন:</label>
            <select id="location-select" class="w-full sm:w-auto p-2 border rounded-lg dark:bg-gray-600 dark:border-gray-500 dark:text-white focus:ring-2 focus:ring-blue-500 transition-all"></select>
        </div>

        <div id="emergency-numbers-display" class="emergency-numbers-grid">
            <!-- জরুরি নম্বরগুলো এখানে জাভাস্ক্রিপ্ট দ্বারা যুক্ত হবে -->
        </div>
    </div>
</div>

<!-- এখান থেকে ওপরে নতুন ট্যাবের সি এস এস কোড লিখতে হবে বা বসাতে হয় বা বসাতে হবে -->
</div>

    <!-- API কী মডেল -->
    <div id="apiKeyModal" class="api-key-modal-overlay hidden">
        <div class="api-key-modal-content">
            <h3>জেমিনি API কী সেট করুন</h3>
            <input type="text" id="apiKeyInput" placeholder="আপনার API কী এখানে লিখুন..." class="rounded-lg">
            <div class="modal-buttons">
                <button id="saveApiKeyBtn" class="modal-button save rounded-lg">সেভ করুন</button>
                <button id="cancelApiKeyBtn" class="modal-button cancel rounded-lg">বাতিল করুন</button>
            </div>
            <div id="apiKeyMessage" class="message-area"></div>
        </div>
    </div>
	
<!--css style End-->

<!--Script started from here-->

    <script>
	
// ====================================================================
// START: IndexedDB with Expiry
// ====================================================================
const DB_NAME = 'BanglaToolboxDB';
const STORE_NAME = 'converterStore';
const DB_VERSION = 1;
const FOUR_DAYS_IN_MS = 4 * 24 * 60 * 60 * 1000;

let dbPromise;

function getDb() {
    if (!dbPromise) {
        dbPromise = new Promise((resolve, reject) => {
            const request = indexedDB.open(DB_NAME, DB_VERSION);

            request.onerror = (event) => {
                console.error("IndexedDB error:", request.error);
                reject("IndexedDB error: " + request.error);
            };

            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                if (!db.objectStoreNames.contains(STORE_NAME)) {
                    db.createObjectStore(STORE_NAME, { keyPath: 'key' });
                }
            };

            request.onsuccess = (event) => {
                resolve(event.target.result);
            };
        });
    }
    return dbPromise;
}

async function idbSet(key, value, ttl = FOUR_DAYS_IN_MS) {
    const db = await getDb();
    const transaction = db.transaction(STORE_NAME, 'readwrite');
    const store = transaction.objectStore(STORE_NAME);
    const now = new Date();
    const item = {
        key: key,
        value: value,
        expiry: now.getTime() + ttl,
    };
    store.put(item);
    return transaction.complete;
}

async function idbGet(key) {
    const db = await getDb();
    const transaction = db.transaction(STORE_NAME, 'readonly');
    const store = transaction.objectStore(STORE_NAME);
    const request = store.get(key);

    return new Promise((resolve, reject) => {
        request.onsuccess = () => {
            const item = request.result;
            if (!item) {
                resolve(null);
                return;
            }
            const now = new Date();
            if (now.getTime() > item.expiry) {
                // Expired, delete it and resolve null
                const deleteTransaction = db.transaction(STORE_NAME, 'readwrite');
                deleteTransaction.objectStore(STORE_NAME).delete(key);
                resolve(null);
            } else {
                resolve(item.value);
            }
        };
        request.onerror = (event) => {
            console.error("idbGet error:", event.target.error);
            reject(event.target.error);
        };
    });
}

async function clearExpiredItems() {
    try {
        const db = await getDb();
        const transaction = db.transaction(STORE_NAME, 'readwrite');
        const store = transaction.objectStore(STORE_NAME);
        const request = store.openCursor();
        const now = new Date().getTime();

        request.onsuccess = event => {
            const cursor = event.target.result;
            if (cursor) {
                if (cursor.value.expiry < now) {
                    cursor.delete();
                }
                cursor.continue();
            }
        };
    } catch (error) {
        console.error("Error clearing expired items:", error);
    }
}
// ====================================================================
// END: IndexedDB with Expiry
// ====================================================================
		
	// Paste Preset Functionality Variables
	let pastePresetLeft = 'default';
	let customPasteValueLeft = '';
	let customSerialCounterLeft = 1;
	let pastePresetRight = 'default';
	let customPasteValueRight = '';
	let customSerialCounterRight = 1;
	let currentModalSide = null; // কোন পাশের ('left' বা 'right') মোডাল খোলা হয়েছে তা ট্র্যাক করে
	let currentModalPreset = null; // কোন প্রিসেট ('custom' বা 'custom-serial') এর জন্য ইনপুট প্রয়োজন তা ট্র্যাক করে

//Start Typing Script

document.addEventListener('DOMContentLoaded', () => {
    // Typing Test Tab এর জন্য প্রয়োজনীয় সকল DOM উপাদান নির্বাচন করা
    const typingTestTab = document.getElementById('typingTestTab');
    const typingTestContent = document.getElementById('typingTestContent');

    const notepadTab = document.getElementById('notepadTab');
    const notepadContent = document.getElementById('notepadContent');
    const imageToTextTab = document.getElementById('imageToTextTab');
    const imageToTextContent = document.getElementById('imageToTextContent');
    const wordCounterTab = document.getElementById('wordCounterTab');
    const wordCounterContent = document.getElementById('wordCounterContent');
    // নতুন যুক্ত করা উপাদান
    const textSelection = document.getElementById('textSelection');
    const timeSelection = document.getElementById('timeSelection');
    const customTextInputContainer = document.getElementById('custom-text-input');
    const clearTypingBtn = document.getElementById('clearTypingBtn');
    const totalWordsDisplay = document.getElementById('totalWordsDisplay');
    const weatherTab = document.getElementById('weatherTab');
    const weatherContent = document.getElementById('weatherContent');
    // আগের উপাদান
    const typingTextDisplay = document.getElementById('typingTextDisplay');
    const typingInput = document.getElementById('typingInput');
    const elapsedTimeDisplay = document.getElementById('elapsedTimeDisplay');
    const remainingTimeDisplay = document.getElementById('remainingTimeDisplay');
    const wpmDisplay = document.getElementById('wpmDisplay');
    const correctWordsDisplay = document.getElementById('correctWordsDisplay');
    const incorrectWordsDisplay = document.getElementById('incorrectWordsDisplay');
    const accuracyDisplay = document.getElementById('accuracyDisplay');
    const restartTypingBtn = document.getElementById('restartTypingBtn');
    const pauseResumeTypingBtn = document.getElementById('pauseResumeTypingBtn'); // পজ/রিজিউম বাটন

    // বাংলা এবং ইংরেজি অনুচ্ছেদের নমুনা
    const paragraphs = {
        bn_1: "বাংলা আমার মাতৃভাষা এবং আমি এই ভাষাকে অনেক ভালোবাসি। এই ভাষার জন্য আমাদের পূর্বপুরুষেরা রক্ত দিয়েছেন। একুশে ফেব্রুয়ারি আমাদের জন্য একটি গর্বের দিন।",
        bn_2: "বাংলাদেশ একটি সুন্দর দেশ। এখানে ছয়টি ঋতু পর্যায়ক্রমে আসে। প্রতিটি ঋতুরই নিজস্ব সৌন্দর্য ও বৈশিষ্ট্য রয়েছে। বর্ষাকালে প্রচুর বৃষ্টিপাত হয় এবং নদনদী পানিতে ভরে যায়।",
        bn_3: "তথ্যপ্রযুক্তি আমাদের জীবনকে অনেক সহজ করে দিয়েছে। ইন্টারনেট ব্যবহার করে আমরা বিশ্বের যেকোনো প্রান্তের মানুষের সাথে যোগাযোগ করতে পারি। শিক্ষা, স্বাস্থ্য, এবং বিনোদনের ক্ষেত্রেও এর ব্যাপক প্রভাব রয়েছে।",
        en_1: "The quick brown fox jumps over the lazy dog. This sentence contains all the letters of the English alphabet. It is often used for practicing typing.",
        en_2: "Technology has revolutionized the way we live and work. The internet connects billions of people worldwide, providing access to information and endless opportunities.",
        en_3: "To be successful in life, one needs dedication, hard work, and perseverance. Challenges are a part of the journey, but they make us stronger and more resilient."
    };

    let timer;
    let timeElapsed = 0;
    let totalTestTime = 0;
    let isTestActive = false;
    let isPaused = false; // টেস্ট পজ করা হয়েছে কিনা তা ট্র্যাক করতে
    let correctChars = 0;
    let incorrectChars = 0;

    // *** নতুন সংযোজন: ক্যারেক্টার রিপ্লেসমেন্টের জন্য হেল্পার ফাংশন ***
    function replaceTypingCharacters(textareaElement) {
        const value = textareaElement.value;
        const selectionStart = textareaElement.selectionStart;
        const selectionEnd = textareaElement.selectionEnd;

        // decomposed form (letter + nukta) থেকে precomposed form-এ পরিবর্তন করা হচ্ছে
        let newValue = value
            .replace(/য়/g, 'য়') // U+09AF + U+09BC -> U+09DF
            .replace(/ড়/g, 'ড়') // U+09A1 + U+09BC -> U+09DC
            .replace(/ঢ়/g, 'ঢ়'); // U+09A2 + U+09BC -> U+09DD

        if (newValue !== value) {
            textareaElement.value = newValue;
            // কার্সরের অবস্থান ঠিক রাখার জন্য
            textareaElement.setSelectionRange(selectionStart, selectionEnd);
        }
    }
    
    // টেস্ট শুরু বা রিসেট করার ফাংশন
    function initializeTest() {
        clearInterval(timer);
        isTestActive = false;
        isPaused = false; // পজ স্টেট রিসেট
        timeElapsed = 0;

        totalTestTime = parseInt(timeSelection.value, 10);

        typingInput.value = '';
        typingInput.disabled = false;
        correctChars = 0;
        incorrectChars = 0;

        const selection = textSelection.value;
        let selectedParagraph = '';

        if (selection === 'custom') {
            selectedParagraph = customTextInputContainer.value.trim();
            if (!selectedParagraph) {
                showCustomAlert('অনুগ্রহ করে কাস্টম টেক্সট ইনপুট করুন। ডিফল্ট অনুচ্ছেদ লোড করা হচ্ছে।');
                selectedParagraph = paragraphs['bn_1'];
            }
        } else {
            selectedParagraph = paragraphs[selection];
        }

        typingTextDisplay.innerHTML = selectedParagraph.split('').map(char => `<span>${char}</span>`).join('');
        const spans = typingTextDisplay.querySelectorAll('span');
        if (spans.length > 0) {
            spans[0].classList.add('current');
        }

        updateTimeDisplays();
        wpmDisplay.innerText = '0';
        correctWordsDisplay.innerText = '0';
        incorrectWordsDisplay.innerText = '0';
        accuracyDisplay.innerText = '100%';
        totalWordsDisplay.innerText = '0';

        // পজ/রিজিউম বাটন রিসেট করা
        if (pauseResumeTypingBtn) {
            pauseResumeTypingBtn.innerText = 'থামান';
            pauseResumeTypingBtn.disabled = true; // টেস্ট শুরু না হওয়া পর্যন্ত নিষ্ক্রিয়
        }
    }

    // টাইমার প্রদর্শন আপডেট করার ফাংশন
    function updateTimeDisplays() {
        const elapsedMinutes = Math.floor(timeElapsed / 60);
        const elapsedSeconds = timeElapsed % 60;
        elapsedTimeDisplay.innerText = `${elapsedMinutes.toString().padStart(2, '0')}:${elapsedSeconds.toString().padStart(2, '0')}`;

        if (totalTestTime > 0) {
            const remainingTime = totalTestTime - timeElapsed;
            if (remainingTime <= 0) {
                remainingTimeDisplay.innerText = '০০:০০';
                if (isTestActive) endTest();
                return;
            }
            const remainingMinutes = Math.floor(remainingTime / 60);
            const remainingSeconds = remainingTime % 60;
            remainingTimeDisplay.innerText = `${remainingMinutes.toString().padStart(2, '0')}:${remainingSeconds.toString().padStart(2, '0')}`;
        } else {
            remainingTimeDisplay.innerText = 'আনলিমিটেড';
        }
    }

    // *** সংশোধিত ফাংশন: handleTypingInput ***
    function handleTypingInput() {
        if (isPaused) return;

        // *** নতুন সংযোজন: অটোমেটিক অক্ষর রিপ্লেসমেন্ট ***
        replaceTypingCharacters(typingInput);
        // *** সংযোজন শেষ ***

        // প্রথম অক্ষর টাইপ করার সাথে সাথে টাইমার শুরু করুন
        if (!isTestActive && typingInput.value.length > 0) {
            startTimer();
            isTestActive = true;
            if (pauseResumeTypingBtn) pauseResumeTypingBtn.disabled = false;
        }

        const spans = Array.from(typingTextDisplay.querySelectorAll('span'));
        const typedValue = typingInput.value;
        const typedLength = typedValue.length;

        let localCorrectChars = 0;
        let localIncorrectChars = 0;

        // টাইপ করা সমস্ত অক্ষর পুনরায় মূল্যায়ন করুন
        spans.forEach((charSpan, index) => {
            charSpan.classList.remove('correct', 'incorrect', 'current');

            if (index < typedLength) {
                const originalChar = charSpan.innerText;
                const typedChar = typedValue[index];
                
                if (originalChar.normalize('NFC') === typedChar.normalize('NFC')) {
                    charSpan.classList.add('correct');
                    localCorrectChars++;
                } else {
                    charSpan.classList.add('incorrect');
                    localIncorrectChars++;
                }
            }
        });

        correctChars = localCorrectChars;
        incorrectChars = localIncorrectChars;

        if (typedLength < spans.length) {
            spans[typedLength].classList.add('current');
        } 
        
        if (typedLength >= spans.length) {
            endTest();
        }
        
        updateStats();
    }

    // টাইমার শুরু করার ফাংশন
    function startTimer() {
        timer = setInterval(() => {
            timeElapsed++;
            updateTimeDisplays();
            updateStats();
            
            if (totalTestTime > 0 && timeElapsed >= totalTestTime) {
                endTest();
            }
        }, 1000);
    }

    // পজ এবং রিজিউম ফাংশন
    function togglePauseResume() {
        if (!isTestActive) return;

        isPaused = !isPaused;

        if (isPaused) {
            clearInterval(timer);
            typingInput.disabled = true;
            pauseResumeTypingBtn.innerText = 'চালু করুন';
            showCustomAlert('টেস্ট থামানো হয়েছে।');
        } else {
            startTimer();
            typingInput.disabled = false;
            typingInput.focus();
            pauseResumeTypingBtn.innerText = 'থামান';
            showCustomAlert('টেস্ট পুনরায় শুরু হয়েছে।');
        }
    }
    
    // *** সংশোধিত ফাংশন: updateStats ***
    function updateStats() {
        const totalTypedChars = correctChars + incorrectChars;
        const accuracy = (totalTypedChars > 0) ? (correctChars / totalTypedChars) * 100 : 100;
        accuracyDisplay.innerText = `${Math.round(accuracy)}%`;
        const timeElapsedInMinutes = timeElapsed / 60;
        if (timeElapsedInMinutes > 0) {
            const netWPM = (correctChars / 5) / timeElapsedInMinutes;
            wpmDisplay.innerText = Math.round(netWPM > 0 ? netWPM : 0);
        } else {
            wpmDisplay.innerText = '0';
        }
        
        const allOriginalWords = typingTextDisplay.innerText.split(/\s+/).filter(Boolean);
        const typedWordsArray = typingInput.value.trim().split(/\s+/).filter(Boolean);
        
        let correctWordsCount = 0;
        typedWordsArray.forEach((typedWord, index) => {
            if (index < allOriginalWords.length && typedWord.normalize('NFC') === allOriginalWords[index].normalize('NFC')) {
                correctWordsCount++;
            }
        });

        const incorrectWordsCount = typedWordsArray.length > 0 ? typedWordsArray.length - correctWordsCount : 0;

        totalWordsDisplay.innerText = typedWordsArray.length;
        correctWordsDisplay.innerText = correctWordsCount;
        incorrectWordsDisplay.innerText = incorrectWordsCount;
    }


    // টেস্ট শেষ করার ফাংশন
    function endTest() {
        clearInterval(timer);
        isTestActive = false;
        typingInput.disabled = true;
        if (pauseResumeTypingBtn) pauseResumeTypingBtn.disabled = true;
        showCustomAlert('টাইপিং টেস্ট শেষ হয়েছে!');
        updateStats();
    }

    // ইভেন্ট লিসেনার যোগ করা
    if (typingTestTab) {
        typingTestTab.addEventListener('click', () => {
             showTab('typingTest');
             initializeTest();
        });
    }
    
    if (restartTypingBtn) {
        restartTypingBtn.addEventListener('click', initializeTest);
    }
    
    if (pauseResumeTypingBtn) {
        pauseResumeTypingBtn.addEventListener('click', togglePauseResume);
    }

    if (clearTypingBtn) {
        clearTypingBtn.addEventListener('click', () => {
            initializeTest();
            typingInput.value = '';
            typingInput.disabled = true;
            showCustomAlert('টেস্ট রিসেট করা হয়েছে।');
        });
    }
    
    if (typingInput) {
        typingInput.addEventListener('input', handleTypingInput);
    }
    
    // *** নতুন সংযোজন: কাস্টম টেক্সট বক্সের জন্য ইভেন্ট লিসেনার ***
    if (customTextInputContainer) {
        customTextInputContainer.addEventListener('input', () => {
            replaceTypingCharacters(customTextInputContainer);
            // কাস্টম টেক্সট পরিবর্তন হলে টেস্ট রিসেট করুন
            if (textSelection.value === 'custom') {
                 initializeTest();
            }
        });
    }
    // *** সংযোজন শেষ ***

    if (textSelection) {
        textSelection.addEventListener('change', (e) => {
            if (e.target.value === 'custom') {
                customTextInputContainer.classList.remove('hidden');
            } else {
                customTextInputContainer.classList.add('hidden');
            }
            initializeTest();
        });
    }

    if (timeSelection) {
        timeSelection.addEventListener('change', initializeTest);
    }
    
    if (typingTestContent && typingTestContent.classList.contains('active')) {
        initializeTest();
    }
 });
//End Typing Script
	
        // ====================================================================
        // START: DATE AND TIME BANNER SCRIPT (নতুন যুক্ত করা হয়েছে)
        // ====================================================================

        // গ্রেগরিয়ান তারিখকে বাংলা তারিখে রূপান্তর করার ফাংশন (বাংলাদেশ স্ট্যান্ডার্ড)
        function getBengaliDate(gregorianDate) {
            const year = gregorianDate.getFullYear();
            const month = gregorianDate.getMonth(); // 0-11
            const day = gregorianDate.getDate();

            let bengaliYear;
            const bengaliMonthNames = [
                "বৈশাখ", "জ্যৈষ্ঠ", "আষাঢ়", "শ্রাবণ", "ভাদ্র", "আশ্বিন",
                "কার্তিক", "অগ্রহায়ণ", "পৌষ", "মাঘ", "ফাল্গুন", "চৈত্র"
            ];

            // বাংলা বছর গণনা করুন (বাংলাদেশ স্ট্যান্ডার্ড: পহেলা বৈশাখ 14 এপ্রিল)
            if (month < 3 || (month === 3 && day < 14)) { // 14 এপ্রিলের আগে
                bengaliYear = year - 594;
            } else { // 14 এপ্রিল বা তার পরে
                bengaliYear = year - 593;
            }

            // বাংলা মাসের দিন সংখ্যা (বাংলাদেশ স্ট্যান্ডার্ড)
            // বৈশাখ থেকে ভাদ্র (5 মাস): 31 দিন
            // আশ্বিন থেকে চৈত্র (7 মাস): সাধারণত 30 দিন, অধিবর্ষে ফাল্গুন 31 দিন
            const bengaliMonthLengths = [31, 31, 31, 31, 31, 30, 30, 30, 30, 30, 30, 30];

            // বাংলা বছরের সাথে সম্পর্কিত গ্রেগরিয়ান বছরটি অধিবর্ষ কিনা তা নির্ধারণ করুন
            // এটি ফাল্গুনকে প্রভাবিত করে (11তম মাস, সূচক 10)
            const gregorianYearForBengaliLeapCheck = bengaliYear + 593;
            const isGregorianLeapYear = (gregorianYearForBengaliLeapCheck % 4 === 0 && gregorianYearForBengaliLeapCheck % 100 !== 0) || gregorianYearForBengaliLeapCheck % 400 === 0;

            if (isGregorianLeapYear) {
                bengaliMonthLengths[10] = 31; // অধিবর্ষে ফাল্গুন 31 দিন
            }

            // বর্তমান বাংলা বছরের শুরু থেকে অতিবাহিত দিন গণনা করুন (14 এপ্রিল)
            const startOfCurrentBengaliYearGregorian = new Date(year, 3, 14); // বর্তমান গ্রেগরিয়ান বছরের 14 এপ্রিল
            if (gregorianDate < startOfCurrentBengaliYearGregorian) {
                // যদি বর্তমান তারিখ 14 এপ্রিলের আগে হয়, তবে পূর্ববর্তী গ্রেগরিয়ান বছরের 14 এপ্রিলকে রেফারেন্স হিসাবে সামঞ্জস্য করুন
                startOfCurrentBengaliYearGregorian.setFullYear(year - 1);
            }

            const diffTime = gregorianDate.getTime() - startOfCurrentBengaliYearGregorian.getTime();
            let daysPassedSinceBengaliYearStart = Math.floor(diffTime / (1000 * 60 * 60 * 24));

            let currentBengaliMonthIndex = 0;
            let currentBengaliDay = 0;

            // সঠিক মাস এবং দিন খুঁজে বের করতে বাংলা মাসগুলির মধ্যে পুনরাবৃত্তি করুন
            for (let i = 0; i < bengaliMonthNames.length; i++) {
                if (daysPassedSinceBengaliYearStart < bengaliMonthLengths[i]) {
                    currentBengaliMonthIndex = i;
                    currentBengaliDay = daysPassedSinceBengaliYearStart + 1; // দিন 1-ইনডেক্সড
                    break;
                }
                daysPassedSinceBengaliYearStart -= bengaliMonthLengths[i];
            }

            // সংখ্যাগুলিকে বাংলা সংখ্যায় রূপান্তর করুন
            const toBengaliNumber = (num) => {
                const numbers = ['০', '১', '২', '৩', '৪', '৫', '৬', '৭', '৮', '৯'];
                return num.toString().split('').map(digit => numbers[parseInt(digit)]).join('');
            };

            // বাংলা মাসের মোট দিন
            const totalDaysInBengaliMonth = bengaliMonthLengths[currentBengaliMonthIndex];

            return {
                day: currentBengaliDay,
                month: bengaliMonthNames[currentBengaliMonthIndex],
                year: bengaliYear,
                totalDays: totalDaysInBengaliMonth,
                formatted: `${toBengaliNumber(currentBengaliDay)} ${bengaliMonthNames[currentBengaliMonthIndex]} ${toBengaliNumber(bengaliYear)} বঙ্গাব্দ`
            };
        }

        // আরবি সংখ্যাকে বাংলা সংখ্যায় রূপান্তর করার ফাংশন
        const arabicToBengaliNumbers = (text) => {
            const arabicDigits = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
            const bengaliDigits = ['০', '১', '২', '৩', '৪', '৫', '৬', '৭', '৮', '৯'];
            let converted = text;
            for (let i = 0; i < arabicDigits.length; i++) {
                converted = converted.replace(new RegExp(arabicDigits[i], 'g'), bengaliDigits[i]);
            }
            return converted;
        };

        // আরবি হিজরি মাসের নামগুলিকে বাংলা নামে ম্যাপ করুন
        const hijriMonthArabicToBengali = {
            'محرم': 'মুহাররম',
            'صفر': 'সফর',
            'ربيع الأول': 'রবিউল আউয়াল',
            'ربيع الآخر': 'রবিউস সানি',
            'جمادى الأولى': 'জমাদিউল আউয়াল',
            'جمادى الآخرة': 'জমাদিউস সানি',
            'رجب': 'রজব',
            'شعبان': 'শাবান',
            'رمضان': 'রমজান',
            'شوال': 'শাওয়াল',
            'ذو القعدة': 'জিলকদ',
            'ذو الحجة': 'জিলহজ'
        };

        function updateDateTimeBanner() {
            const bannerElement = document.getElementById('currentDateTimeBanner');
            if (!bannerElement) return;

            const now = new Date();

            // প্রতি মিনিটের শুরুতে (0 সেকেন্ডে) ব্যানারটি ফেইড ইন করুন
            if (now.getSeconds() === 0) {
                bannerElement.style.opacity = '1';
            }
            // প্রতি মিনিটের শেষে (59 সেকেন্ডে) ব্যানারটি ফেইড আউট করুন
            else if (now.getSeconds() === 59) {
                bannerElement.style.opacity = '0';
            }

            // Gregorian Date
            const gregorianDay = now.getDate();
            const gregorianMonth = now.toLocaleDateString('bn-BD', { month: 'long' });
            const gregorianYear = now.getFullYear();
            const gregorianDateString = `${gregorianDay} ${gregorianMonth} ${gregorianYear}`;
            const dayOfWeekBengali = now.toLocaleDateString('bn-BD', { weekday: 'long' }); // সপ্তাহের দিন বাংলাতে

            // Bengali Date (using existing getBengaliDate function)
            const bengaliDateInfo = getBengaliDate(now);
            const bengaliDateString = bengaliDateInfo.formatted;

            // Hijri Date (using existing logic)
            let hijriCalculationDate = new Date(now);
            hijriCalculationDate.setDate(hijriCalculationDate.getDate() - 2); // স্থানীয় কনভেনশন অনুযায়ী তারিখ সামঞ্জস্য করুন
            const hijriDateFormatter = new Intl.DateTimeFormat('ar-SA', {
                calendar: 'islamic',
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                timeZone: 'Asia/Dhaka'
            });
            const hijriParts = hijriDateFormatter.formatToParts(hijriCalculationDate);

            let hijriDay = '';
            let hijriMonthArabic = '';
            let hijriYear = '';
            for (const part of hijriParts) {
                if (part.type === 'day') {
                    hijriDay = arabicToBengaliNumbers(part.value);
                } else if (part.type === 'month') {
                    hijriMonthArabic = part.value;
                } else if (part.type === 'year') {
                    hijriYear = arabicToBengaliNumbers(part.value);
                }
            }
            const hijriMonthBengali = hijriMonthArabicToBengali[hijriMonthArabic] || hijriMonthArabic;
            const hijriDateString = `${hijriDay} ${hijriMonthBengali} ${hijriYear} হিজরি`;

            // Time
            const timeString = now.toLocaleTimeString('bn-BD', {
                hour: '2-digit',
                minute: '2-digit',
                hour12: true,
                timeZone: 'Asia/Dhaka'
            });

            // ব্যানার আপডেট করুন
            bannerElement.innerHTML = `<span class="text-green-700 dark:text-green-300">আজ</span> <span class="text-green-700 dark:text-green-300">${dayOfWeekBengali}</span>, <span class="text-blue-700 dark:text-blue-300">${gregorianDateString} ইং</span>, <span class="text-green-700 dark:text-green-300">${bengaliDateString.replace('বঙ্গাব্দ', '')} বঙ্গাব্দ</span>, <span class="text-purple-700 dark:text-purple-300">${hijriDateString}</span>, <span class="text-green-700 dark:text-green-300">এখন সময়</span><span class="text-green-700 dark:text-green-300">${timeString}</span>`;
        }

        // প্রতি সেকেন্ডে ব্যানার আপডেট করুন
        setInterval(updateDateTimeBanner, 1000);

        // ====================================================================
        // END: DATE AND TIME BANNER SCRIPT
        // ====================================================================


        // ====================================================================
        // START: DARK MODE / LIGHT MODE TOGGLE SCRIPT
        // ====================================================================
        const themeToggleBtn = document.getElementById('theme-toggle');

        // পৃষ্ঠা লোড হওয়ার সাথে সাথে থিম পরীক্ষা করুন
        if (localStorage.getItem('color-theme') === 'dark' || 
           (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        themeToggleBtn.addEventListener('click', function() {
            // 'dark' ক্লাস টগল করুন
            document.documentElement.classList.toggle('dark');

            // লোকাল স্টোরেজে পছন্দ সেভ করুন
            if (document.documentElement.classList.contains('dark')) {
                localStorage.setItem('color-theme', 'dark');
            } else {
                localStorage.setItem('color-theme', 'light');
            }
        });
        // ====================================================================
        // END: DARK MODE / LIGHT MODE TOGGLE SCRIPT
        // ====================================================================


        // ইউনিকোড থেকে বিজয় রূপান্তরের জন্য ম্যাপিং
        const unicodeToBijoyMap = {
            // স্বরবর্ণ সেকশন
            "অ": "A",        "আ": "Av",       "ই": "B",        "ঈ": "C",        "উ": "D",        "ঊ": "E",        "ঋ": "F",        "এ": "G",        "ঐ": "H",        "ও": "I",
            "ঔ": "J",

            // ব্যাঞ্জনবর্ণ সেকশন
            "ক": "K",        "খ": "L",        "গ": "M",        "ঘ": "N",        "ঙ": "O",        "চ": "P",        "ছ": "Q",        "জ": "R",        "ঝ": "S",        "ঞ": "T",
            "ট": "U",        "ঠ": "V",        "ড": "W",        "ঢ": "X",        "ণ": "Y",        "ত": "Z",        "থ": "_",        "দ": "`",        "ধ": "a",        "ন": "b",
            "প": "c",        "ফ": "d",        "ব": "e",        "ভ": "f",        "ম": "g",        "য": "h",        "র": "i",        "ল": "j",        "শ": "k",        "ষ": "l",
            "স": "m",        "হ": "n",        "ড়": "o",        "ঢ়": "p",        "য়": "q",        "ৎ": "r",        "ং": "s",        "ঃ": "t",        "ঁ": "u",        "ৰ": "v", "ড়": "o",        "ঢ়": "p",        "য়": "q",
             "র্বৃ": "e„©",       "ৱ": "w",     "ড়ে": "‡o",        "ঢ়ে": "‡p",        "য়ে": "‡q",   "ড়ৈ": "‰o",        "ঢ়ৈ": "‰p",        "য়ৈ": "‰q",    "ড়ি": "wo",   "ড়ো" :"‡ov",     "ঢ়ি": "wp",  	"য়ো": "‡qv",      "য়ি": "wq",

            // নম্বর সেকশন
            "০": "0",        "১": "1",        "২": "2",        "৩": "3",        "৪": "4",        "৫": "5",        "৬": "6",        "৭": "7",        "৮": "8",        "৯": "9",
            "৳": "৳",        "₹": "₹",

            // কার চিহ্ন সেকশন
            "া": "v",        "ি": "w",        "ী": "x",        "ু": "y",        "ূ": "~",        "ৃ": "„",

            // ফলা সেকশন
            "্র": "ª",        "্য": "¨",        "র্": "©",	

            // ওকার ঔকার সেকশন
            "ে": "‡",        "ৈ": "‰",        "ো": "‡v",       "ৌ": "‡Š",       "ৗ": "Š",

            // জয়েনার সেকশন
            "্": "&",

            // বিবিধ
            "।": "|",        "॥": "||",       "‘": "Ô",        "’": "Õ",        "“": "Ò",        "”": "Ó",        "৷": "৷",        "৥": "৥",


			
            // যুক্তবর্ণ সেকশন
            "ক্ক": "°",      "ক্ট": "±",      "ক্ত": "³",      "ক্ব": "K¡",     "ক্র": "µ",   "ক্লি": "wK¬",    "ক্ল": "K¬",     "ক্ষ": "¶",      "ক্স": "·",      "খ্র": "Lª",     "গ্দ": "M&`", 
            "গ্ধ": "»",      "গ্ন": "Mœ",     "গ্ম": "M¥",     "গ্র": "MÖ",     "গ্ল": "Mø",     "ঙ্ক": "¼",      "ঙ্খ": "•L",     "ঙ্গ": "½",      "ঙ্ঘ": "•N",     "চ্চ": "”P", 
            "চ্ছ": "”Q", "“ছ": "ÒQ",    "জ্জ": "¾",      "জ্ঝ": "À",      "জ্ঞ": "Á",      "জ্ব": "R¡",     "জ্র": "Rª",     "ঞ্চ": "Â",      "ঞ্ছ": "Ã",      "ঞ্জ": "Ä",	"ন্ব": "š^",
            "ঞ্ঝ": "Å",      "ট্ট": "Æ",      "ট্ব": "U¡",     "ট্ম": "U¥",     "ট্র": "Uª",     "ড্ড": "Ç",      "ড্র": "Wª",     "ঢ্র": "Xª",     "ণ্ট": "È",		"ত্ব": "Z¡",
            "ণ্ঠ": "É",      "ণ্ড": "Ð",      "ণ্ণ": "Yœ",     "ত্ত": "Ë",      "ত্থ": "Ì",      "ত্ন": "Zœ",     "ত্ম": "Z¥",     "ত্র": "Î",      "দ্দ": "Ï",		"ঙ্ম": "•g",	
            "দ্ধ": "×",      "দ্ব": "Ø",      "দ্ভ": "™¢",     "দ্ম": "Ù",      "দ্র": "`ª",     "ধ্ব": "aŸ",     "ধ্ম": "a¥",     "ন্ত": "šÍ",     "ন্থ": "š’",	"ক্ম": "´",
            "ন্দ": "›`",     "ন্ধ": "Ü",      "ন্ন": "bœ",     "ন্ম": "b¥",     "প্ট": "Þ",      "প্ত": "ß",      "প্ন": "cœ",     "প্প": "à",      "প্র": "cÖ",		"ক্ষ্ণ": "ÿè",
            "প্ল": "cø",     "প্স": "á",      "ফ্র": "d«",     "ফ্ল": "d¬",     "ব্জ": "â",      "ব্দ": "ã",      "ব্ধ": "ä",      "ব্ব": "eŸ",     "ব্র": "eª",	"গ্গ": "¹",
            "ব্ল": "eø",     "ভ্র": "å",      "ম্ন": "gœ",     "ম্ফ": "ç",      "ম্ব": "¤^",     "ম্ভ": "¤¢",     "ম্ম": "¤§",     "ম্র": "gª",     "ম্ল": "¤ø",	 "থ্ব": "_¡",
            "ল্ক": "é",      "ল্গ": "ê",      "ল্ট": "ë",      "ল্ড": "ì",      "ল্প": "í",      "ল্ব": "j¦",     "ল্ম": "j¥",     "ল্ল": "jø",     "শ্চ": "ð",	 "দ্দ্ব": "Ï¡",
            "শ্ন": "kœ",     "শ্ব": "k¦",     "শ্ম": "k¥",     "শ্ল": "kø",     "ষ্ক": "®‹",     "ষ্ট": "ó",      "ষ্ঠ": "ô",      "ষ্ণ": "ò",      "ষ্প": "®ú",	 "ন্ত্ব": "šÍ¡",
            "ষ্ফ": "õ",      "ষ্ম": "®§",     "স্ক": "¯‹",     "স্খ": "ö",      "স্ট": "÷",      "স্ত": "¯Í",     "স্থ": "¯’",     "স্ন": "mœ",     "স্প": "¯ú",	 "স্রূ": "¯ªƒ",
            "স্ফ": "ù",      "স্ব": "¯^",     "স্ম": "¯§",     "স্ল": "¯ø",     "হ্ণ": "nè",     "হ্ন": "ý",      "হ্ম": "þ",      "হ্ল": "n¬",     "হু": "û",		"ড়ু": "o–", 
            "হৃ": "ü",      "গু": "¸",      "শু": "ï",      "ক্ত্র": "³ª",     "ক্ন": "Kè",     "ক্ষ্ণ": "òœ",     "ক্ষ্ম": "²",      "ক্ষ্র": "ÿ«",     "গ্ব": "M&e",	"য়ু": "qy", 
            "ঘ্ন": "Nœ",     "ঘ্র": "Nª",     "ঙ্গু": "½y",     "জ্জ্ব": "¾¡",   "ত্ত্ব": "Ë¡",     "ত্রু": "Îæ",     "দ্রু": "`ªæ",    "ভ্রু": "åæ",     "শ্রু": "kÖæ",	"য়ূ": "q~",
            "ম্প": "¤ú",     "্র্য": "ª‍¨",    "র‌্য": "i¨",     "ক্য": "K¨",     "ল্যু": "j¨y",    "ক্লু": "K¬z",    "ত্র্য": "Î¨",     "স্থ্য": "¯’¨",    "দ্য": "`¨", 
            "ক্য": "K¨",     "ভ্য": "f¨",     "ল্য": "j¨", 	"দ্যু": "`y¨",     "ম্য": "g¨",     "ন্য": "b¨",     "ণ্য": "Y¨",     "কার্য": "Kvh©",   "র্ষ": "l©",       "র্য": "h©",		
		"ব্যু": "ey¨",   "ত্ব": "Z¡",	"হ্ব": "nŸ",	"গ্নু": "Mœy",	"র্ু": "z©",       "৳": "$",      "র্ষূ": "l~©",        "র্ষু": "ly©",    "–": "-","৷": "|",	"ড়ূ": "o~",  "“ছ": "ÒQ",
       

		
		};

        // বিজয় থেকে ইউনিকোড রূপান্তরের জন্য ম্যাপিং
        const bijoyToUnicodeMap = {
            // স্বরবর্ণ সেকশন
            "A": "অ",        "Av": "আ",       "B": "ই",        "C": "ঈ",        "D": "উ",        "E": "ঊ",        "F": "ঋ",        "G": "এ",        "H": "ঐ",        "I": "ও",
            "J": "ঔ",

            // *** সংশোধিত অংশ শুরু ***
            "†": "ে", // 'এ' এর পরিবর্তে 'ে' (e-kar)
            "ˆ": "ৈ", // 'ঐ' এর পরিবর্তে 'ৈ' (oi-kar)
            // *** সংশোধিত অংশ শেষ ***
			"‡": "ে", // 'এ' এর পরিবর্তে 'ে' (e-kar)
            "‰": "ৈ",
            // ব্যাঞ্জনবর্ণ সেকশন
            "K": "ক",        "L": "খ",        "M": "গ",        "N": "ঘ",        "O": "ঙ",        "P": "চ",        "Q": "ছ",        "R": "জ",        "S": "ঝ",        "T": "ঞ",
            "U": "ট",        "V": "ঠ",        "W": "ড",        "X": "ঢ",        "Y": "ণ",        "Z": "ত",        "_": "থ",        "`": "দ",        "a": "ধ",        "b": "ন",
            "c": "প",        "d": "ফ",        "e": "ব",        "f": "ভ",        "g": "ম",        "h": "য",        "i": "র",        "j": "ল",        "k": "শ",        "l": "ষ",
            "m": "স",        "n": "হ",        "o": "ড়",        "p": "ঢ়",        "q": "য়",        "r": "ৎ",        "s": "ং",        "t": "ঃ",        "u": "ঁ",

            // নম্বর সেকশন
            "0": "০",        "1": "১",        "2": "২",        "3": "৩",        "4": "৪",        "5": "৫",        "6": "৬",        "7": "৭",        "8": "৮",        "9": "৯",
            "৳": "৳",

            // কার চিহ্ন সেকশন
            "v": "া",        "w": "ি",        "x": "ী",        "y": "ু",        "~": "ূ",        "„": "ৃ",		"‡v": "ো", 	"z": "ু", 	"†v": "ো",		"†Š": "ৌ", 	"‡Š": "ৌ",

            // ফলা সেকশন
            "ª": "্র",        "¨": "্য",        "©": "র্", 	"Ö": "্র",

            // ওকার ঔকার সেকশন
            "‡": "ে",        "‰": "ৈ",        "Š": "ৗ",

            // জয়েনার সেকশন
            "&": "্",

            // বিবিধ
           	"¯’": "¯’",		"”Q": "”Q",		 "|": "।",        "||": "॥",       "Ô": "‘",        "Õ": "’",        "Ò": "“",        "Ó": "”",        " ": " ",        ".": ".",        ",": ",",        "-": "-",
            "?": "?",        "!": "!",        "'": "'",        "(": "(",        ")": ")",	"iæ": "রু",	"eªæ": "ব্রু", 	"Zz": "তু",	"nŸ": "হ্ব",

            // যুক্তবর্ণ সেকশন
            "°": "ক্ক",      "±": "ক্ট",      "³": "ক্ত",      "K¡": "ক্ব",     "µ": "ক্র",  "wK¬": "ক্লি",     "K¬": "ক্ল",     "¶": "ক্ষ",      "·": "ক্স",      "Lª": "খ্র",     "M&`": "গ্দ",
            "»": "গ্ধ",      "Mœ": "গ্ন",     "M¥": "গ্ম",     "MÖ": "গ্র",     "Mø": "গ্ল",     "¼": "ঙ্ক",      "•L": "ঙ্খ",     "½": "ঙ্গ",      "•N": "ঙ্ঘ",     "”P": "চ্চ", 
            "”Q": "চ্ছ",     "¾": "জ্জ",      "À": "জ্ঝ",      "Á": "জ্ঞ",      "R¡": "জ্ব",     "Rª": "জ্র",     "Â": "ঞ্চ",      "Ã": "ঞ্ছ",      "Ä": "ঞ্জ",	"cÖæ": "প্রু",
            "Å": "ঞ্ঝ",      "Æ": "ট্ট",      "U¡": "ট্ব",     "U¥": "ট্ম",     "Uª": "ট্র",     "Ç": "ড্ড",      "Wª": "ড্র",     "Xª": "ঢ্র",     "È": "ণ্ট",	"MÖæ": "গ্রু",
            "É": "ণ্ঠ",      "Ð": "ণ্ড",      "Yœ": "ণ্ণ",     "Ë": "ত্ত",      "Ì": "ত্থ",      "Zœ": "ত্ন",     "Z¥": "ত্ম",     "Î": "ত্র",      "Ï": "দ্দ",	"¯ª": "স্র",
            "×": "দ্ধ",      "Ø": "দ্ব",      "™¢": "দ্ভ",     "Ù": "দ্ম",      "`ª": "দ্র",     "aŸ": "ধ্ব",     "a¥": "ধ্ম",     "šÍ": "ন্ত",     "š’": "ন্থ",   "e„©": "র্বৃ",
            "›`": "ন্দ",     "Ü": "ন্ধ",      "bœ": "ন্ন",     "b¥": "ন্ম",     "Þ": "প্ট",      "ß": "প্ত",      "cœ": "প্ন",     "à": "প্প",      "cÖ": "প্র", 	"¤œ": "ম্ন",
            "cø": "প্ল",     "á": "প্স",      "d«": "ফ্র",     "d¬": "ফ্ল",     "â": "ব্জ",      "ã": "ব্দ",      "ä": "ব্ধ",      "eŸ": "ব্ব",     "eª": "ব্র",	 "´": "ক্ম",
            "eø": "ব্ল",     "å": "ভ্র",      "gœ": "ম্ন",     "ç": "ম্ফ",      "¤^": "ম্ব",     "¤¢": "ম্ভ",     "¤§": "ম্ম",     "gª": "ম্র",     "¤ø": "ম্ল",		"ÿè": "ক্ষ্ন",
            "é": "ল্ক",      "ê": "ল্গ",      "ë": "ল্ট",      "ì": "ল্ড",      "í": "ল্প",      "j¦": "ল্ব",     "j¥": "ল্ম",     "jø": "ল্ল",     "ð": "শ্চ",		"ÿ&Y": "ক্ষ্ণ",
            "kœ": "শ্ন",     "k¦": "শ্ব",     "k¥": "শ্ম",     "kø": "শ্ল",     "®‹": "ষ্ক",     "ó": "ষ্ট",      "ô": "ষ্ঠ",      "ò": "ষ্ণ",      "®ú": "ষ্প",		"¹": "গ্গ",
            "õ": "ষ্ফ",      "®§": "ষ্ম",     "¯‹": "স্ক",     "ö": "স্খ",      "÷": "স্ট",      "¯Í": "স্ত",     "¯’": "স্থ",     "mœ": "স্ন",     "¯ú": "স্প",	"M&M": "গ্গ",
            "ù": "স্ফ",      "¯^": "স্ব",     "¯§": "স্ম",     "¯ø": "স্ল",     "nè": "হ্ণ",     "ý": "হ্ন",      "þ": "হ্ম",      "n¬": "হ্ল",     "û": "হু",	"_¡": "থ্ব",
            "ü": "হৃ",      "¸": "গু",      "ï": "শু",      "³ª": "ক্ত্র",     "Kè": "ক্ন",     "òœ": "ক্ষ্ণ",     "²": "ক্ষ্ম",      "ÿ«": "ক্ষ্র",     "M&e": "গ্ব",	"Ï¡": "দ্দ্ব",
            "Nœ": "ঘ্ন",     "Nª": "ঘ্র",     "½y": "ঙ্গু",     "¾¡": "জ্জ্ব",   "Ë¡": "ত্ত্ব",     "Îæ": "ত্রু",     "`ªæ": "দ্রু",     "åæ": "ভ্রু",     "kÖæ": "শ্রু",	"šÍ¡": "ন্ত্ব",
            "¤ú": "ম্প",     "ª‍¨": "্র্য",    "i¨": "র‌্য",     "K¨": "ক্য",     "j¨y": "ল্যু",    "K¬z": "ক্লু",    "Î¨": "ত্র্য",     "¯’¨": "স্থ্য",    "`¨": "দ্য",	"gø": "ম্ল",
            "f¨": "ভ্য",     "j¨": "ল্য",     "g¨": "ম্য",     "b¨": "ন্য",     "Y¨": "ণ্য",     "Kv¨": "ক্যা",      	"ÿ": "ক্ষ",		"åƒ": "ভ্রূ",	"¯ªƒ": "স্রূ",
		"Z¡": "ত্ব",	"Û": "ন্ড",	"š¿": "ন্ত্র",    "z©": "র্ু", 	"y¨": "্যু",      "©…": "র্ৃ",     "z©": "র্ু",   "z©": "র্ু",    "‚©": "র্ূ",  "•ÿ": "ঙ্ক্ষ", "b¦": "ন্ব",	"¯cø": "স্প্ল",
		"~¨": "্যূ",   "z¨": "্যু",        "‚¨": "্যূ",  	"Kz©¨": "র্ক্যু",   "K‚©¨": "র্ক্যূ",  "³": "ক্ত",       "¯‘": "স্তু", 	"¯¿": "স্ত্র", 	"vu": "াঁ", 	"œ": "্ন",	"¼Í": "ঙ্ক্ত",
		"uv": "াঁ",	 "›Uª": "ন্ট্র",     "n«": "হ্র",	    "š‘": "ন্তু",	    "Z…": "তৃ",	    "K…": "কৃ",	    "P‚": "চূ",	    "f‚": "ভূ",	    "iƒ": "রূ",	  "¦": "্ব",
		"›U": "ন্ট",	    "«": "্র",	    "…": "ৃ",	    "‚": "ূ", 	     "æ": "ু",      "Ý": "ন্স",      "š^": "ন্ব",    "MÖƒ": "গ্রূ", "cÖƒ": "প্রূ", 
			"eªƒ": "ব্রূ", "kÖƒ": "শ্রূ",	"_¦": "থ্ব", "˜M": "দ্গ", "˜N": "দ্ঘ", "Ï": "দ্দ", "$": "৳", "K¥": "ক্ম", "òœ": "ক্ষ্ণ", "M&M": "গ্গ", "º": "গ্দ", "˜M": "দ্গ", "O¥": "ঙ্ম", "”T": "চ্ঞ", 
"Y&X": "ণ্ঢ", "Y¥": "ণ্ম", "Zø": "ত্ল", "Îƒ": "ত্রূ", "_¦": "থ্ব", "_ø": "থ্ল", "™£": "দ্ভ্র", "`ªƒ": "দ্রূ", "Ú": "ন্ঠ", "šÍ¦": "ন্ত্ব", "š’": "ন্থ", "åƒ": "ভ্রূ", "fø": "ভ্ল", "¤£": "ম্ভ্র", "¤ø": "ম্ল",
"î": "ল্ফ", "ñ": "শ্ছ", "®Œ": "ষ্ক্র", "¯Œ": "স্ক্র", "¯’": "স্থ", "¯ª~": "স্রূ", "¯ø": "স্ল", "—M": "ড়্গ", "aªƒ": "ধ্রূ", "¯úø": "স্প্ল", "¤úø": "ম্প্ল", "•g": "ঙ্ম", 	"mø": "স্ল", "¯": "্স",  "Zz¨": "ত্যু",	"¨~": "্যূ",	"o–": "ড়ু", "›Ø": "ন্দ্ব",
				
		};
        // ====================================================================
        // ম্যানুয়াল আনসি (বিজয়) রিপ্লেসমেন্ট ম্যাপ
        // ইউনিকোড থেকে বিজয় কনভার্সনের পর নির্দিষ্ট ভুল সংশোধনের জন্য ব্যবহৃত হয়।
        // ফরম্যাট: "ভুল স্ট্রিং": "সঠিক স্ট্রিং"
        const manualAnsiReplacements = {
            // নিচেরগুলোর মতো ম্যানুয়ালী বসাতে হবে সিকুয়েন্স, যদি আন্সিতে কোনো ভুল আউটপুট আসে।
            // ভবিষ্যতে আরও রিপ্লেসমেন্ট নিয়ম এখানে যোগ করুন
            "GZ‡": "G‡Z", // "এতে" GZ‡ কে G‡Z দিয়ে প্রতিস্থাপন করা হয়েছে, আন্সিতে ভুল আউটপুট এখানে এভাবে অ্যাড করতে হবে, আন্সি ভুল টু আন্সি সঠিক
			"‡ga¨": "g‡a¨",        "P&P": "”P",      "¨y": "y¨",       "©„": "©…",        "—": "-",        	"¯’": "¯’",		"”Q": "”Q",
			"+‡": "+†",        "+‰": "+ˆ",       "vu": "uv",       "xu": "ux",       "Šu": "uŠ",      "`¨y": "`y¨",           "Ô‡": "Ô†",       "Ò‡": "Ò†",      "-‡": "-†",       "(‡": "(†",       "Ô‰": "Ôˆ", // Corrected from "ˆ"
			"Ò‰": "Òˆ",        "-‰": "-ˆ",       "(‰": "ˆ",       "¶y": "ÿz",       "ww¯’Z": "w¯’wZ",      "cz©": "c©y",     "‡‡": "‡",        "††": "†",	"©z": "z©",
			"‰‰": "‰",         "ˆˆ": "ˆ",        "yy": "y",        "~~": "~",        "©©": "©",       "„„": "„",        "&&": "&",        "ªª": "ª",        "ŠŠ": "Š",
			"/‡": "/†",        "/‰": "(ˆ",       "=‡": "=†",       "=‰": "=ˆ",       "[‡": "[†",      "[‰": "[ˆ",      "{‡": "{†",       "{‰": "{ˆ",       " ‡": " †",
			" ‰": " ˆ",         "&;": "Ê",        "&|": "\\",      "&~": "E",        "&„": "F",        "&‡": "G",        "&‰": "H",
			"&b": "œ",         "&e": "¦",        "&g": "¥",        "&I": "I",        "&I&h": "I¨",    "&I&i": "Iª",     "&j": "ø",        "&Ô": "“",        "&Š": "J",
			"&v": "Av",        "&w": "B",        "&x": "C",        "&y": "D",        "&Z": "Í",        "(A)i": "(A)i",  "_&_": "Ì",       "_&e": "_¡",       "_&h": "_¨",
			"_&i": "_ª",        "_ª": "_ª",        "_u_": "Ì",       "`&`": "Ï",       "`&a": "×",       "`&e": "Ø",        "`&f": "™¢",      "`&g": "Ù",        "`&h": "`¨",
			"`&i": "`ª",        "`&M": "˜M",       "`&N": "˜N",       "`ª": "`ª",       "`ª~": "`ªƒ",      "`ªy": "`ªæ",      "¯’~": "¯’‚",      "¯’„": "¯’…",      "¯’y": "¯’z",
			"¯‹&i": "¯Œ",       "¯‹&iæ": "¯Œz",   "¯‹&j": "¯‹¬",    "¯‹~": "¯‹‚",      "¯‹„": "¯‹…",      "¯‹¬y": "¯‹¬z",   "¯‹ª": "¯Œ",      "¯‹y": "¯‹z",      "¯Í&e": "¯Í¡",
			"¯Í&i": "¯¿",       "¯Í~": "¯Í‚",      "¯Í„": "¯Í…",      "¯Íª": "¯¿",       "¯Íy": "¯‘",      "¯Œ~": "¯Œ‚",      "¯Œ„": "¯Œ…",      "¯Œy": "¯Œz",      "¯ú&j": "¯úø",
			"˜M&y": "`&¸",      "”P~": "”P‚",      "”P„": "”P…",      "”Py": "”Pz",      "”Q&e": "”Q¡",    "”Q~": "”Q‚",      "”Q„": "”Q…",      "”Qª": "”Q«",      "”Qy": "”Qz",
			"”T~": "”T‚",      "”T„": "”T…",      "”Ty": "”Tz",      "›`&e": "›Ø",     "›`ª~": "›`ªƒ",   "›`ªy": "›`ªæ",   "›U~": "›U‚",      "›U„": "›U…",      "›Uy": "›Uz",
			"¤¢&i": "¤£",      "¤¢ª": "¤£",      "¤ú&i": "¤úª",    "¤ú&j": "¤úø",    "±~": "±‚",       "±„": "±…",       "±y": "±z",       "»~": "»‚",       "»„": "»…",
			"»y": "»z",        "×~": "×‚",       "×„": "×…",       "×y": "×z",       "÷~": "÷‚",      "÷„": "÷…",       "÷y": "÷z",       "®‹~": "®‹‚",      "®‹„": "®‹…",
			"®‹ª": "®Œ",       "®‹y": "®‹z",      "®Œ~": "®Œ‚",      "®Œ„": "®Œ„",      "®Œy": "®Œz",      "®úª": "®úÖ",    "®úª~": "®úÖƒ",   "®úªy": "®úÖæ",   "°~": "°‚",
			"°„": "°…",        "°y": "°z",        "µ~": "µ‚",       "µ„": "µ…",       "µy": "µz",       "•ÿ~": "•ÿ‚",      "•ÿ„": "•ÿ…",      "•ÿy": "•ÿz",      "¼&l": "•ÿ",
			"¼~": "¼‚",        "¼„": "¼…",       "¼«~": "¼«‚",      "¼«„": "¼«…",      "¼«y": "¼«z",      "¼ª": "¼«",       "¼y": "¼z",       "¾&e": "¾¡",      "³~": "³‚",
			"³„": "³…",        "³ª": "³«",       "³y": "³z",       "a&e": "aŸ",       "a&g": "a¥",       "a&h": "a¨",       "A&h": "A¨",       "a&i": "aª",       "A&i": "Aª",
			"Á~": "Á‚",        "À~": "À‚",       "ä~": "ä‚",       "Ã~": "Ã‚",       "å~": "åƒ",       "Â‚": "Â‚",       "Á„": "Á…",       "À„": "À…",       "ä„": "ä…",
			"Ã„": "Ã…",        "Â…": "Â…",       "aª": "aª",       "Aª": "Aª",       "aª~": "aªƒ",      "aªy": "aªæ",      "Æ~": "Æ‚",       "Æ„": "Æ…",       "Æy": "Æz",
			"Av&h": "Av¨",     "Av&i": "Avª",    "Avª": "Avª",      "Áy": "Áz",       "Ây": "Âz",       "äy": "äz",       "Ãy": "Ãz",       "åy": "åæ",       "Àz": "Àz",
			"b&_": "š’",       "b&`": "›`",      "b&a": "Ü",       "b&b": "bœ",       "b&e": "š^",       "b&g": "b¥",       "b&h": "b¨",       "B&h": "B¨",       "b&i": "bª",
			"B&i": "Bª",        "b&m": "Ý",        "b&U": "›U",      "b&V": "Ú",       "b&W": "Û",       "b&Z": "šÍ",      "b&Z&i": "š¿",    "b&Zª": "š¿",      "bª": "bª",
			"Bª": "Bª",         "c&b": "cœ",       "c&c": "à",       "c&h": "c¨",       "C&h": "C¨",       "c&i": "cÖ",       "C&i": "Cª",       "c&j": "cø",       "c&m": "á",
			"c&U": "Þ",        "c&Z": "ß",       "ç~": "ç‚",       "Ç~": "Ç‚",       "ç„": "ç…",       "Ç„": "Ç…",       "cª": "cÖ",       "Cª": "Cª",       "cª~": "cÖƒ",
			"cªy": "cÖæ",      "cÖ~": "cÖƒ",      "cÖy": "cÖæ",      "çy": "çz",       "Çy": "Çz",       "d&h": "d¨",       "d&i": "d«",       "D&i": "Dª",       "d&j": "d¬",
			"d~": "d‚",        "ð~": "ð‚",       "Ð~": "Ð‚",       "d„": "d…",       "ð„": "ð…",       "Ð„": "Ð…",       "d«~": "d«‚",      "d«„": "d«…",      "d«y": "d«z",
			"d¬~": "d¬‚",      "d¬„": "d¬„",      "d¬y": "d¬z",      "dª": "d«",       "dy": "dz",       "ðy": "ðz",       "Ðy": "Ðz",       "e&`": "ã",       "e&a": "ä",
			"e&e": "eŸ",       "Ë&e": "Ë¡",      "e&h": "e¨",       "e&i": "eª",       "E&i": "Eª",       "e&j": "eø",       "e&R": "â",       "é~": "é‚",       "É~": "É‚",
			"È~": "È‚",        "ë~": "ë‚",      "Ë~": "Ë‚",       "é„": "é…",       "É„": "É…",       "È„": "È…",       "ë„": "ë…",       "Ë„": "Ë…",       "eª": "eª",
			"eª~": "eªƒ",      "eªy": "eªæ",      "éy": "éz",       "Éy": "Éz",       "Èy": "Èz",       "ëy": "ëz",       "Ëy": "Ëz",       "f&h": "f¨",       "F&h": "F¨",
			"f&i": "å",        "F&i": "Fª",       "f&j": "fø",      "f~": "f‚",       "f„": "f…",       "fª": "å",        "Fª": "Fª",       "fª~": "åƒ",      "fªy": "åæ",
			"fy": "fz",        "g&b": "¤œ",       "g&c": "¤ú",      "g&d": "ç",       "g&e": "¤^",       "g&f": "¤¢",       "g&f&i": "¤£",    "g&fª": "¤£",      "g&g": "¤§",
			"g&h": "g¨",       "G&h": "G¨",       "g&i": "¤ª",      "G&i": "Î",       "g&j": "¤ø",       "gª": "¤ª",       "Gª": "Gª",       "h&h": "h¨",       "H&h": "H¨",
			"h&i": "hª",       "H&i": "Hª",       "hª": "hª",       "Hª": "Hª",       "i&&I": "I©",     "i&_": "_©",       "i&`": "`©",      "i&a": "a©",       "i&A": "A©",
			"i&Av": "Av©",     "i&b": "b©",       "i&B": "B©",       "i&c": "c©",       "i&C": "C©",       "i&d": "d©",       "i&D": "D©",       "i&e": "e©",       "i&E": "E©",
			"i&f": "f©",       "i&F": "F©",       "i&g": "g©",       "i&G": "G©",       "i&h": "h©",       "i&H": "H©",       "i&i": "iª",       "i&I": "I©",       "I&i": "Iª",
			"i&j": "j©",       "i&J": "J©",       "i&k": "k©",       "i&K": "K©",       "i&l": "l©",       "i&L": "L©",       "i&m": "m©",       "i&M": "M©",       "i&n": "n©",
			"i&N": "N©",       "i&o": "o©",       "i&O": "O©",       "i&p": "p©",       "i&P": "P©",       "i&q": "q©",       "i&Q": "Q©",       "i&R": "R©",       "i&S": "S©",
			"i&T": "T©",       "i&U": "U©",       "i&V": "V©",       "i&W": "W©",       "i&X": "X©",       "i&Y": "Y©",       "i&Z": "Z©",       "i~": "iƒ",        "î~": "î~",
			"Î~": "Îƒ",       "î„": "î…",       "iª": "iª",        "Iª": "Iª",        "îª": "î«",       "iy": "iæ",        "îy": "îz",        "Îy": "Îæ",       "j&c": "í",
			"j&d": "î",        "j&d&i": "î«",     "j&dª": "î«",      "j&e": "j¦",       "j&g": "j¥",       "j&h": "j¨",       "J&h": "J¨",       "j&i": "jª",       "j&j": "jø",
			"j&K": "é",        "j&M": "ê",        "j&U": "ë",       "j&W": "ì",        "jª": "jª",        "Jª": "Jª",        "k&b": "kœ",       "K&b": "Kè",       "k&e": "k¦",
			"K&e": "K¡",       "k&g": "k¥",       "K&g": "´",        "k&h": "k¨",       "K&h": "K¨",       "k&i": "kÖ",       "K&i": "µ",        "K&j": "K¬",       "K&K": "°",
			"K&l": "ÿ",        "K&m": "·",        "k&P": "ð",       "k&Q": "ñ",        "K&U": "±",       "K&Z": "³",       "K&Zª": "³«",      "K~": "K‚",        "K„": "K…",
			"K¬~": "K¬‚",      "K¬„": "K¬…",      "K¬y": "K¬z",      "kª": "kÖ",       "Kª": "µ",        "kª~": "kÖƒ",      "Kª~": "µ’",      "kªy": "kÖæ",      "Kªy": "µ",
			"Kè~": "Kè‚",      "Kè„": "Kè…",      "Kèy": "Kèz",      "kÖ~": "kÖƒ",      "kÖy": "kÖæ",      "ky": "ï",        "Ky": "Kz",        "l&c": "®ú",      "l&d": "õ",
			"l&g": "®§",       "l&h": "l¨",       "L&h": "L¨",       "l&i": "lª",       "L&i": "Lª",       "l&K": "®‹",       "l&U": "ó",       "l&V": "ô",       "l&Y": "ò",
			"lª": "lª",        "Lª": "Lª",        "Lª~": "Lªƒ",      "Lªy": "Lªæ",      "m&_": "¯’",       "M&`": "º",       "M&a": "»",       "m&b": "¯œ",       "M&b": "Mœ",
			"m&c": "¯ú",       "m&d": "ù",        "m&e": "¯^",       "M&e": "M¦",       "m&g": "¯§",       "M&g": "M¥",       "m&h": "m¨",       "M&h": "M¨",       "m&i": "¯ª",
			"M&i": "MÖ",       "m&j": "¯ø",       "M&j": "Mø",       "m&K": "¯‹",       "m&K&i": "¯Œ",     "m&K&iy": "¯Œz",  "m&Kª": "¯Œ",      "m&Kªy": "¯Œz",    "m&L": "ö",
			"m&U": "÷",        "m&Z": "¯Í",      "mª": "¯ª",       "Mª": "MÖ",       "Mª~": "MÖƒ",      "Mªy": "MÖæ",      "MÖ~": "MÖƒ",      "MÖy": "MÖæ",      "My": "¸",
			"n&b": "ý",        "N&b": "Nœ",       "n&e": "nŸ",       "n&e2": "n¡",     "n&g": "þ",        "n&h": "n¨",       "N&h": "N¨",       "n&i": "n«",       "N&i": "Nª",
			"n&j": "n¬",       "n&Y": "nè",       "ñ~": "ñ‚",       "n„": "ü",        "ñ„": "ñ…",       "nª": "n«",       "Nª": "Nª",       "Nª~": "Nªƒ",      "Nªy": "Nªæ",
			"ny": "û",         "ñy": "ñz",        "O&g": "•g",       "o&h": "o¨",       "O&h": "O¨",       "o&i": "oª",       "O&i": "Oª",       "O&K": "¼",       "O&L": "•L",
			"o&M": "—M",       "O&M": "½",        "O&N": "•N",       "O~": "O‚",        "ó~": "ó‚",       "ò~": "ò‚",       "ô~": "ô‚",       "õ~": "õ‚",       "O„": "O…",
			"ó„": "ó…",        "ò„": "ò…",       "ô„": "ô…",       "õ„": "õ…",       "oª": "oª",       "Oª": "Oª",       "oy": "o–",       "Oy": "Oz",        "óy": "óz",
			"òy": "òz",        "ôy": "ôz",       "õy": "õz",       "p&h": "p¨",       "P&h": "P¨",       "p&i": "pª",       "P&i": "Pª",       "P&P": "”P",       "P&Q": "”Q",
			"P&T": "”T",       "P~": "P‚",        "P„": "P…",       "pª": "pª",       "Pª": "Pª",       "Puv": "Pvu",      "Py": "Pz",        "q&h": "q¨",       "Q&h": "Q¨",
			"q&i": "qª",       "Q&i": "Q«",       "Q~": "Q‚",        "Q„": "Q…",       "qª": "qª",       "Qª": "Q«",       "Qy": "Qz",        "R&e": "R¡",       "R&h": "R¨",
			"R&i": "Rª",       "R&R": "¾",        "R&S": "À",        "R&T": "Á",       "Rª": "Rª",       "rª\t": "rª",     "S&h": "S¨",       "S&i": "Sª",       "S~": "S‚",
			"š’~": "š’‚",      "š’„": "š’…",      "š’y": "š’z",      "S„": "S…",       "sª": "sª",       "Sª": "Sª",       "šÍ&i": "š¿",     "šÍ~": "šÍ‚",      "šÍ„": "šÍ…",
			"šÍª": "š¿",       "šÍy": "š‘",       "ß~": "ß‚",       "ß„": "ß…",       "ßy": "ßz",       "Sy": "Sz",        "T&h": "T¨",       "T&i": "Tª",       "T&P": "Â",
			"T&Q": "Ã",        "T&R": "Ä",        "T&S": "Å",        "T~": "T‚",        "T„": "T…",       "tª": "tª",       "Tª": "Tª",       "þ~": "þ~",        "Þ~": "Þ‚",
			"þ„": "þ„",        "Þ„": "Þ…",       "þy": "þz",       "Þy": "Þz",       "Ty": "Tz",        "™¢~": "™¢‚",      "™¢„": "™¢…",      "™¢ª": "™£",      "™¢y": "™¢z",
			"™£~": "™£ƒ",      "™£y": "™£æ",      "U&e": "U¡",       "U&g": "U¥",       "U&h": "U¨",       "U&i": "Uª",       "U&U": "Æ",       "U~": "U‚",        "Ú~": "Ú‚",
			"ù~": "ù‚",        "Û~": "Û‚",       "Ü~": "Ü‚",       "U„": "U…",       "Ú„": "Ú…",       "ù„": "ù…",       "Û„": "Û…",       "Ü„": "Ü…",       "ù«~": "ù«‚",
			"Ü«~": "Ü«‚",      "Ü«„": "Ü«…",      "ù«y": "ù«z",      "Ü«y": "Ü«z",      "Uª": "Uª",       "ùª": "ù«",       "Üª": "Ü«",       "uŠ": "Šu",        "ux": "xu",
			"uy": "yu",        "Uy": "Uz",        "Úy": "Úz",       "ùy": "ùz",       "Ûy": "Ûz",       "Üy": "Üz",       "V&h": "V¨",       "V&i": "Vª",       "V~": "V‚",
			"V„": "V…",        "Vª": "Vª",        "Vy": "Vz",        "W&h": "W¨",       "W&i": "Wª",       "W&W": "Ç",       "W~": "W‚",        "W„": "W…",       "Wª": "Wª",
			"Wy": "Wz",        "X&h": "X¨",       "X&i": "Xª",       "X~": "X‚",        "X„": "X…",       "Xª": "Xª",       "Xy": "Xz",        "Y&b": "Yœ",       "ÿ&b": "ÿè",
			"Y&e": "Y¦",       "ÿ&g": "²",        "Y&h": "Y¨",       "Y&i": "Yª",       "Y&U": "È",       "Y&V": "É",       "Y&W": "Ð",       "ÿ~": "ÿ‚",         "ÿ„": "ÿ…",
			"Yª": "Yª",        "ÿè~": "ÿè‚",      "ÿè„": "ÿè…",      "ÿèy": "ÿèz",      "ÿy": "ÿz",       "Z&_": "Ì",       "Z&b": "Zœ",       "Z&e": "Z¡",          "Z&g": "Z¥",
			"Z&h": "Z¨",       "Z&i": "Î",        "Z&Z": "Ë",       "Z~": "Z‚",        "Z„": "Z…",       "Zª": "Î",        "Zª~": "Îƒ",          "Zªy": "Îæ",           "Zy": "Zz",
			"|‡": "|†",			",‡": ",†",			".‡": ".†",			"-‡": "-†",			"?‡": "?†",		":‡": ":†",			"=‡": "=†",			"|‰": "|ˆ",	     "K©~": "K‚©",	
			",‰": ",ˆ",		"f¨~": "f‚¨",				"f©~": "f‚©",		".‰": ".ˆ",		"-‰": "-ˆ",			"?‰": "?ˆ",			":‰": ":ˆ",		"=‰": "=ˆ",   "wwK¬": "wK¬w",
			"e©…": "e„©",	   "e¨~": "e~¨",    	  "P©~": "P‚©Ó",   		 "P©y": "Pz©",     "K©y" :"Kz©", 			"f©y": "fz©",		 "Ky": "Kz",	"v©": "©v",		"x©": "©x",
			"Š©": "©Š", 		"¯Õ": "¯’",			"ÓQ": "”Q", 
			
			//"ÒQ": "”Q",
			
			"wwó": "wów",	"šÔ": "š‘",	"dÖ": "d«",  "f’": "f‚",	"šÕ": "š’", "¯Ô": "¯‘",	"ÓP": "”P", "ÓT": "”T", "e«": "eª", 	"g…": "g„",	"e…" : "e„",	"U«" : "Uª",	"d«" : "d«",	"k«" : "kÖ",	"'‡" : "'†",	
			"'‰" : "'ˆ",		"gœ": "¤œ",		"Auv": "Avu",		"iÒ": "iæ",		"M«": "MÖ",	"KÍ¡": "³¦", "¯-":"¯Í", 	"U©y": "Uz©",	"¨~": "‚¨", 		"©¨y": "y©¨", "©¨~": "~¨",	"¨©": "©¨",	"©¨z": "z©¨", "©¨‚": "‚©¨",	"©z": "z©",	"©‚": "‚©",	"©y": "y©", "©~": "~©", "P‚©Ó": "P‚©",	"MÖÒ": "MÖæ",	"Ê": "æ",	"­": "ø",
			"b‚": "b~",
			"ÎÒ": "Îæ", "_ªÒ": "_ªæ", "×Ÿ": "×¦", "`ªÒ": "`ªæ", "š-": "šÍ", "š-¡": "šÍ¦", "c&Î": "ßª", "cÖÒ": "cÖæ", "eªÒ": "eªæ", "åÒ": "åæ", "kÖÒ": "kÖæ", "¯ªÒ": "¯ªæ", "c«": "cÖ",	"÷«": "÷ª",	"U«": "Uª",

        };

        // ম্যানুয়াল ইউনিকোড রিপ্লেসমেন্ট ম্যাপ (নতুন সেকশন)
        // বিজয় থেকে ইউনিকোড কনভার্সনের পর নির্দিষ্ট ভুল সংশোধনের জন্য ব্যবহৃত হয়।
        // ফরম্যাট: "ভুল স্ট্রিং": "সঠিক স্ট্রিং"
        const manualUnicodeReplacements = {
            // "ভুল ইউনিকোড": "সঠিক ইউনিকোড",
            // উদাহরণ: "উদাহরণ": "উদাহরণ", 
			
			"র্তু্য": "র্ত্যু",
			"র্তূ্য": "র্ত্যূ",
			"র্ভূ্য": "র্ভ্যূ",
			"র্ভু্য": "র্ভ্যু",
        };
        // ====================================================================


        // দীর্ঘতম থেকে ছোট ক্রমে কীগুলি সাজান যাতে দীর্ঘ ক্রমগুলি প্রথমে হ্যান্ডেল করা যায়
        const sortedUnicodeKeys = Object.keys(unicodeToBijoyMap).sort((a, b) => b.length - a.length);
        const sortedBijoyKeys = Object.keys(bijoyToUnicodeMap).sort((a, b) => b.length - a.length);

        function convertLeftToRight() {
            const textAreaLeft = document.getElementById('textAreaLeft');
            const textAreaRight = document.getElementById('textAreaRight');
            let unicodeInput = textAreaLeft ? textAreaLeft.value : '';

            // --- ক্যারেক্টার ডেফিনিশন ---
            const bengaliConsonants = 'কখগঘঙচছজঝঞটঠডঢণতথদধনপফবভমযরলশষসহড়ঢ়য়';
            const unicodeIkar = '\u09BF'; // ি
            const unicodeEkar = '\u09C7'; // ে
            const unicodeOikar = '\u09C8'; // ৈ
            const unicodeOkar = '\u09CB'; // ো
            const unicodeOukar = '\u09CC'; // ৌ
            const unicodeAkar = '\u09BE'; // া
            const unicodeOuKarPart2 = '\u09D7'; // ৗ
            const unicodeHasanta = '\u09CD'; // ্
            const unicodeRefChar = '\u09B0\u09CD'; // র্ (র + হসন্ত)
            const unicodeJaPhala = '\u09CD\u09AF'; // ্য (হসন্ত + য)
            const unicodeRaPhala = '\u09CD\u09B0'; // ্র (হসন্ত + র)

            // --- প্রি-প্রসেসিং ধাপ ---

            // ধাপ ১: ও-কার এবং ঔ-কারকে তাদের উপাদান অংশে বিভক্ত করুন
            // এটি করা হয় যাতে 'ে' কারকে সঠিকভাবে আগে আনা যায়।
            // যেমন: কো -> ক + ে + া
            const consonantOrConjunct = `(?:(?:[${bengaliConsonants}]${unicodeHasanta})+[${bengaliConsonants}]|[${bengaliConsonants}])`;
            const o_ou_kar_regex = new RegExp(`(${consonantOrConjunct})(${unicodeOkar}|${unicodeOukar})`, 'g');
            unicodeInput = unicodeInput.replace(o_ou_kar_regex, (match, base, vowelSign) => {
                if (vowelSign === unicodeOkar) return base + unicodeEkar + unicodeAkar;
                if (vowelSign === unicodeOukar) return base + unicodeEkar + unicodeOuKarPart2;
                return match;
            });

            // ধাপ ২: বিজয় লেআউটের জন্য কার-চিহ্ন (ি, ে, ৈ) আগে আনুন
            // এই অংশটি রেফ, র-ফলা, য-ফলা সহ সকল যুক্তবর্ণের জন্য কাজ করবে।
            // যেমন: ক + ি -> ি + ক
            // যেমন: র্ + ক + ি -> ি + র্ + ক
            // যেমন: ক + ্র + ি -> ি + ক + ্র
            const precedingVowelRegex = new RegExp(`(${unicodeRefChar})?(${consonantOrConjunct})((?:${unicodeJaPhala}|${unicodeRaPhala})?)(${unicodeIkar}|${unicodeEkar}|${unicodeOikar})`, 'g');
            unicodeInput = unicodeInput.replace(precedingVowelRegex, (match, reph, base, phala, vowel) => {
                return vowel + (reph || '') + base + (phala || '');
            });
            
            // ধাপ ৩: মূল কনভার্সন লুপ
            let bijoyOutput = '';
            let k = 0;
            while (k < unicodeInput.length) {
                let foundMatch = false;

                // রেফ ('র্') এর জন্য বিশেষ হ্যান্ডলিং (যাতে © চিহ্নটি সঠিক জায়গায় বসে)
                if (unicodeInput.substring(k, k + 2) === unicodeRefChar) {
                    let baseCluster = '';
                    let clusterLen = 0;
                    // রেফের পরে দীর্ঘতম যুক্তবর্ণটি খুঁজুন
                    for (const key of sortedUnicodeKeys) {
                        if (key.length > 0 && unicodeInput.substring(k + 2, k + 2 + key.length) === key) {
                            baseCluster = key;
                            clusterLen = key.length;
                            break;
                        }
                    }
                    
                    if (clusterLen > 0) {
                        bijoyOutput += unicodeToBijoyMap[baseCluster] + '©';
                        k += 2 + clusterLen;
                        foundMatch = true;
                    }
                }

                // সাধারণ ম্যাপিং
                if (!foundMatch) {
                    for (const key of sortedUnicodeKeys) {
                        if (key.length > 0 && unicodeInput.substring(k, k + key.length) === key) {
                            bijoyOutput += unicodeToBijoyMap[key];
                            k += key.length;
                            foundMatch = true;
                            break;
                        }
                    }
                }

                // যদি কোনো ম্যাচ না পাওয়া যায়
                if (!foundMatch) {
                    bijoyOutput += unicodeInput[k];
                    k++;
                }
            }

            // ধাপ ৪: ম্যানুয়াল আনসি রিপ্লেসমেন্ট প্রয়োগ
            for (const [wrong, correct] of Object.entries(manualAnsiReplacements)) {
                if (wrong) { // খালি কী এড়িয়ে চলুন
                    const regex = new RegExp(wrong.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                    bijoyOutput = bijoyOutput.replace(regex, correct);
                }
            }

            // ধাপ ৫: ব্যবহারকারীর অনুরোধ অনুযায়ী অতিরিক্ত রিপ্লেসমেন্ট (লাইনের শুরু এবং দাড়ির পর)
            // এটি শব্দের শুরুতে ভুল কার-চিহ্নকে সঠিক স্বরবর্ণে পরিবর্তন করে।
            // যেমন, একটি লাইন 'ে' (‡) দিয়ে শুরু হতে পারে না, এটি 'এ' (†) হওয়া উচিত।
            bijoyOutput = bijoyOutput.replace(/^‡/gm, '†'); // লাইনের শুরুতে
            bijoyOutput = bijoyOutput.replace(/\|‡/g, '|†');   // দাড়ির পরে

            // একই নিয়ম 'ৈ' (‰) এর ক্ষেত্রেও প্রযোজ্য, যা 'ঐ' (ˆ) হওয়া উচিত।
            bijoyOutput = bijoyOutput.replace(/^‰/gm, 'ˆ'); // লাইনের শুরুতে
            bijoyOutput = bijoyOutput.replace(/\|‰/g, '|ˆ');   // দাড়ির পরে

            if (textAreaRight) {
                textAreaRight.value = bijoyOutput;
                addState('textAreaRight');
            }
            
            // *** নতুন সংযোজন: স্বয়ংক্রিয়ভাবে ফিক্স ফাংশন কল করুন ***
            // showAlert প্যারামিটার false পাঠানো হয়েছে যাতে কোনো পপ-আপ বার্তা না আসে।
            fixAnsiText(false);
        }

// ====================================================================
        // START: UPDATED FUNCTION (বিজয় থেকে ইউনিকোড)
        // ====================================================================
        function convertRightToLeft() {
            const textAreaLeft = document.getElementById('textAreaLeft');
            const textAreaRight = document.getElementById('textAreaRight');
            let bijoyInput = textAreaRight ? textAreaRight.value : '';

            // ধাপ ০: প্রথমে fixAnsiText ফাংশন কল করুন
            // showAlert প্যারামিটার false পাঠানো হয়েছে যাতে কোনো পপ-আপ বার্তা না আসে।
            fixAnsiText(false); 
            bijoyInput = textAreaRight ? textAreaRight.value : ''; // ফিক্সড টেক্সট পুনরায় লোড করুন

            // --- ধাপ ১: বিজয় থেকে ইউনিকোড ম্যাপিং ---
            let unicodeOutput = '';
            let i = 0;
            while (i < bijoyInput.length) {
                let foundMatch = false;
                for (const key of sortedBijoyKeys) {
                    if (bijoyInput.substring(i, i + key.length) === key) {
                        unicodeOutput += bijoyToUnicodeMap[key];
                        i += key.length;
                        foundMatch = true;
                        break;
                    }
                }
                if (!foundMatch) {
                    unicodeOutput += bijoyInput[i];
                    i++;
                }
            }

            // --- ধাপ ২: ইউনিকোড ডোমেইনে পুনঃক্রম এবং সংমিশ্রণ ---

            // ধ্রুবকগুলি সংজ্ঞায়িত করুন
            const unicodeIkar = '\u09BF'; // ি
            const unicodeEkar = '\u09C7'; // ে
            const unicodeOikar = '\u09C8'; // ৈ
            const unicodeConsonants = '\\u0995-\\u09B9\\u09DC-\\u09DF';
            const unicodeHasanta = '\\u09CD';
            const unicodeRef = '\\u09B0' + unicodeHasanta;

            // ধাপ ২.১: রেফ (র্) পুনঃক্রম করুন
            const unicodeVowelSigns = '[\\u09BE-\\u09C4\\u09C7-\\u09C8\\u09CB-\\u09CC\\u09D7]'; // সকল কার-চিহ্ন
            const consonantCluster = `(?:[${unicodeConsonants}](?:${unicodeHasanta}[${unicodeConsonants}])*)`;
            const fullClusterWithVowel = `(${consonantCluster}(?:${unicodeVowelSigns})?)`;
            const robustRephReorder = new RegExp(`${fullClusterWithVowel}(${unicodeRef})`, 'g');
            unicodeOutput = unicodeOutput.replace(robustRephReorder, '$2$1');

            // ধাপ ২.২: প্রি-সিডিং কার-চিহ্ন (ি, ে, ৈ) সঠিক স্থানে আনুন 
            const consonantClusterPattern = `(?:${unicodeRef})?(?:[${unicodeConsonants}](?:${unicodeHasanta}[${unicodeConsonants}])*)`;
            const reorderRegex = new RegExp(`([${unicodeIkar}${unicodeEkar}${unicodeOikar}])(${consonantClusterPattern})`, 'g');
            unicodeOutput = unicodeOutput.replace(reorderRegex, '$2$1');

            // ধাপ ২.৩: ও-কার এবং ঔ-কার গঠন করুন
            const unicodeAkar = '\u09BE'; // া
            const unicodeOkar = '\u09CB'; // ো
            unicodeOutput = unicodeOutput.replace(new RegExp(`(${unicodeEkar})(${unicodeAkar})`, 'g'), unicodeOkar);

            const unicodeOuKarPart2 = '\u09D7'; // ৗ
            const unicodeOukar = '\u09CC'; // ৌ
            unicodeOutput = unicodeOutput.replace(new RegExp(`(${unicodeEkar})(${unicodeOuKarPart2})`, 'g'), unicodeOukar);


            // ধাপ ৩: ম্যানুয়াল ইউনিকোড রিপ্লেসমেন্ট প্রয়োগ (যদি প্রয়োজন হয়)
            for (const [wrong, correct] of Object.entries(manualUnicodeReplacements)) {
                if (wrong) {
                    const regex = new RegExp(wrong.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                    unicodeOutput = unicodeOutput.replace(regex, correct);
                }
            }

            if (textAreaLeft) {
                textAreaLeft.value = unicodeOutput;
                addState('textAreaLeft');
            }
        }
        // ====================================================================
        // END: UPDATED FUNCTION
        // ====================================================================

        // ====================================================================
        // START: ANSI TEXT FIX FUNCTION (UPDATED FOR WORD LIST & SILENT MODE)
        // ====================================================================

        // এই লিস্টে যে শব্দগুলো যোগ করবেন, "ফিক্স করুন" বাটন সেগুলোকে পরিবর্তন করবে না।
        const wordsToIgnore = [
            '—M',
			"”P",
			"”T",
			"¯‘",
			"o–",
			"ÒQÓ",
			"ÒQ",
            // এখানে কমা দিয়ে আরও শব্দ যোগ করুন, যেমন: 'كلمة', 'word'
        ];

        // *** পরিবর্তিত ফাংশন: showAlert প্যারামিটার যোগ করা হয়েছে ***
        function fixAnsiText(showAlert = true) {
            const textAreaRight = document.getElementById('textAreaRight');
            if (!textAreaRight) return;

            let textToFix = textAreaRight.value;
            const placeholders = {};

            // ধাপ ০: লিস্টে থাকা শব্দগুলোকে সাময়িকভাবে প্লেসহোল্ডার দিয়ে প্রতিস্থাপন করুন
            wordsToIgnore.forEach((word, index) => {
                const placeholder = `___IGNORE_WORD_${index}___`;
                placeholders[placeholder] = word;
                const regex = new RegExp(word.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                textToFix = textToFix.replace(regex, placeholder);
            });

            // ধাপ ১: বিজয় টেক্সটবক্সে ভুলবশত থাকা ইউনিকোড অক্ষরগুলিকে তাদের আনসি সমতুল্য দিয়ে প্রতিস্থাপন করুন।
            for (const key of sortedUnicodeKeys) {
                if (key.length > 0 && textToFix.includes(key)) {
                    const regex = new RegExp(key.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                    textToFix = textToFix.replace(regex, unicodeToBijoyMap[key]);
                }
            }

            // ধাপ ২: ম্যানুয়াল আনসি রিপ্লেসমেন্ট ম্যাপ প্রয়োগ করুন
            for (const [wrong, correct] of Object.entries(manualAnsiReplacements)) {
                if (wrong) {
                    const regex = new RegExp(wrong.replace(/[.*+?^${}()|[\]\\]/g, '\\$&'), 'g');
                    textToFix = textToFix.replace(regex, correct);
                }
            }
            
            // ধাপ ৩: বিশেষ কেস হ্যান্ডলিং
            textToFix = textToFix.replace(/(^|\s|\|)‡/gm, '$1†');
            textToFix = textToFix.replace(/(^|\s|\|)‰/gm, '$1ˆ');

            // ধাপ ৪: প্লেসহোল্ডারগুলোকে আবার আসল শব্দ দিয়ে প্রতিস্থাপন করুন
            for (const placeholder in placeholders) {
                if (Object.hasOwnProperty.call(placeholders, placeholder)) {
                    const originalWord = placeholders[placeholder];
                    const regex = new RegExp(placeholder, 'g');
                    textToFix = textToFix.replace(regex, originalWord);
                }
            }

            textAreaRight.value = textToFix;
            addState('textAreaRight');
            
            // *** নতুন সংযোজন: শর্তসাপেক্ষে বার্তা দেখানো ***
            if (showAlert) {
                showCustomAlert('লেখা ফিক্স করা হয়েছে!');
            }
        }
        // ====================================================================
        // END: ANSI TEXT FIX FUNCTION
        // ====================================================================

        function copyToClipboard(elementId) {
            const element = document.getElementById(elementId);
            if (element) {
                element.select();
                element.setSelectionRange(0, 99999); // মোবাইল ডিভাইসের জন্য

                try {
                    document.execCommand('copy');
                    // অ্যালার্টের পরিবর্তে কাস্টম মেসেজ বক্স
                    showCustomAlert('আউটপুট কপি করা হয়েছে!');
                } catch (err) {
                    console.error('কপি করতে ব্যর্থ:', err);
                    showCustomAlert('কপি করতে ব্যর্থ হয়েছে। অনুগ্রহ করে ম্যানুয়ালি কপি করুন।');
                }
            }
        }
        // ====================================================================
        // START: NEW FILE UPLOAD SCRIPT FOR TEXT ASSISTANT
        // ====================================================================

        const fileUploadInput = document.getElementById('fileUploadInput');
        const filePreviewContainer = document.getElementById('filePreviewContainer');
        let uploadedFile = null; // আপলোড করা ফাইলের তথ্য সংরক্ষণ করতে

        if (fileUploadInput) {
            fileUploadInput.addEventListener('change', handleFileSelect);
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) {
                return;
            }

            // ফাইলের ধরন এবং আকার যাচাই করুন
            const allowedTypes = ['image/png', 'image/jpeg', 'image/webp', 'text/plain', 'audio/mpeg', 'audio/wav', 'video/mp4', 'video/webm'];
            if (!allowedTypes.includes(file.type)) {
                showCustomAlert('শুধুমাত্র ছবি, টেক্সট, অডিও, এবং ভিডিও ফাইল আপলোড করা যাবে।');
                fileUploadInput.value = ''; // ইনপুট রিসেট করুন
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                uploadedFile = {
                    name: file.name,
                    type: file.type,
                    base64: e.target.result.split(',')[1], // Base64 ডেটা পান
                    dataUrl: e.target.result // প্রিভিউ এর জন্য ডেটা URL
                };
                displayFilePreview();
            };
            reader.onerror = function() {
                showCustomAlert('ফাইলটি পড়তে একটি ত্রুটি হয়েছে।');
                uploadedFile = null;
            };
            reader.readAsDataURL(file);
        }

        function displayFilePreview() {
            if (!uploadedFile || !filePreviewContainer) return;

            filePreviewContainer.innerHTML = ''; // আগের প্রিভিউ পরিষ্কার করুন
            filePreviewContainer.classList.remove('hidden');

            const previewWrapper = document.createElement('div');
            previewWrapper.className = 'relative flex items-center gap-3 p-2';

            let previewElement;
            if (uploadedFile.type.startsWith('image/')) {
                previewElement = document.createElement('img');
                previewElement.src = uploadedFile.dataUrl;
            } else if (uploadedFile.type.startsWith('video/')) {
                previewElement = document.createElement('video');
                previewElement.src = uploadedFile.dataUrl;
                previewElement.controls = false; // কন্ট্রোল দেখাবেন না
            } else if (uploadedFile.type.startsWith('audio/')) {
                previewElement = document.createElement('div');
                previewElement.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600 dark:text-gray-300"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>`;
            } else { // টেক্সট বা অন্যান্য ফাইলের জন্য
                previewElement = document.createElement('div');
                previewElement.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-gray-600 dark:text-gray-300"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>`;
            }

            if (previewElement.tagName === 'IMG' || previewElement.tagName === 'VIDEO') {
                previewElement.className = 'w-16 h-16 object-cover rounded-lg';
            }


            const fileInfo = document.createElement('div');
            fileInfo.className = 'file-info';
            fileInfo.textContent = uploadedFile.name;

            const removeBtn = document.createElement('button');
            removeBtn.id = 'removeFileBtn';
            removeBtn.innerHTML = '&times;';
            removeBtn.title = 'ফাইল সরান';
            removeBtn.onclick = removeFile;

            previewWrapper.appendChild(removeBtn);
            previewWrapper.appendChild(previewElement);
            previewWrapper.appendChild(fileInfo);
            filePreviewContainer.appendChild(previewWrapper);
        }

        function removeFile() {
            uploadedFile = null;
            fileUploadInput.value = ''; // ফাইল ইনপুট রিসেট করুন
            filePreviewContainer.innerHTML = '';
            filePreviewContainer.classList.add('hidden');
        }

        // চ্যাট উইন্ডোতে ফাইলসহ বার্তা যোগ করার জন্য ফাংশন আপডেট করুন
        function addMessageToChat(text, sender, file = null) {
            const chatWindow = document.getElementById('chatWindow');
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', `${sender}-message`);

            const textElement = document.createElement('p');
            textElement.innerText = text;
            messageElement.appendChild(textElement);

            if (file && file.type.startsWith('image/')) {
                const imgElement = document.createElement('img');
                imgElement.src = file.dataUrl;
                messageElement.appendChild(imgElement);
            }

            if (chatWindow) {
                chatWindow.appendChild(messageElement);
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }
        }
		
        // --- গুগল ম্যাপ ফিচার ---
    document.addEventListener('DOMContentLoaded', () => {
        const searchInput = document.getElementById('searchInput');
        const searchBtn = document.getElementById('searchBtn');
        const myLocationBtn = document.getElementById('myLocationBtn');
        const directionsFrom = document.getElementById('directionsFrom');
        const directionsTo = document.getElementById('directionsTo');
        const directionsBtn = document.getElementById('directionsBtn');

        // 1. স্থান খোঁজার জন্য ইভেন্ট লিসেনার
        if (searchBtn) {
            searchBtn.addEventListener('click', () => {
                const query = searchInput.value.trim();
                if (query) {
                    const url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`;
                    window.open(url, '_blank');
                } else {
                    showCustomAlert('অনুগ্রহ করে খোঁজার জন্য একটি স্থানের নাম লিখুন।');
                }
            });
             // Enter চেপে সার্চ করার সুবিধা
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    searchBtn.click();
                }
            });
        }

        // 2. আমার অবস্থানের জন্য ইভেন্ট লিসেনার
        if (myLocationBtn) {
            myLocationBtn.addEventListener('click', () => {
                // এই URLটি গুগল ম্যাপকে ব্যবহারকারীর বর্তমান অবস্থান খুঁজতে বলবে
                const url = 'https://www.google.com/maps/search/My+Location';
                window.open(url, '_blank');
            });
        }

        // 3. দিকনির্দেশনার জন্য ইভেন্ট লিসেনার
        if (directionsBtn) {
            directionsBtn.addEventListener('click', () => {
                const origin = directionsFrom.value.trim();
                const destination = directionsTo.value.trim();
                if (origin && destination) {
                    const url = `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(origin)}&destination=${encodeURIComponent(destination)}`;
                    window.open(url, '_blank');
                } else {
                    showCustomAlert('অনুগ্রহ করে শুরু এবং গন্তব্য উভয় স্থান লিখুন।');
                }
            });
            // Enter চেপে দিকনির্দেশনা খোঁজার সুবিধা
            directionsTo.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    directionsBtn.click();
                }
            });
             directionsFrom.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    directionsBtn.click();
                }
            });
        }
    });

// নতুন: নামাজের সময়সূচি ট্যাব এর জন্য ফাংশন (API ইন্টিগ্রেশন এবং লোকাল স্টোরেজ সহ)
function initializePrayerTimeTab() {
    const districtSelect = document.getElementById('district-select');
    const prayerTimeDate = document.getElementById('prayerTimeDate');
    const manualTimeToggle = document.getElementById('manualTimeToggle');
    const manualTimeInputsContainer = document.getElementById('manualTimeInputs');

    // ম্যানুয়াল ইনপুট ক্ষেত্র
    const manualInputs = {
        sehri: document.getElementById('manualSehri'),
        fajr: document.getElementById('manualFajr'),
        dhuhr: document.getElementById('manualDhuhr'),
        asr: document.getElementById('manualAsr'),
        iftar: document.getElementById('manualIftar'),
        isha: document.getElementById('manualIsha')
    };

    if (!districtSelect || !manualTimeToggle || !manualTimeInputsContainer) return;

    // API কলের জন্য বাংলা জেলার নামের সাথে ইংরেজি নামের ম্যাপিং
    const districtMap = {
        "ঢাকা": "Dhaka", "গাইবান্ধা": "Gaibandha", "বরগুনা": "Barguna", "বরিশাল": "Barisal", "ভোলা": "Bhola", "ঝালকাঠি": "Jhalokati", "পটুয়াখালী": "Patuakhali", "পিরোজপুর": "Pirojpur",
        "বান্দরবান": "Bandarban", "ব্রাহ্মণবাড়িয়া": "Brahmanbaria", "চাঁদপুর": "Chandpur", "চট্টগ্রাম": "Chattogram", "কুমিল্লা": "Cumilla", "কক্সবাজার": "Cox's Bazar", "ফেনী": "Feni", "খাগড়াছড়ি": "Khagrachhari", "লক্ষ্মীপুর": "Lakshmipur", "নোয়াখালী": "Noakhali", "রাঙ্গামাটি": "Rangamati",
        "ফরিদপুর": "Faridpur", "গাজীপুর": "Gazipur", "গোপালগঞ্জ": "Gopalganj", "কিশোরগঞ্জ": "Kishoreganj", "মাদারীপুর": "Madaripur", "মানিকগঞ্জ": "Manikganj", "মুন্সিগঞ্জ": "Munshiganj", "নারায়ণগঞ্জ": "Narayanganj", "নরসিংদী": "Narsingdi", "রাজবাড়ী": "Rajbari", "শরীয়তপুর": "Shariatpur", "টাঙ্গাইল": "Tangail",
        "বাগেরহাট": "Bagerhat", "চুয়াডাঙ্গা": "Chuadanga", "যশোর": "Jashore", "ঝিনাইদহ": "Jhenaidah", "খুলনা": "Khulna", "কুষ্টিয়া": "Kushtia", "মাগুরা": "Magura", "মেহেরপুর": "Meherpur", "নড়াইল": "Narail", "সাতক্ষীরা": "Satkhira",
        "জামালপুর": "Jamalpur", "ময়মনসিংহ": "Mymensingh", "নেত্রকোনা": "Netrokona", "শেরপুর": "Sherpur",
        "বগুড়া": "Bogura", "জয়পুরহাট": "Joypurhat", "নওগাঁ": "Naogaon", "নাটোর": "Natore", "চাঁপাইনবাবগঞ্জ": "Chapainawabganj", "পাবনা": "Pabna", "রাজশাহী": "Rajshahi", "সিরাজগঞ্জ": "Sirajganj",
        "দিনাজপুর": "Dinajpur", "কুড়িগ্রাম": "Kurigram", "লালমনিরহাট": "Lalmonirhat", "নীলফামারী": "Nilphamari", "পঞ্চগড়": "Panchagarh", "রংপুর": "Rangpur", "ঠাকুরগাঁও": "Thakurgaon",
        "হবিগঞ্জ": "Habiganj", "মৌলভীবাজার": "Moulvibazar", "সুনামগঞ্জ": "Sunamganj", "সিলেট": "Sylhet"
    };

    // ====================================================================
    // START: সেটিংস সেভ এবং লোড করার ফাংশন
    // ====================================================================

    // সকল সেটিংস লোকাল স্টোরেজে সেভ করার ফাংশন
    const saveSettings = () => {
        const settings = {
            isManual: manualTimeToggle.checked,
            district: districtSelect.value,
            manualTimes: {
                sehri: manualInputs.sehri.value,
                fajr: manualInputs.fajr.value,
                dhuhr: manualInputs.dhuhr.value,
                asr: manualInputs.asr.value,
                iftar: manualInputs.iftar.value,
                isha: manualInputs.isha.value,
            }
        };
        localStorage.setItem('prayerTimeSettings', JSON.stringify(settings));
        console.log('সেটিংস সেভ করা হয়েছে:', settings);
    };

    // লোকাল স্টোরেজ থেকে সেটিংস লোড করার ফাংশন
    const loadSettings = () => {
        const savedSettings = localStorage.getItem('prayerTimeSettings');
        if (savedSettings) {
            const settings = JSON.parse(savedSettings);
            console.log('সেটিংস লোড করা হয়েছে:', settings);

            // টগল অবস্থা পুনরুদ্ধার করুন
            manualTimeToggle.checked = settings.isManual;

            // জেলা নির্বাচন পুনরুদ্ধার করুন
            if (settings.district) {
                // জেলা ড্রপডাউন লোড হওয়ার জন্য একটু অপেক্ষা করুন
                setTimeout(() => {
                    districtSelect.value = settings.district;
                }, 100);
            }

            // ম্যানুয়াল সময় পুনরুদ্ধার করুন
            if (settings.manualTimes) {
                manualInputs.sehri.value = settings.manualTimes.sehri || '04:00';
                manualInputs.fajr.value = settings.manualTimes.fajr || '04:10';
                manualInputs.dhuhr.value = settings.manualTimes.dhuhr || '12:00';
                manualInputs.asr.value = settings.manualTimes.asr || '16:30';
                manualInputs.iftar.value = settings.manualTimes.iftar || '18:45';
                manualInputs.isha.value = settings.manualTimes.isha || '20:00';
            }
        }
    };

    // ====================================================================
    // END: সেটিংস সেভ এবং লোড করার ফাংশন
    // ====================================================================

    // 24-ঘণ্টার সময়কে 12-ঘণ্টার ফরম্যাটে রূপান্তর করার ফাংশন
    function formatTo12Hour(time24) {
        if (!time24 || typeof time24 !== 'string') return '--:--';
        const [hour, minute] = time24.split(':').map(Number);
        const period = hour >= 12 ? 'PM' : 'AM';
        const hour12 = hour % 12 || 12;
        return `${hour12.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')} ${period}`;
    }

    // ম্যানুয়াল সময় প্রদর্শন করার ফাংশন
    function displayManualTimes() {
        document.getElementById('sehri-time').textContent = formatTo12Hour(manualInputs.sehri.value);
        document.getElementById('fajr-time').textContent = formatTo12Hour(manualInputs.fajr.value);
        document.getElementById('dhuhr-time').textContent = formatTo12Hour(manualInputs.dhuhr.value);
        document.getElementById('asr-time').textContent = formatTo12Hour(manualInputs.asr.value);
        document.getElementById('iftar-time').textContent = formatTo12Hour(manualInputs.iftar.value);
        document.getElementById('isha-time').textContent = formatTo12Hour(manualInputs.isha.value);
        districtSelect.disabled = true;
    }

    // API থেকে ডেটা নিয়ে আসার এবং প্রদর্শনের ফাংশন
    async function fetchAndDisplayPrayerTimes(district) {
        const prayerTimesP = document.querySelectorAll('.prayer-times-grid p');
        prayerTimesP.forEach(p => p.textContent = 'লোড হচ্ছে...');
        districtSelect.disabled = false;

        const englishDistrict = districtMap[district];
        if (!englishDistrict) {
            prayerTimesP.forEach(p => p.textContent = 'ত্রুটি');
            showCustomAlert('জেলা খুঁজে পাওয়া যায়নি।');
            return;
        }

        const today = new Date();
        const dateString = `${today.getDate()}-${today.getMonth() + 1}-${today.getFullYear()}`;
        const url = `https://api.aladhan.com/v1/timingsByCity/${dateString}?city=${englishDistrict}&country=Bangladesh&method=1`;

        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error(`API থেকে সাড়া পাওয়া যায়নি (স্ট্যাটাস: ${response.status})`);
            const data = await response.json();

            if (data.code === 200) {
                const times = data.data.timings;
                const [fajrHour, fajrMinute] = times.Fajr.split(':').map(Number);
                const fajrDate = new Date();
                fajrDate.setHours(fajrHour, fajrMinute, 0, 0);
                fajrDate.setMinutes(fajrDate.getMinutes() - 10);
                const sehriTime24 = `${fajrDate.getHours().toString().padStart(2, '0')}:${fajrDate.getMinutes().toString().padStart(2, '0')}`;

                document.getElementById('sehri-time').textContent = formatTo12Hour(sehriTime24);
                document.getElementById('fajr-time').textContent = formatTo12Hour(times.Fajr);
                document.getElementById('dhuhr-time').textContent = formatTo12Hour(times.Dhuhr);
                document.getElementById('asr-time').textContent = formatTo12Hour(times.Asr);
                document.getElementById('iftar-time').textContent = formatTo12Hour(times.Maghrib);
                document.getElementById('isha-time').textContent = formatTo12Hour(times.Isha);
            } else {
                throw new Error('API থেকে ডেটা সঠিকভাবে আসেনি।');
            }
        } catch (error) {
            console.error('Prayer Times Error:', error);
            prayerTimesP.forEach(p => p.textContent = 'ব্যর্থ');
            showCustomAlert(`সময় আনতে সমস্যা হয়েছে: ${error.message}`);
        }
    }

    // টগল সুইচের পরিবর্তন হ্যান্ডেল করুন
    manualTimeToggle.addEventListener('change', () => {
        if (manualTimeToggle.checked) {
            manualTimeInputsContainer.classList.remove('hidden');
            displayManualTimes();
        } else {
            manualTimeInputsContainer.classList.add('hidden');
            fetchAndDisplayPrayerTimes(districtSelect.value);
        }
        saveSettings(); // পরিবর্তন সেভ করুন
    });

    // ম্যানুয়াল ইনপুট পরিবর্তন হলে সময় আপডেট এবং সেভ করুন
    Object.values(manualInputs).forEach(input => {
        input.addEventListener('input', () => {
            if (manualTimeToggle.checked) {
                displayManualTimes();
            }
            saveSettings(); // পরিবর্তন সেভ করুন
        });
    });

    // জেলা পরিবর্তন হলে সময় আপডেট এবং সেভ করুন
    districtSelect.addEventListener('change', (e) => {
        if (!manualTimeToggle.checked) {
            fetchAndDisplayPrayerTimes(e.target.value);
        }
        saveSettings(); // পরিবর্তন সেভ করুন
    });

    // ড্রপডাউন এ জেলার নাম যোগ করা
    if (districtSelect.options.length <= 1) {
        Object.keys(districtMap).forEach(district => {
            const option = document.createElement('option');
            option.value = district;
            option.textContent = district;
            districtSelect.appendChild(option);
        });
    }

    // --- মূল التنفيذ লজিক ---
    loadSettings(); // প্রথমে সেভ করা সেটিংস লোড করুন

    // লোড করা সেটিংসের উপর ভিত্তি করে প্রাথমিক অবস্থা নির্ধারণ করুন
    if (manualTimeToggle.checked) {
        manualTimeInputsContainer.classList.remove('hidden');
        displayManualTimes();
    } else {
        manualTimeInputsContainer.classList.add('hidden');
        fetchAndDisplayPrayerTimes(districtSelect.value || "ঢাকা");
    }

    // আজকের তারিখ প্রদর্শন
    const today = new Date();
    prayerTimeDate.textContent = today.toLocaleDateString('bn-BD', {
        weekday: 'long',
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
}

    // যখন নামাজের সময়সূচি ট্যাব ক্লিক করা হবে, তখন এই ফাংশনটি চালু হবে
    document.getElementById('prayerTimeTab')?.addEventListener('click', initializePrayerTimeTab);
    
    // 페이지 로드 시 기도 시간 탭이 활성화되어 있으면 초기화
    if (document.getElementById('prayerTimeContent')?.classList.contains('active')) {
        initializePrayerTimeTab();
    }

        // জেমিনিকে জিজ্ঞাসা করার ফাংশন আপডেট করুন
        async function handleAskGemini() {
            const assistantInput = document.getElementById('assistantInput');
            const assistantLoading = document.getElementById('assistantLoading');
            const askGeminiBtn = document.getElementById('askGeminiBtn');
            const chatWindow = document.getElementById('chatWindow');
            let chatHistory = window.chatHistory || [];

            const promptText = assistantInput.value.trim();
            if (!promptText && !uploadedFile) return;

            // ব্যবহারকারীর বার্তা প্রদর্শন করুন
            addMessageToChat(promptText, 'user', uploadedFile);
            assistantInput.value = '';

            let userParts = [];
            if (promptText) {
                userParts.push({
                    text: promptText
                });
            }
            if (uploadedFile) {
                userParts.push({
                    inlineData: {
                        mimeType: uploadedFile.type,
                        data: uploadedFile.base64
                    }
                });
            }

            chatHistory.push({
                role: "user",
                parts: userParts
            });
            window.chatHistory = chatHistory;

            // ফাইল পাঠানোর পর প্রিভিউ সরিয়ে ফেলুন
            removeFile();

            if (assistantLoading) assistantLoading.style.display = 'block';
            if (askGeminiBtn) askGeminiBtn.disabled = true;

            try {
                const apiKey = localStorage.getItem('geminiApiKey');
                if (!apiKey) {
                    addMessageToChat('জেমিনি API কী সেট করা হয়নি। অনুগ্রহ করে "API কী সেট করুন" বাটনে ক্লিক করে কী সেট করুন।', 'gemini-error');
                    return;
                }

                const payload = {
                    contents: chatHistory
                };
                const model = "gemini-2.5-flash-preview-05-20";
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                let geminiText;

                if (result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                    geminiText = result.candidates[0].content.parts[0].text;
                    chatHistory.push({
                        role: "model",
                        parts: [{
                            text: geminiText
                        }]
                    });
                    window.chatHistory = chatHistory;
                } else {
                    geminiText = 'দুঃখিত, আমি কোনো উত্তর খুঁজে পাইনি। অনুগ্রহ করে আবার চেষ্টা করুন।';
                    console.error('API Response Error:', result);
                }
                addMessageToChat(geminiText, 'gemini');

            } catch (error) {
                const errorMessage = 'একটি ত্রুটি ঘটেছে: ' + error.message;
                addMessageToChat(errorMessage, 'gemini-error');
                console.error('API Call Error:', error);
            } finally {
                if (assistantLoading) assistantLoading.style.display = 'none';
                if (askGeminiBtn) askGeminiBtn.disabled = false;
            }
        }
        // ====================================================================
        // END: NEW FILE UPLOAD SCRIPT
        // ====================================================================

// ====================================================================
// START: UNIT CONVERTER (MEASUREMENT) SCRIPT (CORRECTED)
// ====================================================================
function initializeUnitConverters() {
    // শুধুমাত্র পরিমাপ সেকশনের ভেতরের ইনপুট ও সিলেক্ট এলিমেন্টগুলোই ধরবে
    const unitInputs = document.querySelectorAll('#measurementContent .unit-input');
    const unitSelects = document.querySelectorAll('#measurementContent .unit-select');

    const factors = {
        length: { // base: meter
            meter: 1,
            kilometer: 1000,
            centimeter: 0.01,
            millimeter: 0.001,
            mile: 1609.34,
            yard: 0.9144,
            foot: 0.3048,
            inch: 0.0254
        },
        weight: { // base: gram
            gram: 1,
            kilogram: 1000,
            milligram: 0.001,
            tonne: 1000000,
            pound: 453.592,
            ounce: 28.3495
        },
        area: { // base: square meter
            sq_meter: 1,
            sq_kilometer: 1000000,
            sq_foot: 0.092903,
            sq_inch: 0.00064516,
            hectare: 10000,
            acre: 4046.86,
            bigha: 1337.8, // Approximate value for Bangladesh
            katha: 66.89, // 1 Bigha = 20 Katha
            shotok: 40.4686 // 1 Acre = 100 Shotok
        }
    };

    function performConversion(sourceElement) {
        if (!sourceElement) return;

        const converterType = sourceElement.dataset.converter.replace('_rev', '');
        const isReverse = sourceElement.dataset.converter.includes('_rev');

        // সোর্স এবং টার্গেট এলিমেন্টগুলো শনাক্ত করুন
        const fromValueEl = document.getElementById(`${converterType}FromValue`);
        const fromUnitEl = document.getElementById(`${converterType}FromUnit`);
        const toValueEl = document.getElementById(`${converterType}ToValue`);
        const toUnitEl = document.getElementById(`${converterType}ToUnit`);

        const sourceValueEl = isReverse ? toValueEl : fromValueEl;
        const sourceUnitEl = isReverse ? toUnitEl : fromUnitEl;
        const targetValueEl = isReverse ? fromValueEl : toValueEl;
        const targetUnitEl = isReverse ? fromUnitEl : toUnitEl;

        const sourceValue = parseFloat(sourceValueEl.value);
        
        if (isNaN(sourceValue)) {
            targetValueEl.value = '';
            return;
        }

        const fromUnit = sourceUnitEl.value;
        const toUnit = targetUnitEl.value;
        let result;

        if (converterType === 'temperature') {
            // তাপমাত্রা রূপান্তরের লজিক
            if (fromUnit === toUnit) {
                result = sourceValue;
            } else if (fromUnit === 'celsius') {
                result = toUnit === 'fahrenheit' ? (sourceValue * 9 / 5) + 32 : sourceValue + 273.15;
            } else if (fromUnit === 'fahrenheit') {
                result = toUnit === 'celsius' ? (sourceValue - 32) * 5 / 9 : ((sourceValue - 32) * 5 / 9) + 273.15;
            } else if (fromUnit === 'kelvin') {
                result = toUnit === 'celsius' ? sourceValue - 273.15 : ((sourceValue - 273.15) * 9 / 5) + 32;
            }
        } else {
            // ফ্যাক্টর-ভিত্তিক রূপান্তরের লজিক
            const conversionFactors = factors[converterType];
            const valueInBaseUnit = sourceValue * conversionFactors[fromUnit];
            result = valueInBaseUnit / conversionFactors[toUnit];
        }

        // একটি নির্দিষ্ট দশমিক স্থান পর্যন্ত ফলাফল প্রদর্শন করুন
        targetValueEl.value = Number(result.toFixed(6));
    }

    unitInputs.forEach(input => {
        input.addEventListener('input', (e) => {
            performConversion(e.target);
        });
    });

    unitSelects.forEach(select => {
        select.addEventListener('change', (e) => {
            // কোন ইনপুটটি সোর্স হিসেবে ব্যবহৃত হবে তা নির্ধারণ করুন
            const converterType = e.target.dataset.converter;
            const fromValueEl = document.getElementById(`${converterType}FromValue`);
            // যখন ইউনিট পরিবর্তন হয়, তখন সবসময় 'From' ফিল্ড থেকে গণনা শুরু করুন
            performConversion(fromValueEl);
        });
    });

    // পেজ লোড হওয়ার সাথে সাথে সকল কনভার্টার চালু করুন
    ['length', 'weight', 'area', 'temperature'].forEach(type => {
        const fromValueEl = document.getElementById(`${type}FromValue`);
        if(fromValueEl) {
             performConversion(fromValueEl);
        }
    });
}
// BMI Calculator Script - শুরু
const weightInput = document.getElementById('bmi-weight');
const heightFeetInput = document.getElementById('bmi-height-feet');
const heightInchesInput = document.getElementById('bmi-height-inches');
const calculateBtn = document.getElementById('bmi-calculate-btn');
const resultDiv = document.getElementById('bmi-result');

if (calculateBtn) {
    calculateBtn.addEventListener('click', () => {
        const weight = parseFloat(weightInput.value);
        const feet = parseFloat(heightFeetInput.value) || 0;
        const inches = parseFloat(heightInchesInput.value) || 0;

        if (isNaN(weight) || weight <= 0) {
            showResult('অনুগ্রহ করে সঠিক ওজন লিখুন।', 'bmi-obese');
            return;
        }

        if ((isNaN(feet) && isNaN(inches)) || (feet <= 0 && inches <= 0)) {
            showResult('অনুগ্রহ করে সঠিক উচ্চতা লিখুন।', 'bmi-obese');
            return;
        }

        // Convert height to meters
        const totalInches = (feet * 12) + inches;
        const heightInMeters = totalInches * 0.0254;

        if (heightInMeters <= 0) {
            showResult('অনুগ্রহ করে সঠিক উচ্চতা লিখুন।', 'bmi-obese');
            return;
        }

        // Calculate BMI
        const bmi = weight / (heightInMeters * heightInMeters);
        const bmiFormatted = bmi.toFixed(2);

        // Determine BMI category
        let category = '';
        let categoryClass = '';
        if (bmi < 18.5) {
            category = 'কম ওজন (Underweight)';
            categoryClass = 'bmi-underweight';
        } else if (bmi >= 18.5 && bmi <= 24.9) {
            category = 'স্বাভাবিক ওজন (Normal)';
            categoryClass = 'bmi-normal';
        } else if (bmi >= 25 && bmi <= 29.9) {
            category = 'অতিরিক্ত ওজন (Overweight)';
            categoryClass = 'bmi-overweight';
        } else {
            category = 'স্থূলতা (Obese)';
            categoryClass = 'bmi-obese';
        }

        const resultText = `আপনার BMI: <strong>${bmiFormatted}</strong><br>আপনি '${category}' শ্রেণীতে আছেন।`;
        showResult(resultText, categoryClass);
    });
}


function showResult(message, className) {
    resultDiv.style.display = 'block';
    resultDiv.innerHTML = message;
    // Reset classes
    resultDiv.className = 'bmi-result-section';
    // Add new class
    if(className) {
        resultDiv.classList.add(className);
    }
}
// BMI Calculator Script - শেষ
// ====================================================================
// END: UNIT CONVERTER (MEASUREMENT) SCRIPT (CORRECTED)
// ====================================================================

		// কাস্টম অ্যালার্ট বক্স বাস্তবায়ন New
		function showCustomAlert(message) {
		const alertBox = document.createElement('div');
		alertBox.classList.add(
        'fixed', 'top-1/2', 'left-1/2', 'transform', '-translate-x-1/2', '-translate-y-1/2',
        'bg-gray-800', 'text-white', 'p-4', 'rounded-lg', 'shadow-2xl',
        'z-50', 'text-lg', 'transition-all', 'duration-100', 'ease-in-out',
        'scale-75', 'opacity-0'
    );
		alertBox.textContent = message;
		document.body.appendChild(alertBox);

    // ফেড-ইন এবং স্কেল-ইন
		setTimeout(() => {
        alertBox.classList.remove('scale-75', 'opacity-0');
        alertBox.classList.add('scale-100', 'opacity-100');
		}, 10);

    // 3 সেকেন্ড পর ফেড-আউট এবং সরান
		setTimeout(() => {
        alertBox.classList.remove('scale-100', 'opacity-100');
        setTimeout(() => alertBox.remove(), 100);
		}, 2000);
	}

        // টেক্সটএরিয়াগুলির জন্য আনডু/রিডু ইতিহাস
        let historyLeft = [];
        let historyIndexLeft = -1;
        let historyRight = [];
        let historyIndexRight = -1;

        async function addState(textareaId) {
    const textarea = document.getElementById(textareaId);
    let history, historyIndex;

    if (textareaId === 'textAreaLeft') {
        history = historyLeft;
        historyIndex = historyIndexLeft;
    } else {
        history = historyRight;
        historyIndex = historyIndexRight;
    }

    // If we are not at the end of history, clear subsequent states
    if (historyIndex < history.length - 1) {
        history.splice(historyIndex + 1);
    }

    history.push(textarea.value);
    historyIndex = history.length - 1;

    if (textareaId === 'textAreaLeft') {
        historyLeft = history;
        historyIndexLeft = historyIndex;
        // Save state to IndexedDB
        await idbSet('converterTextLeft', textarea.value);
        await idbSet('converterHistoryLeft', { history: historyLeft, index: historyIndexLeft });
    } else {
        historyRight = history;
        historyIndexRight = historyIndex;
        // Save state to IndexedDB
        await idbSet('converterTextRight', textarea.value);
        await idbSet('converterHistoryRight', { history: historyRight, index: historyIndexRight });
    }
    updateButtonStates(textareaId);
}

        function undoText(textareaId) {
            const textarea = document.getElementById(textareaId);
            const liveConvertToggle = document.getElementById('live-convert-toggle');
            
            // মূল আনডু লজিক, যা পুনরায় ব্যবহার করা যাবে
            const performUndo = () => {
                let history = textareaId === 'textAreaLeft' ? historyLeft : historyRight;
                let historyIndex = textareaId === 'textAreaLeft' ? historyIndexLeft : historyIndexRight;

                if (historyIndex > 0) {
                    historyIndex--;
                    textarea.value = history[historyIndex];
                }

                if (textareaId === 'textAreaLeft') {
                    historyIndexLeft = historyIndex;
                } else {
                    historyIndexRight = historyIndex;
                }
                updateButtonStates(textareaId);
            };

            // একবার আনডু করুন
            performUndo();

            // যদি লাইভ মোড চালু থাকে এবং এটি ডানদিকের টেক্সটবক্স হয়, তবে আবার আনডু করুন
            if (liveConvertToggle && liveConvertToggle.checked && textareaId === 'textAreaRight') {
                performUndo();
            }

            // লাইভ কনভার্ট টগল চালু থাকলে কনভার্সন ট্রিগার করুন
            if (liveConvertToggle && liveConvertToggle.checked) {
                if (textareaId === 'textAreaLeft') {
                    setTimeout(convertLeftToRight, 0);
                } else if (textareaId === 'textAreaRight') {
                    const originalFixAnsiText = window.fixAnsiText;
                    window.fixAnsiText = () => {}; // সাময়িকভাবে নিষ্ক্রিয় করুন
                    setTimeout(() => {
                        convertRightToLeft();
                        window.fixAnsiText = originalFixAnsiText; // আবার সক্রিয় করুন
                    }, 0);
                }
            }
        }

        function redoText(textareaId) {
            const textarea = document.getElementById(textareaId);
            const liveConvertToggle = document.getElementById('live-convert-toggle');

            // মূল রিডু লজিক, যা পুনরায় ব্যবহার করা যাবে
            const performRedo = () => {
                 let history = textareaId === 'textAreaLeft' ? historyLeft : historyRight;
                 let historyIndex = textareaId === 'textAreaLeft' ? historyIndexLeft : historyIndexRight;

                if (historyIndex < history.length - 1) {
                    historyIndex++;
                    textarea.value = history[historyIndex];
                }

                if (textareaId === 'textAreaLeft') {
                    historyIndexLeft = historyIndex;
                } else {
                    historyIndexRight = historyIndex;
                }
                updateButtonStates(textareaId);
            };

            // একবার রিডু করুন
            performRedo();

            // যদি লাইভ মোড চালু থাকে এবং এটি ডানদিকের টেক্সটবক্স হয়, তবে আবার রিডু করুন
            if (liveConvertToggle && liveConvertToggle.checked && textareaId === 'textAreaRight') {
                performRedo();
            }

            // লাইভ কনভার্ট টগল চালু থাকলে কনভার্সন ট্রিগার করুন
            if (liveConvertToggle && liveConvertToggle.checked) {
                if (textareaId === 'textAreaLeft') {
                    setTimeout(convertLeftToRight, 0);
                } else if (textareaId === 'textAreaRight') {
                     const originalFixAnsiText = window.fixAnsiText;
                    window.fixAnsiText = () => {}; // সাময়িকভাবে নিষ্ক্রিয় করুন
                    setTimeout(() => {
                        convertRightToLeft();
                        window.fixAnsiText = originalFixAnsiText; // আবার সক্রিয় করুন
                    }, 0);
                }
            }
        }

        function clearTextarea(textareaId) {
            const textarea = document.getElementById(textareaId);
            if (textarea) {
                textarea.value = '';
                addState(textareaId); // এই ক্লিয়ার অ্যাকশনটি ইতিহাসে যোগ করুন
            }
        }

        function clearAllTextareas() {
            clearTextarea('textAreaLeft');
            clearTextarea('textAreaRight');
        }

        function updateButtonStates(textareaId) {
            let undoBtn = document.getElementById(textareaId === 'textAreaLeft' ? 'undoButtonLeft' : 'undoButtonRight');
            let redoBtn = document.getElementById(textareaId === 'textAreaLeft' ? 'redoButtonLeft' : 'redoButtonRight');
            let history = textareaId === 'textAreaLeft' ? historyLeft : historyRight;
            let historyIndex = textareaId === 'textAreaLeft' ? historyIndexLeft : historyIndexRight;

            if (undoBtn) undoBtn.disabled = historyIndex <= 0;
            if (redoBtn) redoBtn.disabled = historyIndex >= history.length - 1;
        }


        document.addEventListener('DOMContentLoaded', async () => {
		
		// ====================================================================
// START: Load Converter Data from IndexedDB on page load
// ====================================================================
try {
    // Clear expired items on startup
    await clearExpiredItems();

    const textAreaLeft = document.getElementById('textAreaLeft');
    const textAreaRight = document.getElementById('textAreaRight');

    // Load text for Left Textarea
    const savedTextLeft = await idbGet('converterTextLeft');
    if (savedTextLeft && textAreaLeft) {
        textAreaLeft.value = savedTextLeft;
    }

    // Load text for Right Textarea
    const savedTextRight = await idbGet('converterTextRight');
    if (savedTextRight && textAreaRight) {
        textAreaRight.value = savedTextRight;
    }

    // Load history for Left Textarea
    const savedHistoryLeft = await idbGet('converterHistoryLeft');
    if (savedHistoryLeft) {
        historyLeft = savedHistoryLeft.history || [textAreaLeft.value];
        historyIndexLeft = savedHistoryLeft.index !== undefined ? savedHistoryLeft.index : historyLeft.length - 1;
    } else {
        // Initialize if no history found
        historyLeft = [textAreaLeft ? textAreaLeft.value : ''];
        historyIndexLeft = 0;
    }

    // Load history for Right Textarea
    const savedHistoryRight = await idbGet('converterHistoryRight');
    if (savedHistoryRight) {
        historyRight = savedHistoryRight.history || [textAreaRight.value];
        historyIndexRight = savedHistoryRight.index !== undefined ? savedHistoryRight.index : historyRight.length - 1;
    } else {
        // Initialize if no history found
        historyRight = [textAreaRight ? textAreaRight.value : ''];
        historyIndexRight = 0;
    }

    // Update button states after loading history
    updateButtonStates('textAreaLeft');
    updateButtonStates('textAreaRight');
} catch (e) {
    console.error("Error loading converter data from IndexedDB:", e);
    // In case of error, you might want to clear the store, but for now, just log it.
}
// ====================================================================
// END: Load Converter Data from IndexedDB
// ====================================================================

			
            console.log('DOMContentLoaded ইভেন্ট চালু হয়েছে। স্ক্রিপ্ট চলছে।');
            try {
                // --- ট্যাব পরিবর্তন লজিক ---
//এখানে নতুন ট্যাবের const দুটি যুক্ত করতে হয় বা বসাতে হয় ।
                const basicCalcTab = document.getElementById('basicCalcTab');
                const ageCalcTab = document.getElementById('ageCalcTab');
                const dateCalcTab = document.getElementById('dateCalcTab');
                const scientificCalcTab = document.getElementById('scientificCalcTab');
                const newsTab = document.getElementById('newsTab');
                const converterTab = document.getElementById('converterTab');
                const measurementTab = document.getElementById('measurementTab'); // Add this line
                const textAssistantTab = document.getElementById('textAssistantTab');
                const allFeaturesTab = document.getElementById('allFeaturesTab');
                const setApiKeyBtn = document.getElementById('setApiKeyBtn');
                const spellCheckTab = document.getElementById('spellCheckTab');
                const textBeautifierTab = document.getElementById('textBeautifierTab');
                const wordMeaningTab = document.getElementById('wordMeaningTab');
                const ttsTab = document.getElementById('ttsTab'); // TTS ট্যাব
                const sttTab = document.getElementById('sttTab'); // STT ট্যাব
				const typingTestTab = document.getElementById('typingTestTab'); // এই লাইনটি যোগ করুন
                const basicCalculatorContent = document.getElementById('basicCalculatorContent');
                const ageCalculatorContent = document.getElementById('ageCalculatorContent');
                const dateCalculatorContent = document.getElementById('dateCalculatorContent');
                const scientificCalculatorContent = document.getElementById('scientificCalculatorContent');
                const newsContent = document.getElementById('newsContent');
                const converterContent = document.getElementById('converterContent');
                const measurementContent = document.getElementById('measurementContent'); // Add this line
                const textAssistantContent = document.getElementById('textAssistantContent');
                const allFeaturesContent = document.getElementById('allFeaturesContent');
                const spellCheckerContent = document.getElementById('spellCheckerContent');
                const textBeautifierContent = document.getElementById('textBeautifierContent');
                const wordMeaningContent = document.getElementById('wordMeaningContent');
                const textToSpeechContent = document.getElementById('textToSpeechContent'); // TTS কন্টেন্ট
                const speechToTextContent = document.getElementById('speechToTextContent'); // STT কন্টেন্ট
				const mapTab = document.getElementById('mapTab');
				const mapContent = document.getElementById('mapContent');
				const prayerTimeTab = document.getElementById('prayerTimeTab'); // এই লাইনটি যুক্ত করুন
				const prayerTimeContent = document.getElementById('prayerTimeContent'); // এই লাইনটি যুক্ত করুন
				const playerTab = document.getElementById('playerTab');
				const playerContent = document.getElementById('playerContent');
				const zakatCalcTab = document.getElementById('zakatCalcTab');
				const zakatCalculatorContent = document.getElementById('zakatCalculatorContent');
				const qrCodeTab = document.getElementById('qrCodeTab');
				const qrCodeContent = document.getElementById('qrCodeContent');
				const emergencyNumbersTab = document.getElementById('emergencyNumbersTab');
				const emergencyNumbersContent = document.getElementById('emergencyNumbersContent');



//pest button code start
// প্রিসেট ড্রপডাউন এবং মোডাল এর উপাদানগুলো সিলেক্ট করুন
const presetButtonLeft = document.getElementById('presetButtonLeft');
const dropdownMenuLeft = document.getElementById('dropdownMenuLeft');
const presetButtonRight = document.getElementById('presetButtonRight');
const dropdownMenuRight = document.getElementById('dropdownMenuRight');
loadSavedPresets();
const customPresetModal = document.getElementById('customPresetModal');
const customModalTitle = document.getElementById('customModalTitle');
const customModalDesc = document.getElementById('customModalDesc');
const customPresetInput = document.getElementById('customPresetInput');
const saveCustomPresetBtn = document.getElementById('saveCustomPresetBtn');
const cancelCustomPresetBtn = document.getElementById('cancelCustomPresetBtn');

// ড্রপডাউন খোলা এবং বন্ধ করার জন্য ফাংশন
const toggleDropdown = (button, menu) => {
    menu.classList.toggle('hidden');
    button.classList.toggle('open');
};

if (presetButtonLeft) {
    presetButtonLeft.addEventListener('click', (e) => {
        e.stopPropagation(); // পেজ-জুড়ে ক্লিক ইভেন্ট প্রতিরোধ করতে
        toggleDropdown(presetButtonLeft, dropdownMenuLeft);
        dropdownMenuRight.classList.add('hidden'); // অন্য ড্রপডাউন বন্ধ করুন
        presetButtonRight.classList.remove('open');
    });
}

if (presetButtonRight) {
    presetButtonRight.addEventListener('click', (e) => {
        e.stopPropagation();
        toggleDropdown(presetButtonRight, dropdownMenuRight);
        dropdownMenuLeft.classList.add('hidden'); // অন্য ড্রপডাউন বন্ধ করুন
        presetButtonLeft.classList.remove('open');
    });
}



// সমস্ত ড্রপডাউন আইটেমের জন্য ইভেন্ট লিসেনার যুক্ত করুন
document.querySelectorAll('#dropdownMenuLeft a').forEach(item => {
    item.addEventListener('click', (e) => handlePresetSelection(e, 'left'));
});
document.querySelectorAll('#dropdownMenuRight a').forEach(item => {
    item.addEventListener('click', (e) => handlePresetSelection(e, 'right'));
});

// নতুন ফাংশন: পেজ লোড হওয়ার সময় localStorage থেকে সেভ করা প্রিসেট লোড করার জন্য।
function loadSavedPresets() {
    const presetButtonLeft = document.getElementById('presetButtonLeft');
    const presetButtonRight = document.getElementById('presetButtonRight');

    // বাম দিকের প্রিসেট লোড করুন
    const savedPresetLeftValue = localStorage.getItem('presetLeftValue');
    const savedPresetLeftText = localStorage.getItem('presetLeftText');
    if (savedPresetLeftValue && savedPresetLeftText && presetButtonLeft) {
        pastePresetLeft = savedPresetLeftValue;
        presetButtonLeft.childNodes[0].nodeValue = `${savedPresetLeftText} `;
        if (savedPresetLeftValue === 'custom' || savedPresetLeftValue === 'custom-serial') {
            customPasteValueLeft = localStorage.getItem('customPasteValueLeft') || '';
        }
    }

    // ডান দিকের প্রিসেট লোড করুন
    const savedPresetRightValue = localStorage.getItem('presetRightValue');
    const savedPresetRightText = localStorage.getItem('presetRightText');
    if (savedPresetRightValue && savedPresetRightText && presetButtonRight) {
        pastePresetRight = savedPresetRightValue;
        presetButtonRight.childNodes[0].nodeValue = `${savedPresetRightText} `;
        if (savedPresetRightValue === 'custom' || savedPresetRightValue === 'custom-serial') {
            customPasteValueRight = localStorage.getItem('customPasteValueRight') || '';
        }
    }
}

// এই ফাংশনটি আপনার পুরনো handlePresetSelection ফাংশনের পরিবর্তে ব্যবহার করুন।
// এখানে প্রিসেট সিলেক্ট করার সাথে সাথে localStorage-এ সেভ করার কোড যোগ করা হয়েছে।
const handlePresetSelection = (event, side) => {
    event.preventDefault();
    const presetValue = event.target.dataset.preset;
    const presetText = event.target.textContent.trim();
    const presetButtonLeft = document.getElementById('presetButtonLeft');
    const presetButtonRight = document.getElementById('presetButtonRight');

    if (presetValue === 'custom' || presetValue === 'custom-serial') {
        currentModalSide = side;
        currentModalPreset = presetValue;
        
        customModalTitle.textContent = presetValue === 'custom' ? 'কাস্টম প্রিসেট' : 'সিরিয়ালসহ কাস্টম প্রিসেট';
        customModalDesc.textContent = presetValue === 'custom' 
            ? 'প্রতিবার পেস্ট করার আগে যে টেক্সট যুক্ত করতে চান তা লিখুন।'
            : 'এখানে আপনার টেক্সট লিখুন। সিরিয়াল নম্বরের জন্য {serial} ব্যবহার করুন (যেমন: Step {serial}:)।';
        
        const currentCustomValue = (side === 'left') ? customPasteValueLeft : customPasteValueRight;
        customPresetInput.value = currentCustomValue;
        
        customPresetModal.classList.remove('hidden');
    } else {
        if (side === 'left') {
            pastePresetLeft = presetValue;
            presetButtonLeft.childNodes[0].nodeValue = `${presetText} `;
            // localStorage-এ সেভ করুন
            localStorage.setItem('presetLeftValue', presetValue);
            localStorage.setItem('presetLeftText', presetText);
        } else {
            pastePresetRight = presetValue;
            presetButtonRight.childNodes[0].nodeValue = `${presetText} `;
            // localStorage-এ সেভ করুন
            localStorage.setItem('presetRightValue', presetValue);
            localStorage.setItem('presetRightText', presetText);
        }
    }
    
    const dropdown = (side === 'left') ? document.getElementById('dropdownMenuLeft') : document.getElementById('dropdownMenuRight');
    const button = (side === 'left') ? presetButtonLeft : presetButtonRight;
    dropdown.classList.add('hidden');
    button.classList.remove('open');
};

// আপনার পুরনো saveCustomPresetBtn এর click event listener-এর পরিবর্তে এটি ব্যবহার করুন।
// এখানে কাস্টম প্রিসেট সেভ করার সাথে সাথে localStorage-এ সেভ করার কোড যোগ করা হয়েছে।
if (saveCustomPresetBtn) {
    saveCustomPresetBtn.addEventListener('click', () => {
        const customValue = customPresetInput.value;
        const presetText = currentModalPreset === 'custom-serial' ? 'সিরিয়ালসহ কাস্টম' : 'কাস্টম প্রিসেট';
        const presetButtonLeft = document.getElementById('presetButtonLeft');
        const presetButtonRight = document.getElementById('presetButtonRight');

        if (currentModalSide === 'left') {
            pastePresetLeft = currentModalPreset;
            customPasteValueLeft = customValue;
            presetButtonLeft.childNodes[0].nodeValue = `${presetText} `;

            // localStorage-এ সেভ করুন
            localStorage.setItem('presetLeftValue', currentModalPreset);
            localStorage.setItem('presetLeftText', presetText);
            localStorage.setItem('customPasteValueLeft', customValue);

        } else {
            pastePresetRight = currentModalPreset;
            customPasteValueRight = customValue;
            presetButtonRight.childNodes[0].nodeValue = `${presetText} `;
            
            // localStorage-এ সেভ করুন
            localStorage.setItem('presetRightValue', currentModalPreset);
            localStorage.setItem('presetRightText', presetText);
            localStorage.setItem('customPasteValueRight', customValue);
        }
        customPresetModal.classList.add('hidden');
    });
}

if (cancelCustomPresetBtn) {
    cancelCustomPresetBtn.addEventListener('click', () => {
        customPresetModal.classList.add('hidden');
    });
}

// বাইরে ক্লিক করলে ড্রপডাউন বন্ধ করার জন্য
window.addEventListener('click', () => {
    if (!dropdownMenuLeft.classList.contains('hidden')) {
        dropdownMenuLeft.classList.add('hidden');
        presetButtonLeft.classList.remove('open');
    }
    if (!dropdownMenuRight.classList.contains('hidden')) {
        dropdownMenuRight.classList.add('hidden');
        presetButtonRight.classList.remove('open');
    }
});

//paste button code end


                // API কী মডেল উপাদান
                const apiKeyModal = document.getElementById('apiKeyModal');
                const apiKeyInput = document.getElementById('apiKeyInput');
                const saveApiKeyBtn = document.getElementById('saveApiKeyBtn');
                const cancelApiKeyBtn = document.getElementById('cancelApiKeyBtn');
                const apiKeyMessage = document.getElementById('apiKeyMessage');

                // নিশ্চিত করুন যে সমস্ত DOM উপাদান সঠিকভাবে নির্বাচিত হয়েছে
                console.log('basicCalcTab:', basicCalcTab);
                console.log('setApiKeyBtn:', setApiKeyBtn);
                console.log('apiKeyModal:', apiKeyModal);

                // প্রাথমিক ট্যাব প্রদর্শন
                showTab('converter'); // লোডে মৌলিক ক্যালকুলেটরকে সক্রিয় হিসাবে সেট করুন

                // API কী বোতামের স্টাইল আপডেট করার ফাংশন
function updateApiKeyButton() {
    const settingsMenuBtn = document.getElementById('settingsMenuBtn'); // নতুন মেনু বাটনকে টার্গেট করুন
    if (settingsMenuBtn) {
        const apiKey = localStorage.getItem('geminiApiKey');
        if (apiKey) {
            settingsMenuBtn.style.backgroundColor = '#28a745'; // সবুজ
            settingsMenuBtn.style.color = 'white';
        } else {
            settingsMenuBtn.style.backgroundColor = '#ef5350'; // লাল
            settingsMenuBtn.style.color = 'white';
        }
    }
}

                // লোডে কল করুন
                updateApiKeyButton();
// ====================================================================
// START: DROPDOWN MENU LOGIC
// ====================================================================
const moreMenuBtn = document.getElementById('moreMenuBtn');
const moreMenuDropdown = document.getElementById('moreMenuDropdown');
const settingsMenuBtn = document.getElementById('settingsMenuBtn');
const settingsMenuDropdown = document.getElementById('settingsMenuDropdown');

if (moreMenuBtn) {
    moreMenuBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        moreMenuDropdown.classList.toggle('hidden');
        moreMenuBtn.querySelector('svg').classList.toggle('rotate-180');
        // অন্য মেনুটি বন্ধ করুন
        if (settingsMenuDropdown) settingsMenuDropdown.classList.add('hidden');
        if (settingsMenuBtn) settingsMenuBtn.querySelector('svg').classList.remove('rotate-180');
    });
}

if (settingsMenuBtn) {
    settingsMenuBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        settingsMenuDropdown.classList.toggle('hidden');
        settingsMenuBtn.querySelector('svg').classList.toggle('rotate-180');
        // অন্য মেনুটি বন্ধ করুন
        if (moreMenuDropdown) moreMenuDropdown.classList.add('hidden');
        if (moreMenuBtn) moreMenuBtn.querySelector('svg').classList.remove('rotate-180');
    });
}

// মেনুর বাইরে যেকোনো জায়গায় ক্লিক করলে মেনু বন্ধ হয়ে যাবে
window.addEventListener('click', (e) => {
    if (moreMenuDropdown && !moreMenuDropdown.classList.contains('hidden')) {
        moreMenuDropdown.classList.add('hidden');
        moreMenuBtn.querySelector('svg').classList.remove('rotate-180');
    }
    if (settingsMenuDropdown && !settingsMenuDropdown.classList.contains('hidden')) {
        settingsMenuDropdown.classList.add('hidden');
        settingsMenuBtn.querySelector('svg').classList.remove('rotate-180');
    }
});
// ====================================================================
// END: DROPDOWN MENU LOGIC
// ====================================================================

function showTab(tabId) {
    // সমস্ত ট্যাব এর নাম এবং ট্যাব এর কন্টেন্ট নাম একানে বসাতে হয়, এই দুটি সেকশনে নতুন ট্যাবের নাম এবং কনটেন্ট নাম যুক্ত করতে হয় বা বসাতে হয় ।
    const tabs = [
        basicCalcTab,
		ageCalcTab, dateCalcTab, scientificCalcTab, newsTab, converterTab, measurementTab, typingTestTab, zakatCalcTab,
		translatorTab, mapTab, prayerTimeTab, imageToTextTab, wordCounterTab, weatherTab, notepadTab, clockTab,playerTab,
		qrCodeTab,emergencyNumbersTab, spellCheckTab, textBeautifierTab, wordMeaningTab, ttsTab, sttTab, 
        textAssistantTab,
		allFeaturesTab
    ];
    const contents = [
        basicCalculatorContent,
		ageCalculatorContent, dateCalculatorContent, emergencyNumbersContent,scientificCalculatorContent, newsContent, converterContent,
        measurementContent, typingTestContent, translatorContent, mapContent,  prayerTimeContent, imageToTextContent, wordCounterContent,
		weatherContent, notepadContent, clockContent, playerContent,qrCodeContent, spellCheckerContent, textBeautifierContent, wordMeaningContent,
		textToSpeechContent, speechToTextContent, textAssistantContent, zakatCalculatorContent,
        allFeaturesContent
    ];

    // সমস্ত ট্যাব বোতাম থেকে 'active' ক্লাস সরিয়ে দিন
    tabs.forEach(tab => {
        if (tab) tab.classList.remove('active');
    });

    // সমস্ত কন্টেন্ট বিভাগ লুকান
    contents.forEach(content => {
        if (content) content.classList.remove('active');
    });

    // নির্বাচিত ট্যাব সক্রিয় করুন এবং এর কন্টেন্ট দেখান
    let activeTab, activeContent;
	
//নিচের অংশে নতুন ট্যাবের কেস যুক্ত করতে হয় বা বসাতে হয় ।
    switch (tabId) {
        case 'basic':
            activeTab = basicCalcTab;
            activeContent = basicCalculatorContent;
            break;
        case 'age':
            activeTab = ageCalcTab;
            activeContent = ageCalculatorContent;
            break;
        case 'date':
            activeTab = dateCalcTab;
            activeContent = dateCalculatorContent;
            break;
        case 'scientific':
            activeTab = scientificCalcTab;
            activeContent = scientificCalculatorContent;
            break;
        case 'news':
            activeTab = newsTab;
            activeContent = newsContent;
            break;
        case 'converter':
            activeTab = converterTab;
            activeContent = converterContent;
            break;
        case 'measurement':
            activeTab = measurementTab;
            activeContent = measurementContent;
            break;
        case 'typingTest':
            activeTab = typingTestTab;
            activeContent = typingTestContent;
            break;
        case 'translator':
            activeTab = translatorTab;
            activeContent = translatorContent;
            break;
        case 'map':
            activeTab = mapTab;
            activeContent = mapContent;
            break;
		case 'prayerTime':
            activeTab = prayerTimeTab;
            activeContent = prayerTimeContent;
            initializePrayerTimeTab();
            break;
		case 'zakat':
			activeTab = zakatCalcTab;
			activeContent = zakatCalculatorContent;
		break;
        case 'imageToText':
            activeTab = imageToTextTab;
            activeContent = imageToTextContent;
            break;
		case 'wordCounter':
			activeTab = wordCounterTab;
			activeContent = wordCounterContent;
		break;
		case 'weather': // নতুন এই case টি যোগ করুন
            activeTab = weatherTab;
            activeContent = weatherContent;
            break;
		case 'notepad':
			activeTab = notepadTab;
			activeContent = notepadContent;
		break;
		case 'clock':
			activeTab = clockTab;
			activeContent = clockContent;
			initializeClockTab(); // নতুন ফাংশন কল করুন
		break;
		        case 'qrCode':
            activeTab = qrCodeTab;
            activeContent = qrCodeContent;
            break;
		case 'player':
			activeTab = playerTab;
			activeContent = playerContent;
		break;
        case 'spellCheck':
            activeTab = spellCheckTab;
            activeContent = spellCheckerContent;
            break;
        case 'beautify':
            activeTab = textBeautifierTab;
            activeContent = textBeautifierContent;
            break;
        case 'meaning':
            activeTab = wordMeaningTab;
            activeContent = wordMeaningContent;
            break;
        case 'tts':
            activeTab = ttsTab;
            activeContent = textToSpeechContent;
            break;
        case 'stt':
            activeTab = sttTab;
            activeContent = speechToTextContent;
            break;
        case 'textAssistant':
            activeTab = textAssistantTab;
            activeContent = textAssistantContent;
            break;
		case 'emergency':
            activeTab = emergencyNumbersTab;
            activeContent = emergencyNumbersContent;
            initializeEmergencyNumbers(); // Tab-টি চালু করার সময় ফাংশন কল করুন
            break;
        case 'allFeatures':
            activeTab = allFeaturesTab;
            activeContent = allFeaturesContent;
            break;
    }

			if (activeTab) activeTab.classList.add('active');
			if (activeContent) activeContent.classList.add('active');

			console.log(`ট্যাব পরিবর্তন করা হয়েছে: ${tabId}`);
	}

//নিচের এই সেকশনে নতুন ট্যাবের ইফ লাইনটি যুক্ত করতে হয় বা বসাতে হয় ।

                if (basicCalcTab) basicCalcTab.addEventListener('click', () => showTab('basic'));
                if (ageCalcTab) ageCalcTab.addEventListener('click', () => showTab('age'));
                if (dateCalcTab) dateCalcTab.addEventListener('click', () => showTab('date'));
                if (scientificCalcTab) scientificCalcTab.addEventListener('click', () => showTab('scientific'));
                if (newsTab) newsTab.addEventListener('click', () => showTab('news'));
                if (converterTab) converterTab.addEventListener('click', () => showTab('converter'));
                if (measurementTab) measurementTab.addEventListener('click', () => showTab('measurement')); // Add this line
                if (spellCheckTab) spellCheckTab.addEventListener('click', () => showTab('spellCheck'));
                if (textBeautifierTab) textBeautifierTab.addEventListener('click', () => showTab('beautify'));
                if (wordMeaningTab) wordMeaningTab.addEventListener('click', () => showTab('meaning'));
                if (ttsTab) ttsTab.addEventListener('click', () => showTab('tts')); // TTS ট্যাব ইভেন্ট
                if (sttTab) sttTab.addEventListener('click', () => showTab('stt')); // STT ট্যাব ইভেন্ট
				if (typingTestTab) typingTestTab.addEventListener('click', () => showTab('typingTest')); // এই লাইনটি যোগ করুন
				if (mapTab) mapTab.addEventListener('click', () => showTab('map'));
                if (prayerTimeTab) prayerTimeTab.addEventListener('click', () => showTab('prayerTime')); // এই লাইনটি যোগ করুন
				if (imageToTextTab) imageToTextTab.addEventListener('click', () => showTab('imageToText'));
				if (wordCounterTab) wordCounterTab.addEventListener('click', () => showTab('wordCounter'));
				if (weatherTab) weatherTab.addEventListener('click', () => showTab('weather'));
				if (notepadTab) notepadTab.addEventListener('click', async () => {
					showTab('notepad');
					await initializeNotepad(); // Notepad চালু করার জন্য এই ফাংশন কল করুন
					});
				if (clockTab) clockTab.addEventListener('click', () => showTab('clock'));
				if (playerTab) playerTab.addEventListener('click', () => showTab('player'));
				if (zakatCalcTab) zakatCalcTab.addEventListener('click', () => showTab('zakat'));
				if (qrCodeTab) qrCodeTab.addEventListener('click', () => showTab('qrCode'));
                if (textAssistantTab) textAssistantTab.addEventListener('click', () => showTab('textAssistant'));
                if (allFeaturesTab) allFeaturesTab.addEventListener('click', () => showTab('allFeatures'));
				if (emergencyNumbersTab) emergencyNumbersTab.addEventListener('click', () => showTab('emergency'));

                // API কী সেটিং বোতাম এবং মডেল লজিক
                if (setApiKeyBtn) {
                    setApiKeyBtn.addEventListener('click', () => {
                        console.log('API কী সেট করুন বোতামে ক্লিক করা হয়েছে।');
                        if (apiKeyModal) {
                            apiKeyModal.classList.remove('hidden');
                            if (apiKeyInput) apiKeyInput.value = localStorage.getItem('geminiApiKey') || ''; // বর্তমান কী থাকলে দেখান
                            if (apiKeyMessage) apiKeyMessage.innerText = ''; // পূর্ববর্তী বার্তা পরিষ্কার করুন
                            console.log('API কী মডেল দেখানো হয়েছে।');
                        } else {
                            console.error('API কী মডেল উপাদান পাওয়া যায়নি।');
                        }
                    });
                } else {
                    console.error('API কী সেট করুন বোতাম পাওয়া যায়নি।');
                }

                if (saveApiKeyBtn) {
                    saveApiKeyBtn.addEventListener('click', () => {
                        console.log('API কী সেভ করুন বোতামে ক্লিক করা হয়েছে।');
                        const newApiKey = apiKeyInput ? apiKeyInput.value.trim() : '';
                        if (newApiKey) {
                            localStorage.setItem('geminiApiKey', newApiKey);
                            if (apiKeyMessage) {
                                apiKeyMessage.innerText = 'API কী সফলভাবে সেট করা হয়েছে!';
                                apiKeyMessage.classList.remove('error');
                                apiKeyMessage.classList.add('success');
                            }
                            console.log('API কী সফলভাবে সেভ করা হয়েছে।');
                            updateApiKeyButton(); // অবিলম্বে বোতামের স্টাইল আপডেট করুন
                            setTimeout(() => {
                                if (apiKeyModal) apiKeyModal.classList.add('hidden');
                            }, 1500); // 1.5 সেকেন্ড পর মডেল লুকান
                        } else {
                            if (apiKeyMessage) {
                                apiKeyMessage.innerText = 'অনুগ্রহ করে একটি বৈধ API কী লিখুন।';
                                apiKeyMessage.classList.remove('success');
                                apiKeyMessage.classList.add('error');
                            }
                            console.warn('অবৈধ API কী প্রবেশ করানো হয়েছে।');
                        }
                    });
                }

                if (cancelApiKeyBtn) {
                    cancelApiKeyBtn.addEventListener('click', () => {
                        console.log('API কী বাতিল করুন বোতামে ক্লিক করা হয়েছে।');
                        if (apiKeyModal) apiKeyModal.classList.add('hidden');
                    });
                }


                // --- মৌলিক ক্যালকুলেটর ক্লাস এবং লজিক ---
                class Calculator {
                    constructor(previousOperandTextElement, currentOperandTextElement) {
                        this.previousOperandTextElement = previousOperandTextElement;
                        this.currentOperandTextElement = currentOperandTextElement;
                        this.clear();
                    }

                    clear() {
                        this.currentOperand = '';
                        this.previousOperand = '';
                        this.operation = undefined;
                        this.updateDisplay();
                        // Clearing history is handled by the clearHistoryBtn
                    }

                    delete() {
                        this.currentOperand = this.currentOperand.toString().slice(0, -1);
                        this.updateDisplay();
                    }

                    appendNumber(number) {
                        if (number === '.' && this.currentOperand.includes('.')) return;
                        this.currentOperand = this.currentOperand.toString() + number.toString();
                        this.updateDisplay();
                    }

                    chooseOperation(operation) {
                        if (this.currentOperand === '') return;
                        if (this.previousOperand !== '') {
                            this.compute();
                        }
                        this.operation = operation;
                        this.previousOperand = this.currentOperand;
                        this.currentOperand = '';
                        this.updateDisplay();
                    }

                    compute() {
                        let computation;
                        const prev = parseFloat(this.previousOperand);
                        const current = parseFloat(this.currentOperand);
                        if (isNaN(prev) || isNaN(current)) return;
                        switch (this.operation) {
                            case '+':
                                computation = prev + current;
                                break;
                            case '-':
                                computation = prev - current;
                                break;
                            case '×':
                                computation = prev * current;
                                break;
                            case '÷':
                                if (current === 0) {
                                    computation = 'Error';
                                } else {
                                    computation = prev / current;
                                }
                                break;
                            default:
                                return;
                        }

                        // Add to history ONLY if computation is valid
                        if (computation !== 'Error') {
                            this.addHistoryEntry(`${this.getDisplayNumber(prev)} ${this.operation} ${this.getDisplayNumber(current)} = ${this.getDisplayNumber(computation)}`);
                        }

                        this.currentOperand = computation;
                        this.operation = undefined;
                        this.previousOperand = '';
                        this.updateDisplay();
                    }

                    getDisplayNumber(number) {
                        const stringNumber = number.toString();
                        const integerDigits = parseFloat(stringNumber.split('.')[0]);
                        const decimalDigits = stringNumber.split('.')[1];
                        let integerDisplay;
                        if (isNaN(integerDigits)) {
                            integerDisplay = '';
                        } else {
                            integerDisplay = integerDigits.toLocaleString('en', {
                                maximumFractionDigits: 0
                            });
                        }
                        if (decimalDigits != null) {
                            return `${integerDisplay}.${decimalDigits}`;
                        } else {
                            return integerDisplay;
                        }
                    }

                    updateDisplay() {
                        if (this.currentOperandTextElement) {
                            this.currentOperandTextElement.innerText = this.getDisplayNumber(this.currentOperand);
                        }
                        if (this.previousOperandTextElement) {
                            if (this.operation != null) {
                                this.previousOperandTextElement.innerText =
                                    `${this.getDisplayNumber(this.previousOperand)} ${this.operation}`;
                            } else {
                                this.previousOperandTextElement.innerText = '';
                            }
                        }
                    }

                    // Basic Calculator History function
                    addHistoryEntry(entry) {
                        const historyList = document.getElementById('history-list');
                        if (historyList) {
                            const listItem = document.createElement('li');
                            listItem.innerText = entry;
                            historyList.prepend(listItem); // Add to top of list
                            // Keep history clean, maybe limit items
                            while (historyList.children.length > 20) { // Keep last 20 entries
                                historyList.removeChild(historyList.lastChild);
                            }
                        }
                    }
                }

                // মৌলিক ক্যালকুলেটর DOM উপাদান এবং ইনিশিয়ালাইজেশন
                const numberButtons = document.querySelectorAll('[data-number]');
                const operatorButtons = document.querySelectorAll('[data-operator]');
                const equalsButton = document.querySelector('[data-equals]');
                const deleteButton = document.querySelector('[data-delete]');
                const allClearButton = document.querySelector('[data-all-clear]');
                const previousOperandTextElement = document.querySelector('[data-previous-operand]');
                const currentOperandTextElement = document.querySelector('[data-current-operand]');
                // Basic Calculator History elements
                const historyList = document.getElementById('history-list');
                const clearHistoryBtn = document.getElementById('clearHistoryBtn');

                if (previousOperandTextElement && currentOperandTextElement) {
                    const basicCalculator = new Calculator(previousOperandTextElement, currentOperandTextElement);

                    // মৌলিক ক্যালকুলেটর বোতামগুলির জন্য ইভেন্ট লিসেনার
                    numberButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            console.log('সংখ্যা বোতামে ক্লিক করা হয়েছে:', button.innerText);
                            basicCalculator.appendNumber(button.innerText);
                        });
                    });

                    operatorButtons.forEach(button => {
                        button.addEventListener('click', () => {
                            console.log('অপারেটর বোতামে ক্লিক করা হয়েছে:', button.innerText);
                            basicCalculator.chooseOperation(button.innerText);
                        });
                    });

                    if (equalsButton) {
                        equalsButton.addEventListener('click', () => {
                            console.log('সমান বোতামে ক্লিক করা হয়েছে।');
                            basicCalculator.compute();
                        });
                    }

                    if (allClearButton) {
                        allClearButton.addEventListener('click', () => {
                            console.log('সব পরিষ্কার বোতামে ক্লিক করা হয়েছে।');
                            basicCalculator.clear();
                        });
                    }

                    if (deleteButton) {
                        deleteButton.addEventListener('click', () => {
                            console.log('মুছুন বোতামে ক্লিক করা হয়েছে।');
                            basicCalculator.delete();
                        });
                    }

                    // Basic Calculator History Clear Button
                    if (clearHistoryBtn) {
                        clearHistoryBtn.addEventListener('click', () => {
                            if (historyList) {
                                historyList.innerHTML = '';
                                showCustomAlert('হিস্টোরি পরিষ্কার করা হয়েছে!');
                            }
                        });
                    }

                    // মৌলিক ক্যালকুলেটরের জন্য কীবোর্ড ইনপুট সমর্থন
                    document.addEventListener('keydown', e => {
                        if (!basicCalculatorContent || !basicCalculatorContent.classList.contains('active')) return;

                        if (e.key >= '0' && e.key <= '9' || e.key === '.') {
                            basicCalculator.appendNumber(e.key);
                        } else if (e.key === '+' || e.key === '-' || e.key === '*' || e.key === '/') {
                            let operatorKey = e.key;
                            if (operatorKey === '*') operatorKey = '×';
                            if (operatorKey === '/') operatorKey = '÷';
                            basicCalculator.chooseOperation(operatorKey);
                        } else if (e.key === 'Enter' || e.key === '=') {
                            e.preventDefault();
                            basicCalculator.compute();
                        } else if (e.key === 'Backspace') {
                            basicCalculator.delete();
                        } else if (e.key === 'Escape' || e.key === 'Delete') { // <-- এই লাইনটি পরিবর্তন করুন
                            basicCalculator.clear();
                        }
                    });

                    // বৈজ্ঞানিক ক্যালকুলেটরের জন্য কীবোর্ড ডিলিট বাটনের ইভেন্ট লিসেনার
                    document.addEventListener('keydown', (e) => {
                        // "C" (ক্লিয়ার) বাটনের কাজ অনুকরণ করুন
                        if (e.key === 'Delete') {
                            if (scientificExpressionInput) scientificExpressionInput.value = '';
                            if (scientificResultDisplay) scientificResultDisplay.innerText = '';
                            if (scientificErrorMessage) scientificErrorMessage.innerText = '';
                            if (scientificExplanation) scientificExplanation.innerText = '';
                        }
                    });
                } else {
                    console.error('মৌলিক ক্যালকুলেটর ডিসপ্লে উপাদান পাওয়া যায়নি।');
                }


                // মৌলিক ক্যালকুলেটর ব্যাখ্যা বৈশিষ্ট্য
                const explainBasicBtn = document.getElementById('explainBasicBtn');
                const basicExplanation = document.getElementById('basicExplanation');
                const basicExplanationLoading = document.getElementById('basicExplanationLoading');

                if (explainBasicBtn && basicExplanation && basicExplanationLoading) {
                    explainBasicBtn.addEventListener('click', async () => {
                        console.log('মৌলিক ব্যাখ্যা বোতামে ক্লিক করা হয়েছে।');
                        const currentExpression = previousOperandTextElement.innerText + currentOperandTextElement.innerText;
                        let fullExpression = currentExpression.trim();

                        if (!fullExpression) {
                            basicExplanation.innerText = 'ব্যাখ্যার জন্য একটি এক্সপ্রেশন লিখুন।';
                            return;
                        }

                        basicExplanation.innerText = '';
                        basicExplanationLoading.style.display = 'block';
                        explainBasicBtn.disabled = true;

                        try {
                            const apiKey = localStorage.getItem('geminiApiKey');
                            if (!apiKey) {
                                basicExplanation.innerText = 'জেমিনি API কী সেট করা হয়নি। অনুগ্রহ করে "API কী সেট করুন" বাটনে ক্লিক করে কী সেট করুন।';
                                basicExplanationLoading.style.display = 'none';
                                explainBasicBtn.disabled = false;
                                return;
                            }

                            let chatHistory = [];
                            chatHistory.push({
                                role: "user",
                                parts: [{
                                    text: `এই গাণিতিক এক্সপ্রেশনটি সহজ ভাষায় ব্যাখ্যা করুন: "${fullExpression}"। এটি কী করে এবং এর মূল ধারণা কী?`
                                }]
                            });
                            const payload = {
                                contents: chatHistory
                            };
                            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                            const response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(payload)
                            });

                            const result = await response.json();

                            if (result.candidates && result.candidates.length > 0 &&
                                result.candidates[0].content && result.candidates[0].content.parts &&
                                result.candidates[0].content.parts.length > 0) {
                                const text = result.candidates[0].content.parts[0].text;
                                basicExplanation.innerText = text;
                            } else {
                                basicExplanation.innerText = 'জেমিনি থেকে কোনো প্রতিক্রিয়া পাওয়া যায়নি।';
                                console.error('জেমিনি API প্রতিক্রিয়া অপ্রত্যাশিত:', result);
                            }
                        } catch (error) {
                            basicExplanation.innerText = 'জেমিনি API কল করার সময় একটি ত্রুটি হয়েছে: ' + error.message;
                            console.error('জেমিনি API ত্রুটি:', error);
                        } finally {
                            basicExplanationLoading.style.display = 'none';
                            explainBasicBtn.disabled = false;
                        }
                    });
                } else {
                    console.error('মৌলিক ব্যাখ্যা উপাদান পাওয়া যায়নি।');
                }


                // --- বয়স ক্যালকুলেটর লজিক ---
                const birthDateInput = document.getElementById('birthDate');
                const currentDateInput = document.getElementById('currentDate');
                const calculateAgeBtn = document.getElementById('calculateAgeBtn');
                const ageResult = document.getElementById('ageResult');
                const ageErrorMessage = document.getElementById('ageErrorMessage');


                // বর্তমান তারিখ ইনপুটের জন্য বর্তমান তারিখ ডিফল্ট হিসাবে সেট করুন
                const todayCurrentDate = new Date();
                const todayCurrentDateString = todayCurrentDate.toISOString().split('T')[0];
                if (currentDateInput) currentDateInput.value = todayCurrentDateString;

                if (calculateAgeBtn) {
                    calculateAgeBtn.addEventListener('click', () => {
                        console.log('বয়স গণনা করুন বোতামে ক্লিক করা হয়েছে।');
                        calculateAge();
                    });
                }

                function calculateAge() {
                    const birthDateValue = birthDateInput ? birthDateInput.value : '';
                    const currentDateValue = currentDateInput ? currentDateInput.value : '';

                    // পূর্ববর্তী বার্তা পরিষ্কার করুন
                    if (ageResult) ageResult.innerText = '';
                    if (ageErrorMessage) ageErrorMessage.innerText = '';

                    if (!birthDateValue || !currentDateValue) {
                        if (ageErrorMessage) ageErrorMessage.innerText = 'অনুগ্রহ করে জন্ম তারিখ এবং বর্তমান তারিখ উভয়ই নির্বাচন করুন।';
                        return;
                    }

                    const birthDate = new Date(birthDateValue);
                    const currentDate = new Date(currentDateValue);

                    if (birthDate > currentDate) {
                        if (ageErrorMessage) ageErrorMessage.innerText = 'জন্ম তারিখ বর্তমান তারিখের চেয়ে বেশি হতে পারে না।';
                        return;
                    }

                    let years = currentDate.getFullYear() - birthDate.getFullYear();
                    let months = currentDate.getMonth() - birthDate.getMonth();
                    let days = currentDate.getDate() - birthDate.getDate();

                    // দিনগুলি নেতিবাচক হলে মাস এবং বছর সামঞ্জস্য করুন
                    if (days < 0) {
                        months--;
                        // বর্তমান তারিখের পূর্ববর্তী মাসের দিনের সংখ্যা পান
                        const prevMonthLastDay = new Date(currentDate.getFullYear(), currentDate.getMonth(), 0).getDate();
                        days += prevMonthLastDay;
                    }

                    // মাসগুলি নেতিবাচক হলে বছর সামঞ্জস্য করুন
                    if (months < 0) {
                        years--;
                        months += 12;
                    }

                    if (ageResult) ageResult.innerText = `আপনার বয়স: ${years} বছর, ${months} মাস, ${days} দিন।`;
                }
                // --- বছর ক্যালকুলেটর লজিক ---
                const yearCalcDateInput = document.getElementById('yearCalcDateInput');
                const yearCalcYearsInput = document.getElementById('yearCalcYearsInput');
                const calculateYearsBtn = document.getElementById('calculateYearsBtn');
                const yearCalcResult = document.getElementById('yearCalcResult');

                if (calculateYearsBtn) {
                    calculateYearsBtn.addEventListener('click', () => {
                        console.log('বছর ক্যালকুলেটর বোতামে ক্লিক করা হয়েছে।');
                        calculateAndDisplayYears();
                    });
                }

                function calculateAndDisplayYears() {
                    const startDateValue = yearCalcDateInput.value;
                    const yearsToCalc = parseInt(yearCalcYearsInput.value, 10);

                    // আগের ফলাফল মুছে ফেলুন
                    yearCalcResult.innerHTML = '';

                    if (isNaN(yearsToCalc) || yearsToCalc <= 0) {
                        yearCalcResult.innerHTML = '<p class="error-message">অনুগ্রহ করে বছরের একটি সঠিক সংখ্যা লিখুন।</p>';
                        return;
                    }

                    // যদি কোনো তারিখ নির্বাচন করা না থাকে, তাহলে আজকের তারিখ ব্যবহার করুন
                    const startDate = startDateValue ? new Date(startDateValue) : new Date();

                    // তারিখ অবৈধ হলে ত্রুটি দেখান
                    if (isNaN(startDate.getTime())) {
                        yearCalcResult.innerHTML = '<p class="error-message">অনুগ্রহ করে একটি সঠিক তারিখ নির্বাচন করুন।</p>';
                        return;
                    }


                    // ভবিষ্যতের তারিখ গণনা
                    const futureDate = new Date(startDate);
                    futureDate.setFullYear(startDate.getFullYear() + yearsToCalc);

                    // অতীতের তারিখ গণনা
                    const pastDate = new Date(startDate);
                    pastDate.setFullYear(startDate.getFullYear() - yearsToCalc);

                    // ফলাফল প্রদর্শনের জন্য তারিখ ফরম্যাট করুন
                    const dateFormatter = new Intl.DateTimeFormat('bn-BD', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric',
                        weekday: 'long'
                    });

                    // ফলাফল প্রদর্শনের জন্য HTML তৈরি করুন
                    yearCalcResult.innerHTML = `
                        <div class="result-item">
                            <h3>${yearsToCalc} বছর আগে ছিল:</h3>
                            <p class="past-date">${dateFormatter.format(pastDate)}</p>
                        </div>
                        <div class="result-item">
                            <h3>${yearsToCalc} বছর পরে হবে:</h3>
                            <p class="future-date">${dateFormatter.format(futureDate)}</p>
                        </div>
                    `;
                }

                // --- তারিখ ও সময় ক্যালকুলেটর লজিক ---
                const showTodayDatesBtn = document.getElementById('showTodayDatesBtn');
                const showTomorrowDatesBtn = document.getElementById('showTomorrowDatesBtn');

                const todayResultSection = document.getElementById('todayResultSection');
                const tomorrowResultSection = document.getElementById('tomorrowResultSection');

                const todayGregorianDateDisplay = document.getElementById('todayGregorianDateDisplay');
                const todayBengaliDateDisplay = document.getElementById('todayBengaliDateDisplay');
                const todayHijriDateDisplay = document.getElementById('todayHijriDateDisplay');
                const todayDayDisplay = document.getElementById('todayDayDisplay'); // আজকের দিনের জন্য নতুন উপাদান
                const todayTimeDisplay = document.getElementById('todayTimeDisplay');

                const tomorrowGregorianDateDisplay = document.getElementById('tomorrowGregorianDateDisplay');
                const tomorrowBengaliDateDisplay = document.getElementById('tomorrowBengaliDateDisplay');
                const tomorrowHijriDateDisplay = document.getElementById('tomorrowHijriDateDisplay');
                const tomorrowDayDisplay = document.getElementById('tomorrowDayDisplay'); // আগামীকালের দিনের জন্য নতুন উপাদান
                const tomorrowTimeDisplay = document.getElementById('tomorrowTimeDisplay');

                // নতুন তারিখ কনভার্টার DOM উপাদান
                const englishDateInput = document.getElementById('englishDateInput');
                const convertEnglishToBengaliBtn = document.getElementById('convertEnglishToBengaliBtn');
                const convertedBengaliDate = document.getElementById('convertedBengaliDate');
                const convertedDayDisplay = document.getElementById('convertedDayDisplay'); // রূপান্তরিত দিনের জন্য নতুন উপাদান


                if (showTodayDatesBtn) {
                    showTodayDatesBtn.addEventListener('click', () => {
                        console.log('আজকের তারিখ দেখান বোতামে ক্লিক করা হয়েছে।');
                        displayDates('today');
                    });
                }
                if (showTomorrowDatesBtn) {
                    showTomorrowDatesBtn.addEventListener('click', () => {
                        console.log('আগামীকালের তারিখ দেখান বোতামে ক্লিক করা হয়েছে।');
                        displayDates('tomorrow');
                    });
                }

                // গ্রেগরিয়ান তারিখকে বাংলা তারিখে রূপান্তর করার ফাংশন (বাংলাদেশ স্ট্যান্ডার্ড)
                function getBengaliDate(gregorianDate) {
                    const year = gregorianDate.getFullYear();
                    const month = gregorianDate.getMonth(); // 0-11
                    const day = gregorianDate.getDate();

                    let bengaliYear;
                    const bengaliMonthNames = [
                        "বৈশাখ", "জ্যৈষ্ঠ", "আষাঢ়", "শ্রাবণ", "ভাদ্র", "আশ্বিন",
                        "কার্তিক", "অগ্রহায়ণ", "পৌষ", "মাঘ", "ফাল্গুন", "চৈত্র"
                    ];

                    // বাংলা বছর গণনা করুন (বাংলাদেশ স্ট্যান্ডার্ড: পহেলা বৈশাখ 14 এপ্রিল)
                    if (month < 3 || (month === 3 && day < 14)) { // 14 এপ্রিলের আগে
                        bengaliYear = year - 594;
                    } else { // 14 এপ্রিল বা তার পরে
                        bengaliYear = year - 593;
                    }

                    // বাংলা মাসের দিন সংখ্যা (বাংলাদেশ স্ট্যান্ডার্ড)
                    // বৈশাখ থেকে ভাদ্র (5 মাস): 31 দিন
                    // আশ্বিন থেকে চৈত্র (7 মাস): সাধারণত 30 দিন, অধিবর্ষে ফাল্গুন 31 দিন
                    const bengaliMonthLengths = [31, 31, 31, 31, 31, 30, 30, 30, 30, 30, 30, 30];

                    // বাংলা বছরের সাথে সম্পর্কিত গ্রেগরিয়ান বছরটি অধিবর্ষ কিনা তা নির্ধারণ করুন
                    // এটি ফাল্গুনকে প্রভাবিত করে (11তম মাস, সূচক 10)
                    const gregorianYearForBengaliLeapCheck = bengaliYear + 593;
                    const isGregorianLeapYear = (gregorianYearForBengaliLeapCheck % 4 === 0 && gregorianYearForBengaliLeapCheck % 100 !== 0) || gregorianYearForBengaliLeapCheck % 400 === 0;

                    if (isGregorianLeapYear) {
                        bengaliMonthLengths[10] = 31; // অধিবর্ষে ফাল্গুন 31 দিন
                    }

                    // বর্তমান বাংলা বছরের শুরু থেকে অতিবাহিত দিন গণনা করুন (14 এপ্রিল)
                    const startOfCurrentBengaliYearGregorian = new Date(year, 3, 14); // বর্তমান গ্রেগরিয়ান বছরের 14 এপ্রিল
                    if (gregorianDate < startOfCurrentBengaliYearGregorian) {
                        // যদি বর্তমান তারিখ 14 এপ্রিলের আগে হয়, তবে পূর্ববর্তী গ্রেগরিয়ান বছরের 14 এপ্রিলকে রেফারেন্স হিসাবে সামঞ্জস্য করুন
                        startOfCurrentBengaliYearGregorian.setFullYear(year - 1);
                    }

                    const diffTime = gregorianDate.getTime() - startOfCurrentBengaliYearGregorian.getTime();
                    let daysPassedSinceBengaliYearStart = Math.floor(diffTime / (1000 * 60 * 60 * 24));

                    let currentBengaliMonthIndex = 0;
                    let currentBengaliDay = 0;

                    // সঠিক মাস এবং দিন খুঁজে বের করতে বাংলা মাসগুলির মধ্যে পুনরাবৃত্তি করুন
                    for (let i = 0; i < bengaliMonthNames.length; i++) {
                        if (daysPassedSinceBengaliYearStart < bengaliMonthLengths[i]) {
                            currentBengaliMonthIndex = i;
                            currentBengaliDay = daysPassedSinceBengaliYearStart + 1; // দিন 1-ইনডেক্সড
                            break;
                        }
                        daysPassedSinceBengaliYearStart -= bengaliMonthLengths[i];
                    }

                    // সংখ্যাগুলিকে বাংলা সংখ্যায় রূপান্তর করুন
                    const toBengaliNumber = (num) => {
                        const numbers = ['০', '১', '২', '৩', '৪', '৫', '৬', '৭', '৮', '৯'];
                        return num.toString().split('').map(digit => numbers[parseInt(digit)]).join('');
                    };

                    // বাংলা মাসের মোট দিন
                    const totalDaysInBengaliMonth = bengaliMonthLengths[currentBengaliMonthIndex];

                    return {
                        day: currentBengaliDay,
                        month: bengaliMonthNames[currentBengaliMonthIndex],
                        year: bengaliYear,
                        totalDays: totalDaysInBengaliMonth,
                        formatted: `${toBengaliNumber(currentBengaliDay)} ${bengaliMonthNames[currentBengaliMonthIndex]}, ${toBengaliNumber(bengaliYear)} বঙ্গাব্দ`
                    };
                }

                // আরবি সংখ্যাকে বাংলা সংখ্যায় রূপান্তর করার ফাংশন
                const arabicToBengaliNumbers = (text) => {
                    const arabicDigits = ['٠', '١', '٢', '٣', '٤', '٥', '٦', '٧', '٨', '٩'];
                    const bengaliDigits = ['০', '১', '২', '৩', '৪', '৫', '৬', '৭', '৮', '৯'];
                    let converted = text;
                    for (let i = 0; i < arabicDigits.length; i++) {
                        converted = converted.replace(new RegExp(arabicDigits[i], 'g'), bengaliDigits[i]);
                    }
                    return converted;
                };

                // আরবি হিজরি মাসের নামগুলিকে বাংলা নামে ম্যাপ করুন
                const hijriMonthArabicToBengali = {
                    'محرم': 'মুহাররম',
                    'صفر': 'সফর',
                    'ربيع الأول': 'রবিউল আউয়াল',
                    'ربيع الآخر': 'রবিউস সানি',
                    'جمادى الأولى': 'জমাদিউল আউয়াল',
                    'جمادى الآخرة': 'জমাদিউস সানি',
                    'رجب': 'রজব',
                    'شعبان': 'শাবান',
                    'رمضان': 'রমজান',
                    'شوال': 'শাওয়াল',
                    'ذو القعدة': 'জিলকদ',
                    'ذو الحجة': 'জিলহজ'
                };

                function displayDates(period) {
                    console.log(`তারিখগুলি প্রদর্শন করা হচ্ছে: ${period}`);
                    // প্রথমে উভয় বিভাগ পরিষ্কার করুন
                    if (todayResultSection) todayResultSection.style.display = 'none';
                    if (tomorrowResultSection) tomorrowResultSection.style.display = 'none';

                    // পূর্ববর্তী কন্টেন্ট পরিষ্কার করুন
                    if (todayGregorianDateDisplay) todayGregorianDateDisplay.innerHTML = '';
                    if (todayBengaliDateDisplay) todayBengaliDateDisplay.innerHTML = '';
                    if (todayHijriDateDisplay) todayHijriDateDisplay.innerHTML = '';
                    if (todayDayDisplay) todayDayDisplay.innerHTML = ''; // দিনের ডিসপ্লে পরিষ্কার করুন
                    if (todayTimeDisplay) todayTimeDisplay.innerHTML = '';

                    if (tomorrowGregorianDateDisplay) tomorrowGregorianDateDisplay.innerHTML = '';
                    if (tomorrowBengaliDateDisplay) tomorrowBengaliDateDisplay.innerHTML = '';
                    if (tomorrowHijriDateDisplay) tomorrowHijriDateDisplay.innerHTML = '';
                    if (tomorrowDayDisplay) tomorrowDayDisplay.innerHTML = ''; // দিনের ডিসপ্লে পরিষ্কার করুন
                    if (tomorrowTimeDisplay) tomorrowTimeDisplay.innerHTML = '';

                    let dateToDisplay = new Date(); // ডিফল্ট হিসাবে আজ
                    if (period === 'tomorrow') {
                        dateToDisplay.setDate(dateToDisplay.getDate() + 1); // আগামীকালের তারিখের জন্য
                    }

                    // --- তারিখ গণনা ---
                    // গ্রেগরিয়ান তারিখ
                    const gregorianDateFormatted = dateToDisplay.toLocaleDateString('bn-BD', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    const dayOfWeek = dateToDisplay.toLocaleDateString('bn-BD', {
                        weekday: 'long'
                    }); // সপ্তাহের দিন পান

                    // বাংলা তারিখ
                    const bengaliDateInfo = getBengaliDate(dateToDisplay);
                    const bengaliDateFormatted = bengaliDateInfo.formatted;

                    // হিজরি তারিখ (প্রয়োজনে স্থানীয় কনভেনশনের জন্য সামঞ্জস্য করা হয়েছে)
                    let hijriCalculationDate = new Date(dateToDisplay);
                    // ব্যবহারকারীর পর্যবেক্ষণের সাথে মিলানোর জন্য হিজরির জন্য -2 দিনের সামঞ্জস্য পুনরায় চালু করা হচ্ছে
                    // এই সামঞ্জস্য স্থানীয় চাঁদ দেখা ভিত্তিক ক্যালেন্ডারের সাথে সারিবদ্ধ করার জন্য সাধারণ,
					//১ দিন বা ২ দিন আগে পরে করতে নিচের লজিকের মান বসাতে হবে, এখানে 1 দিন বা দুই দিন
					//কমবেশি করে সেট করতে হবে প্রতিমাসে আরবি তারিখের ক্ষেত্রে।
                    hijriCalculationDate.setDate(hijriCalculationDate.getDate() - 2);

                    const hijriDateFormatter = new Intl.DateTimeFormat('ar-SA', {
                        calendar: 'islamic',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric',
                        timeZone: 'Asia/Dhaka'
                    });
                    const hijriParts = hijriDateFormatter.formatToParts(hijriCalculationDate);

                    let hijriDay = '';
                    let hijriMonthArabic = '';
                    let hijriYear = '';

                    for (const part of hijriParts) {
                        if (part.type === 'day') {
                            hijriDay = arabicToBengaliNumbers(part.value);
                        } else if (part.type === 'month') {
                            hijriMonthArabic = part.value;
                        } else if (part.type === 'year') {
                            hijriYear = arabicToBengaliNumbers(part.value);
                        }
                    }
                    const hijriMonthBengali = hijriMonthArabicToBengali[hijriMonthArabic] || hijriMonthArabic;
                    const hijriDateFormatted = `${hijriDay} ${hijriMonthBengali} ${hijriYear} হিজরি`;

                    // সময়
                    const timeFormatted = dateToDisplay.toLocaleTimeString('bn-BD', {
                        hour: '2-digit',
                        minute: '2-digit',
                        second: '2-digit',
                        hour12: true,
                        timeZone: 'Asia/Dhaka' // বাংলাদেশের সময়ের জন্য স্পষ্টভাবে সেট করুন
                    });

                    // 26 বা তার বেশি তারিখের জন্য হাইলাইট লজিক
                    let gregorianHighlightClass = '';
                    if (dateToDisplay.getDate() >= 26) {
                        gregorianHighlightClass = 'text-red-800'; // গাঢ় লাল
                    }

                    let bengaliHighlightClass = '';
                    if (bengaliDateInfo.day >= 26) {
                        bengaliHighlightClass = 'text-red-800'; // গাঢ় লাল
                    }

                    let hijriHighlightClass = '';
                    // তুলনার জন্য hijriDay কে সংখ্যায় রূপান্তর করুন
                    if (parseInt(hijriDay) >= 26) {
                        hijriHighlightClass = 'text-red-800'; // গাঢ় লাল
                    }


                    if (period === 'today') {
                        if (todayResultSection) todayResultSection.style.display = 'block';
                        if (todayGregorianDateDisplay) todayGregorianDateDisplay.innerHTML = `<strong>খ্রিষ্টাব্দ:</strong> <span class="${gregorianHighlightClass}">${gregorianDateFormatted}</span>`;
                        if (todayBengaliDateDisplay) todayBengaliDateDisplay.innerHTML = `<strong>বাংলা তারিখ:</strong> <span class="${bengaliHighlightClass}">${bengaliDateFormatted}</span>`;
                        if (todayHijriDateDisplay) todayHijriDateDisplay.innerHTML = `<strong>হিজরি:</strong> <span class="${hijriHighlightClass}">${hijriDateFormatted}</span>`;
                        if (todayDayDisplay) todayDayDisplay.innerHTML = `<strong>বার:</strong> ${dayOfWeek}`; // দিন প্রদর্শন করুন
                        if (todayTimeDisplay) todayTimeDisplay.innerHTML = `<strong>সময়:</strong> ${timeFormatted}`;
                    } else if (period === 'tomorrow') {
                        if (tomorrowResultSection) tomorrowResultSection.style.display = 'block';
                        if (tomorrowGregorianDateDisplay) tomorrowGregorianDateDisplay.innerHTML = `<strong>খ্রিষ্টাব্দ:</strong> <span class="${gregorianHighlightClass}">${gregorianDateFormatted}</span>`;
                        if (tomorrowBengaliDateDisplay) tomorrowBengaliDateDisplay.innerHTML = `<strong>বাংলা তারিখ:</strong> <span class="${bengaliHighlightClass}">${bengaliDateFormatted}</span>`;
                        if (tomorrowHijriDateDisplay) tomorrowHijriDateDisplay.innerHTML = `<strong>হিজরি:</strong> <span class="${hijriHighlightClass}">${hijriDateFormatted}</span>`;
                        if (tomorrowDayDisplay) tomorrowDayDisplay.innerHTML = `<strong>বার:</strong> ${dayOfWeek}`; // দিন প্রদর্শন করুন
                        if (tomorrowTimeDisplay) tomorrowTimeDisplay.innerHTML = `<strong>সময়:</strong> ${timeFormatted}`;
                    }
                }

                // ইংরেজি থেকে বাংলা তারিখ রূপান্তর লজিক
                if (convertEnglishToBengaliBtn) {
                    convertEnglishToBengaliBtn.addEventListener('click', () => {
                        console.log('ইংরেজি থেকে বাংলা রূপান্তর বোতামে ক্লিক করা হয়েছে।');
                        const englishDateValue = englishDateInput ? englishDateInput.value : '';
                        if (!englishDateValue) {
                            if (convertedBengaliDate) convertedBengaliDate.innerText = 'অনুগ্রহ করে একটি ইংরেজি তারিখ নির্বাচন করুন।';
                            if (convertedDayDisplay) convertedDayDisplay.innerText = ''; // দিনের ডিসপ্লে পরিষ্কার করুন
                            return;
                        }

                        const gregorianDate = new Date(englishDateValue);
                        if (isNaN(gregorianDate.getTime())) { // অবৈধ তারিখ পরীক্ষা
                            if (convertedBengaliDate) convertedBengaliDate.innerText = 'অবৈধ তারিখ ফরম্যাট।';
                            if (convertedDayDisplay) convertedDayDisplay.innerText = ''; // দিনের ডিসপ্লে পরিষ্কার করুন
                            return;
                        }

                        const bengaliDateInfo = getBengaliDate(gregorianDate);
                        const dayOfWeek = gregorianDate.toLocaleDateString('bn-BD', {
                            weekday: 'long'
                        }); // সপ্তাহের দিন পান

                        if (convertedBengaliDate) convertedBengaliDate.innerHTML = `<strong>বাংলা তারিখ:</strong> ${bengaliDateInfo.formatted}`;
                        if (convertedDayDisplay) convertedDayDisplay.innerHTML = `<strong>বার:</strong> ${dayOfWeek}`;
                    });
                }


                // --- বৈজ্ঞানিক ক্যালকুলেটর লজিক ---
                const scientificExpressionInput = document.getElementById('scientificExpressionInput');
                const scientificButtons = document.querySelectorAll('.scientific-buttons-grid button');
                const scientificResultDisplay = document.getElementById('scientificResult');
                const scientificErrorMessage = document.getElementById('scientificErrorMessage');
                // বৈজ্ঞানিক ব্যাখ্যা উপাদানগুলির জন্য সঠিক আইডি
                const explainScientificBtn = document.getElementById('explainScientificBtn');
                const scientificExplanation = document.getElementById('scientificExplanation');
                const scientificExplanationLoading = document.getElementById('scientificExplanationLoading');

                const functionsWithParentheses = ['sin', 'cos', 'tan', 'log', 'ln', 'sqrt'];

                // এক্সপ্রেশন ইনপুটে বোতামের মান যোগ করুন
                scientificButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        console.log('বৈজ্ঞানিক বোতামে ক্লিক করা হয়েছে:', button.dataset.sciInput);
                        const value = button.dataset.sciInput;
                        const inputElement = scientificExpressionInput;
                        // C বাটন চাপলে পুরো ইনপুট ক্ষেত্র পরিষ্কার হবে
                        if (value === 'C') {
                            if (inputElement) inputElement.value = '';
                            if (scientificResultDisplay) scientificResultDisplay.innerText = '';
                            if (scientificErrorMessage) scientificErrorMessage.innerText = '';
                            if (scientificExplanation) scientificExplanation.innerText = '';
                            // DEL বাটন চাপলে একটি অক্ষর মুছে যাবে
                        } else if (value === 'DEL') {
                            if (inputElement) {
                                inputElement.value = inputElement.value.slice(0, -1);
                            }
                        } else if (button.dataset.sciEquals !== undefined) {
                            // সমান হ্যান্ডেল করুন
                            evaluateScientificExpression();
                        } else if (functionsWithParentheses.includes(value)) {
                            // () প্রয়োজন এমন ফাংশন হ্যান্ডেল করুন
                            if (inputElement) {
                                const start = inputElement.selectionStart;
                                const end = inputElement.selectionEnd;
                                const text = inputElement.value;
                                const newValue = text.substring(0, start) + value + '()' + text.substring(end);
                                inputElement.value = newValue;
                                // বন্ধনীর ভিতরে কার্সার অবস্থান করুন
                                inputElement.selectionStart = start + value.length + 1;
                                inputElement.selectionEnd = start + value.length + 1;
                                inputElement.focus();
                            }
                        } else if (value) {
                            // অন্যান্য মান যোগ করুন
                            if (inputElement) inputElement.value += value;
                        }
                    });
                });

                // কীবোর্ড ইনপুট সমর্থন
                if (scientificExpressionInput) {
                    scientificExpressionInput.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            evaluateScientificExpression();
                        } else if (e.key === 'Escape') {
                            if (scientificExpressionInput) scientificExpressionInput.value = '';
                            if (scientificResultDisplay) scientificResultDisplay.innerText = '';
                            if (scientificErrorMessage) scientificErrorMessage.innerText = '';
                            if (scientificExplanation) scientificExplanation.innerText = '';
                        } else if (e.key === 'Backspace' || e.key === 'Delete') {
                            // ব্যাকস্পেস বা ডিলিট বাটন চাপলে শেষ অক্ষরটি মুছে যাবে
                            if (scientificExpressionInput) {
                                scientificExpressionInput.value = scientificExpressionInput.value.slice(0, -1);
                            }
                        }
                    });
                }

                function evaluateScientificExpression() {
                    const expression = scientificExpressionInput ? scientificExpressionInput.value : '';
                    if (scientificResultDisplay) scientificResultDisplay.innerText = '';
                    if (scientificErrorMessage) scientificErrorMessage.innerText = '';
                    if (scientificExplanation) scientificExplanation.innerText = '';

                    if (expression.trim() === '') {
                        if (scientificErrorMessage) scientificErrorMessage.innerText = 'অনুগ্রহ করে একটি এক্সপ্রেশন লিখুন।';
                        return;
                    }

                    // মৌলিক বন্ধনী ভারসাম্য পরীক্ষা
                    let openParentheses = (expression.match(/\(/g) || []).length;
                    let closeParentheses = (expression.match(/\)/g) || []).length;
                    if (openParentheses !== closeParentheses) {
                        if (scientificErrorMessage) scientificErrorMessage.innerText = 'বন্ধনী সঠিকভাবে বন্ধ করা হয়নি।';
                        return;
                    }

                    try {
                        let processedExpression = expression
                            .replace(/sin\(/g, 'Math.sin(Math.PI / 180 * ')
                            .replace(/cos\(/g, 'Math.cos(Math.PI / 180 * ')
                            .replace(/tan\(/g, 'Math.tan(Math.PI / 180 * ')
                            .replace(/log\(/g, 'Math.log10(')
                            .replace(/ln\(/g, 'Math.log(')
                            .replace(/sqrt\(/g, 'Math.sqrt(')
                            .replace(/\^/g, '**')
                            .replace(/π/g, 'Math.PI')
                            .replace(/e/g, 'Math.E')
                            .replace(/×/g, '*') // '×' কে '*' এ রূপান্তর করুন
                            .replace(/÷/g, '/'); // '÷' কে '/' এ রূপান্তর করুন

                        let result = eval(processedExpression);

                        if (isNaN(result) || !isFinite(result)) {
                            if (scientificErrorMessage) scientificErrorMessage.innerText = 'অবৈধ এক্সপ্রেশন বা ফলাফল।';
                        } else {
                            if (scientificResultDisplay) scientificResultDisplay.innerText = result.toLocaleString('en', {
                                maximumFractionDigits: 10
                            });
                        }
                    } catch (error) {
                        if (scientificErrorMessage) scientificErrorMessage.innerText = 'এক্সপ্রেশন ত্রুটি: ' + error.message + '। অনুগ্রহ করে সঠিক সিনট্যাক্স ব্যবহার করুন।';
                        console.error('বৈজ্ঞানিক ক্যালকুলেটর ত্রুটি:', error);
                    }
                }

                // বৈজ্ঞানিক এক্সপ্রেশন ব্যাখ্যার জন্য জেমিনি API কল
                if (explainScientificBtn) {
                    explainScientificBtn.addEventListener('click', async () => {
                        console.log('বৈজ্ঞানিক ব্যাখ্যা বোতামে ক্লিক করা হয়েছে।');
                        const expressionToExplain = scientificExpressionInput ? scientificExpressionInput.value.trim() : '';
                        if (!expressionToExplain) {
                            if (scientificExplanation) scientificExplanation.innerText = 'ব্যাখ্যার জন্য একটি এক্সপ্রেশন লিখুন।';
                            return;
                        }

                        if (scientificExplanation) scientificExplanation.innerText = '';
                        if (scientificExplanationLoading) scientificExplanationLoading.style.display = 'block';
                        if (explainScientificBtn) explainScientificBtn.disabled = true;

                        try {
                            const apiKey = localStorage.getItem('geminiApiKey');
                            if (!apiKey) {
                                if (scientificExplanation) scientificExplanation.innerText = 'জেমিনি API কী সেট করা হয়নি। অনুগ্রহ করে "API কী সেট করুন" বাটনে ক্লিক করে কী সেট করুন।';
                                if (scientificExplanationLoading) scientificExplanationLoading.style.display = 'none';
                                if (explainScientificBtn) explainScientificBtn.disabled = false;
                                return;
                            }

                            let chatHistory = [];
                            chatHistory.push({
                                role: "user",
                                parts: [{
                                    text: `এই গাণিতিক এক্সপ্রেশন বা ফাংশনটি সহজ ভাষায় ব্যাখ্যা করুন: "${expressionToExplain}"। এটি কী করে এবং এর মূল ধারণা কী?`
                                }]
                            });
                            const payload = {
                                contents: chatHistory
                            };
                            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                            const response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(payload)
                            });

                            const result = await response.json();

                            if (result.candidates && result.candidates.length > 0 &&
                                result.candidates[0].content && result.candidates[0].content.parts &&
                                result.candidates[0].content.parts.length > 0) {
                                const text = result.candidates[0].content.parts[0].text;
                                if (scientificExplanation) scientificExplanation.innerText = text;
                            } else {
                                if (scientificExplanation) scientificExplanation.innerText = 'জেমিনি থেকে কোনো প্রতিক্রিয়া পাওয়া যায়নি।';
                                console.error('জেমিনি API প্রতিক্রিয়া অপ্রত্যাশিত:', result);
                            }
                        } catch (error) {
                            if (scientificExplanation) scientificExplanation.innerText = 'জেমিনি API কল করার সময় একটি ত্রুটি হয়েছে: ' + error.message;
                            console.error('জেমিনি API ত্রুটি:', error);
                        } finally {
                            if (scientificExplanationLoading) scientificExplanationLoading.style.display = 'none';
                            if (explainScientificBtn) explainScientificBtn.disabled = false;
                        }
                    });
                } else {
                    console.error('বৈজ্ঞানিক ব্যাখ্যা উপাদান পাওয়া যায়নি।');
                }


                // --- সাম্প্রতিক সংবাদ লজিক ---
                // সংবাদ বিভাগের জন্য HTML এ যা আছে তার বাইরে কোনো নির্দিষ্ট লজিক প্রয়োজন নেই।


                if (textAreaLeft) {
                    addState('textAreaLeft');
                    textAreaLeft.addEventListener('input', () => {
                        // অটোমেটিক অক্ষর রিপ্লেসমেন্ট
                        const value = textAreaLeft.value;
                        const selectionStart = textAreaLeft.selectionStart;

                        // রিপ্লেসমেন্টের তালিকা
                        // decomposed form (letter + nukta) থেকে precomposed form-এ পরিবর্তন করা হচ্ছে
                        let newValue = value
                            .replace(/য়/g, 'য়') // U+09AF U+09BC  -> U+09DF
                            .replace(/ড়/g, 'ড়') // U+09A1 U+09BC  -> U+09DC
                            .replace(/ঢ়/g, 'ঢ়'); // U+09A2 U+09BC  -> U+09DD
                        
                        // যদি কোনো পরিবর্তন হয়ে থাকে, তাহলে টেক্সটবক্স আপডেট করুন
                        if (newValue !== value) {
                            textAreaLeft.value = newValue;
                            // টাইপ করার সময় কার্সরের অবস্থান ঠিক রাখার জন্য
                            textAreaLeft.setSelectionRange(selectionStart, selectionStart);
                        }

                        addState('textAreaLeft'); // আপনার বিদ্যমান আনডু/রিডু কার্যকারিতার জন্য
                    });
                }
                if (textAreaRight) {
                    addState('textAreaRight');
                    textAreaRight.addEventListener('input', () => addState('textAreaRight'));
                }

                // --- নতুন: বাংলা বানান সংশোধন লজিক (অর্থসহ উন্নত) ---
                const checkSpellingBtn = document.getElementById('checkSpellingBtn');
                const spellCheckInput = document.getElementById('spellCheckInput');
                const spellCheckResult = document.getElementById('spellCheckResult');
                const spellCheckLoading = document.getElementById('spellCheckLoading');
                const clearSpellCheckBtn = document.getElementById('clearSpellCheckBtn'); // Get the clear button

                if (checkSpellingBtn) {
                    checkSpellingBtn.addEventListener('click', async () => {
                        const textToCorrect = spellCheckInput.value.trim();
                        if (!textToCorrect) {
                            spellCheckResult.innerText = 'অনুগ্রহ করে পরীক্ষা করার জন্য কিছু লেখা দিন।';
                            return;
                        }

                        spellCheckResult.innerText = '';
                        spellCheckLoading.style.display = 'block';
                        checkSpellingBtn.disabled = true;

                        try {
                            const apiKey = localStorage.getItem('geminiApiKey');
                            if (!apiKey) {
                                spellCheckResult.innerText = 'জেমিনি API কী সেট করা হয়নি। অনুগ্রহ করে "API কী সেট করুন" বাটনে ক্লিক করে কী সেট করুন।';
                                return;
                            }

                            // উন্নত প্রম্পট যা সংশোধিত শব্দের অর্থ এবং ব্যাখ্যা চাইবে
                            const prompt = `নিচের বাংলা লেখাটির বানান এবং ব্যাকরণগত ভুল সংশোধন করো। তোমার উত্তরটি দুটি অংশে বিভক্ত থাকবে।

প্রথম অংশ: 'সংশোধিত লেখা:' শিরোনাম দিয়ে সম্পূর্ণ সঠিক লেখাটি দাও।
দ্বিতীয় অংশ: 'সংশোধিত শব্দাবলি:' শিরোনাম দিয়ে, তুমি যে শব্দগুলো পরিবর্তন করেছ শুধুমাত্র সেগুলোর একটি তালিকা তৈরি করো। প্রতিটি পরিবর্তিত শব্দের জন্য, মূল ভুল শব্দটি উল্লেখ করো, তারপর সঠিক শব্দটি, তার অর্থ এবং একটি সহজ ব্যাখ্যা দাও।

যদি কোনো ভুল না থাকে, তাহলে শুধু 'লেখাটি সঠিক আছে' লিখে দাও।

মূল লেখা:
"${textToCorrect}"`;

                            let chatHistory = [{
                                role: "user",
                                parts: [{
                                    text: prompt
                                }]
                            }];
                            const payload = {
                                contents: chatHistory
                            };
                            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                            const response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(payload)
                            });

                            const result = await response.json();

                            if (result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                                const correctedText = result.candidates[0].content.parts[0].text;
                                spellCheckResult.innerText = correctedText;
                            } else {
                                spellCheckResult.innerText = 'দুঃখিত, কোনো উত্তর পাওয়া যায়নি। অনুগ্রহ করে আবার চেষ্টা করুন।';
                                console.error('API Response Error:', result);
                            }
                        } catch (error) {
                            spellCheckResult.innerText = 'একটি ত্রুটি ঘটেছে: ' + error.message;
                            console.error('API Call Error:', error);
                        } finally {
                            spellCheckLoading.style.display = 'none';
                            checkSpellingBtn.disabled = false;
                        }
                    });
                }

                // Add event listener for Clear button in Spell Checker
                if (clearSpellCheckBtn) {
                    clearSpellCheckBtn.addEventListener('click', () => {
                        if (spellCheckInput) spellCheckInput.value = '';
                        if (spellCheckResult) spellCheckResult.innerText = '';
                        showCustomAlert('বানান সংশোধনের লেখা পরিষ্কার করা হয়েছে!');
                    });
                }

                // --- নতুন: লেখা সাজানো লজিক ---
                const beautifyTextBtn = document.getElementById('beautifyTextBtn');
                const beautifyInput = document.getElementById('beautifyInput');
                const beautifyResult = document.getElementById('beautifyResult');
                const beautifyLoading = document.getElementById('beautifyLoading');
                const copyBeautifiedTextBtn = document.getElementById('copyBeautifiedTextBtn');
                const clearBeautifyTextBtn = document.getElementById('clearBeautifyTextBtn');

                if (beautifyTextBtn) {
                    beautifyTextBtn.addEventListener('click', async () => {
                        const textToBeautify = beautifyInput.value.trim();
                        if (!textToBeautify) {
                            beautifyResult.innerText = 'অনুগ্রহ করে সাজানোর জন্য কিছু লেখা দিন।';
                            return;
                        }

                        beautifyResult.innerText = '';
                        beautifyLoading.style.display = 'block';
                        beautifyTextBtn.disabled = true;

                        try {
                            const apiKey = localStorage.getItem('geminiApiKey');
                            if (!apiKey) {
                                beautifyResult.innerText = 'জেমিনি API কী সেট করা হয়নি। অনুগ্রহ করে "API কী সেট করুন" বাটনে ক্লিক করে কী সেট করুন।';
                                return;
                            }

                            const prompt = `নিচের বাংলা লেখাটিকে সহজ, সুন্দর, প্রাঞ্জল এবং সাবলীল ভাষায় গুছিয়ে লেখো। কোনো ভূমিকা বা অতিরিক্ত ব্যাখ্যা ছাড়াই শুধুমাত্র সাজানো লেখাটি দাও:\n\n"${textToBeautify}"`;

                            let chatHistory = [{
                                role: "user",
                                parts: [{
                                    text: prompt
                                }]
                            }];
                            const payload = {
                                contents: chatHistory
                            };
                            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                            const response = await fetch(apiUrl, {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify(payload)
                            });

                            const result = await response.json();

                            if (result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                                const beautifiedText = result.candidates[0].content.parts[0].text;
                                beautifyResult.innerText = beautifiedText;
                            } else {
                                beautifyResult.innerText = 'দুঃখিত, কোনো উত্তর পাওয়া যায়নি। অনুগ্রহ করে আবার চেষ্টা করুন।';
                                console.error('API Response Error:', result);
                            }
                        } catch (error) {
                            beautifyResult.innerText = 'একটি ত্রুটি ঘটেছে: ' + error.message;
                            console.error('API Call Error:', error);
                        } finally {
                            beautifyLoading.style.display = 'none';
                            beautifyTextBtn.disabled = false;
                        }
                    });
                }

                if (copyBeautifiedTextBtn) {
                    copyBeautifiedTextBtn.addEventListener('click', () => {
                        const textToCopy = beautifyResult.innerText;
                        if (textToCopy) {
                            const tempTextArea = document.createElement('textarea');
                            tempTextArea.value = textToCopy;
                            document.body.appendChild(tempTextArea);
                            tempTextArea.select();
                            tempTextArea.setSelectionRange(0, 99999);
                            try {
                                document.execCommand('copy');
                                showCustomAlert('সাজানো লেখা কপি করা হয়েছে!');
                            } catch (err) {
                                console.error('কপি করতে ব্যর্থ:', err);
                                showCustomAlert('কপি করতে ব্যর্থ হয়েছে।');
                            }
                            document.body.removeChild(tempTextArea);
                        }
                    });
                }

                if (clearBeautifyTextBtn) {
                    clearBeautifyTextBtn.addEventListener('click', () => {
                        beautifyInput.value = '';
                        beautifyResult.innerText = '';
                        showCustomAlert('লেখা সাজানোর ইনপুট পরিষ্কার করা হয়েছে!');
                    });
                }

                // --- নতুন: শব্দের অর্থ খোঁজার লজিক ---
                const findMeaningBtn = document.getElementById('findMeaningBtn');
                const wordMeaningInput = document.getElementById('wordMeaningInput');
                const wordMeaningResult = document.getElementById('wordMeaningResult');
                const wordMeaningLoading = document.getElementById('wordMeaningLoading');
                const clearWordMeaningBtn = document.getElementById('clearWordMeaningBtn'); // Get the clear button

                if (findMeaningBtn) {
                    findMeaningBtn.addEventListener('click', handleFindMeaning);
                }
                if (wordMeaningInput) {
                    wordMeaningInput.addEventListener('keydown', (e) => {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            handleFindMeaning();
                        }
                    });
                }

                async function handleFindMeaning() {
                    const wordToFind = wordMeaningInput.value.trim();
                    if (!wordToFind) {
                        wordMeaningResult.innerText = 'অনুগ্রহ করে অর্থ খোঁজার জন্য একটি শব্দ লিখুন।';
                        return;
                    }

                    wordMeaningResult.innerHTML = '';
                    wordMeaningLoading.style.display = 'block';
                    findMeaningBtn.disabled = true;

                    try {
                        const apiKey = localStorage.getItem('geminiApiKey');
                        if (!apiKey) {
                            wordMeaningResult.innerText = 'জেমিনি API কী সেট করা হয়নি। অনুগ্রহ করে "API কী সেট করুন" বাটনে ক্লিক করে কী সেট করুন।';
                            return;
                        }

                        const prompt = `"${wordToFind}" - এই শব্দটির বিস্তারিত অর্থ, প্রতিশব্দ, বিপরীত শব্দ (যদি থাকে), এবং একটি সহজ উদাহরণসহ ব্যাখ্যা দাও। ফলাফলটি সুন্দরভাবে ফরম্যাট করে দাও। ভুল বানান এর ক্ষেত্রে তোমার উত্তরের শুরুতে বানানটি ভুল উল্লেখ করে শব্দটির সঠিক বানানটিও উল্লেখ করো।`;

                        let chatHistory = [{
                            role: "user",
                            parts: [{
                                text: prompt
                            }]
                        }];
                        const payload = {
                            contents: chatHistory
                        };
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(payload)
                        });

                        const result = await response.json();

                        if (result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                            const meaningText = result.candidates[0].content.parts[0].text;
                            wordMeaningResult.innerText = meaningText;
                        } else {
                            wordMeaningResult.innerText = 'দুঃখিত, কোনো উত্তর পাওয়া যায়নি। অনুগ্রহ করে আবার চেষ্টা করুন।';
                            console.error('API Response Error:', result);
                        }
                    } catch (error) {
                        wordMeaningResult.innerText = 'একটি ত্রুটি ঘটেছে: ' + error.message;
                        console.error('API Call Error:', error);
                    } finally {
                        wordMeaningLoading.style.display = 'none';
                        findMeaningBtn.disabled = false;
                    }
                }

                // Add event listener for Clear button in Word Meaning
                if (clearWordMeaningBtn) {
                    clearWordMeaningBtn.addEventListener('click', () => {
                        if (wordMeaningInput) wordMeaningInput.value = '';
                        if (wordMeaningResult) wordMeaningResult.innerHTML = '';
                        showCustomAlert('শব্দের অর্থ পরিষ্কার করা হয়েছে!');
                    });
                }

// ====================================================================
// START: GEMINI API TEXT-TO-SPEECH (TTS) SCRIPT
// ====================================================================
const ttsInput = document.getElementById('ttsInput');
const speakBtn = document.getElementById('speakBtn');
const pauseBtn = document.getElementById('pauseBtn');
const resumeBtn = document.getElementById('resumeBtn');
const stopBtn = document.getElementById('stopBtn');
const clearTtsBtn = document.getElementById('clearTtsBtn');
const downloadTtsBtn = document.getElementById('downloadTtsBtn'); // ডাউনলোড বাটন

// ভয়েস এবং পিচ/রেট কন্ট্রোলগুলি এখন জেমিনি দ্বারা নিয়ন্ত্রিত হবে, তাই UI থেকে সরানো হয়েছে
const ttsControls = document.querySelector('.tts-controls');
if (ttsControls) ttsControls.style.display = 'none';

let ttsAudio; // অডিও অবজেক্ট সংরক্ষণ করার জন্য
let downloadableAudioBlob = null; // ডাউনলোডযোগ্য অডিও ব্লব সংরক্ষণ করার জন্য

// Base64 থেকে ArrayBuffer এ রূপান্তর করার জন্য হেল্পার ফাংশন
function base64ToArrayBuffer(base64) {
    const binaryString = window.atob(base64);
    const len = binaryString.length;
    const bytes = new Uint8Array(len);
    for (let i = 0; i < len; i++) {
        bytes[i] = binaryString.charCodeAt(i);
    }
    return bytes.buffer;
}

// PCM ডেটা থেকে WAV ফাইল তৈরি করার জন্য হেল্পার ফাংশন
function pcmToWav(pcmData, sampleRate) {
    const header = new ArrayBuffer(44);
    const view = new DataView(header);
    const numChannels = 1;
    const bitsPerSample = 16;
    const blockAlign = numChannels * bitsPerSample / 8;
    const byteRate = sampleRate * blockAlign;

    // RIFF chunk descriptor
    writeString(view, 0, 'RIFF');
    view.setUint32(4, 36 + pcmData.byteLength, true);
    writeString(view, 8, 'WAVE');
    // "fmt " sub-chunk
    writeString(view, 12, 'fmt ');
    view.setUint32(16, 16, true);
    view.setUint16(20, 1, true); // Audio format 1 for PCM
    view.setUint16(22, numChannels, true);
    view.setUint32(24, sampleRate, true);
    view.setUint32(28, byteRate, true);
    view.setUint16(32, blockAlign, true);
    view.setUint16(34, bitsPerSample, true);
    // "data" sub-chunk
    writeString(view, 36, 'data');
    view.setUint32(40, pcmData.byteLength, true);

    function writeString(view, offset, string) {
        for (let i = 0; i < string.length; i++) {
            view.setUint8(offset + i, string.charCodeAt(i));
        }
    }

    return new Blob([header, pcmData], {
        type: 'audio/wav'
    });
}

async function handleGeminiTTS() {
    const textToSpeak = ttsInput.value.trim();
    if (!textToSpeak) {
        showCustomAlert('অনুগ্রহ করে কথা বলার জন্য কিছু টেক্সট লিখুন।');
        return;
    }

    const apiKey = localStorage.getItem('geminiApiKey');
    if (!apiKey) {
        showCustomAlert('জেমিনি API কী সেট করা হয়নি।');
        return;
    }

    // আগের অডিও বন্ধ করুন এবং ডাউনলোড বাটন নিষ্ক্রিয় করুন
    if (ttsAudio) {
        ttsAudio.pause();
        ttsAudio.currentTime = 0;
    }
    downloadableAudioBlob = null;
    if (downloadTtsBtn) downloadTtsBtn.disabled = true;

    speakBtn.disabled = true;
    speakBtn.innerText = 'লোড হচ্ছে...';

    try {
        const payload = {
            contents: [{
                parts: [{
                    text: textToSpeak
                }]
            }],
            generationConfig: {
                responseModalities: ["AUDIO"]
            },
            model: "gemini-2.5-flash-preview-tts"
        };

        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`;
        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(payload)
        });

        const result = await response.json();
        const part = result?.candidates?.[0]?.content?.parts?.[0];
        const audioData = part?.inlineData?.data;
        const mimeType = part?.inlineData?.mimeType;

        if (audioData && mimeType && mimeType.startsWith("audio/")) {
            const sampleRateMatch = mimeType.match(/rate=(\d+)/);
            if (!sampleRateMatch) throw new Error("স্যাম্পেল রেট পাওয়া যায়নি।");

            const sampleRate = parseInt(sampleRateMatch[1], 10);
            const pcmData = base64ToArrayBuffer(audioData);
            const pcm16 = new Int16Array(pcmData);
            const wavBlob = pcmToWav(pcm16, sampleRate);
            
            downloadableAudioBlob = wavBlob; // ডাউনলোড করার জন্য ব্লব সংরক্ষণ করুন
            
            const audioUrl = URL.createObjectURL(wavBlob);

            ttsAudio = new Audio(audioUrl);
            ttsAudio.play();
            
            if (downloadTtsBtn) downloadTtsBtn.disabled = false; // ডাউনলোড বাটন সক্রিয় করুন

            ttsAudio.onended = () => {
                speakBtn.innerText = 'লোড করুন';
                speakBtn.disabled = false;
            };

        } else {
            throw new Error('API থেকে কোনো অডিও ডেটা পাওয়া যায়নি।');
        }
    } catch (error) {
        console.error('Gemini TTS Error:', error);
        showCustomAlert(`একটি ত্রুটি ঘটেছে: ${error.message}`);
        speakBtn.innerText = 'লোড করুন';
        speakBtn.disabled = false;
        if (downloadTtsBtn) downloadTtsBtn.disabled = true;
    }
}

if (speakBtn) speakBtn.addEventListener('click', handleGeminiTTS);
if (pauseBtn) pauseBtn.addEventListener('click', () => ttsAudio?.pause());
if (resumeBtn) resumeBtn.addEventListener('click', () => ttsAudio?.play());
if (stopBtn) stopBtn.addEventListener('click', () => {
    if (ttsAudio) {
        ttsAudio.pause();
        ttsAudio.currentTime = 0;
        speakBtn.innerText = 'লোড করুন';
        speakBtn.disabled = false;
        if (downloadTtsBtn) downloadTtsBtn.disabled = true; // Stop করলে ডাউনলোড বাটন নিষ্ক্রিয় করুন
        downloadableAudioBlob = null;
    }
});
if (clearTtsBtn) clearTtsBtn.addEventListener('click', () => {
    ttsInput.value = '';
    if (ttsAudio) {
        ttsAudio.pause();
        ttsAudio.currentTime = 0;
    }
    speakBtn.innerText = 'লোড করুন';
    speakBtn.disabled = false;
    if (downloadTtsBtn) downloadTtsBtn.disabled = true; // Clear করলে ডাউনলোড বাটন নিষ্ক্রিয় করুন
    downloadableAudioBlob = null;
});

// ডাউনলোড বাটনের জন্য নতুন ইভেন্ট লিসেনার
if (downloadTtsBtn) {
    downloadTtsBtn.addEventListener('click', () => {
        if (downloadableAudioBlob) {
            const url = URL.createObjectURL(downloadableAudioBlob);
            const a = document.createElement('a');
            a.style.display = 'none';
            a.href = url;
            a.download = 'bangla-toolbox-tts.wav'; // ফাইলের নাম
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            a.remove();
        } else {
            showCustomAlert('ডাউনলোড করার জন্য কোনো অডিও নেই।');
        }
    });
}
// ====================================================================
// END: GEMINI API TEXT-TO-SPEECH (TTS) SCRIPT
// ====================================================================

// ====================================================================
// START: GEMINI API BASED SPEECH-TO-TEXT (STT) SCRIPT
// This entire block replaces the old browser-based SpeechRecognition script.
// ====================================================================
const sttOutput = document.getElementById('sttOutput');
const sttStatus = document.getElementById('sttStatus');
const startSttBtn = document.getElementById('startSttBtn');
const uploadAudioBtn = document.getElementById('uploadAudioBtn');
const audioFileInput = document.getElementById('audioFileInput');
const copySttBtn = document.getElementById('copySttBtn');
const clearSttBtn = document.getElementById('clearSttBtn');

let mediaRecorder;
let audioChunks = [];
let audioBlob = null;
let isRecording = false;

// Helper function to insert text at the current cursor position
function insertTextAtCursor(textarea, text) {
    if (!textarea) return;
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const oldText = textarea.value;
    const newText = oldText.substring(0, start) + text + oldText.substring(end);
    textarea.value = newText;
    // Place cursor after the inserted text
    textarea.selectionStart = textarea.selectionEnd = start + text.length;
    textarea.focus();
}

// Main function to transcribe audio using Gemini API
async function transcribeAudioWithGemini(audioFile) {
    const apiKey = localStorage.getItem('geminiApiKey');
    if (!apiKey) {
        showCustomAlert('জেমিনি API কী সেট করা হয়নি।');
        sttStatus.innerText = 'অবস্থা: API কী প্রয়োজন।';
        return;
    }

    sttStatus.innerText = 'অবস্থা: অডিও প্রসেসিং ও জেমিনিকে পাঠানো হচ্ছে...';
    if(startSttBtn) startSttBtn.disabled = true;
    if(uploadAudioBtn) uploadAudioBtn.disabled = true;


    // Convert audio blob/file to Base64
    const reader = new FileReader();
    reader.readAsDataURL(audioFile);
    reader.onloadend = async () => {
        const base64Audio = reader.result.split(',')[1];
        const mimeType = audioFile.type.split(';')[0]; // Get MIME type without codecs

        try {
            const prompt = "Transcribe the following audio. Provide only the transcribed text without any additional comments, explanations, or introductory phrases.";

            const payload = {
                contents: [{
                    parts: [
                        { text: prompt },
                        {
                            inlineData: {
                                mimeType: mimeType,
                                data: base64Audio
                            }
                        }
                    ]
                }]
            };

            const model = "gemini-2.5-flash-preview-05-20"; // This model supports multimodal input
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            const result = await response.json();

            if (response.ok && result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                const transcribedText = result.candidates[0].content.parts[0].text.trim();
                insertTextAtCursor(sttOutput, transcribedText + " "); // Add a space after inserting
                sttStatus.innerText = 'অবস্থা: সফলভাবে টেক্সটে রূপান্তরিত হয়েছে! ✅';
            } else {
                const errorText = result?.error?.message || 'একটি অজানা ত্রুটি ঘটেছে। অডিও থেকে লেখা বের করা যায়নি।';
                sttStatus.innerText = `অবস্থা: ব্যর্থ হয়েছে - ${errorText}`;
                console.error('STT API Response Error:', result);
                showCustomAlert(`ট্রান্সক্রাইব করতে ব্যর্থ: ${errorText}`);
            }
        } catch (error) {
            sttStatus.innerText = `অবস্থা: একটি ত্রুটি ঘটেছে - ${error.message}`;
            console.error('STT API Call Error:', error);
            showCustomAlert(`একটি ত্রুটি ঘটেছে: ${error.message}`);
        } finally {
             // Reset the record button state
             if(startSttBtn) {
                 startSttBtn.dataset.state = 'record';
                 startSttBtn.innerText = 'রেকর্ড করুন';
                 startSttBtn.disabled = false;
             }
             if(uploadAudioBtn) uploadAudioBtn.disabled = false;
        }
    };
    reader.onerror = (error) => {
        console.error('File Reader Error:', error);
        sttStatus.innerText = 'অবস্থা: ফাইল পড়তে সমস্যা হয়েছে।';
        showCustomAlert('ফাইলটি পড়তে একটি ত্রুটি হয়েছে।');
        if(startSttBtn) startSttBtn.disabled = false;
        if(uploadAudioBtn) uploadAudioBtn.disabled = false;
    };
}


// Event listener for the record/stop/send button
if (startSttBtn) {
    startSttBtn.addEventListener('click', async () => {
        const state = startSttBtn.dataset.state;

        if (state === 'record') {
            // Start recording
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                mediaRecorder = new MediaRecorder(stream);
                audioChunks = []; // Clear previous chunks

                mediaRecorder.ondataavailable = event => {
                    audioChunks.push(event.data);
                };

                mediaRecorder.onstop = () => {
                    // Use a common MIME type like audio/webm
                    audioBlob = new Blob(audioChunks, { type: 'audio/webm' }); 
                    startSttBtn.dataset.state = 'send';
                    startSttBtn.innerText = 'পাঠান';
                    sttStatus.innerText = 'অবস্থা: রেকর্ডিং শেষ। পাঠানোর জন্য প্রস্তুত।';
                    startSttBtn.disabled = false;
                    // Stop microphone track to turn off indicator
                    stream.getTracks().forEach(track => track.stop());
                };

                mediaRecorder.start();
                isRecording = true;
                startSttBtn.dataset.state = 'recording';
                startSttBtn.innerText = 'থামান';
                sttStatus.innerText = 'অবস্থা: রেকর্ডিং চলছে... 🎙️';
            } catch (err) {
                console.error("Microphone access error:", err);
                sttStatus.innerText = 'অবস্থা: মাইক্রোফোন অ্যাক্সেস করা যায়নি।';
                showCustomAlert('মাইক্রোফোন ব্যবহারের অনুমতি প্রয়োজন।');
            }
        } else if (state === 'recording') {
            // Stop recording
            if (mediaRecorder && isRecording) {
                mediaRecorder.stop();
                isRecording = false;
                startSttBtn.disabled = true; // Disable until onstop event fires
                sttStatus.innerText = 'অবস্থা: প্রসেসিং...';
            }
        } else if (state === 'send') {
            // Send the recorded audio
            if (audioBlob) {
                transcribeAudioWithGemini(audioBlob);
                audioBlob = null; // Clear blob after sending
            } else {
                 sttStatus.innerText = 'অবস্থা: পাঠানোর জন্য কোনো রেকর্ডিং নেই।';
            }
        }
    });
}

// Event listeners for the upload functionality
if (uploadAudioBtn) {
    uploadAudioBtn.addEventListener('click', () => {
        if(audioFileInput) audioFileInput.click();
    });
}
if (audioFileInput) {
    audioFileInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        if (file) {
            transcribeAudioWithGemini(file);
            audioFileInput.value = ''; // Reset input for the next upload
        }
    });
}


// Event listeners for copy and clear buttons
if (copySttBtn) {
    copySttBtn.addEventListener('click', () => copyToClipboard('sttOutput'));
}

if (clearSttBtn) {
    clearSttBtn.addEventListener('click', () => {
        if (sttOutput) sttOutput.value = '';
        if (isRecording) {
            mediaRecorder.stop(); // Stop recording if active
        }
        // Reset button to initial state
        if(startSttBtn) {
            startSttBtn.dataset.state = 'record';
            startSttBtn.innerText = 'রেকর্ড করুন';
            startSttBtn.disabled = false;
        }
        if(sttStatus) sttStatus.innerText = 'অবস্থা: নিষ্ক্রিয় ✅';
    });
}
// ====================================================================
// END: GEMINI API BASED SPEECH-TO-TEXT (STT) SCRIPT
// ====================================================================

// ====================================================================
// START: TRANSLATOR SCRIPT (GEMINI API)
// ====================================================================

// প্রথমে, DOMContentLoaded এর শুরুতে অন্য ট্যাবগুলোর সাথে এগুলোও যোগ করুন
// const translatorTab = document.getElementById('translatorTab');
// const translatorContent = document.getElementById('translatorContent');

// ট্রান্সলেটরের জন্য DOM উপাদান
const translateBtn = document.getElementById('translateBtn');
const translatorInput = document.getElementById('translatorInput');
const translatorOutput = document.getElementById('translatorOutput');
const targetLanguageSelect = document.getElementById('targetLanguage');
const translatorLoading = document.getElementById('translatorLoading');
const copyTranslatedTextBtn = document.getElementById('copyTranslatedTextBtn');
const clearTranslatorTextBtn = document.getElementById('clearTranslatorTextBtn');

// ড্রপডাউনের জন্য ভাষার তালিকা
const languages = {
    'en': 'English',
    'bn': 'Bengali (বাংলা)',
    'hi': 'Hindi (हिन्दी)',
    'ar': 'Arabic (العربية)',
    'es': 'Spanish (Español)',
    'fr': 'French (Français)',
    'de': 'German (Deutsch)',
    'ja': 'Japanese (日本語)',
    'ko': 'Korean (한국어)',
    'ru': 'Russian (Русский)',
    'zh': 'Chinese (中文)',
    'pt': 'Portuguese (Português)',
    'it': 'Italian (Italiano)',
    'id': 'Indonesian (Bahasa Indonesia)',
    'ms': 'Malay (Bahasa Melayu)',
    'tr': 'Turkish (Türkçe)',
    'vi': 'Vietnamese (Tiếng Việt)',
    'th': 'Thai (ภาษาไทย)',
    'ur': 'Urdu (اردو)'
};

// ভাষার ড্রপডাউনটি পূরণ করার ফাংশন
function populateLanguageDropdown() {
    if (!targetLanguageSelect) return;
    targetLanguageSelect.innerHTML = ''; // আগের অপশন মুছে ফেলুন
    for (const code in languages) {
        const option = document.createElement('option');
        option.value = code;
        option.textContent = languages[code];
        targetLanguageSelect.appendChild(option);
    }
    // ডিফল্ট ভাষা হিসেবে বাংলা সেট করুন
    targetLanguageSelect.value = 'bn';
}

// মূল অনুবাদ ফাংশন
async function handleTranslate() {
    const textToTranslate = translatorInput.value.trim();
    const langCode = targetLanguageSelect.value;
    const langName = languages[langCode];

    if (!textToTranslate) {
        showCustomAlert('অনুগ্রহ করে অনুবাদ করার জন্য কিছু টেক্সট লিখুন।');
        return;
    }

    const apiKey = localStorage.getItem('geminiApiKey');
    if (!apiKey) {
        showCustomAlert('জেমিনি API কী সেট করা হয়নি। অনুগ্রহ করে "API কী সেট করুন" বাটনে ক্লিক করে কী সেট করুন।');
        translatorOutput.value = 'API কী প্রয়োজন।';
        return;
    }

    translatorLoading.style.display = 'block';
    translateBtn.disabled = true;
    translatorOutput.value = '';

    try {
        const prompt = `Translate the following text to ${langName}. Provide only the translated text without any additional explanations, introductory phrases, or quotation marks.\n\nText to translate:\n"${textToTranslate}"`;

        const payload = {
            contents: [{
                parts: [{ text: prompt }]
            }]
        };
        const model = "gemini-2.5-flash-preview-05-20";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;

        const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        const result = await response.json();
        
        if (response.ok && result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
            translatorOutput.value = result.candidates[0].content.parts[0].text.trim();
        } else {
            const errorText = result?.error?.message || 'একটি অজানা ত্রুটি ঘটেছে।';
            translatorOutput.value = `অনুবাদ ব্যর্থ হয়েছে: ${errorText}`;
            console.error('API Response Error:', result);
        }

    } catch (error) {
        translatorOutput.value = `একটি ত্রুটি ঘটেছে: ${error.message}`;
        console.error('API Call Error:', error);
    } finally {
        translatorLoading.style.display = 'none';
        translateBtn.disabled = false;
    }
}

// ট্রান্সলেটরের জন্য ইভেন্ট লিসেনার যোগ করুন
if (translatorTab) {
    translatorTab.addEventListener('click', () => showTab('translator'));
}

if (translateBtn) {
    translateBtn.addEventListener('click', handleTranslate);
}

if (copyTranslatedTextBtn) {
    copyTranslatedTextBtn.addEventListener('click', () => {
        if (translatorOutput.value) {
            copyToClipboard('translatorOutput');
        } else {
            showCustomAlert('কপি করার জন্য কোনো লেখা নেই।');
        }
    });
}

if (clearTranslatorTextBtn) {
    clearTranslatorTextBtn.addEventListener('click', () => {
        translatorInput.value = '';
        translatorOutput.value = '';
        showCustomAlert('অনুবাদকের লেখা পরিষ্কার করা হয়েছে!');
    });
}

// স্ক্রিপ্ট লোড হওয়ার সময় ড্রপডাউনটি পূরণ করুন
populateLanguageDropdown();

// ====================================================================
// START: IMAGE TO TEXT (OCR) SCRIPT (Drag & Drop Updated)
// ====================================================================
const ocrImageInput = document.getElementById('ocrImageInput');
const imageUploadArea = document.querySelector('.image-upload-area'); // আপলোড এরিয়া সিলেক্ট করা হয়েছে
const ocrImagePreview = document.getElementById('ocrImagePreview');
const extractTextBtn = document.getElementById('extractTextBtn');
const ocrLoading = document.getElementById('ocrLoading');
const ocrResultText = document.getElementById('ocrResultText');
const copyOcrTextBtn = document.getElementById('copyOcrTextBtn');
const clearOcrBtn = document.getElementById('clearOcrBtn');

let ocrUploadedFile = null;

// ফাইল প্রসেস করার জন্য একটি ফাংশন তৈরি করা হয়েছে
function handleOcrFile(file) {
    if (!file) return;
    
    // ফাইলটি ছবি কিনা তা পরীক্ষা করা হচ্ছে
    const allowedTypes = ['image/png', 'image/jpeg', 'image/webp'];
    if (!allowedTypes.includes(file.type)) {
        showCustomAlert('শুধুমাত্র PNG, JPEG, বা WEBP ফরম্যাটের ছবি আপলোড করুন।');
        return;
    }

    const reader = new FileReader();
    reader.onload = function(e) {
        ocrUploadedFile = {
            type: file.type,
            base64: e.target.result.split(',')[1],
            dataUrl: e.target.result
        };
        displayOcrImagePreview();
    };
    reader.onerror = () => {
        showCustomAlert('ফাইলটি পড়তে একটি ত্রুটি হয়েছে।');
    };
    reader.readAsDataURL(file);
}

// ইনপুট থেকে ফাইল সিলেক্ট হ্যান্ডেল করা
if (ocrImageInput) {
    ocrImageInput.addEventListener('change', (event) => {
        const file = event.target.files[0];
        handleOcrFile(file);
    });
}

// Drag and Drop ইভেন্ট লিসেনার যোগ করা হয়েছে
if (imageUploadArea) {
    // ডিফল্ট আচরণ বন্ধ করা
    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        imageUploadArea.addEventListener(eventName, (e) => {
            e.preventDefault();
            e.stopPropagation();
        }, false);
    });

    // ড্র্যাগ করে ছবির উপরে আনলে আপলোড এরিয়া হাইলাইট হবে
    ['dragenter', 'dragover'].forEach(eventName => {
        imageUploadArea.addEventListener(eventName, () => {
            imageUploadArea.classList.add('drag-over');
        }, false);
    });

    // ড্র্যাগ করে ছবি সরিয়ে নিলে হাইলাইট চলে যাবে
    ['dragleave', 'drop'].forEach(eventName => {
        imageUploadArea.addEventListener(eventName, () => {
            imageUploadArea.classList.remove('drag-over');
        }, false);
    });

    // ফাইল ড্রপ করলে হ্যান্ডেল করা হবে
    imageUploadArea.addEventListener('drop', (e) => {
        const dt = e.dataTransfer;
        const files = dt.files;
        if (files.length > 0) {
            handleOcrFile(files[0]); // প্রথম ফাইলটি প্রসেস করা হবে
        }
    }, false);
}

// বাকি ফাংশনগুলো আগের মতোই থাকছে
function displayOcrImagePreview() {
    if (!ocrUploadedFile) return;
    ocrImagePreview.innerHTML = `
        <img src="${ocrUploadedFile.dataUrl}" alt="Uploaded Image Preview">
        <button class="remove-image-btn" title="ছবি সরান">&times;</button>
    `;
    ocrImagePreview.classList.remove('hidden');
    ocrImagePreview.querySelector('.remove-image-btn').addEventListener('click', clearOcrAreas);
}

function clearOcrAreas() {
    ocrUploadedFile = null;
    if(ocrImageInput) ocrImageInput.value = '';
    if(ocrImagePreview) ocrImagePreview.innerHTML = '';
    if(ocrImagePreview) ocrImagePreview.classList.add('hidden');
    if(ocrResultText) ocrResultText.value = '';
    if(ocrLoading) ocrLoading.style.display = 'none';
}

if (clearOcrBtn) {
    clearOcrBtn.addEventListener('click', () => {
         clearOcrAreas();
         showCustomAlert('সমস্ত কিছু মুছে ফেলা হয়েছে!');
    });
}

if (extractTextBtn) {
    extractTextBtn.addEventListener('click', async () => {
        if (!ocrUploadedFile) {
            showCustomAlert('অনুগ্রহ করে প্রথমে একটি ছবি নির্বাচন করুন।');
            return;
        }

        const apiKey = localStorage.getItem('geminiApiKey');
        if (!apiKey) {
            showCustomAlert('জেমিনি API কী সেট করা হয়নি।');
            return;
        }

        ocrLoading.style.display = 'block';
        extractTextBtn.disabled = true;
        ocrResultText.value = '';

        try {
            const prompt = "Extract all text from this image, including any text in different languages. Provide only the extracted text without any additional comments or explanations.";
            
            const payload = {
                contents: [{
                    parts: [
                        { text: prompt },
                        {
                            inlineData: {
                                mimeType: ocrUploadedFile.type,
                                data: ocrUploadedFile.base64
                            }
                        }
                    ]
                }]
            };

            const model = "gemini-2.5-flash-preview-05-20";
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/${model}:generateContent?key=${apiKey}`;

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            
            const result = await response.json();

            if (response.ok && result.candidates && result.candidates[0]?.content?.parts?.[0]?.text) {
                ocrResultText.value = result.candidates[0].content.parts[0].text.trim();
            } else {
                const errorText = result?.error?.message || 'একটি অজানা ত্রুটি ঘটেছে। ছবিটি থেকে লেখা বের করা যায়নি।';
                ocrResultText.value = `ব্যর্থ হয়েছে: ${errorText}`;
                console.error('OCR API Response Error:', result);
            }

        } catch (error) {
            ocrResultText.value = `একটি ত্রুটি ঘটেছে: ${error.message}`;
            console.error('OCR API Call Error:', error);
        } finally {
            ocrLoading.style.display = 'none';
            extractTextBtn.disabled = false;
        }
    });
}

if(copyOcrTextBtn){
    copyOcrTextBtn.addEventListener('click', () => {
        if(ocrResultText.value){
            copyToClipboard('ocrResultText');
        } else {
            showCustomAlert('কপি করার জন্য কোনো লেখা নেই।');
        }
    });
}
// ====================================================================
// END: IMAGE TO TEXT (OCR) SCRIPT
// ====================================================================

// ====================================================================
// START: WORD COUNTER SCRIPT
// ====================================================================
function initializeWordCounter() {
    const wordCounterInput = document.getElementById('wordCounterInput');
    const wordCountEl = document.getElementById('wordCount');
    const charCountEl = document.getElementById('charCount');
    const sentenceCountEl = document.getElementById('sentenceCount');
    const paragraphCountEl = document.getElementById('paragraphCount');

    if (!wordCounterInput) return;

    wordCounterInput.addEventListener('input', () => {
        const text = wordCounterInput.value;

        // Character Count
        const charCount = text.length;
        charCountEl.textContent = new Intl.NumberFormat('bn-BD').format(charCount);

        // Word Count
        const words = text.trim().split(/\s+/).filter(word => word.length > 0);
        const wordCount = words.length;
        wordCountEl.textContent = text.trim() === '' ? '০' : new Intl.NumberFormat('bn-BD').format(wordCount);

        // Sentence Count (handles English and Bengali terminators)
        const sentences = text.trim().split(/[.!?।]/).filter(sentence => sentence.trim().length > 0);
        const sentenceCount = sentences.length;
        sentenceCountEl.textContent = new Intl.NumberFormat('bn-BD').format(sentenceCount);

        // Paragraph Count
        const paragraphs = text.trim().split(/\n+/).filter(para => para.trim().length > 0);
        const paragraphCount = paragraphs.length;
        paragraphCountEl.textContent = new Intl.NumberFormat('bn-BD').format(paragraphCount);
    });
}

// Initialize the word counter when the tab is shown
if (wordCounterTab) {
    wordCounterTab.addEventListener('click', initializeWordCounter);
}
// If it's the default active tab, initialize it on load
if (wordCounterContent && wordCounterContent.classList.contains('active')) {
    initializeWordCounter();
}
// ====================================================================
// END: WORD COUNTER SCRIPT
// ====================================================================


// ====================================================================
// START: NOTEPAD / TO-DO LIST SCRIPT (UPDATED WITH FORMATTING TOOLBAR)
// ====================================================================
async function initializeNotepad() {
    const taskInput = document.getElementById('taskInput'); // now a div
    const addTaskBtn = document.getElementById('addTaskBtn');
    const taskList = document.getElementById('taskList');
    const actionToolbar = document.getElementById('notepadActionToolbar');

    if (!taskInput || !addTaskBtn || !taskList || !actionToolbar) return;

    // --- Action Toolbar Logic ---
    let currentTargetElement = null; // কোন এলিমেন্ট এডিট করা হচ্ছে তা ট্র্যাক করার জন্য
    let savedRange = null; // সিলেকশন সেভ করার জন্য

    const showToolbar = () => {
        const selection = window.getSelection();
        if (selection.rangeCount > 0 && !selection.isCollapsed) { // শুধু টেক্সট সিলেক্ট করা থাকলেই দেখাবে
            savedRange = selection.getRangeAt(0).cloneRange(); // সিলেকশন সেভ করুন
            const range = selection.getRangeAt(0);
            const rect = range.getBoundingClientRect();
            const containerRect = taskList.closest('.notepad-container').getBoundingClientRect();

            actionToolbar.style.display = 'flex';
            
            setTimeout(() => {
                actionToolbar.style.opacity = '1';
                actionToolbar.style.transform = 'translateY(0)';
            }, 10);
            
            let top = rect.top - containerRect.top - actionToolbar.offsetHeight - 8;
            let left = rect.left - containerRect.left + (rect.width / 2) - (actionToolbar.offsetWidth / 2);

            if (top < 0) top = rect.bottom - containerRect.top + 8;
            if (left < 0) left = 5;
            if (left + actionToolbar.offsetWidth > containerRect.width) {
                left = containerRect.width - actionToolbar.offsetWidth - 5;
            }

            actionToolbar.style.top = `${top}px`;
            actionToolbar.style.left = `${left}px`;
        } else {
            hideToolbar();
        }
    };

    const hideToolbar = () => {
        actionToolbar.style.opacity = '0';
        actionToolbar.style.transform = 'translateY(-10px)';
        setTimeout(() => {
            if (actionToolbar.style.opacity === '0') {
                actionToolbar.style.display = 'none';
            }
        }, 150); 
    };
    
    // ফরম্যাটিং কমান্ড প্রয়োগ করার ফাংশন (আপডেট করা)
    const applyFormat = (command) => {
        const selection = window.getSelection();
        if (savedRange && selection.rangeCount === 0) {
             selection.addRange(savedRange);
        } else if (selection.rangeCount > 0) {
             savedRange = selection.getRangeAt(0).cloneRange();
        }


        if (command === 'increaseFontSize' || command === 'decreaseFontSize') {
            document.execCommand("fontSize", false, "1"); // একটি অস্থায়ী ফন্ট সাইজ প্রয়োগ করা হয়
            const fontElements = (currentTargetElement || document).getElementsByTagName("font");
            Array.from(fontElements).forEach(fontElement => {
                if (fontElement.size == "1") {
                    const parent = fontElement.parentElement;
                    const currentSize = parseFloat(window.getComputedStyle(parent, null).getPropertyValue('font-size')) || 16;
                    let newSize = currentSize + (command === 'increaseFontSize' ? 2 : -2);
                    if (newSize < 10) newSize = 10;
                    if (newSize > 72) newSize = 72;
                    
                    fontElement.removeAttribute("size");
                    fontElement.style.fontSize = newSize + "px";
                }
            });

        } else if (command === 'removeFormat') {
            if (!selection || selection.rangeCount === 0) return;

            const range = selection.getRangeAt(0);
            const contentFragment = range.extractContents();

            const tempDiv = document.createElement('div');
            tempDiv.appendChild(contentFragment);
            let processedHtml = tempDiv.innerHTML;
            
            // অনুচ্ছেদ বা প্যারাগ্রাফের জন্য ব্যবহৃত div বা p ট্যাগের শেষে একটি লাইন ব্রেক (<br>) যোগ করা হচ্ছে
            processedHtml = processedHtml.replace(/<\/(div|p)>/gi, '<br>');
            
            // যদি অতিরিক্ত লাইন ব্রেক তৈরি হয়, তবে সেগুলো একটিতে নামিয়ে আনা হচ্ছে
            processedHtml = processedHtml.replace(/(<br\s*\/?>\s*){2,}/gi, '<br>');

            // শুধুমাত্র <br> ট্যাগ বাদে বাকি সব HTML ট্যাগ মুছে ফেলা হচ্ছে
            const cleanedHtml = processedHtml.replace(/<\/?(?!(br|BR)\s*\/?)[^>]+>/g, '');
            
            // আগের সিলেকশনের জায়গায় পরিষ্কার করা HTML কোডটি বসানো হচ্ছে
            document.execCommand('insertHTML', false, cleanedHtml);
            
            saveTasks(); // পরিবর্তন সেভ করা হচ্ছে

        } else {
            document.execCommand(command, false, null);
        }

        if(currentTargetElement) {
            currentTargetElement.focus();
            const currentSelection = window.getSelection();
            if (currentSelection.rangeCount > 0) {
                savedRange = currentSelection.getRangeAt(0).cloneRange();
            }
        }
    };

    actionToolbar.addEventListener('mousedown', (e) => {
        e.preventDefault(); 
        const button = e.target.closest('.toolbar-btn');
        if (button) {
            const command = button.dataset.command;
            applyFormat(command);
        }
    });
    
    document.addEventListener('selectionchange', () => {
        const selection = window.getSelection();
        const parent = selection.anchorNode ? (selection.anchorNode.nodeType === 3 ? selection.anchorNode.parentNode : selection.anchorNode) : null;
        const editableParent = parent ? parent.closest('.notepad-container [contenteditable="true"]') : null;
        if(editableParent){
             currentTargetElement = editableParent;
             showToolbar();
        } else {
            hideToolbar();
        }
    });

    document.addEventListener('mousedown', (e) => {
        if (!e.target.closest('.notepad-action-toolbar') && !e.target.closest('[contenteditable="true"]')) {
            hideToolbar();
        }
    });

    // --- Core Notepad Logic (Updated for contenteditable) ---
    await loadTasks();

    async function addTextTask() {
        const content = taskInput.innerHTML.trim();
        if (content === '' || content === '<br>') {
            showCustomAlert('অনুগ্রহ করে একটি কাজ বা নোট লিখুন।');
            return;
        }
        createTaskElement({ type: 'text', content, completed: false, pinned: false });
		showCustomAlert('নোট সফলভাবে যোগ করা হয়েছে!'); // এই লাইনটি যোগ করুন
        taskInput.innerHTML = '';
        await saveTasks();
        await loadTasks();
    }

    async function addImageTask(base64Image) {
        if (!base64Image) return;
        createTaskElement({ type: 'image', content: base64Image, caption: '', completed: false, pinned: false });
        showCustomAlert('ছবি সফলভাবে যোগ করা হয়েছে!');
        await saveTasks();
        await loadTasks();
    }

    async function loadTasks() {
        let tasks = await idbGet('notepadTasks') || [];
        tasks.sort((a, b) => (b.pinned ? 1 : 0) - (a.pinned ? 1 : 0));
        taskList.innerHTML = '';
        tasks.forEach(task => createTaskElement(task));
        updateTaskNumbers();
    }

    async function saveTasks() {
        const tasks = Array.from(document.querySelectorAll('.task-item')).map(item => {
            const textSpan = item.querySelector('.task-text');
            const imageEl = item.querySelector('.task-image');
            if (textSpan) {
                return { type: 'text', content: textSpan.innerHTML, completed: item.classList.contains('completed'), pinned: item.classList.contains('pinned') };
            } else if (imageEl) {
                const captionEl = item.querySelector('.task-image-caption');
                return { type: 'image', content: imageEl.src, caption: captionEl ? captionEl.innerText : '', completed: item.classList.contains('completed'), pinned: item.classList.contains('pinned') };
            }
            return null;
        }).filter(Boolean);
        await idbSet('notepadTasks', tasks);
    }
    
    function createTaskElement(task) {
        const { type, content, completed, pinned, caption } = task;

        const li = document.createElement('li');
        li.className = `task-item ${completed ? 'completed' : ''} ${pinned ? 'pinned' : ''}`;
        li.setAttribute('draggable', 'true');

        const numberSpan = document.createElement('span');
        numberSpan.className = 'task-number';

        const contentWrapper = document.createElement('div');
        contentWrapper.style.flexGrow = '1';

        if (type === 'image') {
             contentWrapper.innerHTML = `
                <div>
                    <img src="${content}" class="task-image" style="width: 100%; height: auto; max-height: 300px; object-fit: cover; border-radius: 8px; margin-top: 5px;">
                    <p class="task-image-caption" style="font-size: 0.9em; color: grey; margin-top: 8px; padding: 4px; border-radius: 4px; word-break: break-word; text-align: justify;">${caption || 'ক্যাপশন যোগ করতে ডাবল-ক্লিক করুন...'}</p>
                </div>
            `;
            const captionEl = contentWrapper.querySelector('.task-image-caption');
            const enableCaptionEdit = (e) => {
                e.stopPropagation();
                if (captionEl.innerText === 'ক্যাপশন যোগ করতে ডাবল-ক্লিক করুন...') captionEl.innerText = '';
                captionEl.contentEditable = true;
                captionEl.focus();
                captionEl.style.outline = '2px solid #3b82f6';
                const originalCaption = captionEl.innerText;
                const saveOnBlur = async () => {
                    captionEl.contentEditable = false;
                    captionEl.style.outline = 'none';
                    if (captionEl.innerText.trim() === '') captionEl.innerText = 'ক্যাপশন যোগ করতে ডাবল-ক্লিক করুন...';
                    if (captionEl.innerText !== originalCaption) await saveTasks();
                };
                captionEl.addEventListener('blur', saveOnBlur, { once: true });
            };
            contentWrapper.querySelector('.task-image').addEventListener('dblclick', enableCaptionEdit);
            captionEl.addEventListener('dblclick', enableCaptionEdit);
        } else {
            const textSpan = document.createElement('div');
            textSpan.className = 'task-text';
            textSpan.innerHTML = content;
            textSpan.contentEditable = true;
            textSpan.spellcheck = false;
            textSpan.addEventListener('blur', saveTasks);
            contentWrapper.appendChild(textSpan);
        }

        contentWrapper.addEventListener('click', async (e) => {
            if (e.target.closest('[contenteditable="true"]')) return;
            li.classList.toggle('completed');
            await saveTasks();
        });

        const actionsDiv = document.createElement('div');
        actionsDiv.className = 'actions';
        actionsDiv.innerHTML = `
            <button class="action-btn pin ${pinned ? 'active' : ''}" title="পিন/আনপিন করুন"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4.146.146A.5.5 0 0 1 4.5 0h7a.5.5 0 0 1 .5.5c0 .68-.342 1.174-.646 1.479-.126.125-.25.224-.354.298v4.431l.078.048c.203.127.476.314.751.555C12.36 7.775 13 8.527 13 9.5a.5.5 0 0 1-.5.5h-4v4.5c0 .276-.224 1.5-.5 1.5s-.5-1.224-.5-1.5V10h-4a.5.5 0 0 1-.5-.5c0-.973.64-1.725 1.17-2.176a6 6 0 0 1 .751-.555l.078-.048V2.147a3.2 3.2 0 0 1-.354-.298C3.842 1.674 3.5 1.18 3.5.5a.5.5 0 0 1 .646-.354m.354 1.354a.5.5 0 0 0-.708 0l-.5.5A.5.5 0 0 0 3 2.5V3h10V2.5a.5.5 0 0 0-.293-.45l-.5-.5a.5.5 0 0 0-.707 0l-.001.002-.002.001-.002.001a.5.5 0 0 1-.17.036H5.02a.5.5 0 0 1-.17-.036l-.002-.001-.002-.001L4.5 1.5z"/></svg></button>
            <button class="action-btn copy" title="কপি করুন"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z"/></svg></button>
            <button class="action-btn delete" title="মুছে ফেলুন"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z"/><path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z"/></svg></button>
        `;

        actionsDiv.querySelector('.pin').addEventListener('click', async () => { li.classList.toggle('pinned'); await saveTasks(); await loadTasks(); });
        
        actionsDiv.querySelector('.copy').addEventListener('click', () => {
             if (type === 'text') {
                const contentToCopy = li.querySelector('.task-text').innerHTML;
                
                // Create a temporary element to hold the rich text content
                const tempEl = document.createElement('div');
                tempEl.style.position = 'absolute';
                tempEl.style.left = '-9999px'; // Move it off-screen
                tempEl.innerHTML = contentToCopy;
                document.body.appendChild(tempEl);

                try {
                    // Select the content of the temporary element
                    const range = document.createRange();
                    range.selectNodeContents(tempEl);
                    const selection = window.getSelection();
                    selection.removeAllRanges();
                    selection.addRange(range);

                    // Execute the copy command
                    const successful = document.execCommand('copy');
                    if (successful) {
                        showCustomAlert('নোটের লেখা ফরম্যাটিং সহ কপি করা হয়েছে!');
                    } else {
                        showCustomAlert('কপি করতে ব্যর্থ হয়েছে।');
                    }
                } catch (err) {
                    console.error('কপি করতে ব্যর্থ:', err);
                    showCustomAlert('কপি করতে ব্যর্থ হয়েছে। অনুগ্রহ করে ম্যানুয়ালি কপি করুন।');
                } finally {
                    // Clean up: remove the temporary element and clear selection
                    document.body.removeChild(tempEl);
                    window.getSelection().removeAllRanges();
                }

            } else if (type === 'image') {
                const capEl = li.querySelector('.task-image-caption');
                if (capEl && capEl.innerText && capEl.innerText !== 'ক্যাপশন যোগ করতে ডাবল-ক্লিক করুন...') {
                    navigator.clipboard.writeText(capEl.innerText).then(() => showCustomAlert('ছবির ক্যাপশন কপি করা হয়েছে!'));
                } else {
                    showCustomAlert('ছবি সরাসরি কপি করা যায় না এবং কোনো ক্যাপশন নেই।');
                }
            }
        });

       actionsDiv.querySelector('.delete').addEventListener('click', async () => {
            if (confirm('আপনি কি নিশ্চিতভাবে এই নোটটি মুছে ফেলতে চান?')) {
                li.remove();
                await saveTasks();
                updateTaskNumbers();
                showCustomAlert('নোট সফলভাবে মুছে ফেলা হয়েছে!');
            }
        });

        li.appendChild(numberSpan);
        li.appendChild(contentWrapper);
        li.appendChild(actionsDiv);
        taskList.appendChild(li);
    }
    
    addTaskBtn.addEventListener('click', addTextTask);

    taskInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            document.execCommand('insertLineBreak');
        }
    });

    taskInput.addEventListener('paste', (event) => {
        const items = (event.clipboardData || window.clipboardData).items;
        for (const item of items) { if (item.type.includes('image')) { event.preventDefault(); const blob = item.getAsFile(); const reader = new FileReader(); reader.onload = (e) => addImageTask(e.target.result); reader.readAsDataURL(blob); return; } }
    });

    let draggingItem = null;
    taskList.addEventListener('dragstart', e => { if (e.target.classList.contains('task-item')) { draggingItem = e.target; setTimeout(() => e.target.classList.add('dragging'), 0); } });
    taskList.addEventListener('dragend', async () => { if (draggingItem) { draggingItem.classList.remove('dragging'); draggingItem = null; await saveTasks(); updateTaskNumbers(); } });
    taskList.addEventListener('dragover', e => { e.preventDefault(); if (draggingItem) { const afterElement = getDragAfterElement(taskList, e.clientY); taskList.insertBefore(draggingItem, afterElement); } });

    function updateTaskNumbers() {
        taskList.querySelectorAll('.task-item').forEach((task, index) => { task.querySelector('.task-number').textContent = index + 1; });
    }

    function getDragAfterElement(container, y) {
        return [...container.querySelectorAll('.task-item:not(.dragging)')].reduce((closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            return (offset < 0 && offset > closest.offset) ? { offset, element: child } : closest;
        }, { offset: Number.NEGATIVE_INFINITY }).element;
    }
}
// ====================================================================
// END: NOTEPAD SCRIPT
// ====================================================================

// ====================================================================
// START: CLOCK TAB SCRIPT (STOPWATCH, ALARM, WORLD CLOCK)
// ====================================================================


// আপনার JavaScript ফাইলে IndexedDB helper ফাংশনগুলোর সাথে এই নতুন idbDelete ফাংশনটি যোগ করুন।
async function idbDelete(key) {
    const db = await getDb();
    const transaction = db.transaction(STORE_NAME, 'readwrite');
    const store = transaction.objectStore(STORE_NAME);
    const request = store.delete(key);
    return new Promise((resolve, reject) => {
        transaction.oncomplete = () => resolve(true);
        transaction.onerror = () => reject(transaction.error);
    });
}


// আপনার JavaScript ফাইলে থাকা পুরনো initializeClockTab ফাংশনটি এই নতুন কোড দিয়ে সম্পূর্ণরূপে প্রতিস্থাপন করুন।
function initializeClockTab() {
    // --- Stopwatch Variables ---
    const stopwatchDisplay = document.querySelector('.stopwatch-display');
    const startBtn = document.getElementById('startStopwatch');
    const stopBtn = document.getElementById('stopStopwatch');
    const resetBtn = document.getElementById('resetStopwatch');
    const lapBtn = document.getElementById('lapStopwatch');
    const lapsList = document.getElementById('lapsList');
    let stopwatchTimer = null, startTime = 0, elapsedTime = 0, isRunning = false, lapCounter = 0;

    // --- Alarm Variables ---
    const alarmTimeInput = document.getElementById('alarmTimeInput');
    const setAlarmBtn = document.getElementById('setAlarmBtn');
    const clearAlarmBtn = document.getElementById('clearAlarmBtn');
    const stopAlarmBtn = document.getElementById('stopAlarmBtn'); // নতুন বাটন
    const alarmStatus = document.getElementById('alarmStatus');
    const alarmSoundSelect = document.getElementById('alarmSoundSelect');
    const customAlarmSoundInput = document.getElementById('customAlarmSoundInput');
    const customAlarmFileName = document.getElementById('customAlarmFileName');
    const removeCustomAlarmSound = document.getElementById('removeCustomAlarmSound');

    let alarmTime = null;
    let alarmCheckInterval = null;
    let alarmCountdownInterval = null;
    let activeAlarmSound = null;
    let customAlarmSoundBlob = null;
    let hasRungThisMinute = false;

    // --- World Clock Variables ---
    const worldClockGrid = document.querySelector('.world-clock-grid');
    const timezoneSelect = document.getElementById('timezone-select');
    const timezonesWithCountries = [
        { zone: 'Asia/Dhaka', city: 'ঢাকা', country: 'বাংলাদেশ' }, { zone: 'Asia/Kolkata', city: 'কলকাতা', country: 'ভারত' },
        { zone: 'Asia/Karachi', city: 'করাচি', country: 'পাকিস্তান' }, { zone: 'Asia/Riyadh', city: 'রিয়াদ', country: 'সৌদি আরব' },
        { zone: 'Asia/Dubai', city: 'দুবাই', country: 'সংযুক্ত আরব আমিরাত' }, { zone: 'Asia/Muscat', city: 'মাস্কাট', country: 'ওমান' },
        { zone: 'Asia/Qatar', city: 'দোহা', country: 'কাতার' }, { zone: 'Asia/Kuwait', city: 'কুয়েত সিটি', country: 'কুয়েত' },
        { zone: 'Asia/Bahrain', city: 'মানামা', country: 'বাহরাইন' }, { zone: 'Asia/Kuala_Lumpur', city: 'কুয়ালালামপুর', country: 'মালয়েশিয়া' },
        { zone: 'Asia/Singapore', city: 'সিঙ্গাপুর', country: 'সিঙ্গাপুর' }, { zone: 'Asia/Tokyo', city: 'টোকিও', country: 'জাপান' },
        { zone: 'Asia/Seoul', city: 'সিওল', country: 'দক্ষিণ কোরিয়া' }, { zone: 'Europe/London', city: 'লন্ডন', country: 'যুক্তরাজ্য' },
        { zone: 'Europe/Rome', city: 'রোম', country: 'ইতালি' }, { zone: 'Europe/Paris', city: 'প্যারিস', country: 'ফ্রান্স' },
        { zone: 'Europe/Berlin', city: 'বার্লিন', country: 'জার্মানি' }, { zone: 'Europe/Moscow', city: 'মস্কো', country: 'রাশিয়া' },
        { zone: 'America/New_York', city: 'নিউ ইয়র্ক', country: 'মার্কিন যুক্তরাষ্ট্র' }, { zone: 'America/Los_Angeles', city: 'লস অ্যাঞ্জেলেস', country: 'মার্কিন যুক্তরাষ্ট্র' },
        { zone: 'America/Toronto', city: 'টরন্টো', country: 'কানাডা' }, { zone: 'Australia/Sydney', city: 'সিডনি', country: 'অস্ট্রেলিয়া' }
    ];
    const defaultTimezones = timezonesWithCountries.filter(tz => ['Asia/Dhaka', 'Asia/Kolkata', 'Europe/London', 'America/New_York', 'Asia/Tokyo', 'Australia/Sydney', 'Asia/Dubai', 'Europe/Moscow'].includes(tz.zone));

    // ======================== HELPER FUNCTIONS ========================
    function formatTo12Hour(timeString24) { if (!timeString24) return '--:--'; const [hours, minutes] = timeString24.split(':'); const h = parseInt(hours, 10); const m = parseInt(minutes, 10); const ampm = h >= 12 ? 'PM' : 'AM'; const hour12 = h % 12 || 12; return `${String(hour12).padStart(2, '0')}:${String(m).padStart(2, '0')} ${ampm}`; }
    
    // ======================== STOPWATCH LOGIC (Unchanged) ========================
    function formatStopwatchTime(ms) { const date = new Date(ms); const minutes = String(date.getUTCMinutes()).padStart(2, '0'); const seconds = String(date.getUTCSeconds()).padStart(2, '0'); const milliseconds = String(date.getUTCMilliseconds()).padStart(3, '0').substring(0, 2); return `${minutes}:${seconds}.${milliseconds}`; }
    function updateStopwatchDisplay() { if(stopwatchDisplay) stopwatchDisplay.textContent = formatStopwatchTime(elapsedTime); }
    function startStopwatch() { if (!isRunning) { startTime = Date.now() - elapsedTime; stopwatchTimer = setInterval(() => { elapsedTime = Date.now() - startTime; updateStopwatchDisplay(); }, 10); isRunning = true; } }
    function stopStopwatch() { if (isRunning) { clearInterval(stopwatchTimer); isRunning = false; } }
    function resetStopwatch() { stopStopwatch(); elapsedTime = 0; lapCounter = 0; updateStopwatchDisplay(); if(lapsList) lapsList.innerHTML = ''; }
    function recordLap() { if (isRunning && lapsList) { lapCounter++; const li = document.createElement('li'); li.innerHTML = `<span>ল্যাপ ${lapCounter}</span><span>${formatStopwatchTime(elapsedTime)}</span>`; lapsList.prepend(li); } }
    if(startBtn) startBtn.addEventListener('click', startStopwatch);
    if(stopBtn) stopBtn.addEventListener('click', stopStopwatch);
    if(resetBtn) resetBtn.addEventListener('click', resetStopwatch);
    if(lapBtn) lapBtn.addEventListener('click', recordLap);

    // ======================== ALARM LOGIC (Updated with Stop Button) ========================
    function stopAlarmSound() {
        if (activeAlarmSound) {
            if (activeAlarmSound.stop) {
                activeAlarmSound.stop();
            } else if (activeAlarmSound.pause) {
                activeAlarmSound.pause();
                activeAlarmSound.currentTime = 0;
            }
            activeAlarmSound = null;
        }
        // অ্যালার্ম থামানোর পর 'থামান' বাটনটি লুকান
        if (stopAlarmBtn) stopAlarmBtn.classList.add('hidden');
    }

    function playAlarmSound() {
        stopAlarmSound(); 
        
        // অ্যালার্ম বাজার সময় 'থামান' বাটনটি দেখান
        if (stopAlarmBtn) stopAlarmBtn.classList.remove('hidden');

        if (customAlarmSoundBlob) {
            try {
                const audioUrl = URL.createObjectURL(customAlarmSoundBlob);
                const customAudio = new Audio(audioUrl);
                activeAlarmSound = customAudio;
                customAudio.play();
                customAudio.onended = () => URL.revokeObjectURL(audioUrl);
                return;
            } catch (e) {
                console.error("কাস্টম অ্যালার্ম সাউন্ড বাজানো সম্ভব হয়নি:", e);
                showCustomAlert("কাস্টম অডিও ফাইলটি বাজানো যাচ্ছে না।");
            }
        }
        
        try {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const selectedSound = alarmSoundSelect.value;
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
            
            oscillator.onended = () => {
                audioContext.close();
                if (activeAlarmSound === oscillator) {
                    activeAlarmSound = null;
                }
            };
            
            activeAlarmSound = oscillator;

            switch (selectedSound) {
                case 'chime': oscillator.type = 'sine'; oscillator.frequency.setValueAtTime(880, audioContext.currentTime); oscillator.frequency.setValueAtTime(1046.50, audioContext.currentTime + 0.2); break;
                case 'radar': oscillator.type = 'sawtooth'; oscillator.frequency.setValueAtTime(1200, audioContext.currentTime); gainNode.gain.exponentialRampToValueAtTime(0.0001, audioContext.currentTime + 0.5); break;
                case 'beep': default: oscillator.type = 'sine'; oscillator.frequency.setValueAtTime(440, audioContext.currentTime); break;
            }
            oscillator.start();
            setTimeout(() => {
                if (activeAlarmSound === oscillator) {
                    oscillator.stop();
                    // ১ সেকেন্ড পর 'থামান' বাটনটি আবার লুকান
                    if (stopAlarmBtn) stopAlarmBtn.classList.add('hidden');
                }
            }, 1000);
        } catch(e) { console.error("অ্যালার্ম সাউন্ড বাজানো সম্ভব হয়নি:", e); }
    }

    function checkAlarm() {
        if (alarmTime) {
            const now = new Date();
            const currentTime = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
            
            if (currentTime === alarmTime) {
                if (!hasRungThisMinute) {
                    playAlarmSound();
                    showCustomAlert(`অ্যালার্ম! এখন সময় ${formatTo12Hour(alarmTime)}`);
                    hasRungThisMinute = true;
                }
            } else {
                hasRungThisMinute = false;
            }
        }
    }
    
    async function setupAlarm(timeValue, showAlert = true) {
        if (timeValue) {
            alarmTime = timeValue;
            await idbSet('activeAlarm', { time: alarmTime });
            
            const time12hr = formatTo12Hour(timeValue);

            clearInterval(alarmCountdownInterval);
            clearInterval(alarmCheckInterval);

            const updateCountdown = () => {
                const [targetHours, targetMinutes] = timeValue.split(':').map(Number);
                const targetTime = new Date();
                targetTime.setHours(targetHours, targetMinutes, 0, 0);

                if (targetTime < new Date()) {
                    targetTime.setDate(targetTime.getDate() + 1);
                }

                const diff = targetTime - new Date();
                if (diff <= 0) {
                     if(alarmStatus) alarmStatus.innerHTML = `অ্যালার্ম সেট করা হয়েছে: ${time12hr}`;
                     return;
                }
                const hours = Math.floor((diff / 3600000) % 24);
                const minutes = Math.floor((diff / 60000) % 60);
                const seconds = Math.floor((diff / 1000) % 60);
                if(alarmStatus) alarmStatus.innerHTML = `অ্যালার্ম সেট করা হয়েছে: ${time12hr} <span class="countdown">বাকি আছে: ${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}</span>`;
            };
            
            updateCountdown();
            alarmCountdownInterval = setInterval(updateCountdown, 1000);
            if(alarmStatus) alarmStatus.classList.add('active');
            alarmCheckInterval = setInterval(checkAlarm, 1000);
            
            if (showAlert) {
                showCustomAlert(`অ্যালার্ম ${time12hr} এর জন্য সেট করা হয়েছে।`);
            }
        }
    }

    async function clearAlarm() {
        stopAlarmSound();
        alarmTime = null;
        hasRungThisMinute = false;
        
        if(alarmTimeInput) alarmTimeInput.value = '';
        clearInterval(alarmCheckInterval);
        clearInterval(alarmCountdownInterval);
        
        await idbDelete('activeAlarm');

        if(alarmStatus) {
            alarmStatus.textContent = 'কোনো অ্যালার্ম সেট করা নেই।';
            alarmStatus.classList.remove('active');
        }
    }
    
    async function loadCustomAlarmSound() {
        try {
            const soundData = await idbGet('customAlarmSound');
            if (soundData && soundData.data) {
                customAlarmSoundBlob = new Blob([soundData.data], { type: soundData.type });
                customAlarmFileName.textContent = soundData.name;
                customAlarmFileName.title = soundData.name;
                removeCustomAlarmSound.classList.remove('hidden');
            } else {
                customAlarmSoundBlob = null;
                customAlarmFileName.textContent = 'কোনো ফাইল নেই';
                customAlarmFileName.title = '';
                removeCustomAlarmSound.classList.add('hidden');
            }
        } catch (e) { console.error("কাস্টম অ্যালার্ম লোড করতে সমস্যা:", e); }
    }

    if(setAlarmBtn) setAlarmBtn.addEventListener('click', () => {
        const timeValue = alarmTimeInput.value;
        if (timeValue) {
            setupAlarm(timeValue, true);
        } else {
            showCustomAlert('অনুগ্রহ করে একটি সঠিক সময় নির্বাচন করুন।');
        }
    });

    if(clearAlarmBtn) clearAlarmBtn.addEventListener('click', () => {
        clearAlarm();
        showCustomAlert('অ্যালার্ম মুছে ফেলা হয়েছে।');
    });
    
    // নতুন: 'থামান' বাটনের জন্য ইভেন্ট লিসেনার
    if(stopAlarmBtn) {
        stopAlarmBtn.addEventListener('click', () => {
            stopAlarmSound();
            hasRungThisMinute = true; // এই মিনিটের জন্য আর বাজবে না
            if (alarmTime && alarmStatus) {
                 alarmStatus.innerHTML = `অ্যালার্ম (${formatTo12Hour(alarmTime)}) থামানো হয়েছে।`;
            }
        });
    }

    if (customAlarmSoundInput) {
        customAlarmSoundInput.addEventListener('change', async (event) => {
            const file = event.target.files[0];
            if (!file) return;
            if (!file.type.startsWith('audio/')) { showCustomAlert('অনুগ্রহ করে একটি অডিও ফাইল নির্বাচন করুন।'); return; }
            const reader = new FileReader();
            reader.onload = async (e) => {
                const arrayBuffer = e.target.result;
                const soundData = { name: file.name, type: file.type, data: arrayBuffer };
                await idbSet('customAlarmSound', soundData);
                await loadCustomAlarmSound();
                showCustomAlert(`'${file.name}' অ্যালার্ম সাউন্ড হিসেবে সেট করা হয়েছে।`);
            };
            reader.readAsArrayBuffer(file);
        });
    }

    if (removeCustomAlarmSound) {
        removeCustomAlarmSound.addEventListener('click', async () => {
            await idbDelete('customAlarmSound');
            await loadCustomAlarmSound();
            showCustomAlert('কাস্টম অ্যালার্ম সাউন্ড সরানো হয়েছে।');
        });
    }

    if (alarmSoundSelect) {
        const savedSound = localStorage.getItem('alarmSound');
        if (savedSound) alarmSoundSelect.value = savedSound;
        alarmSoundSelect.addEventListener('change', () => localStorage.setItem('alarmSound', alarmSoundSelect.value));
    }
    
    async function loadInitialAlarm() {
        await loadCustomAlarmSound();
        const savedAlarm = await idbGet('activeAlarm');
        if (savedAlarm && savedAlarm.time) {
            alarmTimeInput.value = savedAlarm.time;
            setupAlarm(savedAlarm.time, false);
        }
    }

    // ======================== WORLD CLOCK LOGIC (Unchanged) ========================
    function populateTimezoneDropdown() { if (!timezoneSelect) return; timezoneSelect.innerHTML = '<option value="">একটি শহর নির্বাচন করুন...</option>'; timezonesWithCountries.forEach(tz => { const option = document.createElement('option'); option.value = tz.zone; option.textContent = `${tz.city}, ${tz.country}`; timezoneSelect.appendChild(option); }); }
    function updateWorldClocks() { if (!worldClockGrid) return; worldClockGrid.innerHTML = ''; const now = new Date(); const selectedZone = timezoneSelect.value; let finalOrder = []; let selectedTz = null; if (selectedZone) { selectedTz = timezonesWithCountries.find(tz => tz.zone === selectedZone); } let displayList = [...defaultTimezones]; if (selectedTz && !displayList.some(dtz => dtz.zone === selectedTz.zone)) { displayList.unshift(selectedTz); } const uniqueZones = new Map(); if(selectedTz) uniqueZones.set(selectedTz.zone, selectedTz); const dhakaTz = timezonesWithCountries.find(tz => tz.zone === 'Asia/Dhaka'); if(dhakaTz) uniqueZones.set(dhakaTz.zone, dhakaTz); displayList.forEach(tz => uniqueZones.set(tz.zone, tz)); finalOrder = Array.from(uniqueZones.values()); finalOrder.forEach(tz => { const card = document.createElement('div'); card.className = 'world-clock-card'; let timeString, dateString; const countryDiv = `<div class="country">${tz.country || ''}</div>`; if (selectedZone && tz.zone === selectedZone) { card.id = 'selected-timezone-card'; timeString = now.toLocaleTimeString('bn-BD', { timeZone: tz.zone, hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true }); dateString = now.toLocaleDateString('bn-BD', { timeZone: tz.zone, weekday: 'long', day: 'numeric', month: 'long' }); } else { timeString = now.toLocaleTimeString('bn-BD', { timeZone: tz.zone, hour: '2-digit', minute: '2-digit', hour12: true }); dateString = now.toLocaleDateString('bn-BD', { timeZone: tz.zone, weekday: 'short', day: 'numeric' }); } card.innerHTML = `<div class="city">${tz.city}</div>${countryDiv}<div class="time">${timeString}</div><div class="date">${dateString}</div>`; worldClockGrid.appendChild(card); }); }
    
    if (window.worldClockIntervalId) clearInterval(window.worldClockIntervalId);
    populateTimezoneDropdown();
    const savedTimezone = localStorage.getItem('selectedWorldClockTimezone');
    if (savedTimezone && timezoneSelect) timezoneSelect.value = savedTimezone;
    updateWorldClocks(); 
    window.worldClockIntervalId = setInterval(updateWorldClocks, 1000);
    if (timezoneSelect) { timezoneSelect.addEventListener('change', () => { const selectedZone = timezoneSelect.value; if (selectedZone) localStorage.setItem('selectedWorldClockTimezone', selectedZone); else localStorage.removeItem('selectedWorldClockTimezone'); updateWorldClocks(); }); }
    
    // --- Initialize ALARM on load ---
    loadInitialAlarm();
}

// ====================================================================
// END: CLOCK TAB SCRIPT (STOPWATCH, ALARM, WORLD CLOCK)
// ====================================================================


//নতুন কোনো ট্যাব যুক্ত করলে তার স্ক্রিপ্ট এটির আগে অ্যাড করতে হবে।

// ====================================================================
// END: TRANSLATOR SCRIPT
// ====================================================================

                // --- টেক্সট অ্যাসিস্ট্যান্ট (চ্যাট) লজিক ---
                const assistantInput = document.getElementById('assistantInput');
                const askGeminiBtn = document.getElementById('askGeminiBtn');
                const chatWindow = document.getElementById('chatWindow');
                const clearChatBtn = document.getElementById('clearChatBtn');

                window.chatHistory = []; // কথোপকথনের ইতিহাস সংরক্ষণ করে

                // চ্যাট মুছুন বোতামের কার্যকারিতা
                if (clearChatBtn) {
                    clearChatBtn.addEventListener('click', () => {
                        if (chatWindow) chatWindow.innerHTML = '';
                        window.chatHistory = []; // ইতিহাস রিসেট করুন
                        addMessageToChat('হ্যালো! আমি আপনার টেক্সট অ্যাসিস্ট্যান্ট। আমি আপনাকে কীভাবে সাহায্য করতে পারি?', 'gemini');
                    });
                }

                // জেমিনিকে জিজ্ঞাসা করার বোতামের কার্যকারিতা
                if (askGeminiBtn) {
                    askGeminiBtn.addEventListener('click', handleAskGemini);
                }

                // Enter চেপে বার্তা পাঠানোর সুবিধা
                if (assistantInput) {
                    assistantInput.addEventListener('keydown', (e) => {
                        // Shift+Enter চাপলে নতুন লাইন তৈরি হবে, শুধু Enter চাপলে বার্তা যাবে
                        if (e.key === 'Enter' && !e.shiftKey) {
                            e.preventDefault(); // ডিফল্ট Enter আচরণ (নতুন লাইন) বন্ধ করুন
                            handleAskGemini();
                        }
                    });
                }

                // --- ফন্ট কনভার্টার লিসেনার যোগ করুন ---
				// ====================================================================
// ====================================================================
// START: PASTE FROM CLIPBOARD FUNCTIONALITY (বাগ ফিক্সড)
// এই ফাংশনটি আগেরটির জায়গায় সম্পূর্ণরূপে প্রতিস্থাপন করুন।
// ====================================================================
async function pasteFromClipboard(textareaId) {
    const textarea = document.getElementById(textareaId);
    if (!textarea) return;

    try {
        const clipboardText = await navigator.clipboard.readText();
        if (!clipboardText) {
            showCustomAlert('ক্লিপবোর্ডে কোনো টেক্সট নেই।');
            return;
        }

        let textToInsert = '';
        let preset, customValue, serialCounter, updateSerialCounter, resetSerialCounter;

        if (textareaId === 'textAreaLeft') {
            preset = pastePresetLeft;
            customValue = customPasteValueLeft;
            serialCounter = customSerialCounterLeft;
            updateSerialCounter = (val) => { customSerialCounterLeft = val; };
            resetSerialCounter = () => { customSerialCounterLeft = 1; };
        } else {
            preset = pastePresetRight;
            customValue = customPasteValueRight;
            serialCounter = customSerialCounterRight;
            updateSerialCounter = (val) => { customSerialCounterRight = val; };
            resetSerialCounter = () => { customSerialCounterRight = 1; };
        }

        if (preset !== 'custom-serial') {
            resetSerialCounter();
        }

        // বিভিন্ন প্রিসেটের জন্য টেক্সট প্রস্তুত করার লজিক এখানে আপডেট করা হয়েছে।
        switch (preset) {
            case 'double-enter-v2': {
                let processedText = clipboardText.trim().replace(/(\r?\n\s*){2,}/g, '\n');
                if (textarea.value.trim() !== '') {
                    textToInsert = '\n\n' + processedText;
                } else {
                    textToInsert = processedText;
                }
                break;
            }
            case 'double-enter-v3': { // নতুন V3 প্রিসেট যুক্ত করা হয়েছে
                // V2 এর মতো, অতিরিক্ত খালি লাইন রিমুভ করা হয়
                let processedText = clipboardText.trim().replace(/(\r?\n\s*){2,}/g, '\n');
                // নতুন বৈশিষ্ট্য: প্রতিটা লাইনের শুরু থেকে স্পেস রিমুভ করা হয়
                processedText = processedText.replace(/^\s+/gm, ''); 
                if (textarea.value.trim() !== '') {
                    textToInsert = '\n\n' + processedText;
                } else {
                    textToInsert = processedText;
                }
                break;
            }
            case 'custom-serial': {
                const prefix = customValue ? customValue.replace(/\{serial\}/g, serialCounter) : '';
                updateSerialCounter(serialCounter + 1);
                // ফিক্স: টেক্সটবক্স খালি থাকলেও প্রিফিক্সটি ক্লিপবোর্ডের টেক্সটের সাথে যোগ করা হচ্ছে।
                textToInsert = prefix + clipboardText;
                break;
            }
            default: {
                let prefix = '';
                if (preset === 'custom') {
                    // ফিক্স: 'কাস্টম' প্রিসেটের জন্য, প্রিফিক্সটি সর্বদা যোগ করা হচ্ছে।
                    prefix = customValue || '';
                    textToInsert = prefix + clipboardText;
                } else {
                    // অন্যান্য ডিফল্ট প্রিসেট (যেমন স্পেস, এন্টার) শুধুমাত্র তখনই যোগ হবে যখন টেক্সটবক্স খালি থাকবে না।
                    if (textarea.value.trim() !== '') {
                        if (preset === 'single-space') prefix = ' ';
                        else if (preset === 'double-space') prefix = '  ';
                        else if (preset === 'four-space') prefix = '    ';
                        else if (preset === 'single-enter') prefix = '\n';
                        else if (preset === 'double-enter') prefix = '\n\n';
                    }
                    textToInsert = prefix + clipboardText;
                }
                break;
            }
        }
        
        const start = textarea.selectionStart;
        const end = textarea.selectionEnd;
        const currentValue = textarea.value;
        textarea.value = currentValue.substring(0, start) + textToInsert + currentValue.substring(end);
        
        const newCursorPosition = start + textToInsert.length;
        textarea.selectionStart = newCursorPosition;
        textarea.selectionEnd = newCursorPosition;
        textarea.focus();

        addState(textareaId);
        showCustomAlert('টেক্সট পেস্ট করা হয়েছে!');

        const liveConvertToggle = document.getElementById('live-convert-toggle');
        if (liveConvertToggle && liveConvertToggle.checked) {
            if (textareaId === 'textAreaLeft') setTimeout(convertLeftToRight, 0);
            else if (textareaId === 'textAreaRight') setTimeout(convertRightToLeft, 0);
        }

    } catch (err) {
        console.error('পেস্ট করতে ব্যর্থ:', err);
        showCustomAlert('পেস্ট করতে ব্যর্থ হয়েছে। ব্রাউজার পারমিশন চেক করুন।');
    }
}


// ====================================================================
// END: PASTE FROM CLIPBOARD FUNCTIONALITY
// ====================================================================

			
                const fixAnsiButton = document.getElementById('fixAnsiButton');
                if (fixAnsiButton) {
                    fixAnsiButton.addEventListener('click', () => fixAnsiText(true));
                }

                // *** সংশোধিত: প্রাথমিক বার্তাটি এখানে যোগ করা হয়েছে ***
                if (chatWindow && chatWindow.children.length === 0) {
                     addMessageToChat('হ্যালো! আমি আপনার টেক্সট অ্যাসিস্ট্যান্ট। আমি আপনাকে কীভাবে সাহায্য করতে পারি?', 'gemini');
                }
                
                // ইউনিট কনভার্টার ইনিশিয়ালাইজ করুন
                initializeUnitConverters();

// --- ফন্ট কনভার্টার লিসেনার যোগ করুন ---
const pasteButtonLeft = document.getElementById('pasteButtonLeft');
const pasteButtonRight = document.getElementById('pasteButtonRight');

// ====================================================================
// START: LIVE CONVERT TOGGLE FUNCTIONALITY (রিফ্রেশ-সহ আপডেট করা হয়েছে)
// ====================================================================

const liveConvertToggle = document.getElementById('live-convert-toggle');
const textAreaLeftForLive = document.getElementById('textAreaLeft');
const textAreaRightForLive = document.getElementById('textAreaRight');

if (liveConvertToggle && textAreaLeftForLive && textAreaRightForLive) {

    // --- নতুন: পেইজ লোড হওয়ার সময় সেভ করা মোড লোড করুন ---
    const savedLiveConvertMode = localStorage.getItem('liveConvertMode');
    if (savedLiveConvertMode === 'true') {
        liveConvertToggle.checked = true;
    } else {
        liveConvertToggle.checked = false; // ডিফল্ট 'false'
    }

    // --- নতুন: টগল করার সময় মোড সেভ করুন ---
    liveConvertToggle.addEventListener('change', () => {
        localStorage.setItem('liveConvertMode', liveConvertToggle.checked);
    });
    
    // ইউনিকোড টেক্সটবক্সে লাইভ টাইপিং এবং পেস্ট হ্যান্ডেল করা
    const handleUnicodeInput = () => {
        if (liveConvertToggle.checked) {
            // সামান্য ডিলে দেওয়া হয় যাতে পেস্ট হওয়া টেক্সট ঠিকভাবে প্রসেস হয়
            setTimeout(() => convertLeftToRight(), 0);
        }
    };

    // বিজয় টেক্সটবক্সে লাইভ টাইপিং এবং পেস্ট হ্যান্ডেল করা
    const handleBijoyInput = () => {
        if (liveConvertToggle.checked) {
            // সামান্য ডিলে দেওয়া হয় যাতে যুক্তবর্ণ লেখার সময় অক্ষর হারিয়ে না যায়
            setTimeout(() => convertRightToLeft(), 0);
        }
    };

    // 'input' ইভেন্টটি টাইপিং এবং পেস্ট উভয় ক্ষেত্রেই কাজ করবে
    textAreaLeftForLive.addEventListener('input', handleUnicodeInput);
    textAreaRightForLive.addEventListener('input', handleBijoyInput);

} else {
    console.error("Live convert elements could not be found.");
}

// ====================================================================
// END: LIVE CONVERT TOGGLE FUNCTIONALITY
// ====================================================================
if (pasteButtonLeft) {
    pasteButtonLeft.addEventListener('click', () => pasteFromClipboard('textAreaLeft'));
}

if (pasteButtonRight) {
    pasteButtonRight.addEventListener('click', () => pasteFromClipboard('textAreaRight'));
}

            } catch (e) {
                console.error('DOMContentLoaded এক্সিকিউশনের সময় একটি ত্রুটি ঘটেছে:', e);
                const mainContainer = document.querySelector('.main-container');
                if (mainContainer) {
                    const errorMessageDiv = document.createElement('div');
                    errorMessageDiv.className = 'text-red-600 font-bold mt-4 p-4 border border-red-300 rounded-lg';
                    errorMessageDiv.innerText = 'অ্যাপ লোড করতে সমস্যা হয়েছে। অনুগ্রহ করে কনসোল চেক করুন।';
                    mainContainer.prepend(errorMessageDiv);
                }
            }
			
        });
		
// ====================================================================
// START: COMBINED & UPDATED WEATHER SCRIPT
// ====================================================================

// --- প্রথম আবহাওয়া সেকশনের জন্য উপাদান (OpenWeatherMap) ---
const cityInput = document.getElementById('cityInput');
const searchWeatherBtn = document.getElementById('searchWeatherBtn');
const weatherResult = document.getElementById('weatherResult');
const weatherLoading = document.getElementById('weatherLoading');
const weatherApiKey = '4a5a19a6db3c60132629d8bd29949841'; // আপনার OpenWeatherMap API কী

// --- দ্বিতীয় আবহাওয়া সেকশনের জন্য উপাদান (Open-Meteo) ---
const searchInputForecast = document.getElementById('location-search-input');
const searchButtonForecast = document.getElementById('search-weather-button');
const forecastContainer = document.getElementById('forecast-container');
const weatherSection = document.getElementById('weather-section');
const locationNameEl = document.getElementById('location-name');


// --- প্রথম সেকশনের জন্য হেল্পার ফাংশন ---
function formatTime(timestamp) {
    const date = new Date(timestamp * 1000);
    return date.toLocaleTimeString('bn-BD', {
        hour: '2-digit',
        minute: '2-digit',
        hour12: true
    });
}

// --- দ্বিতীয় সেকশনের জন্য হেল্পার ফাংশন ---
const weatherCodes = {
    0: { text: "পরিষ্কার আকাশ", icon: "☀️" }, 1: { text: "প্রধানত পরিষ্কার", icon: "🌤️" },
    2: { text: "আংশিক মেঘলা", icon: "⛅" }, 3: { text: "মেঘলা", icon: "☁️" },
    45: { text: "কুয়াশা", icon: "🌫️" }, 48: { text: "হিম কুয়াশা", icon: "🌫️" },
    51: { text: "হালকা গুঁড়ি গুঁড়ি বৃষ্টি", icon: "🌧️" }, 53: { text: "মাঝারি গুঁড়ি গুঁড়ি বৃষ্টি", icon: "🌧️" },
    55: { text: "ঘন গুঁড়ি গুঁড়ি বৃষ্টি", icon: "🌧️" }, 61: { text: "হালকা বৃষ্টি", icon: "🌧️" },
    63: { text: "মাঝারি বৃষ্টি", icon: "🌧️" }, 65: { text: "প্রবল বৃষ্টি", icon: "🌧️" },
    71: { text: "হালকা তুষারপাত", icon: "🌨️" }, 73: { text: "মাঝারি তুষারপাত", icon: "🌨️" },
    75: { text: "প্রবল তুষারপাত", icon: "🌨️" }, 77: { text: "তুষার দানা", icon: "❄️" },
    80: { text: "হালকা বৃষ্টি", icon: "🌧️" }, 81: { text: "মাঝারি বৃষ্টি", icon: "🌧️" },
    82: { text: "প্রবল বৃষ্টি", icon: "🌧️" }, 95: { text: "বজ্রপাতসহ ঝড়", icon: "⛈️" },
    96: { text: "বজ্রপাতসহ হালকা শিলাবৃষ্টি", icon: "⛈️" }, 99: { text: "বজ্রপাতসহ প্রবল শিলাবৃষ্টি", icon: "⛈️" }
};

function getBanglaDay(date) {
    const days = ['রবিবার', 'সোমবার', 'মঙ্গলবার', 'বুধবার', 'বৃহস্পতিবার', 'শুক্রবার', 'শনিবার'];
    return days[date.getDay()];
}

// --- প্রথম সেকশনের মূল ফাংশন ---
async function getWeather(city) {
    if (weatherApiKey === '') {
        weatherResult.innerHTML = '<p class="text-red-500 font-semibold">আবহাওয়া API কী সেট করা হয়নি।</p>';
        return;
    }
    weatherLoading.style.display = 'block';

    try {
        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${weatherApiKey}&units=metric&lang=bn`);
        if (!response.ok) {
            throw new Error(response.status === 404 ? 'শহরটি খুঁজে পাওয়া যায়নি।' : 'একটি সমস্যা হয়েছে।');
        }
        const data = await response.json();
        displayWeather(data);
        localStorage.setItem('lastSearchedWeatherCity', city);
    } catch (error) {
        if (weatherResult) weatherResult.innerHTML = `<p class="text-red-500 font-semibold">${error.message}</p>`;
    } finally {
        if (weatherLoading) weatherLoading.style.display = 'none';
    }
}

function displayWeather(data) {
    const { name, main, weather, wind, sys } = data;
    const iconUrl = `https://openweathermap.org/img/wn/${weather[0].icon}@4x.png`;
    if (weatherResult) {
        weatherResult.innerHTML = `
            <h4>${name}</h4>
            <img src="${iconUrl}" alt="${weather[0].description}" class="weather-icon">
            <p class="temp">${Math.round(main.temp)}&deg;C</p>
            <p class="description">${weather[0].description}</p>
            <p class="weather-feels-like"> অনুভূত হচ্ছে: ${Math.round(main.feels_like)}&deg;C</p>
            <div class="weather-extra-details">
                <div class="detail-item"><strong>সর্বোচ্চ তাপমাত্রা</strong><span>${Math.round(main.temp_max)}&deg;C</span></div>
                <div class="detail-item"><strong>সর্বনিম্ন তাপমাত্রা</strong><span>${Math.round(main.temp_min)}&deg;C</span></div>
                <div class="detail-item"><strong>আর্দ্রতা</strong><span>${main.humidity}%</span></div>
                <div class="detail-item"><strong>বাতাসের গতি</strong><span>${wind.speed.toFixed(1)} মি/সে</span></div>
                <div class="detail-item"><strong>সূর্যোদয়</strong><span>${formatTime(sys.sunrise)}</span></div>
                <div class="detail-item"><strong>সূর্যাস্ত</strong><span>${formatTime(sys.sunset)}</span></div>
            </div>
        `;
    }
}

// --- দ্বিতীয় সেকশনের মূল ফাংশন ---
async function fetchAndDisplayWeather(latitude, longitude, locationName) {
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&daily=weathercode,temperature_2m_max,temperature_2m_min&timezone=auto&forecast_days=8`;
    try {
        const response = await fetch(url);
        const data = await response.json();
        if (data.daily) {
            forecastContainer.innerHTML = '';
            locationNameEl.textContent = locationName;
            for (let i = 0; i < data.daily.time.length; i++) {
                const date = new Date(data.daily.time[i]);
                const day = i === 0 ? "আজ" : getBanglaDay(date);
                const maxTemp = Math.round(data.daily.temperature_2m_max[i]);
                const minTemp = Math.round(data.daily.temperature_2m_min[i]);
                const weatherInfo = weatherCodes[data.daily.weathercode[i]] || { text: 'তথ্য নেই', icon: '❓' };
                const cardHtml = `
                    <div class="bg-gray-700 p-4 rounded-lg text-center text-white shadow-md transform transition-transform hover:scale-105">
                        <p class="text-xl font-bold">${day}</p>
                        <p class="text-4xl my-2">${weatherInfo.icon}</p>
                        <p class="text-lg font-semibold">${weatherInfo.text}</p>
                        <p class="text-sm">সর্বোচ্চ: ${maxTemp}°C</p>
                        <p class="text-sm">সর্বনিম্ন: ${minTemp}°C</p>
                    </div>`;
                forecastContainer.innerHTML += cardHtml;
            }
            weatherSection.classList.remove('hidden');
        }
    } catch (error) {
        console.error('Forecast data error:', error);
    }
}

async function searchLocation(locationName) {
    const geocodingUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(locationName)}&count=1&language=bn`;
    try {
        const response = await fetch(geocodingUrl);
        const data = await response.json();
        if (data.results && data.results.length > 0) {
            const firstResult = data.results[0];
            fetchAndDisplayWeather(firstResult.latitude, firstResult.longitude, firstResult.name);
            localStorage.setItem('lastSearchedWeatherLocation', locationName);
        } else {
            locationNameEl.textContent = 'অবস্থান খুঁজে পাওয়া যায়নি।';
        }
    } catch (error) {
        console.error('Location search error:', error);
        locationNameEl.textContent = 'অবস্থান অনুসন্ধানের সময় একটি ত্রুটি হয়েছে।';
    }
}

// --- DOMContentLoaded: ইভেন্ট লিসেনার এবং অটো-রিফ্রেশ সেটআপ ---
document.addEventListener('DOMContentLoaded', () => {
    // প্রথম সেকশনের ইভেন্ট লিসেনার
    if (searchWeatherBtn) {
        searchWeatherBtn.addEventListener('click', () => {
            const city = cityInput.value.trim();
            if (city) getWeather(city);
            else showCustomAlert('অনুগ্রহ করে একটি শহরের নাম লিখুন।');
        });
    }
    if (cityInput) {
        cityInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter') searchWeatherBtn.click();
        });
    }

    // দ্বিতীয় সেকশনের ইভেন্ট লিসেনার
    if (searchButtonForecast) {
        searchButtonForecast.addEventListener('click', () => {
            const location = searchInputForecast.value.trim();
            if (location) searchLocation(location);
        });
    }
    if (searchInputForecast) {
        searchInputForecast.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const location = searchInputForecast.value.trim();
                if (location) searchLocation(location);
            }
        });
    }

    // পেজ লোড হলে সর্বশেষ সার্চ করা শহরগুলো লোড করা
    const savedCity1 = localStorage.getItem('lastSearchedWeatherCity');
    if (savedCity1 && cityInput) {
        cityInput.value = savedCity1;
        getWeather(savedCity1);
    }
    const savedCity2 = localStorage.getItem('lastSearchedWeatherLocation') || 'Dhaka';
    if (searchInputForecast) searchInputForecast.value = savedCity2;
    searchLocation(savedCity2);

    // *** নতুন: প্রতি মিনিটে ডেটা রিফ্রেশ করার জন্য setInterval ***
    setInterval(() => {
        console.log("Refreshing weather data...");
        // প্রথম সেকশন রিফ্রেশ করুন
        const lastCity1 = localStorage.getItem('lastSearchedWeatherCity');
        if (lastCity1) {
            console.log(`Refreshing weather for ${lastCity1}...`);
            // ডেটা আনার সময় লোডার দেখানোর জন্য weatherResult খালি করা হচ্ছে
            if(weatherResult) weatherResult.innerHTML = '';
            getWeather(lastCity1);
        }

        // দ্বিতীয় সেকশন রিফ্রেশ করুন
        const lastCity2 = localStorage.getItem('lastSearchedWeatherLocation');
        if (lastCity2) {
            console.log(`Refreshing forecast for ${lastCity2}...`);
            searchLocation(lastCity2);
        }
    }, 60000); // 60000 মিলিসেকেন্ড = 1 মিনিট
});

// ====================================================================
// END: COMBINED & UPDATED WEATHER SCRIPT
// ====================================================================

// ====================================================================
// START: RAPID UNDO/REDO ON HOLD SCRIPT (নতুন যুক্ত করা হয়েছে)
// ====================================================================

/**
 * বাটন চেপে ধরে রাখলে দ্রুত কাজ করার ফাংশন সেটআপ করে।
 * @param {string} buttonId - বাটনের আইডি।
 * @param {function} actionFunction - যে ফাংশনটি বারবার কল করা হবে (যেমন: undoText)।
 * @param {string} textareaId - যে টেক্সটএরিয়ার ওপর কাজটি হবে।
 */
function setupHoldableButton(buttonId, actionFunction, textareaId) {
    const button = document.getElementById(buttonId);
    if (!button) return;

    let holdTimeoutId = null;
    let repeatIntervalId = null;

    const startRepeating = () => {
        // আগের কোনো ইন্টারভ্যাল থাকলে তা পরিষ্কার করুন
        if (repeatIntervalId) clearInterval(repeatIntervalId);
        
        // কাজটি রিপিট করা শুরু করুন
        repeatIntervalId = setInterval(() => {
            actionFunction(textareaId);
            // যদি বাটনটি নিষ্ক্রিয় হয়ে যায়, তাহলে রিপিট করা বন্ধ করুন
            if (button.disabled) {
                stopRepeating();
            }
        }, 120); // প্রতি 120 মিলিসেকেন্ডে কাজটি রিপিট করুন
    };

    const stopRepeating = () => {
        clearTimeout(holdTimeoutId);
        clearInterval(repeatIntervalId);
        holdTimeoutId = null;
        repeatIntervalId = null;
    };

    const handlePress = (e) => {
        // টেক্সট সিলেকশন বা অন্যান্য ডিফল্ট আচরণ বন্ধ করুন
        if (e.cancelable) {
            e.preventDefault();
        }

        // প্রেস করার সাথে সাথে একবার কাজটি করুন
        actionFunction(textareaId);
        
        // একটি নির্দিষ্ট সময় পর কাজটি রিপিট করা শুরু করুন
        holdTimeoutId = setTimeout(startRepeating, 400); // 400ms পর রিপিট শুরু হবে
    };

    // মাউসের জন্য ইভেন্ট লিসেনার
    button.addEventListener('mousedown', handlePress);
    button.addEventListener('mouseup', stopRepeating);
    button.addEventListener('mouseleave', stopRepeating);
    
    // মোবাইলের টাচ ইভেন্টের জন্য লিসেনার
    button.addEventListener('touchstart', handlePress, { passive: false });
    button.addEventListener('touchend', stopRepeating);
    button.addEventListener('touchcancel', stopRepeating);
}

// DOMContentLoaded এর মধ্যে এই সেটআপ ফাংশনগুলো কল করুন যাতে বাটনগুলো লোড হওয়ার পর ইভেন্ট যুক্ত হয়।
document.addEventListener('DOMContentLoaded', () => {
    setupHoldableButton('undoButtonLeft', undoText, 'textAreaLeft');
    setupHoldableButton('redoButtonLeft', redoText, 'textAreaLeft');
    setupHoldableButton('undoButtonRight', undoText, 'textAreaRight');
    setupHoldableButton('redoButtonRight', redoText, 'textAreaRight');
});

// ====================================================================
// END: RAPID UNDO/REDO ON HOLD SCRIPT
// ====================================================================

// ====================================================================
// START: PLAYER TAB SCRIPT
// ====================================================================
function initializePlayerTab() {
    // অডিও এলিমেন্ট
    const audioInput = document.getElementById('audioInput');
    const audioPlayer = document.getElementById('audioPlayer');
    const audioFileName = document.getElementById('audioFileName');
    const audioDropZone = audioInput?.closest('.player-section');

    // ছবি এলিমেন্ট
    const imageInput = document.getElementById('imageInput');
    const imagePreview = document.getElementById('imagePreview');
    const imageDropZone = imageInput?.closest('.player-section');

    // ভিডিও এলিমেন্ট
    const videoInput = document.getElementById('videoInput');
    const videoPlayer = document.getElementById('videoPlayer');
    const videoDropZone = videoInput?.closest('.player-section');

    // --- ফাইল হ্যান্ডেল করার ফাংশন ---
    function handleAudioFile(file) {
        if (!file || !audioPlayer || !audioFileName) return;
        const objectURL = URL.createObjectURL(file);
        audioPlayer.src = objectURL;
        audioPlayer.play();
        audioFileName.textContent = file.name;
        const revoke = () => URL.revokeObjectURL(objectURL);
        audioPlayer.onended = revoke;
        audioPlayer.onerror = revoke;
    }

    function handleImageFile(file) {
        if (!file || !imagePreview) return;
        const objectURL = URL.createObjectURL(file);
        imagePreview.src = objectURL;
        const revoke = () => URL.revokeObjectURL(objectURL);
        imagePreview.onload = revoke;
        imagePreview.onerror = revoke;
    }

    function handleVideoFile(file) {
        if (!file || !videoPlayer) return;
        const objectURL = URL.createObjectURL(file);
        videoPlayer.src = objectURL;
        videoPlayer.play();
        const revoke = () => URL.revokeObjectURL(objectURL);
        videoPlayer.onended = revoke;
        videoPlayer.onerror = revoke;
    }

    // --- ড্র্যাগ অ্যান্ড ড্রপ সেটআপ ফাংশন ---
    function setupDragAndDrop(dropZone, acceptedFileType, fileHandler) {
        if (!dropZone) return;

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, e => {
                e.preventDefault();
                e.stopPropagation();
            }, false);
        });

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => dropZone.classList.add('drag-over'), false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => dropZone.classList.remove('drag-over'), false);
        });

        dropZone.addEventListener('drop', e => {
            const file = e.dataTransfer?.files[0];
            if (file) {
                if (file.type.startsWith(acceptedFileType)) {
                    fileHandler(file);
                } else {
                    showCustomAlert(`অনুগ্রহ করে একটি ${acceptedFileType.split('/')[0]} ফাইল ড্রপ করুন।`);
                }
            }
        }, false);
    }

    // --- ইভেন্ট লিসেনার যুক্ত করুন ---

    // ফাইল ইনপুট লিসেনার
    if (audioInput) {
        audioInput.addEventListener('change', e => handleAudioFile(e.target.files[0]));
    }
    if (imageInput) {
        imageInput.addEventListener('change', e => handleImageFile(e.target.files[0]));
    }
    if (videoInput) {
        videoInput.addEventListener('change', e => handleVideoFile(e.target.files[0]));
    }

    // নতুন: লুপ টগল লিসেনার
    if (audioLoopToggle && audioPlayer) {
        audioLoopToggle.addEventListener('change', () => {
            audioPlayer.loop = audioLoopToggle.checked;
        });
    }

    if (videoLoopToggle && videoPlayer) {
        videoLoopToggle.addEventListener('change', () => {
            videoPlayer.loop = videoLoopToggle.checked;
        });
    }

    // ড্র্যাগ অ্যান্ড ড্রপ লিসেনার
    setupDragAndDrop(audioDropZone, 'audio/', handleAudioFile);
    setupDragAndDrop(imageDropZone, 'image/', handleImageFile);
    setupDragAndDrop(videoDropZone, 'video/', handleVideoFile);
}

// যখন প্লেয়ার ট্যাবটি দেখানো হবে তখন ফাংশনটি কল করুন
document.addEventListener('DOMContentLoaded', () => {
    // যদি ট্যাবটি ডিফল্টভাবে সক্রিয় থাকে
    if (document.getElementById('playerContent')?.classList.contains('active')) {
        initializePlayerTab();
    }
    // অথবা যখন ট্যাবে ক্লিক করা হয়
    document.getElementById('playerTab')?.addEventListener('click', initializePlayerTab);
});
// ====================================================================
// END: PLAYER TAB SCRIPT
// ====================================================================

// ====================================================================
// START: QR CODE GENERATOR SCRIPT (Updated with Live Generation & Unicode Fix)
// এই ব্লকের কোডটি আপনার HTML ফাইলের পুরনো QR কোড স্ক্রিপ্ট ব্লকটির জায়গায় সম্পূর্ণরূপে প্রতিস্থাপন করুন।
// ====================================================================
document.addEventListener('DOMContentLoaded', () => {
    const qrContent = document.getElementById('qrCodeContent');
    if (!qrContent) return; // যদি ট্যাবের কন্টেন্ট না থাকে, তবে কিছুই করবেন না।

    const qrInput = document.getElementById('qrInput');
    const downloadQrBtn = document.getElementById('downloadQrBtn');
    const clearQrBtn = document.getElementById('clearQrBtn');
    const qrcodeContainer = document.getElementById('qrcode');
    const qrcodePlaceholder = document.getElementById('qrcode-placeholder');
    const qrFileInput = document.getElementById('qrFileInput');
    const dropZone = document.querySelector('.qr-code-content'); // QR সেকশনের প্রধান কন্টেইনার

    let qrCodeInstance = null;
    let debounceTimer; // লাইভ আপডেটের জন্য টাইমার

// QR কোড তৈরি করার ফাংশন (লাইভ এবং ইউনিকোড সাপোর্টেড)
const generateQRCode = () => {
    // পরিবর্তন: .trim() সরিয়ে দেওয়া হয়েছে যাতে ব্যবহারকারী চাইলে স্পেসসহ কোড তৈরি করতে পারে।
    const text = qrInput.value;

    // যদি ইনপুট খালি থাকে, তাহলে QR কোড এরিয়া রিসেট করুন
    if (!text) {
        resetQrCodeArea();
        return;
    }

    if (qrcodeContainer) qrcodeContainer.innerHTML = '';
    if (qrcodePlaceholder) qrcodePlaceholder.style.display = 'none';

    try {
        // মূল পরিবর্তন: এখানে encodeURIComponent ব্যবহার করা হয়নি।
        // লাইব্রেরীটি সরাসরি বাংলাসহ যেকোনো UTF-8 টেক্সট হ্যান্ডেল করতে পারে।
        qrCodeInstance = new QRCode(qrcodeContainer, {
            text: text, // সরাসরি মূল টেক্সট ব্যবহার করা হয়েছে
            width: 256,
            height: 256,
            colorDark: "#000000",
            colorLight: "#ffffff",
            // পরিবর্তন: Error Correction Level 'H' (High) থেকে 'L' (Low) করা হয়েছে।
            // এর ফলে একই পরিমাণ ডেটার জন্য QR কোডটি কম ঘন (অল্পসংখ্যক দাগ) হবে।
            // এটি বাংলাসহ যেকোনো ভাষার জন্য কাজ করবে।
            correctLevel: QRCode.CorrectLevel.L
        });
        if (downloadQrBtn) downloadQrBtn.disabled = false;
    } catch (error) {
        console.error("QR Code generation error:", error);
        showCustomAlert("কিউআর কোড তৈরিতে একটি সমস্যা হয়েছে।");
        resetQrCodeArea();
    }
};

    // QR কোড ডাউনলোড করার ফাংশন
    const downloadQRCode = () => {
        if (!qrcodeContainer) return;
        const canvas = qrcodeContainer.querySelector('canvas');
        if (!canvas) {
            showCustomAlert('ডাউনলোড করার জন্য কোনো কিউআর কোড নেই।');
            return;
        }

        const dataUrl = canvas.toDataURL('image/png');
        const link = document.createElement('a');
        link.href = dataUrl;
        link.download = 'qrcode.png';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    };

    // ইনপুট এবং ফলাফল পরিষ্কার করার ফাংশন
    const resetQrCodeArea = () => {
        if (qrInput) qrInput.value = '';
        if (qrcodeContainer) qrcodeContainer.innerHTML = '';
        if (qrcodePlaceholder) qrcodePlaceholder.style.display = 'flex';
        if (downloadQrBtn) downloadQrBtn.disabled = true;
        qrCodeInstance = null;
    };

    // আপলোড বা ড্রপ করা ফাইল হ্যান্ডেল করার ফাংশন
    const handleQrFile = (file) => {
        if (!file || !file.type.startsWith('image/')) {
            showCustomAlert('অনুগ্রহ করে একটি ছবি ফাইল নির্বাচন করুন।');
            return;
        }

        const reader = new FileReader();
        reader.onload = function(event) {
            const img = new Image();
            img.onload = function() {
                const canvas = document.createElement('canvas');
                const context = canvas.getContext('2d', { willReadFrequently: true });
                canvas.width = img.width;
                canvas.height = img.height;
                context.drawImage(img, 0, 0, img.width, img.height);
                const imageData = context.getImageData(0, 0, img.width, img.height);
                const code = jsQR(imageData.data, imageData.width, imageData.height);

                if (code) {
                    // QR কোড থেকে পাওয়া ডেটা সরাসরি টেক্সটবক্সে দেখানো হচ্ছে।
                    if (qrInput) qrInput.value = code.data;
                    showCustomAlert('QR কোড থেকে তথ্য পাওয়া গেছে!');
                    generateQRCode(); // তথ্য পাওয়ার পর সাথে সাথে নতুন QR কোড তৈরি করা হচ্ছে
                } else {
                    showCustomAlert('দুঃখিত, কোনো QR কোড খুঁজে পাওয়া যায়নি।');
                }
            };
            img.src = event.target.result;
        };
        reader.readAsDataURL(file);
    };

    // --- নতুন: লাইভ আপডেটের জন্য ইভেন্ট লিসেনার ---
    if (qrInput) {
        qrInput.addEventListener('input', () => {
            clearTimeout(debounceTimer);
            // ব্যবহারকারী টাইপ থামানোর ৩০০ মিলিসেকেন্ড পর QR কোড তৈরি হবে
            debounceTimer = setTimeout(() => {
                generateQRCode();
            }, 300);
        });
    }

    // বাটনগুলোর জন্য ইভেন্ট লিসেনার
    if (downloadQrBtn) downloadQrBtn.addEventListener('click', downloadQRCode);
    if (clearQrBtn) {
        clearQrBtn.addEventListener('click', () => {
            resetQrCodeArea();
            showCustomAlert('ইনপুট এবং কিউআর কোড পরিষ্কার করা হয়েছে।');
        });
    }

    // ফাইল আপলোডের জন্য ইভেন্ট লিসেনার
    if (qrFileInput) {
        qrFileInput.addEventListener('change', (e) => {
            handleQrFile(e.target.files[0]);
            e.target.value = ''; // একই ফাইল আবার আপলোড করার জন্য ইনপুট রিসেট করুন
        });
    }
    
    // --- ড্র্যাগ অ্যান্ড ড্রপ ইভেন্ট লিসেনার ---
    if (dropZone) {
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, (e) => {
                e.preventDefault();
                e.stopPropagation();
            }, false);
        });
        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => dropZone.classList.add('drag-over'), false);
        });
        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, () => dropZone.classList.remove('drag-over'), false);
        });
        dropZone.addEventListener('drop', (e) => {
            handleQrFile(e.dataTransfer.files[0]);
        }, false);
    }
});
// ====================================================================
// END: QR CODE GENERATOR SCRIPT
// ====================================================================

// ====================================================================
// START: EMERGENCY NUMBERS SCRIPT
// ====================================================================

function initializeEmergencyNumbers() {
    const locationSelect = document.getElementById('location-select');
    const numbersDisplay = document.getElementById('emergency-numbers-display');

    const districtNameMap = {
        "national": "জাতীয় জরুরি সেবা", "Bagerhat": "বাগেরহাট", "Bandarban": "বান্দরবান", "Barguna": "বরগুনা", "Barisal": "বরিশাল", "Bhola": "ভোলা", "Bogra": "বগুড়া", "Brahmanbaria": "ব্রাহ্মণবাড়িয়া", "Chandpur": "চাঁদপুর", "Chapai Nawabganj": "চাঁপাইনবাবগঞ্জ", "Chittagong": "চট্টগ্রাম", "Chuadanga": "চুয়াডাঙ্গা", "Comilla": "কুমিল্লা", "Cox's Bazar": "কক্সবাজার", "Dhaka": "ঢাকা", "Dinajpur": "দিনাজপুর", "Faridpur": "ফরিদপুর", "Feni": "ফেনী", "Gaibandha": "গাইবান্ধা", "Gazipur": "গাজীপুর", "Gopalganj": "গোপালগঞ্জ", "Habiganj": "হবিগঞ্জ", "Jamalpur": "জামালপুর", "Jessore": "যশোর", "Jhalokati": "ঝালকাঠি", "Jhenaidah": "ঝিনাইদহ", "Joypurhat": "জয়পুরহাট", "Khagrachhari": "খাগড়াছড়ি", "Khulna": "খুলনা", "Kishoreganj": "কিশোরগঞ্জ", "Kurigram": "কুড়িগ্রাম", "Kushtia": "কুষ্টিয়া", "Lakshmipur": "লক্ষ্মীপুর", "Lalmonirhat": "লালমনিরহাট", "Madaripur": "মাদারীপুর", "Magura": "মাগুরা", "Manikganj": "মানিকগঞ্জ", "Meherpur": "মেহেরপুর", "Moulvibazar": "মৌলভীবাজার", "Munshiganj": "মুন্সিগঞ্জ", "Mymensingh": "ময়মনসিংহ", "Naogaon": "নওগাঁ", "Narail": "নড়াইল", "Narayanganj": "নারায়ণগঞ্জ", "Narsingdi": "নরসিংদী", "Natore": "নাটোর", "Netrokona": "নেত্রকোনা", "Nilphamari": "নীলফামারী", "Noakhali": "নোয়াখালী", "Pabna": "পাবনা", "Panchagarh": "পঞ্চগড়", "Patuakhali": "পটুয়াখালী", "Pirojpur": "পিরোজপুর", "Rajbari": "রাজবাড়ী", "Rajshahi": "রাজশাহী", "Rangamati": "রাঙ্গামাটি", "Rangpur": "রংপুর", "Satkhira": "সাতক্ষীরা", "Shariatpur": "শরীয়তপুর", "Sherpur": "শেরপুর", "Sirajganj": "সিরাজগঞ্জ", "Sunamganj": "সুনামগঞ্জ", "Sylhet": "সিলেট", "Tangail": "টাঙ্গাইল", "Thakurgaon": "ঠাকুরগাঁও"
    };

    const emergencyNumbersData = {
        "national": [
            { name: "জাতীয় জরুরি সেবা", number: "999" }, { name: "নারী ও শিশু নির্যাতন প্রতিরোধ", number: "109" }, { name: "শিশু সহায়তা", number: "1098" }, { name: "সরকারি আইন সেবা", number: "16430" }, { name: "দুর্নীতি দমন কমিশন", number: "106" }, { name: "স্বাস্থ্য বাতায়ন", number: "16263" }, { name: "দুর্যোগের আগাম বার্তা", number: "1090" }, { name: "বাংলাদেশ ব্যাংক", number: "16236" },
        ],
        "Gaibandha": [
            { name: "পুলিশ সুপার, গাইবান্ধা", number: "01320132500" }, { name: "ফায়ার সার্ভিস, গাইবান্ধা", number: "0541-62222" }, { name: "সদর হাসপাতাল, গাইবান্ধা", number: "+88054161400" }, { name: "সিভিল সার্জন, গাইবান্ধা", number: "01730324729" }, { name: "অ্যাম্বুলেন্স, সদর হাসপাতাল", number: "01730324765" }, { name: "গাইবান্ধা পল্লী বিদ্যুৎ", number: "01769403505" },
        ],
        "Dhaka": [
            { name: "ডিএমপি কন্ট্রোল রুম", number: "01320-042000" }, { name: "ফায়ার সার্ভিস হেডকোয়ার্টার", number: "02-223355555" }, { name: "ঢাকা মেডিকেল কলেজ হাসপাতাল", number: "+880-2-55165000" }, { name: "বঙ্গবন্ধু শেখ মুজিব মেডিকেল বিশ্ববিদ্যালয়", number: "+880-2-55165760" }, { name: "ঢাকা বিদ্যুৎ বিতরণ কর্তৃপক্ষ", number: "16116" },
        ],
        // ... (অন্যান্য জেলার ডাটা এখানে থাকবে)
        "Bagerhat": [{ name: "পুলিশ সুপার, বাগেরহাট", number: "01320142100" }, { name: "ফায়ার সার্ভিস, বাগেরহাট", number: "02-47772222" }, { name: "সদর হাসপাতাল, বাগেরহাট", number: "+88046863232" }], "Bandarban": [{ name: "পুলিশ সুপার, বান্দরবান", number: "01320142200" }, { name: "ফায়ার সার্ভিস, বান্দরবান", number: "0361-62555" }, { name: "সদর হাসপাতাল, বান্দরবান", number: "+88036162544" }], "Barguna": [{ name: "পুলিশ সুপার, বরগুনা", number: "01320142300" }, { name: "ফায়ার সার্ভিস, বরগুনা", number: "0448-62444" }, { name: "সদর হাসপাতাল, বরগুনা", number: "+88044862234" }], "Barisal": [{ name: "পুলিশ সুপার, বরিশাল", number: "01320142400" }, { name: "ফায়ার সার্ভিস, বরিশাল", number: "0431-63888" }, { name: "শের-ই-বাংলা মেডিকেল কলেজ হাসপাতাল", number: "+880431-2173314" }], "Bhola": [{ name: "পুলিশ সুপার, ভোলা", number: "01320142600" }, { name: "ফায়ার সার্ভিস, ভোলা", number: "0491-61333" }, { name: "সদর হাসপাতাল, ভোলা", number: "+88049161291" }], "Bogra": [{ name: "পুলিশ সুপার, বগুড়া", number: "01320132900" }, { name: "ফায়ার সার্ভিস, বগুড়া", number: "051-65555" }, { name: "শহীদ জিয়াউর রহমান মেডিকেল কলেজ", number: "+88051-78701" }], "Brahmanbaria": [{ name: "পুলিশ সুপার, ব্রাহ্মণবাড়িয়া", number: "01320133200" }, { name: "ফায়ার সার্ভিস, ব্রাহ্মণবাড়িয়া", number: "0851-61444" }, { name: "সদর হাসপাতাল, ব্রাহ্মণবাড়িয়া", number: "+88085158494" }], "Chandpur": [{ name: "পুলিশ সুপার, চাঁদপুর", number: "01320133400" }, { name: "ফায়ার সার্ভিস, চাঁদপুর", number: "0841-63333" }, { name: "সদর হাসপাতাল, চাঁদপুর", number: "+88084163497" }], "Chapai Nawabganj": [{ name: "পুলিশ সুপার, চাঁপাইনবাবগঞ্জ", number: "01320133500" }, { name: "ফায়ার সার্ভিস, চাঁপাইনবাবগঞ্জ", number: "0781-52333" }, { name: "সদর হাসপাতাল, চাঁপাইনবাবগঞ্জ", number: "+88078152341" }], "Chittagong": [{ name: "সিএমপি কন্ট্রোল রুম", number: "01676-123123" }, { name: "ফায়ার সার্ভিস, আগ্রাবাদ", number: "031-634444" }, { name: "চট্টগ্রাম মেডিকেল কলেজ হাসপাতাল", number: "+88031619620" }], "Chuadanga": [{ name: "পুলিশ সুপার, চুয়াডাঙ্গা", number: "01320143000" }, { name: "ফায়ার সার্ভিস, চুয়াডাঙ্গা", number: "0761-62333" }, { name: "সদর হাসপাতাল, চুয়াডাঙ্গা", number: "+88076162312" }], "Comilla": [{ name: "পুলিশ সুপার, কুমিল্লা", number: "01320134000" }, { name: "ফায়ার সার্ভিস, কুমিল্লা", number: "081-76333" }, { name: "কুমিল্লা মেডিকেল কলেজ হাসপাতাল", number: "+8808168788" }], "Cox's Bazar": [{ name: "পুলিশ সুপার, কক্সবাজার", number: "01320134300" }, { name: "ফায়ার সার্ভিস, কক্সবাজার", number: "0341-64333" }, { name: "সদর হাসপাতাল, কক্সবাজার", number: "+88034164222" }], "Dinajpur": [{ name: "পুলিশ সুপার, দিনাজপুর", number: "01320134800" }, { name: "ফায়ার সার্ভিস, দিনাজপুর", number: "0531-64444" }, { name: "এম আব্দুর রহিম মেডিকেল কলেজ হাসপাতাল", number: "+88053163152" }], "Faridpur": [{ name: "পুলিশ সুপার, ফরিদপুর", number: "01320135100" }, { name: "ফায়ার সার্ভিস, ফরিদপুর", number: "0631-63333" }, { name: "বঙ্গবন্ধু শেখ মুজিব মেডিকেল কলেজ", number: "+88063162758" }], "Feni": [{ name: "পুলিশ সুপার, ফেনী", number: "01320135300" }, { name: "ফায়ার সার্ভিস, ফেনী", number: "0331-63333" }, { name: "সদর হাসপাতাল, ফেনী", number: "+88033162000" }], "Gazipur": [{ name: "জিএমপি কন্ট্রোল রুম", number: "01320042000" }, { name: "ফায়ার সার্ভিস, গাজীপুর", number: "02-9263333" }, { name: "শহীদ তাজউদ্দীন আহমদ মেডিকেল কলেজ", number: "+88029263004" }], "Gopalganj": [{ name: "পুলিশ সুপার, গোপালগঞ্জ", number: "01320135800" }, { name: "ফায়ার সার্ভিস, গোপালগঞ্জ", number: "0668-61333" }, { name: "সদর হাসপাতাল, গোপালগঞ্জ", number: "+88066861250" }], "Habiganj": [{ name: "পুলিশ সুপার, হবিগঞ্জ", number: "01320136000" }, { name: "ফায়ার সার্ভিস, হবিগঞ্জ", number: "0831-64444" }, { name: "সদর হাসপাতাল, হবিগঞ্জ", number: "+88083162094" }], "Jamalpur": [{ name: "পুলিশ সুপার, জামালপুর", number: "01320136200" }, { name: "ফায়ার সার্ভিস, জামালপুর", number: "0981-63333" }, { name: "সদর হাসপাতাল, জামালপুর", number: "+88098163450" }], "Jessore": [{ name: "পুলিশ সুপার, যশোর", number: "01320143400" }, { name: "ফায়ার সার্ভিস, যশোর", number: "0421-68888" }, { name: "সদর হাসপাতাল, যশোর", number: "+88042165215" }], "Jhalokati": [{ name: "পুলিশ সুপার, ঝালকাঠি", number: "01320142800" }, { name: "ফায়ার সার্ভিস, ঝালকাঠি", number: "0498-63333" }, { name: "সদর হাসপাতাল, ঝালকাঠি", number: "+88049863453" }], "Jhenaidah": [{ name: "পুলিশ সুপার, ঝিনাইদহ", number: "01320143700" }, { name: "ফায়ার সার্ভিস, ঝিনাইদহ", number: "0451-62333" }, { name: "সদর হাসপাতাল, ঝিনাইদহ", number: "+88045162300" }], "Joypurhat": [{ name: "পুলিশ সুপার, জয়পুরহাট", number: "01320136400" }, { name: "ফায়ার সার্ভিস, জয়পুরহাট", number: "0571-62333" }, { name: "সদর হাসপাতাল, জয়পুরহাট", number: "+88057162241" }], "Khagrachhari": [{ name: "পুলিশ সুপার, খাগড়াছড়ি", number: "01320136600" }, { name: "ফায়ার সার্ভিস, খাগড়াছড়ি", number: "0371-61555" }, { name: "সদর হাসপাতাল, খাগড়াছড়ি", number: "+88037161828" }], "Khulna": [{ name: "কেএমপি কন্ট্রোল রুম", number: "01320-043100" }, { name: "ফায়ার সার্ভিস, খুলনা", number: "041-762222" }, { name: "খুলনা মেডিকেল কলেজ হাসপাতাল", number: "+88041761699" }], "Kishoreganj": [{ name: "পুলিশ সুপার, কিশোরগঞ্জ", number: "01320136800" }, { name: "ফায়ার সার্ভিস, কিশোরগঞ্জ", number: "0941-61999" }, { name: "সদর হাসপাতাল, কিশোরগঞ্জ", number: "+88094161962" }], "Kurigram": [{ name: "পুলিশ সুপার, কুড়িগ্রাম", number: "01320137000" }, { name: "ফায়ার সার্ভিস, কুড়িগ্রাম", number: "0581-61666" }, { name: "সদর হাসপাতাল, কুড়িগ্রাম", number: "+88058161541" }], "Kushtia": [{ name: "পুলিশ সুপার, কুষ্টিয়া", number: "01320144200" }, { name: "ফায়ার সার্ভিস, কুষ্টিয়া", number: "071-62222" }, { name: "সদর হাসপাতাল, কুষ্টিয়া", number: "+8807162339" }], "Lakshmipur": [{ name: "পুলিশ সুপার, লক্ষ্মীপুর", number: "01320137300" }, { name: "ফায়ার সার্ভিস, লক্ষ্মীপুর", number: "0381-61444" }, { name: "সদর হাসপাতাল, লক্ষ্মীপুর", number: "+88038161350" }], "Lalmonirhat": [{ name: "পুলিশ সুপার, লালমনিরহাট", number: "01320137500" }, { name: "ফায়ার সার্ভিস, লালমনিরহাট", number: "0591-61333" }, { name: "সদর হাসপাতাল, লালমনিরহাট", number: "+88059161300" }], "Madaripur": [{ name: "পুলিশ সুপার, মাদারীপুর", number: "01320137700" }, { name: "ফায়ার সার্ভিস, মাদারীপুর", number: "0661-61777" }, { name: "সদর হাসপাতাল, মাদারীপুর", number: "+88066161835" }], "Magura": [{ name: "পুলিশ সুপার, মাগুরা", number: "01320144400" }, { name: "ফায়ার সার্ভিস, মাগুরা", number: "0488-62444" }, { name: "সদর হাসপাতাল, মাগুরা", number: "+88048862441" }], "Manikganj": [{ name: "পুলিশ সুপার, মানিকগঞ্জ", number: "01320137900" }, { name: "ফায়ার সার্ভিস, মানিকগঞ্জ", number: "02-7710333" }, { name: "সদর হাসপাতাল, মানিকগঞ্জ", number: "+88027710202" }], "Meherpur": [{ name: "পুলিশ সুপার, মেহেরপুর", number: "01320144600" }, { name: "ফায়ার সার্ভিস, মেহেরপুর", number: "0791-62333" }, { name: "সদর হাসপাতাল, মেহেরপুর", number: "+88079162234" }], "Moulvibazar": [{ name: "পুলিশ সুপার, মৌলভীবাজার", number: "01320138100" }, { name: "ফায়ার সার্ভিস, মৌলভীবাজার", number: "0861-52333" }, { name: "সদর হাসপাতাল, মৌলভীবাজার", number: "+88086152285" }], "Munshiganj": [{ name: "পুলিশ সুপার, মুন্সিগঞ্জ", number: "01320138300" }, { name: "ফায়ার সার্ভিস, মুন্সিগঞ্জ", number: "02-7612222" }, { name: "সদর হাসপাতাল, মুন্সিগঞ্জ", number: "+88027612140" }], "Mymensingh": [{ name: "পুলিশ সুপার, ময়মনসিংহ", number: "01320138500" }, { name: "ফায়ার সার্ভিস, ময়মনসিংহ", number: "091-65555" }, { name: "ময়মনসিংহ মেডিকেল কলেজ হাসপাতাল", number: "+8809166060" }], "Naogaon": [{ name: "পুলিশ সুপার, নওগাঁ", number: "01320138800" }, { name: "ফায়ার সার্ভিস, নওগাঁ", number: "0741-62333" }, { name: "সদর হাসপাতাল, নওগাঁ", number: "+88074162351" }], "Narail": [{ name: "পুলিশ সুপার, নড়াইল", number: "01320144800" }, { name: "ফায়ার সার্ভিস, নড়াইল", number: "0481-62444" }, { name: "সদর হাসপাতাল, নড়াইল", number: "+88048162268" }], "Narayanganj": [{ name: "পুলিশ সুপার, নারায়ণগঞ্জ", number: "01320139000" }, { name: "ফায়ার সার্ভিস, নারায়ণগঞ্জ", number: "02-7647333" }, { name: "সদর হাসপাতাল, নারায়ণগঞ্জ", number: "+88027649501" }], "Narsingdi": [{ name: "পুলিশ সুপার, নরসিংদী", number: "01320139200" }, { name: "ফায়ার সার্ভিস, নরসিংদী", number: "02-9462333" }, { name: "সদর হাসপাতাল, নরসিংদী", number: "+88029462270" }], "Natore": [{ name: "পুলিশ সুপার, নাটোর", number: "01320139400" }, { name: "ফায়ার সার্ভিস, নাটোর", number: "0771-66333" }, { name: "সদর হাসপাতাল, নাটোর", number: "+88077166556" }], "Netrokona": [{ name: "পুলিশ সুপার, নেত্রকোনা", number: "01320139600" }, { name: "ফায়ার সার্ভিস, নেত্রকোনা", number: "0951-61444" }, { name: "সদর হাসপাতাল, নেত্রকোনা", number: "+88095161560" }], "Nilphamari": [{ name: "পুলিশ সুপার, নীলফামারী", number: "01320139800" }, { name: "ফায়ার সার্ভিস, নীলফামারী", number: "0551-61444" }, { name: "সদর হাসপাতাল, নীলফামারী", number: "+88055161300" }], "Noakhali": [{ name: "পুলিশ সুপার, নোয়াখালী", number: "01320140000" }, { name: "ফায়ার সার্ভিস, নোয়াখালী", number: "0321-62222" }, { name: "আব্দুল মালেক উকিল মেডিকেল কলেজ", number: "+88032161217" }], "Pabna": [{ name: "পুলিশ সুপার, পাবনা", number: "01320140300" }, { name: "ফায়ার সার্ভিস, পাবনা", number: "0731-66000" }, { name: "সদর হাসপাতাল, পাবনা", number: "+88073165354" }], "Panchagarh": [{ name: "পুলিশ সুপার, পঞ্চগড়", number: "01320140500" }, { name: "ফায়ার সার্ভিস, পঞ্চগড়", number: "0568-61333" }, { name: "সদর হাসপাতাল, পঞ্চগড়", number: "+88056861250" }], "Patuakhali": [{ name: "পুলিশ সুপার, পটুয়াখালী", number: "01320145000" }, { name: "ফায়ার সার্ভিস, পটুয়াখালী", number: "0441-62333" }, { name: "সদর হাসপাতাল, পটুয়াখালী", number: "+88044162483" }], "Pirojpur": [{ name: "পুলিশ সুপার, পিরোজপুর", number: "01320145200" }, { name: "ফায়ার সার্ভিস, পিরোজপুর", number: "0461-62444" }, { name: "সদর হাসপাতাল, পিরোজপুর", number: "+88046162350" }], "Rajbari": [{ name: "পুলিশ সুপার, রাজবাড়ী", number: "01320140700" }, { name: "ফায়ার সার্ভিস, রাজবাড়ী", number: "0641-65333" }, { name: "সদর হাসপাতাল, রাজবাড়ী", number: "+88064165561" }], "Rajshahi": [{ name: "আরএমপি কন্ট্রোল রুম", number: "01320-041000" }, { name: "ফায়ার সার্ভিস, রাজশাহী", number: "0721-772222" }, { name: "রাজশাহী মেডিকেল কলেজ হাসপাতাল", number: "+880721772428" }], "Rangamati": [{ name: "পুলিশ সুপার, রাঙ্গামাটি", number: "01320141200" }, { name: "ফায়ার সার্ভিস, রাঙ্গামাটি", number: "0351-63333" }, { name: "সদর হাসপাতাল, রাঙ্গামাটি", number: "+88035162211" }], "Rangpur": [{ name: "পুলিশ সুপার, রংপুর", number: "01320141400" }, { name: "ফায়ার সার্ভিস, রংপুর", number: "0521-62222" }, { name: "রংপুর মেডিকেল কলেজ হাসপাতাল", number: "+88052162121" }], "Satkhira": [{ name: "পুলিশ সুপার, সাতক্ষীরা", number: "01320145400" }, { name: "ফায়ার সার্ভিস, সাতক্ষীরা", number: "0471-63333" }, { name: "সদর হাসপাতাল, সাতক্ষীরা", number: "+88047163283" }], "Shariatpur": [{ name: "পুলিশ সুপার, শরীয়তপুর", number: "01320141700" }, { name: "ফায়ার সার্ভিস, শরীয়তপুর", number: "0601-61444" }, { name: "সদর হাসপাতাল, শরীয়তপুর", number: "+88060161453" }], "Sherpur": [{ name: "পুলিশ সুপার, শেরপুর", number: "01320141900" }, { name: "ফায়ার সার্ভিস, শেরপুর", number: "0931-61333" }, { name: "সদর হাসপাতাল, শেরপুর", number: "+88093161281" }], "Sirajganj": [{ name: "পুলিশ সুপার, সিরাজগঞ্জ", number: "01320142100" }, { name: "ফায়ার সার্ভিস, সিরাজগঞ্জ", number: "0751-62333" }, { name: "সদর হাসপাতাল, সিরাজগঞ্জ", number: "+88075162499" }], "Sunamganj": [{ name: "পুলিশ সুপার, সুনামগঞ্জ", number: "01320142300" }, { name: "ফায়ার সার্ভিস, সুনামগঞ্জ", number: "0871-61444" }, { name: "সদর হাসপাতাল, সুনামগঞ্জ", number: "+88087161300" }], "Sylhet": [{ name: "এসএমপি কন্ট্রোল রুম", number: "01320-099999" }, { name: "ফায়ার সার্ভিস, সিলেট", number: "0821-714444" }, { name: "এম.এ.জি. ওসমানী মেডিকেল কলেজ", number: "+880821716970" }], "Tangail": [{ name: "পুলিশ সুপার, টাঙ্গাইল", number: "01320142700" }, { name: "ফায়ার সার্ভিস, টাঙ্গাইল", number: "0921-62222" }, { name: "সদর হাসপাতাল, টাঙ্গাইল", number: "+88092163456" }], "Thakurgaon": [{ name: "পুলিশ সুপার, ঠাকুরগাঁও", number: "01320142900" }, { name: "ফায়ার সার্ভিস, ঠাকুরগাঁও", number: "0561-52444" }, { name: "সদর হাসপাতাল, ঠাকুরগাঁও", number: "+88056152026" }]
    };
    
    // নম্বরগুলো প্রদর্শন করার ফাংশন
    const displayNumbers = async (location) => {
        if (!numbersDisplay) return;
        numbersDisplay.innerHTML = '';
        
        // IndexedDB থেকে কাস্টম নম্বর লোড করুন
        const customNumbers = await idbGet('customEmergencyNumbers') || {};

        const defaultNumbers = emergencyNumbersData[location] || [];

        if (defaultNumbers.length === 0) {
            numbersDisplay.innerHTML = `<p class="text-gray-500 dark:text-gray-400 col-span-full text-center">এই জেলার জন্য কোনো নম্বর যোগ করা হয়নি।</p>`;
            return;
        }

        defaultNumbers.forEach((item, index) => {
            const itemKey = `${location}-${index}`;
            // যদি কাস্টম নম্বর থাকে, সেটি ব্যবহার করুন, নাহলে ডিফল্ট নম্বর ব্যবহার করুন
            const currentNumber = customNumbers[itemKey] || item.number;

            const card = document.createElement('div');
            card.className = 'emergency-card';
            card.innerHTML = `
                <div>
                    <h4 class="card-title">${item.name}</h4>
                    <p class="card-number" data-key="${itemKey}">${currentNumber}</p>
                </div>
                <div class="actions">
                     <button class="action-btn edit" title="নম্বর এডিট করুন">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/><path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5z"/></svg>
                    </button>
                    <button class="action-btn copy" title="নম্বর কপি করুন">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1zM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1z"/></svg>
                    </button>
                </div>
                <a href="tel:${currentNumber}" class="call-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.6 17.6 0 0 0 4.168 6.608 17.6 17.6 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.68.68 0 0 0-.58-.122l-2.19.547a1.75 1.75 0 0 1-1.657-.459L5.482 8.062a1.75 1.75 0 0 1-.46-1.657l.548-2.19a.68.68 0 0 0-.122-.58zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.68.68 0 0 0 .178.643l2.457 2.457a.68.68 0 0 0 .644.178l2.189-.547a1.75 1.75 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.6 18.6 0 0 1-7.01-4.42 18.6 18.6 0 0 1-4.42-7.009c-.363-1.03-.038-2.137.703-2.877z"/></svg>
                    কল করুন
                </a>
            `;
            numbersDisplay.appendChild(card);
            
            // Action বাটনগুলোর জন্য ইভেন্ট লিসেনার
            const numberEl = card.querySelector('.card-number');
            const editBtn = card.querySelector('.action-btn.edit');
            const copyBtn = card.querySelector('.action-btn.copy');
            const callBtn = card.querySelector('.call-button');

            editBtn.addEventListener('click', () => {
                numberEl.contentEditable = true;
                numberEl.focus();
                // টেক্সট সিলেক্ট করুন
                const range = document.createRange();
                range.selectNodeContents(numberEl);
                const sel = window.getSelection();
                sel.removeAllRanges();
                sel.addRange(range);
            });

            copyBtn.addEventListener('click', () => {
                navigator.clipboard.writeText(numberEl.textContent).then(() => {
                    showCustomAlert('নম্বর কপি করা হয়েছে!');
                }).catch(err => {
                    console.error('Copy failed', err);
                    showCustomAlert('কপি করতে ব্যর্থ হয়েছে।');
                });
            });
            
            numberEl.addEventListener('blur', async () => {
                numberEl.contentEditable = false;
                const newNumber = numberEl.textContent.trim();
                const key = numberEl.dataset.key;
                
                // কল বাটনের href আপডেট করুন
                callBtn.href = `tel:${newNumber}`;

                // IndexedDB তে সেভ করুন
                const allCustomNumbers = await idbGet('customEmergencyNumbers') || {};
                allCustomNumbers[key] = newNumber;
                await idbSet('customEmergencyNumbers', allCustomNumbers);
                showCustomAlert('নম্বর সেভ করা হয়েছে!');
            });
            
            // Enter চাপলে এডিট মোড থেকে বের হওয়ার জন্য
            numberEl.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    numberEl.blur();
                }
            });
        });
    };

    const populateDropdown = () => {
        if (!locationSelect) return;
        const currentSelection = locationSelect.value;
        locationSelect.innerHTML = '';

        const nationalOption = document.createElement('option');
        nationalOption.value = "national";
        nationalOption.textContent = districtNameMap["national"];
        locationSelect.appendChild(nationalOption);

        Object.keys(emergencyNumbersData)
            .filter(key => key !== "national")
            .sort((a, b) => districtNameMap[a].localeCompare(districtNameMap[b], 'bn'))
            .forEach(districtKey => {
                const option = document.createElement('option');
                option.value = districtKey;
                option.textContent = districtNameMap[districtKey];
                locationSelect.appendChild(option);
            });
        
        if (currentSelection) {
            locationSelect.value = currentSelection;
        }
    };
    
    if (locationSelect) {
        locationSelect.addEventListener('change', (e) => {
            const selectedLocation = e.target.value;
            displayNumbers(selectedLocation);
            localStorage.setItem('selectedEmergencyLocation', selectedLocation);
        });
    }
    
    // ইনিশিয়ালাইজেশন
    populateDropdown();
    
    const savedLocation = localStorage.getItem('selectedEmergencyLocation');
    
    if (locationSelect) {
        if (savedLocation && emergencyNumbersData[savedLocation]) {
            locationSelect.value = savedLocation;
        } else {
            locationSelect.value = 'Gaibandha';
            localStorage.setItem('selectedEmergencyLocation', 'Gaibandha');
        }
    }
    
    if (locationSelect) {
        displayNumbers(locationSelect.value);
    }
}
// ====================================================================
// END: EMERGENCY NUMBERS SCRIPT
// ====================================================================

// ====================================================================
// START: ZAKAT CALCULATOR SCRIPT
// ====================================================================
function initializeZakatCalculator() {
    // Input elements
    const silverPriceInput = document.getElementById('silverPrice');
    const goldPriceInput = document.getElementById('goldPrice');
    const goldAmountInput = document.getElementById('goldAmount');
    const silverAmountInput = document.getElementById('silverAmount');
    const cashAmountInput = document.getElementById('cashAmount');
    const businessAssetsInput = document.getElementById('businessAssets');
    const otherAssetsInput = document.getElementById('otherAssets');
    const debtAmountInput = document.getElementById('debtAmount');

    // Button and display elements
    const calculateBtn = document.getElementById('calculateZakatBtn');
    const nisabAmountSpan = document.getElementById('nisabAmount');
    const resultArea = document.getElementById('zakatResultArea');

    // Helper function to get number value from input
    const getValue = (el) => parseFloat(el.value) || 0;

    // Function to calculate and update Nisab
    const updateNisab = () => {
        const silverPrice = getValue(silverPriceInput);
        const nisabValue = silverPrice * 52.5;
        nisabAmountSpan.textContent = `৳ ${nisabValue.toLocaleString('bn-BD', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
        return nisabValue;
    };

    // Function to calculate Zakat
    const calculateZakat = () => {
        const nisab = updateNisab();

        // Get all asset values
        const goldPrice = getValue(goldPriceInput);
        const goldAmount = getValue(goldAmountInput);
        const silverPrice = getValue(silverPriceInput);
        const silverAmount = getValue(silverAmountInput);
        const cashAmount = getValue(cashAmountInput);
        const businessAssets = getValue(businessAssetsInput);
        const otherAssets = getValue(otherAssetsInput);
        
        // Get liability value
        const debtAmount = getValue(debtAmountInput);

        // Calculate total assets
        const totalGoldValue = goldAmount * goldPrice;
        const totalSilverValue = silverAmount * silverPrice;
        const totalAssets = totalGoldValue + totalSilverValue + cashAmount + businessAssets + otherAssets;

        // Calculate net zakatable assets
        const netAssets = totalAssets - debtAmount;

        // Display logic
        resultArea.style.display = 'block';
        resultArea.classList.remove('not-payable');
        
        if (netAssets < nisab) {
            resultArea.classList.add('not-payable');
            resultArea.innerHTML = `
                <h4>আপনার যাকাত প্রযোজ্য নয়</h4>
                <p>আপনার মোট যাকাতযোগ্য সম্পদ (৳ ${netAssets.toLocaleString('bn-BD')}) নিসাব পরিমাণ (৳ ${nisab.toLocaleString('bn-BD')}) অপেক্ষা কম।</p>
            `;
        } else {
            const zakatAmount = netAssets * 0.025;
            resultArea.innerHTML = `
                <h4>আপনার যাকাতের হিসাব</h4>
                <p>মোট সম্পদ: ৳ ${totalAssets.toLocaleString('bn-BD')}</p>
                <p>বাদযোগ্য দেনা: ৳ ${debtAmount.toLocaleString('bn-BD')}</p>
                <p>যাকাতযোগ্য নিট সম্পদ: ৳ ${netAssets.toLocaleString('bn-BD')}</p>
                <p class="final-zakat">আপনার প্রদেয় যাকাতের পরিমাণ: ৳ ${zakatAmount.toLocaleString('bn-BD', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</p>
            `;
        }
    };

    // Event Listeners
    if (silverPriceInput) {
        silverPriceInput.addEventListener('input', updateNisab);
    }
    
    if (calculateBtn) {
        calculateBtn.addEventListener('click', calculateZakat);
    }

    // Initial Nisab calculation on load
    updateNisab();
}

// Initialize when the tab is shown or page loads if it's active
document.addEventListener('DOMContentLoaded', () => {
    if (document.getElementById('zakatCalculatorContent')?.classList.contains('active')) {
        initializeZakatCalculator();
    }
    document.getElementById('zakatCalcTab')?.addEventListener('click', initializeZakatCalculator);
});
// ====================================================================
// END: ZAKAT CALCULATOR SCRIPT
// ====================================================================

// ====================================================================
// START: Animated News Ticker Script (Updated with Live News & Navigation)
// ====================================================================
document.addEventListener('DOMContentLoaded', () => {
const tickerContainer = document.getElementById('news-ticker-container');
const tickerTextElement = document.getElementById('news-ticker-text');
const prevBtn = document.getElementById('prev-news');
const nextBtn = document.getElementById('next-news');

if (!tickerContainer || !tickerTextElement || !prevBtn || !nextBtn) {
    console.error("News ticker elements not found.");
    return;
}

// --- সেটিংস এখানে ট্রু বা true; সেট করলে নিউজ হেডলাইন দেখাবে এবং ফলস বা false; লিখে দিলে নিচের মেসেজগুলো দেখাবে ---
const showNewsHeadlines = true;

const customMessages = [
    { title: "বাংলা টুলবক্স-এ আপনাকে স্বাগতম!", link: "#", source: "Bangla Toolbox" },
    { title: "আপনার টুলস ব্যবহারের অভিজ্ঞতা কেমন?", link: "#", source: "Bangla Toolbox" },
    { title: "যেকোনো মতামতের জন্য আমাদের সাথে যোগাযোগ করুন।", link: "https://bio.link/mdsifatbiolink", source: "Developer" }
];

let allMessages = [];
let messageIndex = 0;
let autoPlayInterval = null;
const animationInterval = 10000; // ১০ সেকেন্ড

/**
 * বিভিন্ন সংবাদপত্রের RSS ফিড থেকে গত ২ ঘণ্টার খবর নিয়ে আসে।
 * @returns {Promise<object[]|null>} - খবরগুলোর একটি অ্যারে অথবা ব্যর্থ হলে null।
 */
async function fetchNewsHeadlines() {
    const feeds = {
        'ঢাকা পোস্ট': 'https://www.dhakapost.com/rss',
        'বাংলাদেশ প্রতিদিন': 'https://www.bd-pratidin.com/rss.xml',
        'কালের কণ্ঠ': 'https://www.kalerkantho.com/rss.xml',
        'ইত্তেফাক': 'https://www.ittefaq.com.bd/rss.xml'
    };
    const twoHoursAgo = new Date(Date.now() - 2 * 60 * 60 * 1000);

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    try {
        const promises = Object.entries(feeds).map(([source, url]) =>
            fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`)
            .then(response => {
                if (!response.ok) throw new Error(`Failed to fetch from ${url}`);
                return response.text();
            })
            .then(xmlText => ({ source, xmlText }))
            .catch(err => {
                console.warn(`Could not fetch from ${source}: ${err.message}`);
                return null; // Return null on failure
            })
        );

        const results = await Promise.all(promises);
        let allHeadlines = [];
        const parser = new DOMParser();

        results.forEach(result => {
            if (result) {
                const { source, xmlText } = result;
                const doc = parser.parseFromString(xmlText, 'application/xml');
                const items = doc.querySelectorAll('item');

                items.forEach(item => {
                    const titleEl = item.querySelector('title');
                    const linkEl = item.querySelector('link');
                    const pubDateEl = item.querySelector('pubDate');

                    if (titleEl && linkEl && pubDateEl) {
                        try {
                            const pubDate = new Date(pubDateEl.textContent);
                            if (pubDate > twoHoursAgo) {
                                allHeadlines.push({
                                    title: titleEl.textContent.trim(),
                                    link: linkEl.textContent.trim(),
                                    source: source
                                });
                            }
                        } catch (e) {
                            console.error("Invalid date in feed:", pubDateEl.textContent);
                        }
                    }
                });
            }
        });
        
        if (allHeadlines.length === 0) {
            return [{ title: "গত ২ ঘণ্টায় কোনো নতুন খবর পাওয়া যায়নি। নেটওয়ার্ক যাচাই করে ব্রাউজার রিফ্রেশ করুন", link: "#", source: "System" }];
        }

        return shuffleArray([...new Set(allHeadlines.map(item => JSON.stringify(item)))].map(item => JSON.parse(item)));

    } catch (error) {
        console.error('All news feeds failed:', error);
        return null;
    }
}

/**
 * স্ক্রিনে বর্তমান শিরোনামটি টাইপিং অ্যানিমেশনসহ দেখানোর ফাংশন।
 * (পরিবর্তিত)
 */
function displayCurrentHeadline() {
    if (allMessages.length === 0) {
        tickerTextElement.textContent = "বার্তা লোড হচ্ছে...";
        return;
    }
    
    // ইনডেক্স যেন অ্যারের সীমার মধ্যে থাকে তা নিশ্চিত করা
    if (messageIndex < 0) messageIndex = allMessages.length - 1;
    if (messageIndex >= allMessages.length) messageIndex = 0;

    const currentMessage = allMessages[messageIndex];
    const displayText = ` ● ${currentMessage.title} - <span class="news-source">${currentMessage.source}</span>`;
    
    tickerTextElement.href = currentMessage.link;
    
    // অ্যানিমেশন এবং স্টাইল রিসেট করা
    tickerTextElement.style.animation = 'none';
    tickerTextElement.offsetHeight; // রি-ফ্লো ট্রিগার করা
    tickerTextElement.style.whiteSpace = 'nowrap'; // অ্যানিমেশনের জন্য nowrap সেট করা
    
    const fullContent = document.createElement('div');
    fullContent.innerHTML = displayText;
    const textLength = fullContent.textContent.length;
    
    const duration = Math.max(3.5, textLength * 0.1);

    tickerTextElement.innerHTML = displayText;
    tickerTextElement.style.width = '0'; // টাইপিং ইফেক্টের জন্য প্রস্থ শূন্য থেকে শুরু হবে
    
    // নতুন অ্যানিমেশন সেট করা (blink-caret ছাড়া)
    tickerTextElement.style.animation = `typing ${duration}s steps(${textLength}, end)`;
    tickerTextElement.style.animationFillMode = 'forwards';

    // অ্যানিমেশন শেষ হলে লেখা র‍্যাপ করার জন্য ইভেন্ট লিসেনার
    const handleAnimationEnd = () => {
        tickerTextElement.style.whiteSpace = 'normal'; // র‍্যাপ করার অনুমতি দেওয়া
    };
    
    // { once: true } ব্যবহার করা হয়েছে যাতে ইভেন্টটি একবারই রান করে
    tickerTextElement.addEventListener('animationend', handleAnimationEnd, { once: true });
}


function showNextHeadline() {
    messageIndex++;
    displayCurrentHeadline();
}

function showPrevHeadline() {
    messageIndex--;
    displayCurrentHeadline();
}

function startAutoPlay() {
    stopAutoPlay();
    autoPlayInterval = setInterval(showNextHeadline, animationInterval);
}

function stopAutoPlay() {
    clearInterval(autoPlayInterval);
}

/**
 * টিকারটি চালু করার মূল ফাংশন।
 */
async function initializeTicker() {
    if (showNewsHeadlines) {
        const news = await fetchNewsHeadlines();
        if (news && news.length > 0) {
            allMessages = news;
        } else {
            allMessages = customMessages;
        }
    } else {
        allMessages = customMessages;
    }
    
    displayCurrentHeadline();
    startAutoPlay();
}

// ইভেন্ট লিসেনার
nextBtn.addEventListener('click', () => {
    showNextHeadline();
    startAutoPlay();
});

prevBtn.addEventListener('click', () => {
    showPrevHeadline();
    startAutoPlay();
});

tickerContainer.addEventListener('mouseenter', stopAutoPlay);
tickerContainer.addEventListener('mouseleave', startAutoPlay);

// টিকার চালু করা হচ্ছে
initializeTicker();

// ব্যাকগ্রাউন্ডে খবর আপডেট (প্রতি ৫ মিনিটে)
setInterval(async () => {
    if(showNewsHeadlines) {
        console.log("Background news update...");
        const news = await fetchNewsHeadlines();
        if (news && news.length > 0) {
            const currentLink = allMessages[messageIndex]?.link;
            const newIndex = news.findIndex(item => item.link === currentLink);

            allMessages = news;
            if (newIndex !== -1) {
                messageIndex = newIndex;
            }
        }
    }
}, 5 * 60 * 1000);

});
// ====================================================================
// END: Animated News Ticker Script
// ====================================================================



//এই কমেন্টের আগেও নতুন ট্যাব এর স্ক্রিপ্ট বসানো যাবে বা বসাতে হয় ।
        window.onload = function() {
            const preloader = document.getElementById('preloader');
            const mainContainer = document.querySelector('.main-container');

            if (preloader) {
                // প্রি-লোডার লুকানোর জন্য ক্লাস যোগ করুন
                preloader.classList.add('preloader-hidden');

                // প্রি-লোডারের ট্রানজিশন (fade-out) শেষ হওয়ার জন্য অপেক্ষা করুন
                preloader.addEventListener('transitionend', () => {
                    if (mainContainer) {
                        // মূল কন্টেন্ট দৃশ্যমান করুন
                        mainContainer.style.visibility = 'visible';
                        // একটি সুন্দর ফেড-ইন অ্যানিমেশন প্রয়োগ করুন (ডিউরেশন এখানে পরিবর্তন করুন)
                        mainContainer.style.animation = 'fadeInContent 2s ease-out forwards'; // 0.75s থেকে 2s করা হয়েছে
                    }
                }, {
                    once: true
                }); // ইভেন্টটি কেবল একবার চালানোর জন্য
            } else {
                // যদি কোনো কারণে প্রি-লোডার না থাকে, তাহলে সরাসরি কন্টেন্ট দেখান
                if (mainContainer) {
                    mainContainer.style.visibility = 'visible';
                    mainContainer.style.opacity = '1';
                }
            }
        };

    </script>
</body>
</html>
